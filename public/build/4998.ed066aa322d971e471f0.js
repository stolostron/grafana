"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4998],{48241:(E,p,i)=>{i.d(p,{i:()=>e});var r=i(2543),t=i.n(r),a=i(47232),s=i(11261);const e=(h,f=!1)=>{const w=h.values;switch(h.type){case s.PU.number:return N(w,f);case s.PU.string:return R(w,f);case s.PU.boolean:return L(w,f);case s.PU.time:return typeof h.values[0]=="number"?b(w,f):F(w,f);default:return U(f)}},l=(h,f)=>{if(!h||!f)return v(h,f);if((0,r.isNumber)(h)&&(0,r.isNumber)(f))return c(h,f);if((0,a.u8)(h)&&(0,a.u8)(f)){if((0,a.KQ)(h).isBefore(f))return-1;if((0,a.KQ)(f).isBefore(h))return 1}return 0},c=(h,f)=>h-f,n=(h,f)=>!h||!f?v(h,f):h.localeCompare(f),g=(h,f)=>v(h,f),v=(h,f)=>!h&&f?1:h&&!f?-1:0,b=(h,f)=>{let w=f?-1:1;return(x,O)=>w*(h[x]-h[O])},F=(h,f)=>(w,x)=>{const O=h[w],M=h[x];return f?l(M,O):l(O,M)},L=(h,f)=>(w,x)=>{const O=h[w],M=h[x];return f?g(M,O):g(O,M)},N=(h,f)=>(w,x)=>{const O=h[w],M=h[x];return f?c(M,O):c(O,M)},R=(h,f)=>(w,x)=>{const O=h[w],M=h[x];return f?n(M,O):n(O,M)},U=h=>(f,w)=>h?c(w,f):c(f,w)},98358:(E,p,i)=>{i.d(p,{c:()=>t});var r=i(52622);function t(a,s,e){switch((a==null||e==null)&&(a==null&&(a="null"),e==null&&(e="null"),(s===r.zT.GTE||s===r.zT.LTE)&&(s=r.zT.EQ)),s){case r.zT.EQ:return`${a}`==`${e}`;case r.zT.NEQ:return`${a}`!=`${e}`;case r.zT.GT:return a>e;case r.zT.GTE:return a>=e;case r.zT.LT:return a<e;case r.zT.LTE:return a<=e;default:return!1}}},7029:(E,p,i)=>{i.d(p,{_:()=>c});var r=i(11261),t=i(1173);const a={id:t.Ct.byType,name:"Field Type",description:"match based on the field type",defaultOptions:r.PU.number,get:n=>(g,v,b)=>n===g.type,getOptionsDisplayText:n=>`Field type: ${n}`},s={id:t.Ct.byTypes,name:"Field Type",description:"match based on the field types",defaultOptions:new Set,get:n=>(g,v,b)=>n.has(g.type),getOptionsDisplayText:n=>`Field types: ${[...n].join(" | ")}`},e={id:t.Ct.numeric,name:"Numeric Fields",description:"Fields with type number",get:()=>a.get(r.PU.number),getOptionsDisplayText:()=>"Numeric Fields"},l={id:t.Ct.time,name:"Time Fields",description:"Fields with type time",get:()=>a.get(r.PU.time),getOptionsDisplayText:()=>"Time Fields"};function c(){return[a,s,e,l]}},24814:(E,p,i)=>{i.d(p,{u:()=>l});var r=i(52622),t=i(75059),a=i(98358),s=i(1173);function e(c){return c===t.gy.allIsNull||c===t.gy.allIsZero}const l={id:s.Ct.byValue,name:"By value (reducer)",description:"Reduce a field to a single value and test for inclusion",defaultOptions:{reducer:t.gy.allIsZero,op:r.zT.GTE,value:0},get:c=>{if(!c||!c.reducer)return()=>!1;let{reducer:n,op:g,value:v}=c;const b=e(n);return g||(g=r.zT.EQ),(F,L,N)=>{const R=(0,t.Nw)({field:F,reducers:[n]})[n];return b?!!R:(0,a.c)(R,g,v)}},getOptionsDisplayText:c=>`By value (${c.reducer})`}},1173:(E,p,i)=>{i.d(p,{Ct:()=>t,Js:()=>s,cV:()=>r,jR:()=>a});var r=(e=>(e.anyMatch="anyMatch",e.allMatch="allMatch",e.invertMatch="invertMatch",e.alwaysMatch="alwaysMatch",e.neverMatch="neverMatch",e))(r||{}),t=(e=>(e.numeric="numeric",e.time="time",e.first="first",e.firstTimeField="firstTimeField",e.byType="byType",e.byTypes="byTypes",e.byName="byName",e.byNames="byNames",e.byRegexp="byRegexp",e.byRegexpOrNames="byRegexpOrNames",e.byFrameRefID="byFrameRefID",e.byValue="byValue",e))(t||{}),a=(e=>(e.byName="byName",e.byRefId="byRefId",e.byIndex="byIndex",e))(a||{}),s=(e=>(e.regex="regex",e.isNull="isNull",e.isNotNull="isNotNull",e.greater="greater",e.greaterOrEqual="greaterOrEqual",e.lower="lower",e.lowerOrEqual="lowerOrEqual",e.equal="equal",e.notEqual="notEqual",e.substring="substring",e.notSubstring="notSubstring",e.between="between",e))(s||{})},8549:(E,p,i)=>{i.d(p,{i:()=>s});var r=i(54479),t=i(1173);const a={id:t.jR.byRefId,name:"Query refId",description:"match the refId",defaultOptions:"A",get:e=>{const l=(0,r.dO)(e);return c=>l.test(c.refId||"")},getOptionsDisplayText:e=>`RefID: ${e}`};function s(){return[a]}},83855:(E,p,i)=>{i.d(p,{W:()=>e});var r=i(11261),t=i(1173);const a={id:t.Ct.first,name:"First Field",description:"The first field in the frame",get:l=>(c,n,g)=>c===n.fields[0],getOptionsDisplayText:()=>"First field"},s={id:t.Ct.firstTimeField,name:"First time field",description:"The first field of type time in a frame",get:l=>(c,n,g)=>c.type===r.PU.time&&c===n.fields.find(v=>v.type===r.PU.time),getOptionsDisplayText:()=>"First time field"};function e(){return[a,s]}},60005:(E,p,i)=>{i.d(p,{d:()=>s});var r=i(1173);const t={id:r.Js.equal,name:"Is equal",description:"Match where value for given field is equal to options value.",get:e=>(l,c)=>c.values[l]==e.value,getOptionsDisplayText:()=>"Matches all rows where field is null.",isApplicable:()=>!0,getDefaultOptions:()=>({value:""})},a={id:r.Js.notEqual,name:"Is not equal",description:"Match where value for given field is not equal to options value.",get:e=>(l,c)=>c.values[l]!=e.value,getOptionsDisplayText:()=>"Matches all rows where field is not null.",isApplicable:()=>!0,getDefaultOptions:()=>({value:""})},s=()=>[t,a]},21262:(E,p,i)=>{i.d(p,{_:()=>s});var r=i(1173);const t={id:r.Js.isNull,name:"Is null",description:"Match where value for given field is null.",get:()=>(e,l)=>l.values[e]==null,getOptionsDisplayText:()=>"Matches all rows where field is null.",isApplicable:()=>!0,getDefaultOptions:()=>({})},a={id:r.Js.isNotNull,name:"Is not null",description:"Match where value for given field is not null.",get:()=>(e,l)=>l.values[e]!=null,getOptionsDisplayText:()=>"Matches all rows where field is not null.",isApplicable:()=>!0,getDefaultOptions:()=>({})},s=()=>[t,a]},70218:(E,p,i)=>{i.d(p,{E:()=>c});var r=i(11261),t=i(1173);const a={id:t.Js.greater,name:"Is greater",description:"Match when field value is greater than option.",get:n=>(g,v)=>{const b=v.values[g];return isNaN(b)?!1:b>n.value},getOptionsDisplayText:n=>`Matches all rows where field value is greater than: ${n.value}.`,isApplicable:n=>n.type===r.PU.number,getDefaultOptions:()=>({value:0})},s={id:t.Js.greaterOrEqual,name:"Is greater or equal",description:"Match when field value is greater than or equal to option.",get:n=>(g,v)=>{const b=v.values[g];return isNaN(b)?!1:b>=n.value},getOptionsDisplayText:n=>`Matches all rows where field value is greater than or equal to: ${n.value}.`,isApplicable:n=>n.type===r.PU.number,getDefaultOptions:()=>({value:0})},e={id:t.Js.lower,name:"Is lower",description:"Match when field value is lower than option.",get:n=>(g,v)=>{const b=v.values[g];return isNaN(b)?!1:b<n.value},getOptionsDisplayText:n=>`Matches all rows where field value is lower than: ${n.value}.`,isApplicable:n=>n.type===r.PU.number,getDefaultOptions:()=>({value:0})},l={id:t.Js.lowerOrEqual,name:"Is lower or equal",description:"Match when field value is lower or equal than option.",get:n=>(g,v)=>{const b=v.values[g];return isNaN(b)?!1:b<=n.value},getOptionsDisplayText:n=>`Matches all rows where field value is lower or equal than: ${n.value}.`,isApplicable:n=>n.type===r.PU.number,getDefaultOptions:()=>({value:0})},c=()=>[a,s,e,l]},55008:(E,p,i)=>{i.d(p,{G:()=>s});var r=i(11261),t=i(1173);const a={id:t.Js.between,name:"Is between",description:"Match when field value is between given option values.",get:e=>(l,c)=>{const n=c.values[l];return isNaN(n)?!1:n>e.from&&n<e.to},getOptionsDisplayText:e=>`Matches all rows where field value is between ${e.from} and ${e.to}.`,isApplicable:e=>e.type===r.PU.number,getDefaultOptions:()=>({from:0,to:100})},s=()=>[a]},16378:(E,p,i)=>{i.d(p,{z:()=>a});var r=i(1173);const t={id:r.Js.regex,name:"Regex",description:"Match when field value is matching regex.",get:s=>{const e=new RegExp(s.value);return(l,c)=>{const n=c.values[l];return e.test(n)}},getOptionsDisplayText:s=>`Matches all rows where field value is matching regex: ${s.value}`,isApplicable:()=>!0,getDefaultOptions:()=>({value:".*"})},a=()=>[t]},75754:(E,p,i)=>{i.d(p,{m:()=>e});var r=i(11261),t=i(1173);const a={id:t.Js.substring,name:"Contains substring",description:"Match where value for given field is a substring to options value.",get:l=>(c,n)=>{const g=n.values[c];return g&&l.value&&typeof g=="string"&&g.toLowerCase().includes(l.value.toLowerCase())||l.value===""},getOptionsDisplayText:()=>"Matches all rows where field is similar to the value.",isApplicable:l=>l.type===r.PU.string,getDefaultOptions:()=>({value:""})},s={id:t.Js.notSubstring,name:"Does not contain substring",description:"Match where value for given field is not a substring to options value.",get:l=>(c,n)=>{const g=n.values[c];return typeof g=="string"&&l.value&&g&&l.value!==""&&!g.toLowerCase().includes(l.value.toLowerCase())},getOptionsDisplayText:()=>"Matches all rows where field is not similar to the value.",isApplicable:l=>l.type===r.PU.string,getDefaultOptions:()=>({value:""})},e=()=>[a,s]},18282:(E,p,i)=>{i.d(p,{F:()=>r});var r=(t=>(t.append="append",t.reduce="reduce",t.order="order",t.organize="organize",t.rename="rename",t.calculateField="calculateField",t.seriesToColumns="seriesToColumns",t.seriesToRows="seriesToRows",t.merge="merge",t.concatenate="concatenate",t.labelsToFields="labelsToFields",t.filterFields="filterFields",t.filterFieldsByName="filterFieldsByName",t.filterFrames="filterFrames",t.filterByRefId="filterByRefId",t.renameByRegex="renameByRegex",t.filterByValue="filterByValue",t.noop="noop",t.ensureColumns="ensureColumns",t.groupBy="groupBy",t.sortBy="sortBy",t.histogram="histogram",t.configFromData="configFromData",t.rowsToFields="rowsToFields",t.prepareTimeSeries="prepareTimeSeries",t.convertFieldType="convertFieldType",t.fieldLookup="fieldLookup",t.heatmap="heatmap",t.spatial="spatial",t.joinByField="joinByField",t.joinByLabels="joinByLabels",t.extractFields="extractFields",t.groupingToMatrix="groupingToMatrix",t.limit="limit",t.partitionByValues="partitionByValues",t.timeSeriesTable="timeSeriesTable",t.formatTime="formatTime",t.formatString="formatString",t.regression="regression",t.groupToNestedTable="groupToNestedTable",t))(r||{})},83077:(E,p,i)=>{i.d(p,{O:()=>t});var r=i(43429);class t{constructor(s){this.init=s,this.ordered=[],this.byId=new Map,this.initialized=!1,this.setInit=e=>{if(this.initialized)throw new Error("Registry already initialized");this.init=e},this.init=s}getIfExists(s){if(this.initialized||this.initialize(),s)return this.byId.get(s)}initialize(){if(this.init)for(const s of this.init())this.register(s);this.sort(),this.initialized=!0}get(s){const e=this.getIfExists(s);if(!e)throw new Error(`"${s}" not found in: ${this.list().map(l=>l.id)}`);return e}selectOptions(s,e){this.initialized||this.initialize();const l={options:[],current:[]},c={};if(s)for(const n of s)c[n]={};for(const n of this.ordered){if(n.excludeFromPicker||e&&!e(n))continue;const g={value:n.id,label:n.name,description:n.description};n.state===r.pn.alpha&&(g.label+=" (alpha)"),l.options.push(g),c[n.id]&&(c[n.id]=g)}return s&&(l.current=Object.values(c)),l}list(s){if(this.initialized||this.initialize(),s){const e=[];for(const l of s){const c=this.getIfExists(l);c&&e.push(c)}return e}return this.ordered}isEmpty(){return this.initialized||this.initialize(),this.ordered.length===0}register(s){if(this.byId.has(s.id))throw new Error("Duplicate Key:"+s.id);if(this.byId.set(s.id,s),this.ordered.push(s),s.aliasIds)for(const e of s.aliasIds)this.byId.has(e)||this.byId.set(e,s);this.initialized&&this.sort()}sort(){}}},43659:(E,p,i)=>{i.d(p,{j:()=>r});function r(t,a){const s=/\{\{\s*(.+?)\s*\}\}/g;return t.replace(s,(e,l)=>a[l]?a[l]:l)}},12091:(E,p,i)=>{i.d(p,{u:()=>r});function r(t){const a=t||{};if(!a.message){if(typeof t=="string")return{message:t};let s="Query error";a.message?s=a.message:a.data&&a.data.message&&a.data?.message!=="Query data error"?s=a.data.message:a?.data?.message==="Query data error"&&a?.data?.error||a.data&&a.data.error?s=a.data.error:a.status&&(s=`Query error: ${a.status} ${a.statusText}`),a.message=s}return a}},97527:(E,p,i)=>{i.d(p,{w:()=>j});var r=i(35392),t=i(1005),a=i(96222),s=i(49426),e=i(55004),l=i(9631),c=i(88483),n=i(39741),g=i(81160),v=i(39070),b=i(12091),F=i(47118);const L=S=>o=>new c.c(u=>{let d=[],m=!0;const _=()=>{u.next(d),d=[]},T=S.subscribe({next:C=>{m=C,m&&d.length&&_()}}),A=o.subscribe({next(C){m?d.length?_():u.next([C]):d.push(C)},error(C){u.error(C)},complete(){u.complete()}});return()=>{A.unsubscribe(),T.unsubscribe()}});var N=(S=>(S[S.Error=0]="Error",S[S.NewValuesSameSchema=1]="NewValuesSameSchema",S[S.ChangedSchema=2]="ChangedSchema",S))(N||{});const R=S=>({values:S.reduce((o,{values:u})=>{for(let d=0;d<u.length;d++){o[d]||(o[d]=[]);for(let m=0;m<u[d].length;m++)o[d].push(u[d][m])}return o},[]),type:1}),U=(S,o)=>S.filter(u=>u.type===o);class h{constructor(o){this.deps=o,this.stream=new n.m(1),this.shutdown=()=>{this.stream.complete(),this.liveEventsSubscription.unsubscribe(),this.deps.onShutdown()},this.shutdownIfNoSubscribers=()=>{this.stream.observed||this.shutdown()},this.onError=u=>{console.log("LiveQuery [error]",{err:u},this.deps.channelId),this.stream.next({type:0,error:(0,b.u)(u)}),this.shutdown()},this.onComplete=()=>{console.log("LiveQuery [complete]",this.deps.channelId),this.shutdown()},this.onNext=u=>{if((0,e.Z7)(u)){this.process(u.message);return}const d=(0,e.ew)(u);if(d&&u.error){const m=(0,b.u)(u.error);this.stream.next({type:0,error:{...m,message:`Streaming channel error: ${m.message}`}})}d&&(u.state===e.ZF.Connected||u.state===e.ZF.Pending)&&u.message&&this.process(u.message)},this.process=u=>{this.frameBuffer.push(u).schemaChanged?this.stream.next({type:2}):this.stream.next({type:1,values:this.frameBuffer.getValuesFromLastPacket()})},this.resizeBuffer=u=>{u&&this.frameBuffer.needsResizing(u)&&this.frameBuffer.resize(u)},this.prepareInternalStreamForNewSubscription=u=>{!this.frameBuffer.hasAtLeastOnePacket()&&u.frame&&this.process(u.frame)},this.clearShutdownTimeout=()=>{this.shutdownTimeoutId&&(clearTimeout(this.shutdownTimeoutId),this.shutdownTimeoutId=void 0)},this.get=(u,d)=>{this.clearShutdownTimeout();const m=(0,l.m8)(u.buffer);this.resizeBuffer(m),this.prepareInternalStreamForNewSubscription(u);const _=u?.buffer?.action===l.Kh.Replace,T=u.filter?.fields,C=T?.length?({name:y})=>T.includes(y):void 0;let W;const K=(y,P)=>(W=C?this.frameBuffer.getMatchingFieldIndexes(C):void 0,_?P?{key:d,state:v.Gu.Error,data:[{type:F._w.FullFrame,frame:this.frameBuffer.serialize(C,m,{maxLength:0})}],error:P}:y.length?{key:d,state:v.Gu.Streaming,data:[{type:F._w.FullFrame,frame:this.frameBuffer.serialize(C,m,{maxLength:this.frameBuffer.packetInfo.length})}],error:P}:(console.warn(`expected to find at least one non error message ${y.map(({type:B})=>B)}`),{key:d,state:v.Gu.Streaming,data:[{type:F._w.FullFrame,frame:this.frameBuffer.serialize(C,m,{maxLength:0})}],error:P}):{key:d,state:P?v.Gu.Error:v.Gu.Streaming,data:[{type:F._w.FullFrame,frame:this.frameBuffer.serialize(C,m)}],error:P}),Q=y=>{const P=y.length?y[y.length-1]:void 0,B=_&&P?P.values:R(y).values,z=W?B.filter((Z,I)=>W?.includes(I)):B;return{key:d,state:v.Gu.Streaming,data:[{type:F._w.NewValuesSameSchema,values:z}]}};let V=!0;const J=this.stream.pipe(L(this.deps.subscriberReadiness),(0,g.T)((y,P)=>{const B=U(y,0),z=B.length?B[B.length-1].error:void 0;if(V)return V=!1,K(y,z);if(B.length)return K(y,z);if(y.some($=>$.type===2))return K(y,void 0);const I=U(y,1);return I.length!==y.length&&console.warn(`unsupported message type ${y.map(({type:$})=>$)}`),Q(I)}));return new c.c(y=>{const P=J.subscribe({next:B=>{y.next(B)},error:B=>{y.error(B)},complete:()=>{y.complete()}});return()=>{P.unsubscribe(),this.stream.observed||(this.clearShutdownTimeout(),this.shutdownTimeoutId=setTimeout(this.shutdownIfNoSubscribers,this.deps.shutdownDelayInMs))}})},this.frameBuffer=l.k9.empty(o.defaultStreamingFrameOptions),this.liveEventsSubscription=o.liveEventsObservable.subscribe({error:this.onError,complete:this.onComplete,next:this.onNext})}}var f=i(13752);class w{constructor(o,u){this.opened=Date.now(),this.stream=new f.B,this.disconnectIfNoListeners=()=>{this.stream.observers.length===0&&this.disconnect()},this.id=o,this.addr=u,this.currentStatus={type:e.o4.Status,id:o,timestamp:this.opened,state:e.ZF.Pending},(0,e.aj)(u)||(this.currentStatus.state=e.ZF.Invalid,this.currentStatus.error="invalid channel address")}initalize(){if(this.initalized)throw new Error("Channel already initalized: "+this.id);this.initalized=!0,this.subscription.on("publication",o=>{try{o.data&&(o.data.schema&&(this.lastMessageWithSchema=o.data),this.stream.next({type:e.o4.Message,message:o.data})),this.currentStatus.error&&(this.currentStatus.timestamp=Date.now(),delete this.currentStatus.error,this.sendStatus())}catch(u){console.log("publish error",this.addr,u),this.currentStatus.error=u,this.currentStatus.timestamp=Date.now(),this.sendStatus()}}).on("error",o=>{this.currentStatus.timestamp=Date.now(),this.currentStatus.error=o.error.message,this.sendStatus()}).on("subscribed",o=>{this.currentStatus.timestamp=Date.now(),this.currentStatus.state=e.ZF.Connected,delete this.currentStatus.error,o.data?.schema&&(this.lastMessageWithSchema=o.data),this.sendStatus(o.data)}).on("unsubscribed",()=>{this.currentStatus.timestamp=Date.now(),this.currentStatus.state=e.ZF.Disconnected,this.sendStatus()}).on("subscribing",()=>{this.currentStatus.timestamp=Date.now(),this.currentStatus.state=e.ZF.Connecting,this.sendStatus()}).on("join",o=>{this.stream.next({type:e.o4.Join,user:o.info.user})}).on("leave",o=>{this.stream.next({type:e.o4.Leave,user:o.info.user})})}sendStatus(o){const u={...this.currentStatus};o&&(u.message=o),this.stream.next(u)}getStream(){return new c.c(o=>{const u={...this.currentStatus};this.lastMessageWithSchema?.schema&&(u.message={schema:this.lastMessageWithSchema?.schema}),o.next({...this.currentStatus,message:this.lastMessageWithSchema});const d=this.stream.subscribe(o);return()=>{d.unsubscribe(),this.stream.observers.length===0&&setTimeout(this.disconnectIfNoListeners,250)}})}async getPresence(){return this.subscription?this.subscription.presence().then(o=>({users:Object.keys(o.clients)})):Promise.reject("not subscribed")}disconnect(){this.currentStatus.state=e.ZF.Shutdown,this.currentStatus.timestamp=Date.now(),this.subscription&&(this.subscription.unsubscribe(),this.subscription.removeAllListeners(),this.subscription=void 0),this.stream.complete(),this.stream.next({...this.currentStatus}),this.stream.complete(),this.shutdownCallback&&this.shutdownCallback()}shutdownWithError(o){this.currentStatus.error=o,this.sendStatus(),this.disconnect()}}function x(S,o,u){return{id:o,opened:Date.now(),addr:u,getStream:()=>of({type:LiveChannelEventType.Status,id:o,timestamp:Date.now(),state:LiveChannelConnectionState.Invalid,error:S}),disconnect:()=>{}}}const O={maxLength:100,maxDelta:1/0,action:l.Kh.Append},M=5e3;class j{constructor(o){this.deps=o,this.open=new Map,this.liveDataStreamByChannelId={},this.onConnect=m=>{this.connectionState.next(!0)},this.onDisconnect=m=>{this.connectionState.next(!1)},this.onServerSideMessage=m=>{console.log("Publication from server-side channel",m)},this.getConnectionState=()=>this.connectionState.asObservable(),this.getStream=m=>this.getChannel(m).getStream(),this.createSubscriptionKey=m=>m.key??`xstr/${D++}`,this.getLiveDataStream=m=>{const _=(0,e.Qp)(m.addr),T=this.liveDataStreamByChannelId[_];if(T)return T;const A=this.getChannel(m.addr);return this.liveDataStreamByChannelId[_]=new h({channelId:_,onShutdown:()=>{delete this.liveDataStreamByChannelId[_]},liveEventsObservable:A.getStream(),subscriberReadiness:this.dataStreamSubscriberReadiness,defaultStreamingFrameOptions:O,shutdownDelayInMs:M}),this.liveDataStreamByChannelId[_]},this.getDataStream=m=>{const _=this.createSubscriptionKey(m);return this.getLiveDataStream(m).get(m,_)},this.getQueryData=async m=>(this.centrifuge.state!==r.Uw.Connected&&await this.connectionBlocker,this.centrifuge.rpc("grafana.query",m.body)),this.getPresence=m=>this.getChannel(m).getPresence(),this.dataStreamSubscriberReadiness=o.dataStreamSubscriberReadiness.pipe((0,t.u)(),(0,a.Z)(!0));let u=`${o.appUrl.replace(/^http/,"ws")}/api/live/ws`;const d=o.grafanaAuthToken;d!==null&&d!==""&&(u+="?auth_token="+d),this.centrifuge=new r.Ft(u,{timeout:3e4}),o.liveEnabled&&o.orgRole!==""&&this.centrifuge.connect(),this.connectionState=new s.t(this.centrifuge.state===r.Uw.Connected),this.connectionBlocker=new Promise(m=>{if(this.centrifuge.state===r.Uw.Connected)return m();const _=()=>{m(),this.centrifuge.removeListener("connected",_)};this.centrifuge.addListener("connected",_)}),this.centrifuge.on("connected",this.onConnect),this.centrifuge.on("connecting",this.onDisconnect),this.centrifuge.on("disconnected",this.onDisconnect),this.centrifuge.on("publication",this.onServerSideMessage)}getChannel(o){const u=`${this.deps.orgId}/${o.scope}/${o.namespace}/${o.path}`;let d=this.open.get(u);return d!=null||(d=new w(u,o),d.currentStatus.state===e.ZF.Invalid)||(d.shutdownCallback=()=>{this.open.delete(u),this.centrifuge.removeSubscription(this.centrifuge.getSubscription(u))},this.open.set(u,d),this.initChannel(d).catch(m=>{d&&(d.currentStatus.state=e.ZF.Invalid,d.shutdownWithError(m)),this.open.delete(u)})),d}async initChannel(o){this.centrifuge.state!==r.Uw.Connected&&await this.connectionBlocker;const u=this.centrifuge.newSubscription(o.id,{data:o.addr.data});o.subscription=u,o.initalize(),u.subscribe()}}let D=0},99355:(E,p,i)=>{var r=i(14590),t=i(75508);const a={canHandle(s){return!!(s&&s instanceof t.vU)},serialize(s){const e=r.BX(s),{port1:l,port2:c}=new MessageChannel;return r.p(e,l),[c,[c]]},deserialize(s){return s.start(),r.LV(s)}};r.J3.set("SubscriberHandler",a)}}]);

//# sourceMappingURL=4998.ed066aa322d971e471f0.js.map