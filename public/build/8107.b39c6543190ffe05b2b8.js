"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8107],{28107:(L,l,s)=>{s.r(l),s.d(l,{ChangePasswordPage:()=>y,default:()=>N});var a=s(96540),r=s(71468),w=s(4392),c=s(67608),f=s(88575),E=s(67061),h=s(55852),A=s(72235),p=s(35043),P=s(2913),o=s(8484),t=s(78361);const U=({user:i,onChangePassword:d,isSaving:e})=>{const[n,F]=(0,a.useState)(!1),[T,b]=(0,a.useState)(!0),{disableLoginForm:x}=P.Ay,O=i.authLabels?.length&&i.authLabels[0];return O==="LDAP"||O==="Auth Proxy"?a.createElement("p",null,a.createElement(o.x6,{i18nKey:"profile.change-password.ldap-auth-proxy-message"},"You cannot change password when signed in with LDAP or auth proxy.")):O&&x?a.createElement("p",null,a.createElement(o.x6,{i18nKey:"profile.change-password.cannot-change-password-message"},"Password cannot be changed here.")):a.createElement(A.l,{onSubmit:d,maxWidth:400},({register:D,errors:u,getValues:I,watch:B})=>{const K=B("newPassword");return a.createElement(a.Fragment,null,a.createElement(f.D,{label:(0,o.t)("profile.change-password.old-password-label","Old password"),invalid:!!u.oldPassword,error:u?.oldPassword?.message},a.createElement(t.s,{id:"current-password",autoComplete:"current-password",...D("oldPassword",{required:(0,o.t)("profile.change-password.old-password-required","Old password is required")})})),a.createElement(f.D,{label:(0,o.t)("profile.change-password.new-password-label","New password"),invalid:!!u.newPassword,error:u?.newPassword?.message},a.createElement(t.s,{id:"new-password",autoComplete:"new-password",onFocus:()=>F(!0),...D("newPassword",{onBlur:()=>b(!1),required:(0,o.t)("profile.change-password.new-password-required","New password is required"),validate:{strongPasswordValidationRegister:p.DP,confirm:g=>g===I().confirmNew||(0,o.t)("profile.change-password.passwords-must-match","Passwords must match"),old:g=>g!==I().oldPassword||(0,o.t)("profile.change-password.new-password-same-as-old","New password can't be the same as the old one.")}})})),n&&a.createElement(p.zJ,{pristine:T,password:K,strongPasswordValidations:p.NQ}),a.createElement(f.D,{label:(0,o.t)("profile.change-password.confirm-password-label","Confirm password"),invalid:!!u.confirmNew,error:u?.confirmNew?.message},a.createElement(t.s,{id:"confirm-new-password",autoComplete:"new-password",...D("confirmNew",{required:(0,o.t)("profile.change-password.confirm-password-required","New password confirmation is required"),validate:g=>g===I().newPassword||(0,o.t)("profile.change-password.passwords-must-match","Passwords must match")})})),a.createElement(E.B,null,a.createElement(h.$n,{variant:"primary",disabled:e,type:"submit"},a.createElement(o.x6,{i18nKey:"profile.change-password.change-password-button"},"Change Password")),a.createElement(h.z9,{variant:"secondary",href:`${P.Ay.appSubUrl}/profile`,fill:"outline"},a.createElement(o.x6,{i18nKey:"profile.change-password.cancel-button"},"Cancel"))))})};var v=s(84969);function m(i){const d=i.user,{isUpdating:e,user:n}=d;return{isUpdating:e,user:n}}const S={loadUser:v.YW,changePassword:v.ec},C=(0,r.connect)(m,S);function y({loadUser:i,isUpdating:d,user:e,changePassword:n}){return(0,w.A)(()=>i()),a.createElement(c.Y,{navId:"profile/password"},a.createElement(c.Y.Contents,{isLoading:!e},e?a.createElement(a.Fragment,null,a.createElement(U,{user:e,onChangePassword:n,isSaving:d})):null))}const N=C(y)},84969:(L,l,s)=>{s.d(l,{ec:()=>U,Aj:()=>i,Qe:()=>v,YW:()=>m,_O:()=>N,eg:()=>d});var a=s(32264),r=s(17172);async function w(e){try{await(0,r.AI)().put("/api/user/password",e)}catch(n){console.error(n)}}function c(){return(0,r.AI)().get("/api/user")}function f(){return(0,r.AI)().get("/api/user/teams")}function E(){return(0,r.AI)().get("/api/user/orgs")}function h(){return(0,r.AI)().get("/api/user/auth-tokens")}async function A(e){await(0,r.AI)().post("/api/user/revoke-auth-token",{authTokenId:e})}async function p(e){await(0,r.AI)().post("/api/user/using/"+e.orgId,{})}async function P(e){try{await(0,r.AI)().put("/api/user",e)}catch(n){console.error(n)}}const o={changePassword:w,revokeUserSession:A,loadUser:c,loadSessions:h,loadOrgs:E,loadTeams:f,setUserOrg:p,updateUserProfile:P};var t=s(81862);function U(e){return async function(n){n((0,t.Nm)({updating:!0})),await o.changePassword(e),n((0,t.Nm)({updating:!1}))}}function v(){return async function(e){await e(m()),e(S()),e(C()),e(y())}}function m(){return async function(e){const n=await o.loadUser();e((0,t.HO)({user:n}))}}function S(){return async function(e){e((0,t.ri)());const n=await o.loadTeams();e((0,t.Q9)({teams:n}))}}function C(){return async function(e){e((0,t.Mj)());const n=await o.loadOrgs();e((0,t.ny)({orgs:n}))}}function y(){return async function(e){e((0,t.uh)());const n=await o.loadSessions();e((0,t.RS)({sessions:n}))}}function N(e){return async function(n){n((0,t.Nm)({updating:!0})),await o.revokeUserSession(e),n((0,t.g$)({tokenId:e}))}}function i(e){return async function(n){n((0,t.Nm)({updating:!0})),await o.setUserOrg(e),window.location.href=a.$.appSubUrl+"/profile"}}function d(e){return async function(n){n((0,t.Nm)({updating:!0})),await o.updateUserProfile(e),await n(m()),n((0,t.Nm)({updating:!1}))}}},4392:(L,l,s)=>{s.d(l,{A:()=>w});var a=s(94701),r=function(c){(0,a.A)(function(){c()})};const w=r}}]);

//# sourceMappingURL=8107.b39c6543190ffe05b2b8.js.map