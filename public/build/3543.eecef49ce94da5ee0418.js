"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3543],{32346:(it,ie,o)=>{o.d(ie,{g:()=>H});var V=o(96540),b=o(32196),F=o(14186),s=o(79924),D=o(10354),P=o(29020),se=Object.defineProperty,te=Object.defineProperties,h=Object.getOwnPropertyDescriptors,ae=Object.getOwnPropertySymbols,oe=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,Q=(T,f,w)=>f in T?se(T,f,{enumerable:!0,configurable:!0,writable:!0,value:w}):T[f]=w,N=(T,f)=>{for(var w in f||(f={}))oe.call(f,w)&&Q(T,w,f[w]);if(ae)for(var w of ae(f))C.call(f,w)&&Q(T,w,f[w]);return T},j=(T,f)=>te(T,h(f));const H=({config:T,onChange:f,className:w})=>{const B=J=>{f(j(N({},T),{jsonData:j(N({},T.jsonData),{keepCookies:J})}))},W=J=>{f(j(N({},T),{jsonData:j(N({},T.jsonData),{timeout:parseInt(J.currentTarget.value,10)})}))},ce={container:(0,b.css)({maxWidth:578})};return V.createElement(P.I,{title:"Advanced HTTP settings",className:(0,b.cx)(ce.container,w)},V.createElement(F.I,{htmlFor:"advanced-http-cookies",label:"Allowed cookies",labelWidth:24,tooltip:"Grafana proxy deletes forwarded cookies by default. Specify cookies by name that should be forwarded to the data source.",disabled:T.readOnly,grow:!0},V.createElement(s.u,{id:"advanced-http-cookies",placeholder:"New cookie (hit enter to add)",tags:T.jsonData.keepCookies,onChange:B})),V.createElement(F.I,{htmlFor:"advanced-http-timeout",label:"Timeout",labelWidth:24,tooltip:"HTTP request timeout in seconds",disabled:T.readOnly,grow:!0},V.createElement(D.p,{id:"advanced-http-timeout",type:"number",min:0,placeholder:"Timeout in seconds","aria-label":"Timeout in seconds",value:T.jsonData.timeout,onChange:W})))}},33309:(it,ie,o)=>{o.d(ie,{m:()=>oe});var V=o(32196),b=o(96540),F=o(22391),s=o(29020),D=o(35931),P=o(40845),se=o(39268),te=o(14186),h=o(15292);function ae({options:Q,onOptionsChange:N}){const j=(0,P.of)(C);return b.createElement("div",{className:j.container},b.createElement(se.C,{className:j.row},b.createElement(te.I,{tooltip:"Displays the node graph above the trace view. Default: disabled",label:"Enable node graph",labelWidth:26},b.createElement(h.K,{id:"enableNodeGraph",value:Q.jsonData.nodeGraph?.enabled,onChange:H=>(0,F.lO)({onOptionsChange:N,options:Q},"nodeGraph",{...Q.jsonData.nodeGraph,enabled:H.currentTarget.checked})}))))}const oe=({options:Q,onOptionsChange:N})=>{let j=Q.type;return j+=Q.type==="tempo"?"/configure-tempo-data-source/#node-graph":"/#node-graph",b.createElement(s.I,{title:"Node graph",description:b.createElement(D.H,{description:"Show or hide the node graph visualization.",suffix:j,feature:"the node graph"})},b.createElement(ae,{options:Q,onOptionsChange:N}))},C=Q=>({infoText:(0,V.css)({label:"infoText",paddingBottom:Q.spacing(2),color:Q.colors.text.secondary}),container:(0,V.css)({label:"container",width:"100%"}),row:(0,V.css)({label:"row",alignItems:"baseline"})})},90057:(it,ie,o)=>{o.d(ie,{$:()=>H});var V=o(32196),b=o(96540),F=o(22391),s=o(91062),D=o(35931),P=o(55882),se=o(40845),te=o(39268),h=o(14186),ae=o(55852),oe=o(10354),C=o(20323),Q=o(63009),N=o(43549);function j({options:f,onOptionsChange:w}){const B=(0,se.of)(T);return b.createElement("div",{className:(0,V.css)({width:"100%"})},b.createElement(te.C,{className:B.row},b.createElement(h.I,{tooltip:"The Prometheus data source the trace is going to navigate to",label:"Data source",labelWidth:26},b.createElement(P.s,{inputId:"trace-to-metrics-data-source-picker",pluginId:"prometheus",current:f.jsonData.tracesToMetrics?.datasourceUid,noDefault:!0,width:40,onChange:W=>(0,F.lO)({onOptionsChange:w,options:f},"tracesToMetrics",{...f.jsonData.tracesToMetrics,datasourceUid:W.uid})})),f.jsonData.tracesToMetrics?.datasourceUid?b.createElement(ae.$n,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,F.lO)({onOptionsChange:w,options:f},"tracesToMetrics",{...f.jsonData.tracesToMetrics,datasourceUid:void 0})}},"Clear"):null),b.createElement(te.C,null,b.createElement(C.e,{label:(0,N.cJ)("start"),tooltip:(0,N.XX)("start","-2m"),value:f.jsonData.tracesToMetrics?.spanStartTimeShift||"",onChange:W=>{(0,F.lO)({onOptionsChange:w,options:f},"tracesToMetrics",{...f.jsonData.tracesToMetrics,spanStartTimeShift:W})},placeholder:"-2m",isInvalidError:N.FJ})),b.createElement(te.C,null,b.createElement(C.e,{label:(0,N.cJ)("end"),tooltip:(0,N.XX)("end","2m"),value:f.jsonData.tracesToMetrics?.spanEndTimeShift||"",onChange:W=>{(0,F.lO)({onOptionsChange:w,options:f},"tracesToMetrics",{...f.jsonData.tracesToMetrics,spanEndTimeShift:W})},placeholder:"2m",isInvalidError:N.FJ})),b.createElement(te.C,null,b.createElement(h.I,{tooltip:"Tags that will be used in the metrics query",label:"Tags",labelWidth:26},b.createElement(Q.l,{values:f.jsonData.tracesToMetrics?.tags??[],onChange:W=>(0,F.lO)({onOptionsChange:w,options:f},"tracesToMetrics",{...f.jsonData.tracesToMetrics,tags:W})}))),f.jsonData.tracesToMetrics?.queries?.map((W,ce)=>b.createElement("div",{key:ce,className:B.queryRow},b.createElement(h.I,{label:"Link Label",labelWidth:26,tooltip:"Descriptive label for the linked query"},b.createElement(oe.p,{label:"Link Label",type:"text",allowFullScreen:!0,value:W.name,width:40,onChange:J=>{const we=(f.jsonData.tracesToMetrics?.queries??[]).map((re,Xe)=>Xe===ce?{...re,name:J.currentTarget.value}:re);(0,F.lO)({onOptionsChange:w,options:f},"tracesToMetrics",{...f.jsonData.tracesToMetrics,queries:we})}})),b.createElement(h.I,{label:"Query",labelWidth:10,tooltip:"The Prometheus query that will run when navigating from a trace to metrics. Interpolate tags using the `$__tags` keyword",grow:!0},b.createElement(oe.p,{label:"Query",type:"text",allowFullScreen:!0,value:W.query,onChange:J=>{const we=(f.jsonData.tracesToMetrics?.queries??[]).map((re,Xe)=>Xe===ce?{...re,query:J.currentTarget.value}:re);(0,F.lO)({onOptionsChange:w,options:f},"tracesToMetrics",{...f.jsonData.tracesToMetrics,queries:we})}})),b.createElement(ae.$n,{variant:"destructive",title:"Remove query",icon:"times",type:"button",onClick:()=>{const J=f.jsonData.tracesToMetrics?.queries.filter((we,re)=>re!==ce);(0,F.lO)({onOptionsChange:w,options:f},"tracesToMetrics",{...f.jsonData.tracesToMetrics,queries:J})}}))),b.createElement(ae.$n,{variant:"secondary",title:"Add query",icon:"plus",type:"button",onClick:()=>{(0,F.lO)({onOptionsChange:w,options:f},"tracesToMetrics",{...f.jsonData.tracesToMetrics,queries:[...f.jsonData.tracesToMetrics?.queries??[],{query:""}]})}},"Add query"))}const H=({options:f,onOptionsChange:w})=>{let B=f.type;return B+=f.type==="tempo"?"/configure-tempo-data-source/#trace-to-metrics":"/#trace-to-metrics",b.createElement(s.A,{title:"Trace to metrics",description:b.createElement(D.H,{description:"Navigate from a trace span to the selected data source's metrics.",suffix:B,feature:"trace to metrics"}),isCollapsible:!0,isInitiallyOpen:!0},b.createElement(j,{options:f,onOptionsChange:w}))},T=f=>({infoText:{paddingBottom:f.spacing(2),color:f.colors.text.secondary},row:(0,V.css)({label:"row",alignItems:"baseline"}),queryRow:(0,V.css)({label:"queryRow",display:"flex",flexFlow:"wrap"})})},63543:(it,ie,o)=>{o.r(ie),o.d(ie,{plugin:()=>dd});var V=o(40187),b=o(69129),F=o(3591),s=o(96540),D=o(14110),P=o(32264),se=o(72109);function te(){return(0,D.rR)("grafana_traces_cheatsheet_clicked",{datasourceType:"tempo",grafana_version:P.$.buildInfo.version}),s.createElement(s.Fragment,null,s.createElement("h2",null,"Tempo Cheat Sheet"),s.createElement("p",null,s.createElement(se.Y,{href:"https://grafana.com/docs/tempo/latest/",external:!0},"Grafana Tempo")," ","is an open source, easy-to-use, and high-volume distributed tracing backend."),s.createElement("p",null,"Tempo implements"," ",s.createElement(se.Y,{href:"https://grafana.com/docs/tempo/latest/traceql",external:!0},"TraceQL"),", a traces-first query language inspired by LogQL and PromQL. This query language allows users to precisely and easily select spans and jump directly to the spans fulfilling the specified conditions."),s.createElement("p",null,"You can compose TraceQL queries using either the Search tab (the TraceQL query builder) or the TraceQL tab (the TraceQL query editor). Both of these methods let you build queries and drill-down into result sets. (",s.createElement(se.Y,{href:"https://grafana.com/docs/grafana/latest/datasources/tempo/query-editor/",external:!0},"Learn more"),")"))}var h=o(32196),ae=o(37390),oe=o(37270),C=o(39268),Q=o(14186),N=o(66864),j=o(94354),H=o(55852),T=o(40845),f=o(24705),w=o(76892);function B(e){return W(e/1e3)}function W(e){return Math.floor(e/60)}function ce(e,t){if(e&&t){const a=B(e.from.valueOf())===B(t.from.valueOf()),r=B(e.to.valueOf())===B(t.to.valueOf());return!(a&&r)}return!1}const J=/[*+?()|\\.\[\]{}^$]/g;function we(e){return e.replace(J,"\\$&")}function re(e){return e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function Xe(e){return e.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function Va(e){return re(we(e))}function ld(e,t){return Fa(t)?Va(e):re(e)}function Fa(e){return!!(e&&(e.includes("=~")||e.includes("!~")))}function id(e){const t=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],a=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${t.join("|")})$`);return!!e.match(a)}const Ua=s.lazy(()=>Promise.all([o.e(1216),o.e(6587),o.e(84),o.e(1952)]).then(o.bind(o,61226))),ja=e=>s.createElement(s.Suspense,{fallback:null},s.createElement(Ua,{...e})),Xa=e=>{const t=(0,s.useRef)(null),{onRunQuery:a,onChange:r,...n}=e,d=i=>{t.current=i,r(i),a()},l=i=>{r(i)};return s.createElement(ja,{onRunQuery:d,onBlur:l,onChange:r,...n})};class Wa extends s.PureComponent{constructor(t){super(t),this._isMounted=!1,this.onChangeQuery=(a,r)=>{const{query:n,onChange:d,onRunQuery:l}=this.props;if(d){const i={...n,expr:a};d(i),r&&l&&l()}},this.state={labelsLoaded:!1}}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(t){const{range:a,datasource:{languageProvider:r}}=this.props;ce(a,t.range)&&r.fetchLabels()}render(){const{ExtraFieldElement:t,query:a,datasource:r,history:n,onRunQuery:d}=this.props,l=this.props.placeholder??"Enter a Loki query (run with Shift+Enter)";return s.createElement(s.Fragment,null,s.createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"]},s.createElement("div",{className:"gf-form--grow flex-shrink-1 min-width-15"},s.createElement(Xa,{datasource:r,history:n??[],onChange:this.onChangeQuery,onRunQuery:d,initialValue:a.expr??"",placeholder:l}))),t)}}var ne=o(19347);const G=(e,t)=>{const a=e?` (${e})`:"";return`${t||"Error"}${a}. Please check the server logs for more details.`};async function Ut(e){if(!e)return;const t=(0,ne.l)();try{return await t.get(e)}catch(a){console.error("Failed to load data source",a);return}}function ka({logsDatasourceUid:e,onChange:t,onRunQuery:a,query:r}){const n=(0,f.A)(()=>Ut(e),[e]);if(n.loading)return null;const d=n.value;return d?s.createElement(s.Fragment,null,s.createElement(w.c,null,"Tempo uses ",d.name," to find traces."),s.createElement(Wa,{datasource:d,onChange:t,onRunQuery:a,query:r.linkedQuery??{refId:"linked"},history:[]})):e?e&&!d?s.createElement("div",{className:"text-warning"},"Loki search datasource is configured but the data source no longer exists. Please configure existing data source to use the search."):null:s.createElement("div",{className:"text-warning"},"Please set up a Loki search datasource in the datasource settings.")}var jt=o(50877),We=o(70416),he=o(17172),ve=o(72574),Ya=o(9830),Se=o(42418),Z=o(88323),ze=o(10354),_a=o(30038),ot=o(1081),$e=(e=>(e.Success="success",e.Warning="warning",e.Error="error",e.Info="info",e))($e||{}),Ba=(e=>(e[e.Success=3e3]="Success",e[e.Warning=5e3]="Warning",e[e.Error=7e3]="Error",e))(Ba||{});const od={success:3e3,warning:5e3,error:7e3,info:3e3},Ga=25,ct="notifications",Za=`${ct}/lastRead`,qa={byId:er(),lastRead:Number.parseInt(window.localStorage.getItem(Za)??`${Date.now()}`,10)},Xt=(0,_a.Z0)({name:"appNotifications",initialState:qa,reducers:{notifyApp:(e,{payload:t})=>{Object.values(e.byId).some(a=>Ha(t,a)&&a.showing)||(e.byId[t.id]=t,ke(e.byId))},hideAppNotification:(e,{payload:t})=>{t in e.byId&&(e.byId[t].showing=!1,ke(e.byId))},clearNotification:(e,{payload:t})=>{delete e.byId[t],ke(e.byId)},clearAllNotifications:e=>{e.byId={},ke(e.byId)},readAllNotifications:(e,{payload:t})=>{e.lastRead=t}}}),{notifyApp:Te,hideAppNotification:cd,clearNotification:ud,clearAllNotifications:pd,readAllNotifications:md}=Xt.actions,gd=Xt.reducer,Od=e=>e.lastRead,Wt=e=>e.byId,Ka=(0,ot.Mz)(Wt,e=>Object.values(e).sort((t,a)=>a.timestamp-t.timestamp)),fd=(0,ot.Mz)(Ka,e=>e.filter(kt)),hd=(0,ot.Mz)(Wt,e=>Object.values(e).filter(t=>t.showing));function Ha(e,t){return e.icon===t.icon&&e.severity===t.severity&&e.text===t.text&&e.title===t.title}function kt(e){return e.severity===$e.Warning||e.severity===$e.Error}function Ja(e){return typeof e=="object"&&e!==null&&"id"in e&&"icon"in e&&"title"in e&&"text"in e}function er(){const e=window.localStorage.getItem(ct);if(!e)return{};const t=JSON.parse(e);return Object.values(t).every(a=>Ja(a))?t:{}}function ke(e){const t=Object.values(e).filter(kt).sort((a,r)=>r.timestamp-a.timestamp).slice(0,Ga).reduce((a,r)=>(a[r.id]={id:r.id,severity:r.severity,icon:r.icon,title:r.title,text:r.text,traceId:r.traceId,timestamp:r.timestamp,showing:!1},a),{});try{window.localStorage.setItem(ct,JSON.stringify(t))}catch(a){console.error("Unable to persist notifications to local storage"),console.error(a)}}var Ye=o(62938);function tr(e){if(typeof e=="string")return e;if(e){if(e instanceof Error)return e.message;if((0,he.NF)(e)){if(e.data&&e.data.message)return e.data.message;if(e.statusText)return e.statusText}}return JSON.stringify(e)}const ar={title:"",text:"",severity:$e.Success,icon:"check"},rr={title:"",text:"",severity:$e.Error,icon:"exclamation-triangle"},vd=(e,t="",a)=>({...ar,title:e,text:t,id:uuidv4(),timestamp:Date.now(),showing:!0}),ye=(e,t="",a,r)=>({...rr,text:tr(t),title:e,id:(0,Ye.A)(),traceId:a,component:r,timestamp:Date.now(),showing:!0});let Ee;const sr={keys:{}};function Sd(e){Ee=e}function Td(){return!Ee||!Ee.getState?{templating:{...sr,lastKey:"key"}}:Ee.getState()}function Qe(e){if(!(!Ee||!Ee.getState))return Ee.dispatch(e)}var q=o(2543),ut=o(75505),M=o(62467),_e=o(65474),nr=o(13288),Yt=o(44240),_t=o(61701),Y=o(81160),be=o(66847),pt=o(69862),Bt=o(95864),mt=o(9084),dr=o(99589),lr=o.n(dr),de=o(39070),Gt=o(65879),Be=o(47232),ir=o(76885),or=o(41987),K=o(11261),Zt=o(26657),xe=o(52622),R=o(64616);const cr={wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,brackets:[["{","}"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}},qt=["=","!=",">","<",">=","<=","=~","!~"],ur=["=","!="],pr=["=","!=","=~","!~"],mr=["=","!=",">","<",">=","<="],Ge=["duration","kind","name","rootName","rootServiceName","status","statusMessage","traceDuration"],Kt=["resource","span"],gr=["avg","min","max","sum","count","by"],Ht=Ge.concat(Kt),Or={ignoreCase:!1,defaultToken:"",tokenPostfix:".traceql",keywords:Ht,operators:qt,statusValues:["ok","unset","error","false","true"],functions:gr,symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,tokenizer:{root:[[/\/\/.*/,"comment"],[/\/\*.*\*\//,"comment"],[/[0-9]+(.[0-9]+)?(us|Âµs|ns|ms|s|m|h)/,"number"],[/^\s*[0-9A-Fa-f]+\s*$/,"tag"],[`(?:${Ht.join("|")})`,{cases:{"@keywords":"keyword","@default":"tag"}}],[/(?:\w|^[^{}()=~!<>&|," ]|"(?:\\"|\\\\|[^\\"])*")+/,{cases:{"@functions":"predefined","@statusValues":"type","@default":"tag"}}],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/([^\w])(")/,[{token:""},{token:"string",next:"@string_double"}]],[/([^\w])(')/,[{token:""},{token:"string",next:"@string_single"}]],[/([^\w])(`)/,[{token:""},{token:"string",next:"@string_back"}]],[/[{}()\[\]]/,"delimiter.bracket"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?[fFdD]?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?[fFdD]?/,"number.float"],[/0(@octaldigits)[Ll]?/,"number.octal"],[/0[bB](@binarydigits)[Ll]?/,"number.binary"],[/(@digits)[fFdD]/,"number.float"],[/(@digits)[lL]?/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_back:[[/[^\\`]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]]}},fr={id:"traceql",extensions:[".traceql"],aliases:["tempo","traceql"],mimetypes:[],def:{language:Or,languageConfiguration:cr}},hr={comment:{pattern:/\/\/.*/},"span-set":{pattern:/\{[^}]*}/,inside:{filter:{pattern:/([\w.\/-]+)?(\s*)(([!=+\-<>~]+)\s*("([^"\n&]+)?"?|([^"\n\s&|}]+))?)/g,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-z_.][\w./_-]*(?=\s*(=|!=|>|<|>=|<=|=~|!~))/,alias:"attr-name"},"label-value":{pattern:/("(?:\\.|[^\\"])*")|(\w+)/,alias:"attr-value"}}},punctuation:/[}{&|]/}},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,operator:new RegExp("/[-+*/=%^~]|&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?|","i"),punctuation:/[{};()`,.]/},Ce=e=>`{${e.filter(t=>t.tag&&t.operator&&t.value?.length).map(t=>`${Jt(t)}${Sr(t,e)}${t.operator}${vr(t)}`).join(" && ")}}`,vr=e=>Array.isArray(e.value)&&e.value.length>1?`"${e.value.join("|")}"`:e.valueType==="string"?`"${e.value}"`:e.value,Jt=e=>Ge.find(t=>t===e.tag)?"":(e.scope===R.d.Resource||e.scope===R.d.Span?e.scope?.toLowerCase():"")+".",Sr=(e,t)=>{if(e.tag==="duration"){const a=t.find(r=>r.id==="duration-type");return a?a.value==="trace"?"traceDuration":"duration":e.tag}return e.tag},gt=e=>Jt(e)+e.tag,Tr=e=>e.tag==="name"?"Span Name":e.tag==="service.name"&&e.scope===R.d.Resource?"Service Name":(0,q.startCase)(gt(e)),yr=(e,t)=>[...Ge,...e].filter(a=>!t.includes(a)),Ze=e=>(0,q.uniq)(e.map(t=>t.name&&t.name!=="intrinsic"&&t.tags?t.tags:[]).flat()),Er=e=>(0,q.uniq)(e.map(t=>t.tags?t.tags:[]).flat()),Ot=(e,t)=>(0,q.uniq)(e.map(a=>a.name&&a.name===t&&a.tags?a.tags:[]).flat());function ft(e,t,a){const r=e.slice(0);return r[t]=a,r}const ea=e=>{const t={label:e,value:e};switch(e){case"=":t.description="Equals";break;case"!=":t.description="Not equals";break;case">":t.description="Greater";break;case">=":t.description="Greater or Equal";break;case"<":t.description="Less";break;case"<=":t.description="Less or Equal";break;case"=~":t.description="Matches regex";break;case"!~":t.description="Does not match regex";break}return t};var ht=(e=>(e[e.LabelNames=0]="LabelNames",e[e.LabelValues=1]="LabelValues",e))(ht||{});const Qr=[{label:"Label names",value:0},{label:"Label values",value:1}],vt="TempoDatasourceVariableQueryEditor-VariableQuery",br=({onChange:e,query:t,datasource:a})=>{const[r,n]=(0,s.useState)(t.label||""),[d,l]=(0,s.useState)(t.type),[i,c]=(0,s.useState)([]);(0,s.useEffect)(()=>{d===1&&a.labelNamesQuery().then(g=>{c(g.map(({text:O})=>({label:O,value:O})))})},[a,t,d]);const u=g=>{l(g.value),g.value!==void 0&&e({type:g.value,label:r,refId:vt})},p=g=>{const O=g.value||"";n(O),d!==void 0&&e({type:d,label:O,refId:vt})},m=()=>{d!==void 0&&e({type:d,label:r,refId:vt})};return s.createElement(s.Fragment,null,s.createElement(C.C,null,s.createElement(Q.I,{label:"Query type",labelWidth:20},s.createElement(Z.l6,{"aria-label":"Query type",onChange:u,onBlur:m,value:d,options:Qr,width:32}))),d===1&&s.createElement(C.C,null,s.createElement(Q.I,{label:"Label",labelWidth:20},s.createElement(Z.l6,{"aria-label":"Label",onChange:p,onBlur:m,value:{label:r,value:r},options:i,width:32,allowCustomValue:!0}))))};var k=o(44066);class ta extends V.Is{constructor(t,a){super(),this.request=async(r,n={})=>(await this.datasource.metadataRequest(r,n))?.data,this.start=async()=>(this.startTask||(this.startTask=this.fetchTags().then(()=>[])),this.startTask),this.setV1Tags=r=>{this.tagsV1=r},this.setV2Tags=r=>{this.tagsV2=r},this.getTags=r=>this.tagsV2&&r?r===R.d.Unscoped?Ze(this.tagsV2):Ot(this.tagsV2,r):this.tagsV1?(this.tagsV1.find(n=>n==="status")||this.tagsV1.push("status"),this.tagsV1):[],this.getMetricsSummaryTags=r=>this.tagsV2&&r?r===R.d.Unscoped?Ze(this.tagsV2):Ot(this.tagsV2,r):this.tagsV1?this.tagsV1:[],this.getTraceqlAutocompleteTags=r=>{if(this.tagsV2){if(r){if(r===R.d.Unscoped)return Ze(this.tagsV2)}else return Ze(this.tagsV2);return Ot(this.tagsV2,r)}else if(this.tagsV1)return this.tagsV1.find(n=>n==="status")||this.tagsV1.push("status"),this.tagsV1;return[]},this.getAutocompleteTags=()=>this.tagsV2?Er(this.tagsV2):this.tagsV1?(this.tagsV1.find(r=>r==="status.code")||this.tagsV1.push("status.code"),this.tagsV1):[],this.encodeTag=r=>encodeURIComponent(encodeURIComponent(r)),this.datasource=t,Object.assign(this,a)}async fetchTags(){let t,a;try{a=await this.request("/api/v2/search/tags",[])}catch{t=await this.request("/api/search/tags",[])}a&&a.scopes?this.setV2Tags(a.scopes):t&&this.setV1Tags(t.tagNames)}async getOptionsV1(t){const a=this.encodeTag(t),r=await this.request(`/api/search/tag/${a}/values`);let n=[];return r&&r.tagValues&&(n=r.tagValues.map(d=>({value:d,label:d}))),n}async getOptionsV2(t,a){const r=this.encodeTag(t),n=await this.request(`/api/v2/search/tag/${r}/values`,a?{q:a}:{});let d=[];return n&&n.tagValues&&n.tagValues.forEach(l=>{l.value&&d.push({type:l.type,value:l.value,label:l.value})}),d}}var aa=o(14236),xr=o(37471);function Rr(e,t,a){let r;if(!e.length)return Me;const n={};e.forEach(l=>{const i=wr(l.series,t);l.series.forEach(c=>{n[c.key]={name:`${c.key}`,type:K.PU.string,config:Cr(c,i,a),values:[]}})}),r=(0,aa.EI)({name:"Metrics Summary",refId:"metrics-summary",fields:[...Object.values(n).sort((l,i)=>l.name.localeCompare(i.name)),{name:"kind",type:K.PU.string,config:{displayNameFromDS:"Kind",custom:{width:150}}},{name:"spanCount",type:K.PU.number,config:{displayNameFromDS:"Span count",custom:{width:150}}},{name:"errorPercentage",type:K.PU.number,config:{displayNameFromDS:"Error",unit:"percent",custom:{width:150}}},Ke("p50"),Ke("p90"),Ke("p95"),Ke("p99")],meta:{preferredVisualisationType:"table"}});const d=e.map(Pr);r.length=d.length;for(const l of d)for(const i of r.fields)i.values.push(l[i.name]);return r=(0,aa.ES)(r,0),[r]}const Pr=e=>{const t=e.errorSpanCount?Re(e.errorSpanCount)/Re(e.spanCount)*100:"0%",a={kind:"server",spanCount:Re(e.spanCount),errorPercentage:t,p50:Re(e.p50),p90:Re(e.p90),p95:Re(e.p95),p99:Re(e.p99)};return e.series.forEach(r=>{a[`${r.key}`]=Ir(r)||""}),a},wr=(e,t)=>{const a=e.map(d=>{const l=d.value.type===3||d.value.type===4,i=d.value.type===8||d.value.type===9,c=l||i?"":'"';return`${d.key}=${c}\${__data.fields["`+d.key+`"]}${c}`});let r="";const n=t.indexOf("}");if(n!==-1){const d=t.substring(n+1);r=t.substring(0,n),a.length>0&&(r+=t.replace(/\s/g,"").includes("{}")?"":" && ",r+=`${a.join(" && ")} && kind=server`,r+="}"),r+=`${d}`}else r=`{${a.join(" && ")} && kind=server} | ${t}`;return r},Cr=(e,t,a)=>{const r={displayNameFromDS:e.key,noValue:"<no value>",links:[{title:"Query in explore",url:"",internal:{datasourceUid:a.uid,datasourceName:a.name,query:{query:t,queryType:"traceql"}}}]};return e.value.type===7?{...r,unit:"ns"}:{...r}},qe="",Ir=e=>{if(!e.value.type)return qe;switch(e.value.type){case 3:return e.value.n;case 4:return e.value.f;case 5:return e.value.s;case 6:return e.value.b;case 7:return e.value.d;case 8:return Dr(e.value.status);case 9:return Nr(e.value.kind);default:return qe}},Dr=e=>{if(!e)return qe;switch(e){case 0:return"error";case 1:return"ok";default:return"unset"}},Nr=e=>{if(!e)return qe;switch(e){case 1:return"internal";case 2:return"client";case 3:return"server";case 4:return"producer";case 5:return"consumer";default:return"unspecified"}},Ke=e=>({name:e,type:K.PU.number,config:{displayNameFromDS:e,unit:"ns",custom:{width:150}}}),Re=e=>{const t=parseInt(e,10);return isNaN(t)?0:t},Me=new xr.k({name:"Metrics Summary",refId:"metrics-summary",fields:[],meta:{preferredVisualisationType:"table"}});var ue=o(98216),zr=o(46662),$r=o(55004),Mr=o(50082),Ar=o(78731);function Lr(){return(0,Ye.A)()}function Vr(e,t,a,r){const n=a.range;let d,l=de.Gu.NotStarted;const i=performance.now();return(0,Ar.oF)().getStream({scope:$r.qD.DataSource,namespace:t.uid,path:`search/${Lr()}`,data:{...e,SpansPerSpanSet:e.spss??Ie,timeRange:{from:n.from.toISOString(),to:n.to.toISOString()}}}).pipe((0,zr.v)(c=>{if("message"in c&&c?.message){const u=c.message.data.values[2][0];if(u===R.O8.Done||u===R.O8.Error)return!1}return!0},!0)).pipe((0,Y.T)(c=>{if("message"in c&&c?.message){const p=performance.now()-i,m=c.message.data.values[0][0],g=c.message.data.values[1][0],O=c.message.data.values[2][0],S=c.message.data.values[3][0];switch(O){case R.O8.Done:l=de.Gu.Done;break;case R.O8.Streaming:l=de.Gu.Streaming;break;case R.O8.Error:throw new Error(S)}d=[Fr(g,O,p),...(0,ue.bT)(m,r,e.tableType)]}return{data:d||[],state:l}}))}function Fr(e,t,a){const r={steps:[{color:"blue",value:-1/0},{color:"green",value:75}],mode:Mr.O.Absolute};return{refId:"streaming-progress",name:"Streaming Progress",length:1,fields:[{name:"state",type:K.PU.string,values:[(0,q.capitalize)(t.toString())],config:{displayNameFromDS:"State"}},{name:"elapsedTime",type:K.PU.number,values:[a],config:{unit:"ms",displayNameFromDS:"Elapsed Time"}},{name:"totalBlocks",type:K.PU.number,values:[e.totalBlocks],config:{displayNameFromDS:"Total Blocks"}},{name:"completedJobs",type:K.PU.number,values:[e.completedJobs],config:{displayNameFromDS:"Completed Jobs"}},{name:"totalJobs",type:K.PU.number,values:[e.totalJobs],config:{displayNameFromDS:"Total Jobs"}},{name:"progress",type:K.PU.number,values:[t===R.O8.Done?100:(e.completedJobs||0)/(e.totalJobs||1)*100],config:{displayNameFromDS:"Progress",unit:"percent",min:0,max:100,custom:{cellOptions:{type:"gauge",mode:"gradient"}},thresholds:r}}],meta:{preferredVisualisationType:"table"}}}var Ur=o(29505);class jr extends Ur.f5{constructor(t){super(),this.datasource=t,this.editor=br}query(t){if(!this.datasource)throw new Error("Datasource not initialized");const a=this.datasource.executeVariableQuery(t.targets[0]);return(0,_e.H)(a).pipe((0,Y.T)(r=>({data:r})))}}const pe=20,Ie=3;var Xr=(e=>(e.streaming="streaming",e))(Xr||{});const Wr={streaming:"2.2.0"},kr="2.1.0";class Yr extends Zt.iy{constructor(t,a=(0,ve.w)()){super(t),this.instanceSettings=t,this.templateSrv=a,this.uploadedJson=null,this.init=async()=>{const r=await(0,ut.s)(this._request("/api/status/buildinfo").pipe((0,Y.T)(n=>n),(0,be.W)(n=>(console.error("Failure in retrieving build information",n.data.message),(0,M.of)({error:n,data:{version:null}})))));this.tempoVersion=r.data.version},this.handleMetricsSummary=(r,n,d)=>{if((0,D.rR)("grafana_traces_metrics_summary_queried",{datasourceType:"tempo",app:d.app??"",grafana_version:P.$.buildInfo.version,filterCount:r.groupBy?.length??0}),n==="{}")return(0,M.of)({error:{message:"Please ensure you do not have an empty query. This is so filters are applied and the metrics summary is not generated from all spans."},data:Me});const l=r.groupBy?this.formatGroupBy(r.groupBy):"";return this._request("/api/metrics/summary",{q:n,groupBy:l,start:d.range.from.unix(),end:d.range.to.unix()}).pipe((0,Y.T)(i=>i.data.summaries?i.data.summaries.some(u=>u.series.length>0)?{data:Rr(i.data.summaries,n,this.instanceSettings)}:{error:{message:G("No series data. Ensure you are using an up to date version of Tempo")},data:Me}:{error:{message:G(`No summary data for '${l}'. Note: the metrics summary API only considers spans of kind = server. You can check if the attributes exist by running a TraceQL query like { attr_key = attr_value && kind = server }`)},data:Me}),(0,be.W)(i=>(0,M.of)({error:{message:G(i.data.message)},data:Me})))},this.formatGroupBy=r=>r?.filter(n=>n.tag).map(n=>n.scope===R.d.Unscoped?`.${n.tag}`:n.scope!==R.d.Intrinsic?`${n.scope}.${n.tag}`:n.tag).join(", "),this.hasGroupBy=r=>r.groupBy?.find(n=>n.tag),this.handleTraceQlQuery=(r,n,d)=>P.$.featureToggles.traceQLStreaming&&this.isFeatureAvailable("streaming")?this.handleStreamingSearch(r,n.traceql,d):this._request("/api/search",{q:d,limit:r.targets[0].limit??pe,spss:r.targets[0].spss??Ie,start:r.range.from.unix(),end:r.range.to.unix()}).pipe((0,Y.T)(l=>({data:(0,ue.bT)(l.data.traces,this.instanceSettings,n.traceql[0].tableType)})),(0,be.W)(l=>(0,M.of)({error:{message:G(l.data.message)},data:[]}))),this.handleTraceQlMetricsQuery=(r,n)=>this._request("/api/metrics/query_range",{query:n,start:r.range.from.unix(),end:r.range.to.unix()}).pipe((0,Y.T)(d=>({data:(0,ue.TG)(n,d.data)})),(0,be.W)(d=>(0,M.of)({error:{message:G(d.data.message)},data:[]}))),this.getLokiSearchDS=()=>{const r=this.tracesToLogs?.lokiSearch!==!1&&this.lokiSearch===void 0?this.tracesToLogs?.datasourceUid:void 0;return this.lokiSearch?.datasourceUid??r},this.tracesToLogs=t.jsonData.tracesToLogs,this.serviceMap=t.jsonData.serviceMap,this.search=t.jsonData.search,this.nodeGraph=t.jsonData.nodeGraph,this.lokiSearch=t.jsonData.lokiSearch,this.traceQuery=t.jsonData.traceQuery,this.languageProvider=new ta(this),this.search?.filters||(this.search={...this.search,filters:[{id:"service-name",tag:"service.name",operator:"=",scope:R.d.Resource},{id:"span-name",tag:"name",operator:"=",scope:R.d.Span}]}),this.variables=new jr(this)}async executeVariableQuery(t){if(t.type===void 0)return new Promise(()=>[]);switch(t.type){case ht.LabelNames:return await this.labelNamesQuery();case ht.LabelValues:return this.labelValuesQuery(t.label);default:throw Error("Invalid query type: "+t.type)}}async labelNamesQuery(){return await this.languageProvider.fetchTags(),this.languageProvider.getAutocompleteTags().filter(a=>a!==void 0).map(a=>({text:a}))}async labelValuesQuery(t){if(!t)return[];let a;try{const r=(this.languageProvider.tagsV2||[]).flatMap(d=>d.tags.map(l=>({scope:d.name,name:l}))).find(d=>d.name===t)?.scope;if(!r)throw Error(`Scope for tag ${t} not found`);const n=r==="intrinsic"?t:`${r}.${t}`;a=await this.languageProvider.getOptionsV2(n)}catch{a=await this.languageProvider.getOptionsV1(t)}return a.flatMap(r=>r.value!==void 0?[{text:r.value}]:[])}isFeatureAvailable(t){const a=this.tempoVersion??kr;try{return lr().gte(a,Wr[t])}catch{return!0}}query(t){const a=[],r=t.targets.filter(l=>!l.hide),n=(0,q.groupBy)(r,l=>l.queryType||"traceql");if(n.clear)return(0,M.of)({data:[],state:de.Gu.Done});const d=this.getLokiSearchDS();if(d&&n.search?.length>0){(0,D.rR)("grafana_traces_loki_search_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:P.$.buildInfo.version,hasLinkedQueryExpr:!!(n.search[0].linkedQuery?.expr&&n.search[0].linkedQuery?.expr!=="")});const l=(0,ne.l)();a.push((0,_e.H)(l.get(d)).pipe((0,pt.Z)(i=>{const c={...t,targets:n.search.map(m=>m.linkedQuery)},p=i.instanceSettings.jsonData.derivedFields?.filter(m=>m.datasourceUid===this.uid&&m.matcherRegex).map(m=>m.matcherRegex)||[];if(!p||p.length===0)return(0,nr.$)(()=>new Error("No Loki datasource configured for search. Set up Derived Fields for traces in a Loki datasource settings and link it to this Tempo datasource."));{const m=i.query(c);return(0,_e.H)(m).pipe((0,Y.T)(g=>g.error?g:(0,ue._2)(g,this.uid,this.name,p)))}})))}if(n.nativeSearch?.length)try{(0,D.rR)("grafana_traces_search_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:P.$.buildInfo.version,hasServiceName:!!n.nativeSearch[0].serviceName,hasSpanName:!!n.nativeSearch[0].spanName,resultLimit:n.nativeSearch[0].limit??"",hasSearch:!!n.nativeSearch[0].search,minDuration:n.nativeSearch[0].minDuration??"",maxDuration:n.nativeSearch[0].maxDuration??""});const l={startTime:t.range.from.unix(),endTime:t.range.to.unix()},i=this.applyVariables(n.nativeSearch[0],t.scopedVars),c=this.buildSearchQuery(i,l);a.push(this._request("/api/search",c).pipe((0,Y.T)(u=>({data:[(0,ue.qS)(u.data.traces,this.instanceSettings)]})),(0,be.W)(u=>(0,M.of)({error:{message:G(u.data.message)},data:[]}))))}catch(l){return(0,M.of)({error:{message:l instanceof Error?l.message:"Unknown error occurred"},data:[]})}if(n.traceql?.length)try{const i=this.applyVariables(n.traceql[0],t.scopedVars)?.query||"";this.isTraceIdQuery(i)?((0,D.rR)("grafana_traces_traceID_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:P.$.buildInfo.version,hasQuery:i!==""}),a.push(this.handleTraceIdQuery(t,n.traceql))):this.isTraceQlMetricsQuery(i)?((0,D.rR)("grafana_traces_traceql_metrics_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:P.$.buildInfo.version,query:i??""}),a.push(this.handleTraceQlMetricsQuery(t,i))):((0,D.rR)("grafana_traces_traceql_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:P.$.buildInfo.version,query:i??"",streaming:P.$.featureToggles.traceQLStreaming}),a.push(this.handleTraceQlQuery(t,n,i)))}catch(l){return(0,M.of)({error:{message:l instanceof Error?l.message:"Unknown error occurred"},data:[]})}if(n.traceqlSearch?.length)try{if(P.$.featureToggles.metricsSummary){const i=n.traceqlSearch.find(c=>this.hasGroupBy(c));if(i){const c=this.applyVariables(i,t.scopedVars);a.push(this.handleMetricsSummary(c,Ce(c.filters),t))}}const l=P.$.featureToggles.metricsSummary?n.traceqlSearch.filter(i=>!this.hasGroupBy(i)):n.traceqlSearch;if(l.length>0){const i=this.applyVariables(l[0],t.scopedVars),c=Ce(i.filters);(0,D.rR)("grafana_traces_traceql_search_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:P.$.buildInfo.version,query:c??"",streaming:P.$.featureToggles.traceQLStreaming}),P.$.featureToggles.traceQLStreaming&&this.isFeatureAvailable("streaming")?a.push(this.handleStreamingSearch(t,l,c)):a.push(this._request("/api/search",{q:c,limit:t.targets[0].limit??pe,spss:t.targets[0].spss??Ie,start:t.range.from.unix(),end:t.range.to.unix()}).pipe((0,Y.T)(u=>({data:(0,ue.bT)(u.data.traces,this.instanceSettings,n.traceqlSearch[0].tableType)})),(0,be.W)(u=>(0,M.of)({error:{message:G(u.data.message)},data:[]}))))}}catch(l){return(0,M.of)({error:{message:l instanceof Error?l.message:"Unknown error occurred"},data:[]})}if(n.upload?.length)if(this.uploadedJson){(0,D.rR)("grafana_traces_json_file_uploaded",{datasourceType:"tempo",app:t.app??"",grafana_version:P.$.buildInfo.version});const l=JSON.parse(this.uploadedJson),i=l.batches,c=Array.isArray(l)&&l.some(u=>u?.meta?.preferredVisualisationType==="nodeGraph");i?a.push((0,M.of)((0,ue.q0)(l.batches,this.nodeGraph?.enabled))):c?a.push((0,M.of)({data:l,state:de.Gu.Done})):a.push((0,M.of)({error:{message:"Unable to parse uploaded data."},data:[]}))}else a.push((0,M.of)({data:[],state:de.Gu.Done}));if(this.serviceMap?.datasourceUid&&n.serviceMap?.length>0){(0,D.rR)("grafana_traces_service_graph_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:P.$.buildInfo.version,hasServiceMapQuery:!!n.serviceMap[0].serviceMapQuery});const l=this.serviceMap.datasourceUid,i=this.uid;a.push(_r(t,l,i).pipe((0,Bt.H)(c=>Br(t,c,l).pipe((0,Bt.H)(u=>Gr(t,u,l,i))))))}return(0,Yt.h)(...a)}isTraceQlMetricsQuery(t){const a=/\|\s*(rate|count_over_time|avg_over_time|max_over_time|min_over_time|quantile_over_time)\s*\(/;return!!t.trim().match(a)}isTraceIdQuery(t){const a=/^[0-9A-Fa-f]*$/;return!!t.trim().match(a)}applyTemplateVariables(t,a){return this.applyVariables(t,a)}interpolateVariablesInQueries(t,a){return!t||t.length===0?[]:t.map(r=>({...r,datasource:this.getRef(),...this.applyVariables(r,a)}))}applyVariables(t,a){const r={...t};return t.linkedQuery&&(r.linkedQuery={...t.linkedQuery,expr:this.templateSrv.replace(t.linkedQuery?.expr??"",a)}),t.filters&&(r.filters=t.filters.map(n=>{const d={...n,tag:this.templateSrv.replace(n.tag??"",a)};return n.value&&(d.value=typeof n.value=="string"?this.templateSrv.replace(n.value??"",a,xe.$m.Pipe):n.value.map(l=>this.templateSrv.replace(l??"",a,xe.$m.Pipe))),d})),{...r,query:this.templateSrv.replace(t.query??"",a,xe.$m.Pipe),serviceName:this.templateSrv.replace(t.serviceName??"",a),spanName:this.templateSrv.replace(t.spanName??"",a),search:this.templateSrv.replace(t.search??"",a),minDuration:this.templateSrv.replace(t.minDuration??"",a),maxDuration:this.templateSrv.replace(t.maxDuration??"",a),serviceMapQuery:Array.isArray(t.serviceMapQuery)?t.serviceMapQuery.map(n=>this.templateSrv.replace(n,a)):this.templateSrv.replace(t.serviceMapQuery??"",a)}}handleTraceIdQuery(t,a){const r=a.filter(d=>d.query).map(d=>({...d,query:d.query?.trim(),queryType:"traceId"}));if(!r.length)return _t.w;const n=this.traceIdQueryRequest(t,r);return super.query(n).pipe((0,Y.T)(d=>d.error?d:(0,ue.kX)(d,this.instanceSettings,this.nodeGraph?.enabled)))}traceIdQueryRequest(t,a){const r={...t,targets:a};return this.traceQuery?.timeShiftEnabled?r.range=t.range&&{...t.range,from:t.range.from.subtract(Gt.intervalToMs(this.traceQuery?.spanStartTimeShift||"30m"),"milliseconds"),to:t.range.to.add(Gt.intervalToMs(this.traceQuery?.spanEndTimeShift||"30m"),"milliseconds")}:r.range={from:(0,Be.KQ)(0),to:(0,Be.KQ)(0),raw:{from:(0,Be.KQ)(0),to:(0,Be.KQ)(0)}},r}handleStreamingSearch(t,a,r){return r===""?_t.w:(0,Yt.h)(...a.map(n=>Vr({...n,query:r},this,t,this.instanceSettings)))}async metadataRequest(t,a={}){return await(0,ut.s)(this._request(t,a,{method:"GET",hideFromInspector:!0}))}_request(t,a,r){const n=a?ir.kM.serializeParams(a):"",d=`${this.instanceSettings.url}${t}${n.length?`?${n}`:""}`,l={...r,url:d};return(0,he.AI)().fetch(l)}async testDatasource(){const t={headers:{},method:"GET",url:`${this.instanceSettings.url}/api/echo`};return await(0,ut.s)((0,he.AI)().fetch(t).pipe((0,pt.Z)(()=>(0,M.of)({status:"success",message:"Data source successfully connected."})),(0,be.W)(a=>(0,M.of)({status:"error",message:G(a.data.message,"Unable to connect with Tempo")}))))}getQueryDisplayText(t){return t.queryType!=="nativeSearch"?t.query??"":["serviceName","spanName","search","minDuration","maxDuration","limit"].filter(r=>t[r]).map(r=>`${(0,q.startCase)(r)}: ${t[r]}`).join(", ")}buildSearchQuery(t,a){let r=t.search??"",n=(0,q.pick)(t,["minDuration","maxDuration","limit"]);if(n=(0,q.pickBy)(n,q.identity),t.serviceName&&(r+=` service.name="${t.serviceName}"`),t.spanName&&(r+=` name="${t.spanName}"`),n.limit||(n.limit=pe),n.minDuration){if(n.minDuration=this.templateSrv.replace(n.minDuration??""),!(0,We.pp)(n.minDuration))throw new Error("Please enter a valid min duration.");n.minDuration=n.minDuration.replace(/\s/g,"")}if(n.maxDuration){if(n.maxDuration=this.templateSrv.replace(n.maxDuration??""),!(0,We.pp)(n.maxDuration))throw new Error("Please enter a valid max duration.");n.maxDuration=n.maxDuration.replace(/\s/g,"")}if(!Number.isInteger(n.limit)||n.limit<=0)throw new Error("Please enter a valid limit.");let d={tags:r,...n};return a&&(d.start=a.startTime,d.end=a.endTime),d}}function St(e,t){return(0,_e.H)((0,ne.l)().get(t)).pipe((0,pt.Z)(a=>a.query(e)))}function _r(e,t,a){const r=Tt(e);return St(r,t).pipe((0,mt.$)(),(0,Y.T)(n=>{const d=n.find(p=>!!p.error);if(d)throw new Error(G(d.error?.message));const{nodes:l,edges:i}=(0,k.yz)(n,e.range);if(l.fields.length>0&&i.fields.length>0){const p=l.fields[0].values.length,m=i.fields[0].values.length;(0,D.rR)("grafana_traces_service_graph_size",{datasourceType:"tempo",grafana_version:P.$.buildInfo.version,nodeLength:p,edgeLength:m})}const{serviceMapIncludeNamespace:c,refId:u}=e.targets[0];return l.refId=u,i.refId=u,c?(l.fields[0].config=He(t,a,"__data.fields.title","__data.fields[0]",void 0,{targetNamespace:"__data.fields.subtitle"}),i.fields[0].config=He(t,a,"__data.fields.targetName","__data.fields.target","__data.fields.sourceName",{targetNamespace:"__data.fields.targetNamespace",sourceNamespace:"__data.fields.sourceNamespace"})):(l.fields[0].config=He(t,a,"__data.fields.id","__data.fields[0]"),i.fields[0].config=He(t,a,"__data.fields.target","__data.fields.target","__data.fields.source")),{nodes:l,edges:i,state:de.Gu.Done}}))}function Br(e,t,a){const r=Tt(e);return r.targets=na([Pe(k.hN,k.uW,e)]),St(r,a).pipe((0,mt.$)(),(0,Y.T)(n=>{const d=n.find(l=>!!l.error);if(d)throw new Error(G(d.error?.message));return{rates:n[0]?.data??[],nodes:t.nodes,edges:t.edges}}))}function Gr(e,t,a,r){let n=[],d="",l=[],i=[];if(t.rates[0]&&e.app===or.Jk.Explore){const p=t.rates[0].fields.find(m=>m.name==="span_name");p&&p.values&&(i=p.values)}else t.rates&&t.rates.map(p=>{const m=p.fields.find(g=>g.labels?.span_name);m&&i.push(m.labels?.span_name)});const c=Zr(i);c.length>0&&(d=Pe(k.Zh,'span_name=~"'+c.join("|")+'"',e),n.push(d),c.map(p=>{const m=Pe(k.XF,'span_name=~"'+p+'"',e);l.push(m),n.push(m)}));const u=Tt(e);return u.targets=na(n),St(u,a).pipe((0,mt.$)(),(0,Y.T)(p=>{const m=p.find(O=>!!O.error);if(m)throw new Error(G(m.error?.message));const g=qr(e,t,p[0],d,l,a,r);return g.fields.length===0?{data:[t.nodes,t.edges],state:de.Gu.Done}:{data:[g,t.nodes,t.edges],state:de.Gu.Done}}))}function De(e,t,a,r){return{url:"",title:e,internal:{query:{expr:t,range:!r,exemplar:!r,instant:r},datasourceUid:a,datasourceName:(0,ne.l)().getInstanceSettings(a)?.name??""}}}function Zr(e){return e.map(t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\\\$&"))}function He(e,t,a,r,n,d){let l=n?`client="\${${n}}",`:"",i=`server="\${${a}}"`,c="server";if(d!==void 0){const{targetNamespace:u}=d;if(i+=`,server_service_namespace="\${${u}}"`,c+=", server_service_namespace",l){const{sourceNamespace:p}=d;l+=`client_service_namespace="\${${p}}",`,c+=", client_service_namespace"}}return{links:[De("Request rate",`sum by (client, ${c})(rate(${k.OB}{${l}${i}}[$__rate_interval]))`,e,!1),De("Request histogram",`histogram_quantile(0.9, sum(rate(${k.dk}{${l}${i}}[$__rate_interval])) by (le, client, ${c}))`,e,!1),De("Failed request rate",`sum by (client, ${c})(rate(${k.sL}{${l}${i}}[$__rate_interval]))`,e,!1),ra("View traces",`\${${r}}`,"",t)]}}function ra(e,t,a,r){let n={refId:"A",queryType:"traceqlSearch",filters:[]};return t!==""&&n.filters.push({id:"service-name",scope:R.d.Resource,tag:"service.name",value:t,operator:"=",valueType:"string"}),a!==""&&n.filters.push({id:"span-name",scope:R.d.Span,tag:"name",value:a,operator:"=",valueType:"string"}),{url:"",title:e,internal:{query:n,datasourceUid:r,datasourceName:(0,ne.l)().getInstanceSettings(r)?.name??""}}}function Tt(e){return{...e,targets:k.lp.map(t=>{const{serviceMapQuery:a,serviceMapIncludeNamespace:r}=e.targets[0],n=r?", client_service_namespace, server_service_namespace":"",l=(Array.isArray(a)?a:[a]).map(i=>`sum by (client, server${n}) (rate(${t}${i||""}[$__range]))`);return{format:"table",refId:t,expr:l.join(" OR "),instant:!0}})}}function qr(e,t,a,r,n,d,l){let i={fields:[]};const c=t.rates.filter(m=>m.refId===Pe(k.hN,k.uW,e)),u=a.data.filter(m=>m.refId===r),p=a.data.filter(m=>n.includes(m.refId??""));if(c.length>0&&c[0].fields?.length>2&&(i.fields.push({...c[0].fields[1],name:"Name",config:{filterable:!1}}),i.fields.push({...c[0].fields[2],name:"Rate",config:{links:[De("Rate",yt(Pe(k.hN,'span_name="${__data.fields[0]}"',e)),d,!1)],decimals:2}}),i.fields.push({...c[0].fields[2],name:"  ",labels:null,config:{color:{mode:"continuous-BlPu"},custom:{cellOptions:{mode:xe.eX.Lcd,type:xe.ob.Gauge}},decimals:3}})),u.length>0&&u[0].fields?.length>2){const m=u[0].fields[1]?.values??[],g=u[0].fields[2]?.values??[];let O={};m.map((y,z)=>{O[y]={value:g[z]}});const S=sa({...c},O);i.fields.push({...u[0].fields[2],name:"Error Rate",values:S,config:{links:[De("Error Rate",yt(Pe(k.Zh,'span_name="${__data.fields[0]}"',e)),d,!1)],decimals:2}}),i.fields.push({...u[0].fields[2],name:"   ",values:S,labels:null,config:{color:{mode:"continuous-RdYlGr"},custom:{cellOptions:{mode:xe.eX.Lcd,type:xe.ob.Gauge}},decimals:3}})}if(p.length>0){let m={};p.forEach(g=>{if(g.fields.length>1){const O=g.refId?.includes('span_name=~"')?'span_name=~"':'span_name="',S=g.refId?.split(O)[1].split('"}')[0];m[S]={value:g.fields[1].values[0]}}}),Object.keys(m).length>0&&i.fields.push({...p[0].fields[1],name:"Duration (p90)",values:sa({...c},m),config:{links:[De("Duration",yt(Pe(k.XF,'span_name="${__data.fields[0]}"',e)),d,!1)],unit:"s"}})}return i.fields.length>0&&i.fields[0].values&&i.fields.push({name:"Links",type:K.PU.string,values:i.fields[0].values.map(()=>"Tempo"),config:{links:[ra("Tempo","","${__data.fields[0]}",l)]}}),i}function Pe(e,t,a){let r=a.targets[0]?.serviceMapQuery??"";const i=(Array.isArray(r)?r:[r]).map(c=>{const u=c.match(/^{(.*)}$/);return u?.length&&(c=u[1]),c=c.replace("client","service").replace("server","service"),c.includes("span_name")?e.params.concat(c):e.params.concat(c).concat(t).filter(p=>p)}).map(c=>e.expr.replace("{}","{"+c.join(",")+"}")).join(" OR ");return e.topk?`topk(${e.topk}, ${i})`:i}function yt(e){return e=e.replace("topk(5, ","").replace(" by (span_name))",""),e.replace("__range","__rate_interval")}function sa(e,t){const a=e[0]?.fields[1]?.values??[];let r=[];for(let n=0;n<a.length;n++)Object.keys(t).includes(a[n])?r.push(t[a[n]].value):r.push("0");return r}function na(e){return e.map(t=>({refId:t,expr:t,instant:!0}))}var da=o(32372);class Kr{constructor(t){this.triggerCharacters=["="," "],this.cachedValues={},this.languageProvider=t.languageProvider}provideCompletionItems(t,a){if(!(this.monaco&&this.editor))throw new Error("provideCompletionItems called before CompletionProvider was initialized");if(this.editor.getModel()?.id!==t.id)return{suggestions:[]};const{range:r,offset:n}=Jr(this.monaco,t,a),d=this.getSituation(t.getValue(),n);return this.getCompletions(d).then(i=>{const c=i.length.toString().length;return{suggestions:i.map((p,m)=>({kind:Hr(p.type,this.monaco),label:p.label,insertText:p.insertText,sortText:m.toString().padStart(c,"0"),range:r}))}})}async getTagValues(t){let a;return this.cachedValues.hasOwnProperty(t)?a=this.cachedValues[t]:(a=await this.languageProvider.getOptionsV1(t),this.cachedValues[t]=a),a}async getCompletions(t){switch(t.type){case"UNKNOWN":return[];case"EMPTY":return this.getTagsCompletions();case"IN_NAME":return this.getTagsCompletions();case"IN_VALUE":const a=await this.getTagValues(t.tagName),r=[],n=d=>`"${d.label}"`;return a.forEach(d=>{d?.label&&r.push({label:d.label,insertText:n(d),type:"TAG_VALUE"})}),r;default:throw new Error(`Unexpected situation ${t}`)}}getTagsCompletions(){return this.languageProvider.getAutocompleteTags().sort((a,r)=>a.localeCompare(r,void 0,{sensitivity:"accent"})).map(a=>({label:a,insertText:a,type:"TAG_NAME"}))}getSituation(t,a){if(t===""||a===0||t[t.length-1]===" ")return{type:"EMPTY"};const r=t.substring(0,a),n=/(?<key>[^= ]+)(?<equals>=)?(?<value>([^ "]+)|"([^"]*)")?/,d=r.match(new RegExp(n,"g"));if(d?.length){const i=d[d.length-1].match(n);if(i){const c=i.groups?.key,u=i.groups?.equals;return c?u?{type:"IN_VALUE",tagName:c}:{type:"IN_NAME"}:{type:"EMPTY"}}}return{type:"EMPTY"}}}function Hr(e,t){switch(e){case"TAG_NAME":return t.languages.CompletionItemKind.Enum;case"KEYWORD":return t.languages.CompletionItemKind.Keyword;case"OPERATOR":return t.languages.CompletionItemKind.Operator;case"TAG_VALUE":return t.languages.CompletionItemKind.EnumMember;case"SCOPE":return t.languages.CompletionItemKind.Class;default:throw new Error(`Unexpected CompletionType: ${e}`)}}function Jr(e,t,a){const r=t.getWordAtPosition(a),n=r!=null?e.Range.lift({startLineNumber:a.lineNumber,endLineNumber:a.lineNumber,startColumn:r.startColumn,endColumn:r.endColumn}):e.Range.fromPositions(a),d={column:a.column,lineNumber:a.lineNumber};return{offset:t.getOffsetAt(d),range:n}}const es={id:"tagsfield",extensions:[".tagsfield"],aliases:["tagsfield"],mimetypes:[],def:{language:{ignoreCase:!1,defaultToken:"",tokenPostfix:".tagsfield",operators:["="],symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,integersuffix:/(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,floatsuffix:/[fFlL]?/,tokenizer:{root:[[/[a-z_.][\w./_-]*(?=\s*(=|!=|>|<|>=|<=|=~|!~))/,"tag"],[/[a-zA-Z_.]\w*/,{cases:{"@default":"identifier"}}],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/\d+/,"number"],[/\d*\d+[eE]([\-+]?\d+)?(@floatsuffix)/,"number.float"],[/\d*\.\d+([eE][\-+]?\d+)?(@floatsuffix)/,"number.float"],[/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/,"number.hex"],[/0[0-7']*[0-7](@integersuffix)/,"number.octal"],[/0[bB][0-1']*[0-1](@integersuffix)/,"number.binary"],[/\d[\d']*\d(@integersuffix)/,"number"],[/\d(@integersuffix)/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],clauses:[[/[^(,)]/,"tag"],[/\)/,"identifier","@pop"]],whitespace:[[/[ \t\r\n]+/,"white"]]}},languageConfiguration:{wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,brackets:[["{","}"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}}}};function ts(e){const{onChange:t,onBlur:a,placeholder:r}=e,n=ss(e.datasource),d=(0,T.$j)(),l=ds(d,r);return s.createElement(da.B,{value:e.value,language:Ae,onBlur:a,onChange:t,containerStyles:l.queryField,monacoOptions:{folding:!1,fontSize:14,lineNumbers:"off",overviewRulerLanes:0,renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,wordWrap:"on"},onBeforeEditorMount:ns,onEditorDidMount:(i,c)=>{n(i,c),as(i,c,l),rs(i)}})}function as(e,t,a){const r=[{range:new t.Range(1,1,1,1),options:{className:a.placeholder,isWholeLine:!0}}];let n=[];const d=()=>{const l=e.getModel();if(!l)return;const i=l.getValueLength()===0?r:[];n=l.deltaDecorations(n,i)};d(),e.onDidChangeModelContent(d)}function rs(e){const t=e.getDomNode(),a=()=>{if(t){const r=Math.min(1e3,e.getContentHeight()),n=parseInt(t.style.width,10);t.style.width=`${n}px`,t.style.height=`${r}px`,e.layout({width:n,height:r})}};e.onDidContentSizeChange(a),a()}function ss(e){const t=(0,s.useRef)(new Kr({languageProvider:e.languageProvider}));(0,s.useEffect)(()=>{(async()=>{try{await e.languageProvider.start()}catch(n){n instanceof Error&&Qe(Te(ye("Error",n)))}})()},[e]);const a=(0,s.useRef)(null);return(0,s.useEffect)(()=>()=>{a.current?.()},[]),(r,n)=>{t.current.editor=r,t.current.monaco=n;const{dispose:d}=n.languages.registerCompletionItemProvider(Ae,t.current);a.current=d}}let la=!1;const Ae="tagsfield";function ns(e){if(!la){la=!0;const{aliases:t,extensions:a,mimetypes:r,def:n}=es;e.languages.register({id:Ae,aliases:t,extensions:a,mimetypes:r}),e.languages.setMonarchTokensProvider(Ae,n.language),e.languages.setLanguageConfiguration(Ae,n.languageConfiguration)}}const ds=(e,t)=>({queryField:(0,h.css)({borderRadius:e.shape.radius.default,border:`1px solid ${e.components.input.borderColor}`,flex:1}),placeholder:(0,h.css)({"::after":{content:`'${t}'`,fontFamily:e.typography.fontFamilyMonospace,opacity:.3}})}),ia="e.g. 1.2s, 100ms",ls=({datasource:e,query:t,onChange:a,onBlur:r,onRunQuery:n})=>{const d=(0,T.of)(is),l=(0,s.useMemo)(()=>new ta(e),[e]),[i,c]=(0,s.useState)(),[u,p]=(0,s.useState)(),[m,g]=(0,s.useState)(null),[O,S]=(0,s.useState)({}),[y,z]=(0,s.useState)({serviceName:!1,spanName:!1}),_=(0,s.useCallback)(async(E,U="")=>{const fe=E==="serviceName"?"service.name":"name";z(X=>({...X,[E]:!0}));try{return(await l.getOptionsV1(fe)).filter(x=>x.value?(0,Ya.I)(x.value,U).found:!1)}catch(X){return(0,he.NF)(X)&&X?.status===404?g(X):X instanceof Error&&Qe(Te(ye("Error",X))),[]}finally{z(X=>({...X,[E]:!1}))}},[l]);(0,s.useEffect)(()=>{(async()=>{try{const[U,fe]=await Promise.all([_("serviceName"),_("spanName")]);t.serviceName&&(0,ve.w)().containsTemplate(t.serviceName)&&U.push((0,jt.z)(t.serviceName)),c(U),t.spanName&&(0,ve.w)().containsTemplate(t.spanName)&&fe.push((0,jt.z)(t.spanName)),p(fe)}catch(U){(0,he.NF)(U)&&U?.status===404?g(U):U instanceof Error&&Qe(Te(ye("Error",U)))}})()},[l,_,t.serviceName,t.spanName]);const v=E=>{E.key==="Enter"&&(E.shiftKey||E.ctrlKey)&&n()},I=(0,s.useCallback)(E=>{a({...t,search:E})},[a,t]),L=(0,ve.w)();return s.createElement(s.Fragment,null,s.createElement("div",{className:d.container},s.createElement(Se.F,{title:"Deprecated query type",severity:"warning"},"This query type has been deprecated and will be removed in Grafana v10.3. Please migrate to another Tempo query type."),s.createElement(C.C,null,s.createElement(Q.I,{label:"Service Name",labelWidth:14,grow:!0},s.createElement(Z.l6,{inputId:"service",options:i,onOpenMenu:()=>{_("serviceName")},isLoading:y.serviceName,value:i?.find(E=>E?.value===t.serviceName)||t.serviceName,onChange:E=>{a({...t,serviceName:E?.value})},placeholder:"Select a service",isClearable:!0,onKeyDown:v,"aria-label":"select-service-name",allowCustomValue:!0}))),s.createElement(C.C,null,s.createElement(Q.I,{label:"Span Name",labelWidth:14,grow:!0},s.createElement(Z.l6,{inputId:"spanName",options:u,onOpenMenu:()=>{_("spanName")},isLoading:y.spanName,value:u?.find(E=>E?.value===t.spanName)||t.spanName,onChange:E=>{a({...t,spanName:E?.value})},placeholder:"Select a span",isClearable:!0,onKeyDown:v,"aria-label":"select-span-name",allowCustomValue:!0}))),s.createElement(C.C,null,s.createElement(Q.I,{label:"Tags",labelWidth:14,grow:!0,tooltip:"Values should be in logfmt."},s.createElement(ts,{placeholder:"http.status_code=200 error=true",value:t.search||"",onChange:I,onBlur:r,datasource:e}))),s.createElement(C.C,null,s.createElement(Q.I,{label:"Min Duration",invalid:!!O.minDuration,labelWidth:14,grow:!0},s.createElement(ze.p,{id:"minDuration",value:t.minDuration||"",placeholder:ia,onBlur:()=>{const E=L.replace(t.minDuration??"");t.minDuration&&!(0,We.pp)(E)?S({...O,minDuration:!0}):S({...O,minDuration:!1})},onChange:E=>a({...t,minDuration:E.currentTarget.value}),onKeyDown:v}))),s.createElement(C.C,null,s.createElement(Q.I,{label:"Max Duration",invalid:!!O.maxDuration,labelWidth:14,grow:!0},s.createElement(ze.p,{id:"maxDuration",value:t.maxDuration||"",placeholder:ia,onBlur:()=>{const E=L.replace(t.maxDuration??"");t.maxDuration&&!(0,We.pp)(E)?S({...O,maxDuration:!0}):S({...O,maxDuration:!1})},onChange:E=>a({...t,maxDuration:E.currentTarget.value}),onKeyDown:v}))),s.createElement(C.C,null,s.createElement(Q.I,{label:"Limit",invalid:!!O.limit,labelWidth:14,grow:!0,tooltip:"Maximum number of returned results"},s.createElement(ze.p,{id:"limit",value:t.limit||"",placeholder:`Default: ${pe}`,type:"number",onChange:E=>{let U=E.currentTarget.value?parseInt(E.currentTarget.value,10):void 0;U&&(!Number.isInteger(U)||U<=0)?S({...O,limit:!0}):S({...O,limit:!1}),a({...t,limit:E.currentTarget.value?parseInt(E.currentTarget.value,10):void 0})},onKeyDown:v})))),m?s.createElement(Se.F,{title:"Unable to connect to Tempo search",severity:"info",className:d.alert},"Please ensure that Tempo is configured with search enabled. If you would like to hide this tab, you can configure it in the ",s.createElement("a",{href:`/datasources/edit/${e.uid}`},"datasource settings"),"."):null)},is=e=>({container:(0,h.css)({maxWidth:"500px"}),alert:(0,h.css)({maxWidth:"75ch",marginTop:e.spacing(2)})});var os=o(28848),cs=o.n(os);function us({query:e,lang:t,className:a}){const r=(0,T.$j)(),n=ps(r),d=cs().highlight(e,t.grammar,t.name);return s.createElement("div",{className:(0,h.cx)(n.editorField,"prism-syntax-highlight",a),"aria-label":"selector",dangerouslySetInnerHTML:{__html:d}})}const ps=e=>({editorField:(0,h.css)({fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize})});var ms=o(9e4),Et=o(81580),oa=o(51440),gs=o(42941),Os=o(83195),fs=o(82762),ca=o(67061),hs=o(56034),ua=o(14578);function vs({title:e,children:t,collapsedInfo:a,queryStats:r}){const[n,d]=(0,gs.A)(!1),l=(0,T.of)(Ss);return s.createElement("div",{className:l.wrapper},s.createElement(fs.S,{className:l.collapse,collapsible:!0,isOpen:n,onToggle:d,label:s.createElement(ca.B,{gap:0},s.createElement("h6",{className:l.title},e),!n&&s.createElement("div",{className:l.description},a.map((i,c)=>s.createElement("span",{key:c},i))))},s.createElement("div",{className:l.body},t)),r&&P.$.featureToggles.lokiQuerySplitting&&s.createElement(hs.m,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part."},s.createElement(ua.I,{tabIndex:0,name:"info-circle",className:l.tooltip,size:"sm"})),r&&s.createElement("p",{className:l.stats},Ts(r)))}const Ss=e=>({collapse:(0,h.css)({backgroundColor:"unset",border:"unset",marginBottom:0,["> button"]:{padding:e.spacing(0,1)}}),wrapper:(0,h.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,h.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,h.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,h.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"}),stats:(0,h.css)({margin:"0px",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize}),tooltip:(0,h.css)({marginRight:e.spacing(.25)})}),Ts=e=>e.message?e.message:`This query will process approximately ${ys(e)}.`,ys=e=>{const{text:t,suffix:a}=(0,Os.j_)("bytes")(e.bytes,1);return t+a},pa=(e,t)=>{const a=parseInt(e,10);return isNaN(a)?t:a},Qt=s.memo(({onChange:e,query:t})=>{t.hasOwnProperty("limit")||(t.limit=pe),t.hasOwnProperty("tableType")||(t.tableType=R.Jv.Traces);const a=l=>{e({...t,limit:pa(l.currentTarget.value,pe)})},r=l=>{e({...t,spss:pa(l.currentTarget.value,Ie)})},n=l=>{e({...t,tableType:l})},d=[`Limit: ${t.limit||pe}`,`Spans Limit: ${t.spss||Ie}`,`Table Format: ${t.tableType===R.Jv.Traces?"Traces":"Spans"}`];return s.createElement(s.Fragment,null,s.createElement(ms.U,null,s.createElement(vs,{title:"Options",collapsedInfo:d},s.createElement(Et.c,{label:"Limit",tooltip:"Maximum number of traces to return."},s.createElement(oa.D,{className:"width-4",placeholder:"auto",type:"number",min:1,defaultValue:t.limit||pe,onCommitChange:a,value:t.limit})),s.createElement(Et.c,{label:"Span Limit",tooltip:"Maximum number of spans to return for each span set."},s.createElement(oa.D,{className:"width-4",placeholder:"auto",type:"number",min:1,defaultValue:t.spss||Ie,onCommitChange:r,value:t.spss})),s.createElement(Et.c,{label:"Table Format",tooltip:"How the query data should be displayed in the results table"},s.createElement(j.z,{options:[{label:"Traces",value:R.Jv.Traces},{label:"Spans",value:R.Jv.Spans}],value:t.tableType,onChange:n})))))});Qt.displayName="TempoQueryBuilderOptions";const Es=/^(\$\w+)|(\d+(?:\.\d)?\d*(?:us|Âµs|ns|ms|s|m|h))$/,Qs=()=>({noBoxShadow:(0,h.css)({boxShadow:"none","*:focus":{boxShadow:"none"}})}),ma=({filter:e,operators:t,updateFilter:a})=>{const r=(0,T.of)(Qs);let n=!1;return typeof e.value=="string"&&(n=e.value?!Es.test(e.value.concat("")):!1),s.createElement(N.Gy,{spacing:"none"},s.createElement(Z.l6,{className:r.noBoxShadow,inputId:`${e.id}-operator`,options:t.map(ea),value:e.operator,onChange:d=>{a({...e,operator:d?.value})},isClearable:!1,"aria-label":`select ${e.id} operator`,allowCustomValue:!0,width:8}),s.createElement(ze.p,{className:r.noBoxShadow,value:e.value,onChange:d=>{a({...e,value:d.currentTarget.value})},placeholder:"e.g. 100ms, 1.2s","aria-label":`select ${e.id} value`,invalid:n,width:18}))};var Je=o(3721);const Le=({label:e,tooltip:t,children:a})=>s.createElement(C.C,null,s.createElement(Q.I,{label:e,labelWidth:28,grow:!0,tooltip:t},a)),bs=e=>{const{datasource:t,onChange:a,query:r,isTagsLoading:n}=e,d=(0,T.of)(xs),l=()=>(0,Ye.A)().slice(0,8);(0,s.useEffect)(()=>{(!r.groupBy||r.groupBy.length===0)&&a({...r,groupBy:[{id:l(),scope:R.d.Span}]})},[a,r]);const i=g=>t.languageProvider.getMetricsSummaryTags(g.scope),c=()=>{p({id:l(),scope:R.d.Span})},u=g=>{a({...r,groupBy:r.groupBy?.filter(O=>O.id!==g.id)})},p=g=>{const O={...r};O.groupBy||=[];const S=O.groupBy.findIndex(y=>y.id===g.id);S>=0?O.groupBy=ft(O.groupBy,S,g):O.groupBy.push(g),a(O)},m=Object.values(R.d).map(g=>({label:g,value:g}));return s.createElement(Le,{label:"Aggregate by",tooltip:"Select one or more tags to see the metrics summary. Note: the metrics summary API only considers spans of kind = server."},s.createElement(s.Fragment,null,r.groupBy?.map((g,O)=>s.createElement("div",{key:g.id},s.createElement(N.Gy,{spacing:"none",width:"auto"},s.createElement(Z.l6,{"aria-label":`Select scope for filter ${O+1}`,onChange:S=>{p({...g,scope:S?.value,tag:""})},options:m,placeholder:"Select scope",value:g.scope}),s.createElement(Z.l6,{"aria-label":`Select tag for filter ${O+1}`,isClearable:!0,isLoading:n,key:g.tag,onChange:S=>{p({...g,tag:S?.value})},options:i(g)?.map(S=>({label:S,value:S})),placeholder:"Select tag",value:g.tag||""}),(g.tag||(r.groupBy?.length??0)>1)&&s.createElement(Je.Z,{"aria-label":`Remove tag for filter ${O+1}`,icon:"times",onClick:()=>u(g),tooltip:"Remove tag",title:`Remove tag for filter ${O+1}`,variant:"secondary"}),g.tag&&O===(r.groupBy?.length??0)-1&&s.createElement("span",{className:d.addTag},s.createElement(Je.Z,{"aria-label":"Add tag",icon:"plus",onClick:()=>c(),tooltip:"Add tag",variant:"secondary"})))))))},xs=e=>({addTag:(0,h.css)({marginLeft:e.spacing(1)})}),Rs=()=>({dropdown:(0,h.css)({boxShadow:"none"})}),bt=({filter:e,datasource:t,updateFilter:a,isTagsLoading:r,tags:n,setError:d,hideScope:l,hideTag:i,hideValue:c,query:u,isMulti:p=!0,allowCustomValue:m=!0})=>{const g=(0,T.of)(Rs),O=(0,s.useMemo)(()=>gt(e),[e]),[S,y]=(0,s.useState)(e.operator),[z,_]=(0,s.useState)(e.value),v=async()=>{try{return e.tag?await t.languageProvider.getOptionsV2(O,u):[]}catch(x){(0,he.NF)(x)&&x?.status===404?d(x):x instanceof Error&&Qe(Te(ye("Error",x)))}return[]},{loading:I,value:L}=(0,f.A)(v,[O,t.languageProvider,d,u]);e.value&&!Array.isArray(e.value)&&L&&!L.find(x=>x.value===e.value)&&L.push({label:e.value.toString(),value:e.value.toString(),type:e.valueType}),(0,s.useEffect)(()=>{Array.isArray(e.value)&&e.value.length>1&&e.operator!=="=~"&&e.operator!=="!~"&&(y(e.operator),a({...e,operator:"=~"})),Array.isArray(e.value)&&e.value.length<=1&&(z?.length||0)>1&&a({...e,operator:S,value:e.value[0]})},[z,S,a,e]),(0,s.useEffect)(()=>{_(e.value)},[e.value]);const E=Object.values(R.d).filter(x=>x!==R.d.Intrinsic).map(x=>({label:x,value:x})),U=L?.filter(x=>x.type===L[0]?.type),fe=L?.length===U?.length?L?.[0]?.type:void 0;let X=qt;switch(fe){case"keyword":X=ur;break;case"string":X=pr;break;case"int":case"float":X=mr}const je=x=>{const Ft=(0,ve.w)().getVariables();return[...x||[],...Ft.map(La=>({label:`$${La.name}`,value:`$${La.name}`}))]};return s.createElement(N.Gy,{spacing:"none",width:"auto"},!l&&s.createElement(Z.l6,{className:g.dropdown,inputId:`${e.id}-scope`,options:je(E),value:e.scope,onChange:x=>{a({...e,scope:x?.value})},placeholder:"Select scope","aria-label":`select ${e.id} scope`}),!i&&s.createElement(Z.l6,{className:g.dropdown,inputId:`${e.id}-tag`,isLoading:r,options:je((e.tag!==void 0?(0,q.uniq)([e.tag,...n]):n).map(x=>({label:x,value:x}))),value:e.tag,onChange:x=>{a({...e,tag:x?.value,value:[]})},placeholder:"Select tag",isClearable:!0,"aria-label":`select ${e.id} tag`,allowCustomValue:!0}),s.createElement(Z.l6,{className:g.dropdown,inputId:`${e.id}-operator`,options:je(X.map(ea)),value:e.operator,onChange:x=>{a({...e,operator:x?.value})},isClearable:!1,"aria-label":`select ${e.id} operator`,allowCustomValue:!0,width:8}),!c&&s.createElement(Z.l6,{className:g.dropdown,inputId:`${e.id}-value`,isLoading:I,options:je(L),value:e.value,onChange:x=>{Array.isArray(x)?a({...e,value:x.map(Ft=>Ft.value),valueType:x[0]?.type||fe}):a({...e,value:x?.value,valueType:x?.type||fe})},placeholder:"Select value",isClearable:!0,"aria-label":`select ${e.id} value`,allowCustomValue:m,isMulti:p,allowCreateWhileLoading:!0}))},Ps=e=>({vertical:(0,h.css)({display:"flex",flexDirection:"column",gap:e.spacing(.25)}),horizontal:(0,h.css)({display:"flex",flexDirection:"row",gap:e.spacing(1)}),addTag:(0,h.css)({marginLeft:e.spacing(1)})}),ga=({updateFilter:e,deleteFilter:t,filters:a,datasource:r,setError:n,staticTags:d,isTagsLoading:l,hideValues:i,requireTagAndValue:c,query:u})=>{const p=(0,T.of)(Ps),m=()=>(0,Ye.A)().slice(0,8),g=(0,s.useCallback)(()=>e({id:m(),operator:"=",scope:R.d.Span}),[e]);(0,s.useEffect)(()=>{a?.length||g()},[a,g]);const O=y=>{const z=r.languageProvider.getTags(y.scope);return yr(z,d)},S=y=>c?y.tag&&y.value&&y.value.length>0:y.tag;return s.createElement("div",{className:p.vertical},a?.map((y,z)=>s.createElement("div",{className:p.horizontal,key:y.id},s.createElement(bt,{filter:y,datasource:r,setError:n,updateFilter:e,tags:O(y),isTagsLoading:l,hideValue:i,query:u}),(S(y)||a.length>1)&&s.createElement(Je.Z,{"aria-label":`Remove tag with ID ${y.id}`,variant:"secondary",icon:"times",onClick:()=>t?.(y),tooltip:"Remove tag"}),S(y)&&z===a.length-1&&s.createElement("span",{className:p.addTag},s.createElement(Je.Z,{"aria-label":"Add tag",variant:"secondary",icon:"plus",onClick:g,tooltip:"Add tag"})))))},ws=["min-duration","max-duration","status"],Cs=({datasource:e,query:t,onChange:a,onClearResults:r,app:n})=>{const d=(0,T.of)(Is),[l,i]=(0,s.useState)(null),[c,u]=(0,s.useState)(!0),[p,m]=(0,s.useState)(""),g=(0,ve.w)(),O=(0,s.useCallback)(v=>{const I={...t};I.filters||=[];const L=I.filters.findIndex(E=>E.id===v.id);L>=0?I.filters=ft(I.filters,L,v):I.filters.push(v),a(I)},[a,t]),S=v=>{a({...t,filters:t.filters.filter(I=>I.id!==v.id)})};(0,s.useEffect)(()=>{m(Ce(t.filters||[]))},[t]);const y=(0,s.useCallback)(v=>t.filters?.find(I=>I.id===v),[t.filters]);(0,s.useEffect)(()=>{(async()=>{try{await e.languageProvider.start(),u(!1)}catch(I){I instanceof Error&&Qe(Te(ye("Error",I)))}})()},[e]),(0,s.useEffect)(()=>{e.search?.filters?.filter(v=>v.value).forEach(v=>{y(v.id)||O(v)})},[e.search?.filters,y,O]);const z=e.search?.filters?.map(v=>v.tag)||[];z.push("duration"),z.push("traceDuration");const _=(t.filters||[]).filter(v=>!ws.includes(v.id)&&(e.search?.filters?.findIndex(I=>I.id===v.id)||0)===-1&&v.id!=="duration-type");return s.createElement(s.Fragment,null,s.createElement("div",{className:d.container},s.createElement("div",null,e.search?.filters?.map(v=>v.tag&&s.createElement(Le,{key:v.id,label:Tr(v),tooltip:`Filter your search by ${gt(v)}. To modify the default filters shown for search visit the Tempo datasource configuration page.`},s.createElement(bt,{filter:y(v.id)||v,datasource:e,setError:i,updateFilter:O,tags:[],hideScope:!0,hideTag:!0,query:p}))),s.createElement(Le,{label:"Status"},s.createElement(bt,{filter:y("status")||{id:"status",tag:"status",scope:R.d.Intrinsic,operator:"="},datasource:e,setError:i,updateFilter:O,tags:[],hideScope:!0,hideTag:!0,query:p,isMulti:!1,allowCustomValue:!1})),s.createElement(Le,{label:"Duration",tooltip:"The trace or span duration, i.e. end - start time of the trace/span. Accepted units are ns, ms, s, m, h"},s.createElement(N.Gy,{spacing:"none"},s.createElement(Z.l6,{options:[{label:"span",value:"span"},{label:"trace",value:"trace"}],value:y("duration-type")?.value??"span",onChange:v=>{const I=y("duration-type")||{id:"duration-type",value:"span"};O({...I,value:v?.value})},"aria-label":"duration type"}),s.createElement(ma,{filter:y("min-duration")||{id:"min-duration",tag:"duration",operator:">",valueType:"duration"},operators:[">",">="],updateFilter:O}),s.createElement(ma,{filter:y("max-duration")||{id:"max-duration",tag:"duration",operator:"<",valueType:"duration"},operators:["<","<="],updateFilter:O}))),s.createElement(Le,{label:"Tags"},s.createElement(ga,{filters:_,datasource:e,setError:i,updateFilter:O,deleteFilter:S,staticTags:z,isTagsLoading:c,query:p,requireTagAndValue:!0})),P.$.featureToggles.metricsSummary&&s.createElement(bs,{datasource:e,onChange:a,query:t,isTagsLoading:c})),s.createElement("div",{className:d.rawQueryContainer},s.createElement(us,{query:g.replace(p),lang:{grammar:hr,name:"traceql"}}),s.createElement(H.$n,{variant:"secondary",size:"sm",onClick:()=>{(0,D.rR)("grafana_traces_copy_to_traceql_clicked",{app:n??"",grafana_version:P.$.buildInfo.version,location:"search_tab"}),r();const v=Ce(t.filters||[]);a({...t,query:v,queryType:"traceql"})}},"Edit in TraceQL")),s.createElement(Qt,{onChange:a,query:t})),l?s.createElement(Se.F,{title:"Unable to connect to Tempo search",severity:"info",className:d.alert},"Please ensure that Tempo is configured with search enabled. If you would like to hide this tab, you can configure it in the ",s.createElement("a",{href:`/datasources/edit/${e.uid}`},"datasource settings"),"."):null)},Is=e=>({alert:(0,h.css)({maxWidth:"75ch",marginTop:e.spacing(2)}),container:(0,h.css)({display:"flex",gap:"4px",flexWrap:"wrap",flexDirection:"column"}),rawQueryContainer:(0,h.css)({alignItems:"center",backgroundColor:e.colors.background.secondary,display:"flex",justifyContent:"space-between",padding:e.spacing(1)})});var Oa=o(38401),Ds=o(72635),xt=o(83684);const fa=90,ha=({datasource:e,onChange:t,disabled:a,filterKey:r,allFilters:n})=>{const d=()=>va(e,r,n),l=()=>$s(e,r,n);return r===null?s.createElement("div",{className:"gf-form","data-testid":"AdHocFilterKey-add-key-wrapper"},s.createElement(xt.s,{disabled:a,className:"query-segment-key",Component:zs,value:r,onChange:t,loadOptions:d,inputMinWidth:fa})):s.createElement("div",{className:"gf-form","data-testid":"AdHocFilterKey-key-wrapper"},s.createElement(xt.s,{disabled:a,className:"query-segment-key",value:r,onChange:t,loadOptions:l,inputMinWidth:fa}))},et="-- remove filter --",Ns={label:et,value:et},zs=s.createElement("span",{className:"gf-form-label query-part","aria-label":"Add Filter"},s.createElement(ua.I,{name:"plus"})),va=async(e,t,a)=>{const r=await(0,ne.l)().get(e);if(!r||!r.getTagKeys)return[];const n=a.filter(l=>l.key!==t);return(await r.getTagKeys({filters:n})).map(l=>({label:l.text,value:l.text}))},$s=async(e,t,a)=>{const r=await va(e,t,a);return[Ns,...r]};var Ms=o(43127);const As=({datasource:e,disabled:t,onChange:a,filterKey:r,filterValue:n,placeHolder:d,allFilters:l})=>{const i=()=>Ls(e,r,l);return s.createElement("div",{className:"gf-form","data-testid":"AdHocFilterValue-value-wrapper"},s.createElement(xt.s,{className:"query-segment-value",disabled:t,placeholder:d,value:n,onChange:a,loadOptions:i}))},Ls=async(e,t,a)=>{const r=await(0,ne.l)().get(e);if(!r||!r.getTagValues)return[];const n=(0,Ms.E2)(),d=a.filter(i=>i.key!==t);return(await r.getTagValues({key:t,filters:d,timeRange:n})).map(i=>({label:i.text,value:i.text}))},Vs=["=","!=","<",">","=~","!~"].map(e=>({label:e,value:e})),Fs=({value:e,disabled:t,onChange:a})=>s.createElement(Oa.Y,{className:"query-segment-operator",value:e,disabled:t,options:Vs,onChange:a}),Sa=({datasource:e,filter:{key:t,operator:a,value:r},onKeyChange:n,onOperatorChange:d,onValueChange:l,placeHolder:i,allFilters:c,disabled:u})=>s.createElement(s.Fragment,null,s.createElement(ha,{disabled:u,datasource:e,filterKey:t,onChange:n,allFilters:c}),s.createElement("div",{className:"gf-form"},s.createElement(Fs,{disabled:u,value:a,onChange:d})),s.createElement(As,{disabled:u,datasource:e,filterKey:t,filterValue:r,allFilters:c,onChange:l,placeHolder:i})),Us=Ds.default.t,js=(e,t,a)=>Us(e,t,a),Xs=({datasource:e,appendBefore:t,onCompleted:a,allFilters:r})=>{const[n,d]=(0,s.useState)(null),[l,i]=(0,s.useState)("="),c=(0,s.useCallback)(m=>{if(m.value!==et){d(m.value??"");return}d(null)},[d]),u=(0,s.useCallback)(m=>i(m.value??""),[i]),p=(0,s.useCallback)(m=>{a({value:m.value??"",operator:l,key:n}),d(null),i("=")},[a,l,n]);return n===null?s.createElement(ha,{datasource:e,filterKey:n,onChange:c,allFilters:r}):s.createElement(s.Fragment,{key:"filter-builder"},t,s.createElement(Sa,{datasource:e,filter:{key:n,value:"",operator:l},placeHolder:js("variable.adhoc.placeholder","Select value"),onKeyChange:c,onOperatorChange:u,onValueChange:p,allFilters:r}))},Ta=({label:e})=>s.createElement("div",{className:"gf-form"},s.createElement("span",{className:"gf-form-label query-keyword"},e));class Ws extends s.PureComponent{constructor(){super(...arguments),this.onChange=(t,a)=>r=>{const{filters:n}=this.props,{value:d}=r;return r.value===et?this.props.removeFilter(t):this.props.changeFilter(t,{...n[t],[a]:d})},this.appendFilterToVariable=t=>{this.props.addFilter(t)}}render(){const{filters:t,disabled:a}=this.props;return s.createElement("div",{className:"gf-form-inline"},this.renderFilters(t,a),!a&&s.createElement(Xs,{datasource:this.props.datasource,appendBefore:t.length>0?s.createElement(Ta,{label:"AND"}):null,onCompleted:this.appendFilterToVariable,allFilters:this.getAllFilters()}))}getAllFilters(){return this.props.baseFilters?this.props.baseFilters.concat(this.props.filters):this.props.filters}renderFilters(t,a){return t.length===0&&a?s.createElement(Oa.Y,{disabled:a,value:"No filters",options:[],onChange:()=>{}}):t.reduce((r,n,d)=>(r.length>0&&r.push(s.createElement(Ta,{label:"AND",key:`condition-${d}`})),r.push(this.renderFilterSegments(n,d,a)),r),[])}renderFilterSegments(t,a,r){return s.createElement(s.Fragment,{key:`filter-${a}`},s.createElement(Sa,{disabled:r,datasource:this.props.datasource,filter:t,onKeyChange:this.onChange(a,"key"),onOperatorChange:this.onChange(a,"operator"),onValueChange:this.onChange(a,"value"),allFilters:this.getAllFilters()}))}}function ks({graphDatasourceUid:e,query:t,onChange:a}){const r=(0,T.of)(_s),n=(0,f.A)(()=>Ut(e),[e]),[d,l]=(0,s.useState)(void 0);if((0,s.useEffect)(()=>{async function u(p){const m=await p.getTagKeys({filters:[{key:"__name__",operator:"=~",value:"traces_service_graph_request_server_seconds_sum|traces_service_graph_request_total|traces_service_graph_request_failed_total",condition:""}]});l(!!m.length)}!n.loading&&n.value&&u(n.value)},[n]),n.loading)return null;const i=n.value;if(!e)return Rt("No service graph datasource selected","Please set up a service graph datasource in the datasource settings",r);if(e&&!i)return Rt("No service graph data found","Service graph datasource is configured but the data source no longer exists. Please configure existing data source to use the service graph functionality",r);const c=Ys((Array.isArray(t.serviceMapQuery)?t.serviceMapQuery[0]:t.serviceMapQuery)||"");return s.createElement("div",null,s.createElement(C.C,null,s.createElement(Q.I,{label:"Filter",labelWidth:14,grow:!0},s.createElement(Ws,{datasource:{uid:e},filters:c,baseFilters:[{key:"__name__",operator:"=~",value:"traces_service_graph_request_total|traces_spanmetrics_calls_total",condition:""}],addFilter:u=>{a({...t,serviceMapQuery:Pt([...c,u])})},removeFilter:u=>{const p=[...c];p.splice(u,1),a({...t,serviceMapQuery:Pt(p)})},changeFilter:(u,p)=>{const m=[...c];m.splice(u,1,p),a({...t,serviceMapQuery:Pt(m)})}}))),d===!1?Rt("No service graph data found","Please ensure that service graph metrics are set up correctly",r):null)}function Rt(e,t,a){return s.createElement(Se.F,{title:e,severity:"info",className:a.alert},t," according to the"," ",s.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://grafana.com/docs/grafana/latest/datasources/tempo/service-graph/",className:a.link},"Tempo documentation"),".")}function Ys(e){let t,a=[];const r=/([\w_]+)(=|!=|<|>|=~|!~)"(.*?)"/g;for(;(t=r.exec(e))!==null;)a.push({key:t[1],operator:t[2],value:t[3],condition:""});return a}function Pt(e){return`{${e.map(t=>`${t.key}${t.operator}"${t.value}"`).join(",")}}`}const _s=e=>({alert:(0,h.css)({maxWidth:"75ch",marginTop:e.spacing(2)}),link:(0,h.css)({color:e.colors.text.link,textDecoration:"underline"})}),Bs={};var Gs=(e=>(e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.INTERNAL=1]="INTERNAL",e[e.SERVER=2]="SERVER",e[e.CLIENT=3]="CLIENT",e[e.PRODUCER=4]="PRODUCER",e[e.CONSUMER=5]="CONSUMER",e))(Gs||{}),Zs=(e=>(e[e.Error=7e3]="Error",e[e.Info=3e3]="Info",e[e.Success=3e3]="Success",e[e.Warning=5e3]="Warning",e))(Zs||{});const qs=e=>(0,h.css)({position:"absolute",zIndex:e.zIndex.portal,top:0,right:10}),Ks={error:7e3,info:3e3,success:3e3,warning:5e3},Hs=e=>{const t=qs((0,T.$j)()),[a,r]=(0,s.useState)(!1),[n,d]=(0,s.useState)();return(0,s.useEffect)(()=>()=>{n&&clearTimeout(n)},[n]),(0,s.useEffect)(()=>{if(e.text!==""){r(!0);const l=setTimeout(()=>{r(!1)},Ks[e.severity]);d(l)}},[e.severity,e.text]),s.createElement(s.Fragment,null,a&&s.createElement(Se.F,{className:t,elevated:!0,title:e.text,severity:e.severity}))};var ya=o(48820);const wt=ya.U1.deserialize({version:14,states:"1pO]QPOOP!pOPOOO]QPO'#CkO#dQPO'#CjO%wQQO'#ClOOQO'#DP'#DPOOQO'#DO'#DOO&OQPO'#DOO&TQSO'#C{OOQO'#C|'#C|O&]QPO'#C|O&hQPO'#DRO&mQPO'#DSO&rQPO'#DUOOQO'#DW'#DWO&wQPO'#DVOOQO'#Cj'#CjQ'PQPOOOOQO'#C`'#C`P'nO!bO'#C^POOO)C?S)C?SO'yQPO,59VO(QQSO,59hO(]QPO,59TO(}QPO,58zO)UQPO,59VO)UQPO,59VO)UQPO,59VO)UQPO,59VO)UQPO,59VO)UQPO,59VO)UQPO,59VOOQO'#Co'#CoOOQO'#Cu'#CuO)ZQWO'#CuO)rQ`O'#CwO)wQPO'#CwO#nQQO'#CmO)|QWO,59WO#nQQO'#CmOOQO'#Cm'#CmOOQO,59W,59WO#nQQO,59jO*[QPO,59hO*[QPO,59gOOQO,59h,59hO#nQQO,59mO#nQQO,59nOOQO,59p,59pO+PQPO,59qO,rQPO,59qO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zPOOO'#D['#D[P,yO!bO,58xPOOO,58x,58xOOQO1G.q1G.qOOQO1G/S1G/SOOQO1G.o1G.oOOQO1G.f1G.fO)UQPO'#CkO-vQPO1G.qO.oQPO1G.qO.vQPO1G.qO/oQPO1G.qO/vQPO1G.qO/}QPO1G.qO0UQ`O,59cOOQO,59c,59cO0aQ`O,59cO0fQWO,59XO#nQQO,59XO#nQQO,59XO#nQQO,59XOOQO1G.r1G.rO0tQWO,59XO1YQWO1G/UO*[QPO'#C|O1hQpO1G/RO2`QWO1G/XO2nQWO'#DTO3PQPO1G/YOOQO1G/]1G/]O3XQPO'#CuOOQO'#DZ'#DZOOQO'#DY'#DYO3dQPO'#DXOOQO'#DX'#DXO3lQPO1G/]O4cQPO1G.fO5[QPO1G.fO5cQPO1G.fO6[QPO1G.fO6cQPO1G.fO6jQPO1G.fO7cQPO1G.fO7jQPO1G.fPOOO-E7Y-E7YPOOO1G.d1G.dO7qQPO,59VOOQO1G.}1G.}O8]QPO1G.}OOQO1G.s1G.sO8sQWO1G.sO8zQWO1G.sOOQO7+$p7+$pO9RQSO,59hOOQO7+$s7+$sO#nQQO,59oOOQO7+$t7+$tO9ZQPO,59tO9eQPO7+$wO:]Q`O7+$iO:bQWO1G/ZOOQO1G/`1G/`OOQO1G/_1G/_O:sQPO1G/_OOQO<<Hc<<HcOOQO<<HT<<HTO:xQPO7+$yOOQO<<He<<He",stateData:";[~O!ROSPOS!SPQ~OeXOfXOgXOhXO!WQO!ZSO!]YO!uUO!vTO!wTO!xTO!yTO!zZO!{[O!}]O#P^O#Q^O#R^O#S^O#T^O#U^O~O!ScO~OTiOUjOVlOWkOXmOYnO!YoOZ^X[^X~O!P^X!X^X~P!uOdpOepOfpOgpOhpOjrOmtOntO!WuO!]wO!^wO!_pO!`pO!apO!bpO!cpO!dpO!epO!fpO!gpO!hpO!ipO!jpO!kqO!lqO!mqO!nqO!oqO!pqO!qqO!rqO!sqO!tsO~O![yO~P#nO!WzO~Oq{Ot|O~Oe}Of}Og}O~O!W!OO~O!W!PO~O#O!QO~O!W!SO#O!RO~OT!TOU!UOV!VOW!WOX!XOY!YOZ![O[!]O!Y!ZO~O!T!^O!U!^O!V!`O~O!X!aO~P!uOq{Ot|O!X!bO~O!X!cOTSXUSXVSXWSXXSXYSXZSX[SX!YSX~O!X!dO~P'PO!W!eO~O!t!lOTiXYiXbiX![iX!XiX!|iX~Ol!mO~O!t!nO~OT!qOY!rOb!pO![!sO~OeXOfXOgXOhXO!W!vO!]YO!uUO!vTO!wTO!xTO!yTO~O!zZOTyaUyaVyaWyaXyaYyaZya[ya!Pya!Yya!Xya~Oj!|OmtOntO!kqO!lqO!mqO!nqO!oqO!pqO!qqO!rqO!sqO!tsO~Og#QO~P+wO!T!^O!U!^O!V#]O~OUjOVlOWkOXmO!YoOY_iZ_i[_i!P_i!X_i~OT_i~P-UOUjOT_iV_iX_iY_iZ_i[_i!P_i!Y_i!X_i~OW_i~P-}OWkO~P-}OUjOVlOWkOT_iY_iZ_i[_i!P_i!Y_i!X_i~OX_i~P.}OTiO~P-UOXmO~P.}Ol#_Om#`On#`O~Ol#_O~OT!qOY!rOb!pO!X#aO~OT!qOY!rOb!pO![aa!Xaa!|aa~OT!qOY!rOb!pO!X#dO~Oq{OToiUoiVoiWoiXoiYoiZoi[oi!Poi!Yoi!Xoi~OT!qOY!rOb!pO!X#fO~OT!qOY!rOb!pO!XwX!|wX~O!X#hO!|#gO~O!t!lO!XiX!|iX~O!|#iO!X{X~O!X#jO~OU!UOV!VOW!WOX!XO!Y!ZOYSiZSi[Si!PSi!XSi~OTSi~P3qOU!UOTSiVSiXSiYSiZSi[Si!PSi!YSi!XSi~OW!WO~P4jOWSi~P4jOU!UOV!VOW!WOTSiYSiZSi[Si!PSi!YSi!XSi~OXSi~P5jOT!TO~P3qOX!XO~P5jOT!TOU!UOV!VOW!WOX!XOY!YO!Y!ZO[Si!PSi!XSi~OZSi~P6qOZ![O~P6qOTiOUjOVlOWkOXmOYnO!X!aO!YoO~O!t#kO~Ob!pOYai![ai!Xai!|ai~OTai~P8bOT!qO~P8bOq{O!X!bO~Of#oOg#nO~P+wO!zZOTyqUyqVyqWyqXyqYyqZyq[yq!Pyq!Yyq!Xyq~Ol#qO~OT!qOY!rOb!pO!Xwi!|wi~O!|#rO~Og#sO~OgfePqbjmjnln~",goto:"(X!PPP!QP!TPPPPPPPP!v#T#d$]$jP%YPPPPP%fP%fPPP$]%vP&`&pP'Q$]'e$]$]'h'u'x'{(RRdPQaOQhQQ!d!UQ#S!TQ#T!VQ#U!WQ#V!XQ#W!YQ#X!ZQ#Y![R#Z!]gbOQ!T!U!V!W!X!Y!Z![!]dbO!T!U!V!W!X!Y!Z![!]RgQdRO!T!U!V!W!X!Y!Z![!]QeQQ!ajQ!fiQ!gkQ!hlQ!imQ!jnQ!koR#^!eg`OQ!T!U!V!W!X!Y!Z![!]QvSQ!ouQ!twQ!uzQ!x!OQ!y!PQ#a!pQ#b!qQ#c!rR#l#gexSuwz!O!P!p!q!r#gdxSuwz!O!P!p!q!r#gT!}!S#idWO!T!U!V!W!X!Y!Z![!]QfQQ!b{Q!w|R#e!vmXOQ{|!T!U!V!W!X!Y!Z![!]!vmVOQ{|!T!U!V!W!X!Y!Z![!]!vf`OQ!T!U!V!W!X!Y!Z![!]Q!{!RR#p#jR!z!Pg_OQ!T!U!V!W!X!Y!Z![!]R#R!SR#P!SQ#O!SR#m#iQ!_cR#[!_",nodeNames:"\u26A0 LineComment BlockComment TraceQL SpansetPipelineExpression And Gt Desc Lt Anc Or Pipe ExperimentalOp WrappedSpansetPipeline SpansetPipeline SpansetExpression SpansetFilter FieldExpression FieldOp Static String Integer Float Duration TemplateVariable IntrinsicField Parent AttributeField Identifier Resource Span ScalarFilter ScalarExpression ScalarOp Aggregate AggregateExpression ComparisonOp GroupOperation SelectOperation SelectArgs CoalesceOperation MetricsOperation MetricsOperationType MetricsArgs MetricsQuery MetricsQueryExpression",maxTerm:98,skippedNodes:[0,1,2,46],repeatNodeCount:1,tokenData:"&5x~R!`X^%Tpq%Tqr%xrs'Qst(dtu*juv2cvw3_wx(dxy3jyz3wz{2c{|2c|}3|}!O4R!O!P4[!P!Q4a!Q![5[![!](d!]!^(d!^!_7O!_!`7d!`!a7n!a!b(d!b!c(d!c!}(d#Q#R8S#R#S(d#S#T8Z#T#U<c#U#VHo#V#WJg#W#X!C}#X#Y!Ki#Y#Z#!Z#Z#](d#]#^#&{#^#_(d#_#`#.g#`#a(d#a#b#2Z#b#c#I{#c#d$ m#d#e$#e#e#f$/w#f#g$@w#g#h%.m#h#i%Hh#i#j&(v#j#o(d#o#p&5Y#p#q&5_#q#r&5l#r#s&5q#y#z%T$f$g%T#BY#BZ%T$IS$I_%T$I|$JO%T$JT$JU%T$KV$KW%T&FU&FV%T~%YY!R~X^%Tpq%T#y#z%T$f$g%T#BY#BZ%T$IS$I_%T$I|$JO%T$JT$JU%T$KV$KW%T&FU&FV%T#Q%}S!^S!^!_&Z!_!`&h!`!a&o#r#s&w!d&`P[!d!^!_&c!d&hO[!dh&oOtWb`!d&tP[!d!`!a&c!|'QOtW[!db`t'TVOr'Qrs'js#O'Q#O#P*Z#P;'S'Q;'S;=`*d<%lO'Qt'qZdSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dp(iZlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dp)_VOr)[rs(ds#O)[#O#P)t#P;'S)[;'S;=`)}<%lO)[p)wQrs)[#O#P)[p*QP;=`<%l)[p*WP;=`<%l(dt*^Qrs'Q#O#P'Qt*gP;=`<%l'Qv*oelpOp(drs,Qst,jtu,juv,jwx,jz|,j}![(d![!],j!]!^,j!a!b,j!b!c,j!c!},j!}#Q(d#R#S,j#S#T,j#T#o,j#o#p-y#s;'S(d;'S;=`*T<%lO(dv,TVOr,Qrs,js#O,Q#O#P-j#P;'S,Q;'S;=`-s<%lO,Qv,qZhUlpOp,jrs,Qsv,jwx,jz|,j}!^,j!a#Q,j#R#o,j#s;'S,j;'S;=`-d<%lO,jv-gP;=`<%l,jv-mQrs,Q#O#P,Qv-vP;=`<%l,Qv-|^rs.xst/btu/buv/bwx/bz|/b![!]/b!]!^/b!a!b/b!b!c/b!c!}/b#R#S/b#S#T/b#T#o/bv.{VOr.xrs/bs#O.x#O#P2S#P;'S.x;'S;=`2]<%lO.xv/e^Op/brs.xsv/bwx/bz|/b}![/b![!]0a!]!^/b!a#Q/b#R#o/b#q#r1u#s;'S/b;'S;=`1|<%lO/bv0deOp/brs.xsv/bwx/bz|/b}!O/b!O!P0a!P!Q/b!Q![0a![!]0a!]!^/b!a!c/b!c!}0a!}#Q/b#R#S0a#S#T/b#T#o0a#q#r1u#s;'S/b;'S;=`1|<%lO/bv1|OhUlpv2PP;=`<%l/bv2VQrs.x#O#P.xv2`P;=`<%l.x#l2lZq!jb`lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~3bPvw3e~3jOT~~3oP!W~yz3r~3wO#O~~3|O!X~~4RO!|~#Q4[O!]Uq!jb`~4aO!t~~4hQq!jb`z{4n!P!Q4s~4sO!S~~4xSP~OY4sZ;'S4s;'S;=`5U<%lO4s~5XP;=`<%l4s~5aWe~!O!P5y!Q![5[#[#]6k#a#b6p#b#c6x#g#h6k#i#j6x${$|6x~5|P!Q![6P~6UVf~!Q![6P#[#]6k#a#b6p#b#c6x#g#h6k#i#j6x${$|6x~6pOg~~6uPg~#g#h6k~6{P#g#h6k!|7XQtWW!db`!^!_7_!_!`&h!d7dOX!dh7kPtWb`#r#s&h!|7wQtWU!db`!_!`&h!`!a7}!d8SOV!d!z8ZOq!jb`t8`dlpOp8Zpr9nrs:]sv8Zvw9nwx8Zxz9nz|8Z|}9n}!^8Z!^!a9n!a#Q8Z#Q#R9n#R#S8Z#S#T'j#T#o8Z#o#s9n#s;'S8Z;'S;=`<]<%lO8ZS9qTO#S9n#S#T:Q#T;'S9n;'S;=`:V<%lO9nS:VOdSS:YP;=`<%l9nt:`XOr:]rs8Zs#O:]#O#P:{#P#S:]#S#T;k#T;'S:];'S;=`<V<%lO:]t;OXOr9nrs:]s#O9n#O#P:]#P#S9n#S#T:Q#T;'S9n;'S;=`:V<%lO9nt;pVdSOr)[rs(ds#O)[#O#P)t#P;'S)[;'S;=`)}<%lO)[t<YP;=`<%l:]t<`P;=`<%l8Zr<h]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k=a#k#o(d#s;'S(d;'S;=`*T<%lO(dr=f]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#Z(d#Z#[>_#[#o(d#s;'S(d;'S;=`*T<%lO(dr>f[!xQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#S?[#S#o(d#s;'S(d;'S;=`*T<%lO(dr?a]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d@Y#d#o(d#s;'S(d;'S;=`*T<%lO(dr@_]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#kAW#k#o(d#s;'S(d;'S;=`*T<%lO(drA]]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#YBU#Y#o(d#s;'S(d;'S;=`*T<%lO(drBZ]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#gCS#g#o(d#s;'S(d;'S;=`*T<%lO(drCX[lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#SC}#S#o(d#s;'S(d;'S;=`*T<%lO(drDS]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#iD{#i#o(d#s;'S(d;'S;=`*T<%lO(drEQ]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^Ey#^#o(d#s;'S(d;'S;=`*T<%lO(drFO]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#bFw#b#o(d#s;'S(d;'S;=`*T<%lO(drF|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#YGu#Y#o(d#s;'S(d;'S;=`*T<%lO(drG|Z#RQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(drHt]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#m(d#m#nIm#n#o(d#s;'S(d;'S;=`*T<%lO(drItZ!zQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dvJlalpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#[(d#[#]Kq#]#`(d#`#a!&Z#a#c(d#c#d!*{#d#o(d#s;'S(d;'S;=`*T<%lO(dvKv]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^Lo#^#o(d#s;'S(d;'S;=`*T<%lO(dvLt]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#aMm#a#o(d#s;'S(d;'S;=`*T<%lO(dvMr]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#XNk#X#o(d#s;'S(d;'S;=`*T<%lO(dvNp]lpOp(drs)[sv(dwx(dz|(d}!^(d!a!e(d!e!f! i!f#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv! n]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d!!g#d#o(d#s;'S(d;'S;=`*T<%lO(dv!!l]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j!#e#j#o(d#s;'S(d;'S;=`*T<%lO(dv!#j]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!$c#c#o(d#s;'S(d;'S;=`*T<%lO(dv!$h]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i!%a#i#o(d#s;'S(d;'S;=`*T<%lO(dv!%hZ!kUlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!&`]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^!'X#^#o(d#s;'S(d;'S;=`*T<%lO(dt!'^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!(V#Y#o(d#s;'S(d;'S;=`*T<%lO(dt!([]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!)T#c#o(d#s;'S(d;'S;=`*T<%lO(dt!)Y]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i!*R#i#o(d#s;'S(d;'S;=`*T<%lO(dt!*YZ!hSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv!+QalpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!,V#U#b(d#b#c!1u#c#i(d#i#j!7e#j#o(d#s;'S(d;'S;=`*T<%lO(dr!,[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a!-T#a#o(d#s;'S(d;'S;=`*T<%lO(dr!-Y]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!.R#Y#o(d#s;'S(d;'S;=`*T<%lO(dr!.W]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h!/P#h#o(d#s;'S(d;'S;=`*T<%lO(dr!/U]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W!/}#W#o(d#s;'S(d;'S;=`*T<%lO(dr!0S]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!0{#Y#o(d#s;'S(d;'S;=`*T<%lO(dr!1SZ!}QlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!1z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h!2s#h#o(d#s;'S(d;'S;=`*T<%lO(dt!2x]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j!3q#j#o(d#s;'S(d;'S;=`*T<%lO(dt!3v]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b!4o#b#o(d#s;'S(d;'S;=`*T<%lO(dt!4t]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!5m#Y#o(d#s;'S(d;'S;=`*T<%lO(dt!5r]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!6k#g#o(d#s;'S(d;'S;=`*T<%lO(dt!6rZ!jSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr!7j]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!8c#c#o(d#s;'S(d;'S;=`*T<%lO(dr!8h]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i!9a#i#o(d#s;'S(d;'S;=`*T<%lO(dr!9f]lpOp(drs)[sv(dwx(dxy!:_z|(d}!^(d!a#Q(d#R#S!:j#S#o(d#s;'S(d;'S;=`*T<%lO(dQ!:bPyz!:eQ!:jO!uQr!:o]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d!;h#d#o(d#s;'S(d;'S;=`*T<%lO(dr!;m]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k!<f#k#o(d#s;'S(d;'S;=`*T<%lO(dr!<k]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!=d#Y#o(d#s;'S(d;'S;=`*T<%lO(dr!=i]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!>b#g#o(d#s;'S(d;'S;=`*T<%lO(dr!>g[lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#S!?]#S#o(d#s;'S(d;'S;=`*T<%lO(dr!?b]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i!@Z#i#o(d#s;'S(d;'S;=`*T<%lO(dr!@`]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^!AX#^#o(d#s;'S(d;'S;=`*T<%lO(dr!A^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b!BV#b#o(d#s;'S(d;'S;=`*T<%lO(dr!B[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!CT#Y#o(d#s;'S(d;'S;=`*T<%lO(dr!C[Z#QQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv!DS]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j!D{#j#o(d#s;'S(d;'S;=`*T<%lO(dv!EQ]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!Ey#g#o(d#s;'S(d;'S;=`*T<%lO(dv!FO]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!Fw#U#o(d#s;'S(d;'S;=`*T<%lO(dv!F|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i!Gu#i#o(d#s;'S(d;'S;=`*T<%lO(dv!Gz]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^!Hs#^#o(d#s;'S(d;'S;=`*T<%lO(dv!Hx]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d!Iq#d#o(d#s;'S(d;'S;=`*T<%lO(dv!Iv]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!Jo#c#o(d#s;'S(d;'S;=`*T<%lO(dv!JvZ!lUlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!Kn]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!Lg#g#o(d#s;'S(d;'S;=`*T<%lO(dt!Ll]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!Me#g#o(d#s;'S(d;'S;=`*T<%lO(dt!Mj]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d!Nc#d#o(d#s;'S(d;'S;=`*T<%lO(dt!Nh]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g# a#g#o(d#s;'S(d;'S;=`*T<%lO(dt# hZ!cSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#!`]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U##X#U#o(d#s;'S(d;'S;=`*T<%lO(dt##^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a#$V#a#o(d#s;'S(d;'S;=`*T<%lO(dt#$[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h#%T#h#o(d#s;'S(d;'S;=`*T<%lO(dt#%Y]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#&R#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#&YZ!`SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#'Q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c#'y#c#o(d#s;'S(d;'S;=`*T<%lO(dt#(O]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i#(w#i#o(d#s;'S(d;'S;=`*T<%lO(dt#(|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#)u#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#)z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g#*s#g#o(d#s;'S(d;'S;=`*T<%lO(dt#*x]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c#+q#c#o(d#s;'S(d;'S;=`*T<%lO(dt#+v]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U#,o#U#o(d#s;'S(d;'S;=`*T<%lO(dt#,t]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a#-m#a#o(d#s;'S(d;'S;=`*T<%lO(dt#-tZ!fSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv#.l]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^#/e#^#o(d#s;'S(d;'S;=`*T<%lO(dv#/j]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c#0c#c#o(d#s;'S(d;'S;=`*T<%lO(dv#0h]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#X#1a#X#o(d#s;'S(d;'S;=`*T<%lO(dv#1hZ!mUlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr#2`_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U#3_#U#](d#]#^#>m#^#o(d#s;'S(d;'S;=`*T<%lO(dr#3d]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#l(d#l#m#4]#m#o(d#s;'S(d;'S;=`*T<%lO(dr#4d[!vQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#S#5Y#S#o(d#s;'S(d;'S;=`*T<%lO(dr#5_]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d#6W#d#o(d#s;'S(d;'S;=`*T<%lO(dr#6]]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k#7U#k#o(d#s;'S(d;'S;=`*T<%lO(dr#7Z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#8S#Y#o(d#s;'S(d;'S;=`*T<%lO(dr#8X]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g#9Q#g#o(d#s;'S(d;'S;=`*T<%lO(dr#9V[lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#S#9{#S#o(d#s;'S(d;'S;=`*T<%lO(dr#:Q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i#:y#i#o(d#s;'S(d;'S;=`*T<%lO(dr#;O]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^#;w#^#o(d#s;'S(d;'S;=`*T<%lO(dr#;|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b#<u#b#o(d#s;'S(d;'S;=`*T<%lO(dr#<z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#=s#Y#o(d#s;'S(d;'S;=`*T<%lO(dr#=zZ#SQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr#>r]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c#?k#c#o(d#s;'S(d;'S;=`*T<%lO(dr#?r[!wQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#S#@h#S#o(d#s;'S(d;'S;=`*T<%lO(dr#@m]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d#Af#d#o(d#s;'S(d;'S;=`*T<%lO(dr#Ak]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k#Bd#k#o(d#s;'S(d;'S;=`*T<%lO(dr#Bi]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#Cb#Y#o(d#s;'S(d;'S;=`*T<%lO(dr#Cg]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g#D`#g#o(d#s;'S(d;'S;=`*T<%lO(dr#De[lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#S#EZ#S#o(d#s;'S(d;'S;=`*T<%lO(dr#E`]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i#FX#i#o(d#s;'S(d;'S;=`*T<%lO(dr#F^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^#GV#^#o(d#s;'S(d;'S;=`*T<%lO(dr#G[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b#HT#b#o(d#s;'S(d;'S;=`*T<%lO(dr#HY]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#IR#Y#o(d#s;'S(d;'S;=`*T<%lO(dr#IYZ#TQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv#JQ_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U#KP#U#](d#]#^#Mu#^#o(d#s;'S(d;'S;=`*T<%lO(dv#KU]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b#K}#b#o(d#s;'S(d;'S;=`*T<%lO(dv#LS]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#L{#Y#o(d#s;'S(d;'S;=`*T<%lO(dv#MSZ!nUlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#Mz]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a#Ns#a#o(d#s;'S(d;'S;=`*T<%lO(dt#NzZ!aSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$ r]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#_(d#_#`$!k#`#o(d#s;'S(d;'S;=`*T<%lO(dt$!rZ!bSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~$#j_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$$i#U#f(d#f#g$)Z#g#o(d#s;'S(d;'S;=`*T<%lO(d~$$n]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g$%g#g#o(d#s;'S(d;'S;=`*T<%lO(d~$%l]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$&e#Y#o(d#s;'S(d;'S;=`*T<%lO(d~$&j]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c$'c#c#o(d#s;'S(d;'S;=`*T<%lO(d~$'h]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$(a#i#o(d#s;'S(d;'S;=`*T<%lO(d~$(hZj~lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$)`]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d$*X#d#o(d#s;'S(d;'S;=`*T<%lO(dt$*^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#X$+V#X#o(d#s;'S(d;'S;=`*T<%lO(dt$+[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j$,T#j#o(d#s;'S(d;'S;=`*T<%lO(dt$,Y]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W$-R#W#o(d#s;'S(d;'S;=`*T<%lO(dt$-W]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$.P#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$.U]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g$.}#g#o(d#s;'S(d;'S;=`*T<%lO(dt$/UZ!iSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr$/|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j$0u#j#o(d#s;'S(d;'S;=`*T<%lO(dr$0z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$1s#U#o(d#s;'S(d;'S;=`*T<%lO(dr$1x]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c$2q#c#o(d#s;'S(d;'S;=`*T<%lO(dr$2v]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$3o#i#o(d#s;'S(d;'S;=`*T<%lO(dr$3t]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^$4m#^#o(d#s;'S(d;'S;=`*T<%lO(dr$4r]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a$5k#a#o(d#s;'S(d;'S;=`*T<%lO(dr$5p]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$6i#Y#o(d#s;'S(d;'S;=`*T<%lO(dr$6n[lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#S$7d#S#o(d#s;'S(d;'S;=`*T<%lO(dr$7i]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d$8b#d#o(d#s;'S(d;'S;=`*T<%lO(dr$8g]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k$9`#k#o(d#s;'S(d;'S;=`*T<%lO(dr$9e]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$:^#Y#o(d#s;'S(d;'S;=`*T<%lO(dr$:c]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g$;[#g#o(d#s;'S(d;'S;=`*T<%lO(dr$;a[lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#S$<V#S#o(d#s;'S(d;'S;=`*T<%lO(dr$<[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$=T#i#o(d#s;'S(d;'S;=`*T<%lO(dr$=Y]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^$>R#^#o(d#s;'S(d;'S;=`*T<%lO(dr$>W]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b$?P#b#o(d#s;'S(d;'S;=`*T<%lO(dr$?U]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$?}#Y#o(d#s;'S(d;'S;=`*T<%lO(dr$@UZ#UQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~$@|alpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$BR#U#X(d#X#Y$Dw#Y#c(d#c#d$Ke#d#o(d#s;'S(d;'S;=`*T<%lO(dr$BW]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$CP#i#o(d#s;'S(d;'S;=`*T<%lO(dr$CU]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$C}#Y#o(d#s;'S(d;'S;=`*T<%lO(dr$DUZ#PQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~$D|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h$Eu#h#o(d#s;'S(d;'S;=`*T<%lO(d~$Ez]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d$Fs#d#o(d#s;'S(d;'S;=`*T<%lO(d~$Fx]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j$Gq#j#o(d#s;'S(d;'S;=`*T<%lO(d~$Gv]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g$Ho#g#o(d#s;'S(d;'S;=`*T<%lO(d~$Ht]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W$Im#W#o(d#s;'S(d;'S;=`*T<%lO(d~$Ir]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$Jk#Y#o(d#s;'S(d;'S;=`*T<%lO(d~$JrZm~lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv$Kj]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d$Lc#d#o(d#s;'S(d;'S;=`*T<%lO(dv$Lh]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$Ma#i#o(d#s;'S(d;'S;=`*T<%lO(dv$Mf_lpOp(drs)[sv(dwx(dz|(d}!^(d!a!p(d!p!q$Ne!q!u(d!u!v%$X!v#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv$Nj]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U% c#U#o(d#s;'S(d;'S;=`*T<%lO(dv% h]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b%!a#b#o(d#s;'S(d;'S;=`*T<%lO(dv%!f]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%#_#Y#o(d#s;'S(d;'S;=`*T<%lO(dv%#fZ!oUlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv%$^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%%V#Y#o(d#s;'S(d;'S;=`*T<%lO(dv%%[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g%&T#g#o(d#s;'S(d;'S;=`*T<%lO(dv%&Y]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k%'R#k#o(d#s;'S(d;'S;=`*T<%lO(dv%'W]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^%(P#^#o(d#s;'S(d;'S;=`*T<%lO(dv%(U]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W%(}#W#o(d#s;'S(d;'S;=`*T<%lO(dv%)S]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%){#Y#o(d#s;'S(d;'S;=`*T<%lO(dv%*Q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a!p(d!p!q%*y!q#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv%+O]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U%+w#U#o(d#s;'S(d;'S;=`*T<%lO(dv%+|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b%,u#b#o(d#s;'S(d;'S;=`*T<%lO(dv%,z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%-s#Y#o(d#s;'S(d;'S;=`*T<%lO(dv%-zZ!pUlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~%.rblpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%/z#Y#d(d#d#e%8f#e#h(d#h#i%;[#i#j%Fp#j#o(d#s;'S(d;'S;=`*T<%lO(dv%0P_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a%1O#a#f(d#f#g%4r#g#o(d#s;'S(d;'S;=`*T<%lO(dr%1T]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%1|#Y#o(d#s;'S(d;'S;=`*T<%lO(dr%2R]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W%2z#W#o(d#s;'S(d;'S;=`*T<%lO(dr%3P]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i%3x#i#o(d#s;'S(d;'S;=`*T<%lO(dr%4PZ!{QlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt%4w]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k%5p#k#o(d#s;'S(d;'S;=`*T<%lO(dt%5u]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%6n#Y#o(d#s;'S(d;'S;=`*T<%lO(dt%6s]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g%7l#g#o(d#s;'S(d;'S;=`*T<%lO(dt%7sZ!gSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~%8k]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U%9d#U#o(d#s;'S(d;'S;=`*T<%lO(d~%9i]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c%:b#c#o(d#s;'S(d;'S;=`*T<%lO(d~%:iZn~lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv%;a]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U%<Y#U#o(d#s;'S(d;'S;=`*T<%lO(dv%<_]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i%=W#i#o(d#s;'S(d;'S;=`*T<%lO(dv%=]]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j%>U#j#o(d#s;'S(d;'S;=`*T<%lO(dv%>Z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h%?S#h#o(d#s;'S(d;'S;=`*T<%lO(dv%?Z]!qUlpOp(drs)[sv(dwx(dz|(d}!^(d!a!o(d!o!p%@S!p#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv%@X]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%AQ#Y#o(d#s;'S(d;'S;=`*T<%lO(dv%AV]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h%BO#h#o(d#s;'S(d;'S;=`*T<%lO(dv%BT]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h%B|#h#o(d#s;'S(d;'S;=`*T<%lO(dv%CR]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U%Cz#U#o(d#s;'S(d;'S;=`*T<%lO(dv%DP]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#Z(d#Z#[%Dx#[#o(d#s;'S(d;'S;=`*T<%lO(dv%D}]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%Ev#Y#o(d#s;'S(d;'S;=`*T<%lO(dv%E}Z!rUlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr%Fu]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b%Gn#b#o(d#s;'S(d;'S;=`*T<%lO(dr%GuZ!yQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv%Hm]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g%If#g#o(d#s;'S(d;'S;=`*T<%lO(dv%Ik_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U%Jj#U#i(d#i#j&'O#j#o(d#s;'S(d;'S;=`*T<%lO(dv%Jo]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W%Kh#W#o(d#s;'S(d;'S;=`*T<%lO(dv%Km]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%Lf#Y#o(d#s;'S(d;'S;=`*T<%lO(dv%Lk]lpOp(drs)[sv(dwx(dz|(d}!^(d!a!f(d!f!g%Md!g#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv%Mi]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j%Nb#j#o(d#s;'S(d;'S;=`*T<%lO(dv%Ng]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g& `#g#o(d#s;'S(d;'S;=`*T<%lO(dv& e]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U&!^#U#o(d#s;'S(d;'S;=`*T<%lO(dv&!c]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i&#[#i#o(d#s;'S(d;'S;=`*T<%lO(dv&#a]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^&$Y#^#o(d#s;'S(d;'S;=`*T<%lO(dv&$_]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d&%W#d#o(d#s;'S(d;'S;=`*T<%lO(dv&%]]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c&&U#c#o(d#s;'S(d;'S;=`*T<%lO(dv&&]Z!sUlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt&'T]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y&'|#Y#o(d#s;'S(d;'S;=`*T<%lO(dt&(TZ!_SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt&({]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c&)t#c#o(d#s;'S(d;'S;=`*T<%lO(dt&)y]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h&*r#h#o(d#s;'S(d;'S;=`*T<%lO(dt&*w_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y&+v#Y#d(d#d#e&-n#e#o(d#s;'S(d;'S;=`*T<%lO(dt&+{]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i&,t#i#o(d#s;'S(d;'S;=`*T<%lO(dt&,{Z!dSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt&-s]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y&.l#Y#o(d#s;'S(d;'S;=`*T<%lO(dt&.q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W&/j#W#o(d#s;'S(d;'S;=`*T<%lO(dt&/o]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^&0h#^#o(d#s;'S(d;'S;=`*T<%lO(dt&0m]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#Y(d#Y#Z&1f#Z#o(d#s;'S(d;'S;=`*T<%lO(dt&1k]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^&2d#^#o(d#s;'S(d;'S;=`*T<%lO(dt&2i]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y&3b#Y#o(d#s;'S(d;'S;=`*T<%lO(dt&3g]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#X&4`#X#o(d#s;'S(d;'S;=`*T<%lO(dt&4gZ!eSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~&5_O!Z~~&5dPZ~#p#q&5g~&5lOY~~&5qO![~!t&5xO!Y!db`",tokenizers:[1,2,3,4,5,6,new ya.uC("j~RQYZXz{^~^O!U~~aP!P!Qd~iO!V~~",25,51)],topRules:{TraceQL:[0,3]},tokenPrec:1195}),Dd=1,Nd=2,Js=3,tt=4,Ea=5,zd=6,$d=7,Md=8,Ad=9,Qa=10,ba=11,Ld=12,Vd=13,en=14,Fd=15,at=16,ee=17,Ct=18,It=19,tn=20,Ud=21,jd=22,Xd=23,Wd=24,Dt=25,an=26,Ve=27,rn=28,sn=29,nn=30,xa=31,dn=32,kd=33,rt=34,Yd=35,Ra=36,Nt=37,zt=38,ln=39,_d=40,Bd=41,Gd=42,Zd=43,qd=44,Kd=45;function Pa(e,t){const a=e.cursorAt(t);do if(a.from===t||a.to===t){const{node:r}=a;if(r.type.isError)return r}while(a.next());return null}function on(e,t){return e[t]}function me(e,t){let a=e;for(const[r,n]of t)if(a=on(a,r),a===null||n.find(d=>d===a?.type.id)===void 0)return null;return a}function st(e,t){return t.slice(e.from===e.to?e.from-1:e.from,e.to)}function cn(e,t){return e.every((a,r)=>a===t[r])}function un(e,t){if(e==="")return{query:e,type:"EMPTY"};const a=wt.parse(e);let r=t;for(;r-1>=0&&e[r-1]===" ";)r-=1;let n=Pa(a,r);n||(n=Pa(a,r-1));const d=n!=null?n.cursor():a.cursorAt(r),l=d.node,i=[d.type.id];for(;d.parent();)i.push(d.type.id);let c;for(let u of pn)cn(u.path,i)&&(c=u.fun(l,e,r,t));return{query:e,...c??{type:"UNKNOWN"}}}const le=0,pn=[{path:[le,Ve],fun:mn},{path:[le,ee],fun:Ca},{path:[le,at],fun:fn},{path:[le,rt],fun:nt},{path:[le,Dt],fun:nt},{path:[le,Nt],fun:nt},{path:[le,zt],fun:nt},{path:[le,tt],fun:On},{path:[le,xa,en],fun:gn},{path:[ee],fun:wa},{path:[at],fun:wa},{path:[tt],fun:Ia},{path:[Js],fun:Ia},{path:[tn,It],fun:Ca}],$t=(e,t,a)=>{const r=l=>{const i=me(l,[["firstChild",[Ve]]]),c=i?st(i,t):"",u=c.indexOf(".");return c.slice(0,u)};if(t[a-1]===" ")return;const n=me(e,[["firstChild",[ee]]]);if(n)return{type:"SPANSET_IN_NAME_SCOPE",scope:r(n)};const d=me(e,[["parent",[at]],["firstChild",[ee]]]);if(d&&t[a]!==" ")return{type:"SPANSET_IN_NAME_SCOPE",scope:r(d)}};function wa(e,t,a,r){const n=$t(e,t,r);if(n)return n;let d=me(e,[["firstChild",[ee]],["firstChild",[Ve]]]);return d?{type:"SPANSET_EXPRESSION_OPERATORS"}:(d=me(e,[["lastChild",[ee]],["lastChild",[ee]],["lastChild",[It]]]),d?{type:"SPANFIELD_COMBINING_OPERATORS"}:(d=me(e,[["lastChild",[ee]]]),d?{type:"SPANSET_EXPRESSION_OPERATORS"}:{type:"SPANSET_EMPTY"}))}function mn(e,t){const a=me(e,[["parent",[Ve]]]),r=a?st(a,t):"";if(r===".")return{type:"SPANSET_ONLY_DOT"};const n=r.indexOf("."),d=r.slice(0,n);return["span","resource","parent"].find(l=>l===d)?{type:"SPANSET_IN_NAME_SCOPE",scope:d}:{type:"SPANSET_IN_NAME"}}function Ca(e,t,a,r){const n=$t(e,t,r);if(n)return n;if(me(e,[["parent",[It]],["parent",[ee]],["prevSibling",[Ct]]])){let d=e.parent?.parent?.prevSibling?.prevSibling;if(d)return{type:"SPANSET_IN_VALUE",tagName:st(d,t),betweenQuotes:!0}}if(e.prevSibling?.type.id===Ct){let d=e.prevSibling?.prevSibling;if(d)return{type:"SPANSET_IN_VALUE",tagName:st(d,t),betweenQuotes:!1}}return e.prevSibling?.type.name==="And"||e.prevSibling?.type.name==="Or"?{type:"SPANSET_EMPTY"}:{type:"SPANSET_IN_THE_MIDDLE"}}function gn(e,t,a){if(e.prevSibling?.type.id!==Ra)return{type:"SPANSET_COMPARISON_OPERATORS"}}function Ia(e,t,a){let r=e.firstChild;try{for(r=e.firstChild;r.to<a;)r=r.nextSibling}catch(n){console.error("Unexpected error while searching for previous node",n)}return r?.type.id===Ea||r?.type.id===Qa?{type:"NEW_SPANSET"}:{type:"SPANSET_COMBINING_OPERATORS"}}function nt(e,t,a){const r=e?.parent;if(r&&[Dt,rt,Nt,zt,ln].includes(r.type.id))return{type:"ATTRIBUTE_FOR_FUNCTION"}}function On(e,t,a){return e.prevSibling?.type.id===ba?{type:"SPANSET_PIPELINE_AFTER_OPERATOR"}:{type:"NEW_SPANSET"}}function fn(e,t,a){const r=$t(e,t,a);return r||{type:"SPANSET_EXPRESSION_OPERATORS_WITH_MISSING_CLOSED_BRACE"}}const $=class{constructor(e){this.triggerCharacters=["{",".","[","(","=","~"," ",'"'],this.cachedValues={},this.languageProvider=e.languageProvider,this.registerInteractionCommandId=null}provideCompletionItems(e,t){if(!(this.monaco&&this.editor))throw new Error("provideCompletionItems called before CompletionProvider was initialized");if(this.editor.getModel()?.id!==e.id)return{suggestions:[]};const{range:a,offset:r}=vn(this.monaco,e,t),n=un(e.getValue(),r);return(n!=null?this.getCompletions(n):Promise.resolve([])).then(l=>{const i=l.length.toString().length;return{suggestions:l.map((u,p)=>{const m={kind:hn(u.type,this.monaco),label:u.label,insertText:u.insertText,insertTextRules:u.insertTextRules,detail:u.detail,documentation:u.documentation,sortText:p.toString().padStart(i,"0"),range:a,command:{id:this.registerInteractionCommandId||"noOp",title:"Report Interaction",arguments:[u.label,u.type]}};return Sn(m,u.type,e,r),m})}})}setRegisterInteractionCommandId(e){this.registerInteractionCommandId=e}async getTagValues(e,t){let a;const r=`${e}:${t}`;return this.cachedValues.hasOwnProperty(r)?a=this.cachedValues[r]:(a=await this.languageProvider.getOptionsV2(e,t),this.cachedValues[r]=a),a}async getCompletions(e){switch(e.type){case"UNKNOWN":return[];case"EMPTY":return this.getScopesCompletions("{ ","$0 }").concat(this.getIntrinsicsCompletions("{ ","$0 }")).concat(this.getTagsCompletions("{ ."));case"SPANSET_EMPTY":return this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions("."));case"SPANSET_ONLY_DOT":return this.getTagsCompletions();case"SPANSET_IN_THE_MIDDLE":return[...$.comparisonOps,...$.logicalOps].map(l=>({...l,type:"OPERATOR"}));case"SPANSET_EXPRESSION_OPERATORS_WITH_MISSING_CLOSED_BRACE":return[...$.comparisonOps,...$.logicalOps].map(l=>({...l,type:"OPERATOR"}));case"SPANSET_IN_NAME":return this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions());case"SPANSET_IN_NAME_SCOPE":return this.getTagsCompletions(void 0,e.scope);case"SPANSET_EXPRESSION_OPERATORS":return[...$.comparisonOps,...$.logicalOps,...$.arithmeticOps].map(l=>({...l,type:"OPERATOR"}));case"SPANFIELD_COMBINING_OPERATORS":return[...$.logicalOps,...$.arithmeticOps,...$.comparisonOps].map(l=>({...l,type:"OPERATOR"}));case"SPANSET_COMBINING_OPERATORS":return $.spansetOps.map(l=>({...l,type:"OPERATOR"}));case"SPANSET_PIPELINE_AFTER_OPERATOR":const t=$.functions.map(l=>({...l,insertTextRules:this.monaco?.languages.CompletionItemInsertTextRule?.InsertAsSnippet,type:"FUNCTION"})),a=this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions("."));return[...t,...a];case"SPANSET_COMPARISON_OPERATORS":return $.comparisonOps.map(l=>({...l,type:"OPERATOR"}));case"SPANSET_IN_VALUE":let r;try{r=await this.getTagValues(e.tagName,e.query)}catch(l){(0,he.NF)(l)?Qe(Te(ye(l.data.error,new Error(l.data.message)))):l instanceof Error&&Qe(Te(ye("Error",l)))}const n=[],d=l=>e.betweenQuotes?l.label:l.type==="string"?`"${l.label}"`:l.label;return r?.forEach(l=>{l?.label&&n.push({label:l.label,insertText:d(l),type:"TAG_VALUE"})}),n;case"SPANSET_AFTER_VALUE":return $.logicalOps.map(l=>({label:l.label,insertText:l.insertText+"}",type:"OPERATOR"}));case"NEW_SPANSET":return this.getScopesCompletions("{ ","$0 }").concat(this.getIntrinsicsCompletions("{ ","$0 }")).concat(this.getTagsCompletions("."));case"ATTRIBUTE_FOR_FUNCTION":return this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions("."));default:throw new Error(`Unexpected situation ${e}`)}}getTagsCompletions(e,t){return this.languageProvider.getTraceqlAutocompleteTags(t).sort((r,n)=>r.localeCompare(n,void 0,{sensitivity:"accent"})).map(r=>({label:r,insertText:(e||"")+r,type:"TAG_NAME"}))}getIntrinsicsCompletions(e,t){return Ge.map(a=>({label:a,insertText:(e||"")+a+(t||""),type:"KEYWORD",insertTextRules:this.monaco?.languages.CompletionItemInsertTextRule?.InsertAsSnippet}))}getScopesCompletions(e,t){return Kt.map(a=>({label:a,insertText:(e||"")+a+(t||""),type:"SCOPE",insertTextRules:this.monaco?.languages.CompletionItemInsertTextRule?.InsertAsSnippet}))}};let ge=$;ge.arithmeticOps=[{label:"+",insertText:"+",detail:"Plus"},{label:"-",insertText:"-",detail:"Minus"},{label:"*",insertText:"*",detail:"Times"},{label:"/",insertText:"/",detail:"Over"}],ge.logicalOps=[{label:"&&",insertText:"&&",detail:"And",documentation:"And (intersection) operator. Checks that both conditions found matches."},{label:"||",insertText:"||",detail:"Or",documentation:"Or (union) operator. Checks that either condition found matches."}],ge.comparisonOps=[{label:"=",insertText:"=",detail:"Equality"},{label:"!=",insertText:"!=",detail:"Inequality"},{label:">",insertText:">",detail:"Greater than"},{label:">=",insertText:">=",detail:"Greater than or equal to"},{label:"<",insertText:"<",detail:"Less than"},{label:"<=",insertText:"<=",detail:"Less than or equal to"},{label:"=~",insertText:"=~",detail:"Regular expression"},{label:"!~",insertText:"!~",detail:"Negated regular expression"}],ge.structuralOps=[{label:">>",insertText:">>",detail:"Descendant",documentation:"Descendant operator. Looks for spans matching {condB} that are descendants of a span matching {condA}"},{label:">",insertText:">",detail:"Child",documentation:"Child operator. Looks for spans matching {condB} that are direct child spans of a parent matching {condA}"},{label:"<<",insertText:"<<",detail:"Ancestor",documentation:"Ancestor operator. Looks for spans matching {condB} that are ancestors of a span matching {condA}"},{label:"<",insertText:"<",detail:"Parent",documentation:"Parent operator. Looks for spans matching {condB} that are direct parent spans of a child matching {condA}"},{label:"~",insertText:"~",detail:"Sibling",documentation:"Sibling operator. Checks that spans matching {condA} and {condB} are siblings of the same parent span."}],ge.spansetOps=[{label:"|",insertText:"|",detail:"Pipe"},...$.logicalOps,...$.structuralOps],ge.spansetAggregatorOps=[{label:"count",insertText:"count()$0",detail:"Number of spans",documentation:"Counts the number of spans in a spanset"},{label:"avg",insertText:"avg($0)",detail:"Average of attribute",documentation:"Computes the average of a given numeric attribute or intrinsic for a spanset."},{label:"max",insertText:"max($0)",detail:"Max value of attribute",documentation:"Computes the maximum value of a given numeric attribute or intrinsic for a spanset."},{label:"min",insertText:"min($0)",detail:"Min value of attribute",documentation:"Computes the minimum value of a given numeric attribute or intrinsic for a spanset."},{label:"sum",insertText:"sum($0)",detail:"Sum value of attribute",documentation:"Computes the sum value of a given numeric attribute or intrinsic for a spanset."}],ge.functions=[...$.spansetAggregatorOps,{label:"by",insertText:"by($0)",detail:"Grouping of attributes",documentation:"Groups by arbitrary attributes."},{label:"select",insertText:"select($0)",detail:"Selection of fields",documentation:"Selects arbitrary fields from spans."}];function hn(e,t){switch(e){case"TAG_NAME":return t.languages.CompletionItemKind.Enum;case"KEYWORD":return t.languages.CompletionItemKind.Keyword;case"OPERATOR":return t.languages.CompletionItemKind.Operator;case"TAG_VALUE":return t.languages.CompletionItemKind.EnumMember;case"SCOPE":return t.languages.CompletionItemKind.Class;case"FUNCTION":return t.languages.CompletionItemKind.Function;default:throw new Error(`Unexpected CompletionType: ${e}`)}}function vn(e,t,a){const r=t.getWordAtPosition(a),n=r!=null?e.Range.lift({startLineNumber:a.lineNumber,endLineNumber:a.lineNumber,startColumn:r.startColumn,endColumn:r.endColumn}):e.Range.fromPositions(a),d={column:a.column,lineNumber:a.lineNumber};return{offset:t.getOffsetAt(d),range:n}}function Sn(e,t,a,r){if(t==="TAG_NAME"){const n=a.getValue().substring(0,r).match(/(span\.|resource\.|\.)?([\w./-]*)$/);if(n){const d=n[1],l=n[2];l&&(!d&&e.insertText[0]!=="."&&(e.insertText="."+e.insertText),e.range={...e.range,startColumn:r-l.length+1})}}}const Tn=e=>{switch(e.parent?.type.id){case ee:switch(e.prevSibling?.type.id){case Ea:case Qa:return"Invalid value after logical operator.";case Ct:return"Invalid value after comparison or arithmetic operator.";default:return"Invalid operator after field expression."}case at:return e.prevSibling?.type.id===ee?"Invalid comparison operator after field expression.":"Invalid expression for spanset.";case tt:switch(e.prevSibling?.type.id){case tt:return"Invalid spanset combining operator after spanset expression.";case ba:return"Invalid aggregation operator after pipepile operator.";default:return"Invalid spanset expression after spanset combining operator."}case Dt:case rt:return"Invalid expression for aggregator operator.";case Nt:return"Invalid expression for by operator.";case zt:return"Invalid expression for select operator.";case Ve:return"Invalid expression for spanset.";case xa:switch(e.prevSibling?.type.id){case Ra:return"Invalid value after comparison operator.";case dn:if(e.prevSibling?.firstChild?.type.id===rt)return"Invalid comparison operator after aggregator operator.";default:return"Invalid value after comparison operator."}default:return"Invalid query."}},Da=e=>{if(e.trim()==="")return[];const t=/^[0-9A-Fa-f]*$/;if(e.trim().match(t))return[];const a=wt.parse(e),r=[];return a.iterate({enter:n=>{n.type.id===0&&r.push(n.node)}}),r},Mt=(e,t,a)=>{const r=[...yn(e.MarkerSeverity.Error,t,a),...En(e.MarkerSeverity.Warning,t)];e.editor.setModelMarkers(t,"owner",r)},yn=(e,t,a)=>a.map(r=>{const n=Tn(r);return Na(e,n,t,r.from,r.to)}),En=(e,t)=>{let a=[];const r=t.getValue(),n=wt.parse(r);if(r.indexOf(".")>-1){const l=n.cursorAt(0);do{const{node:i}=l;if(i.type.id===rn&&i.prevSibling?.type.id!==an&&i.prevSibling?.type.id!==sn&&i.prevSibling?.type.id!==nn){const c=i.prevSibling?i.prevSibling.from:i.from-1,u=i.prevSibling?i.prevSibling.to:i.from-1,p="Add resource or span scope to attribute to improve query performance.";a.push(Na(e,p,t,c,u))}}while(l.next())}return a},Na=(e,t,a,r,n)=>{let d=0,l=0,i=r,c=n;for(;i>0;)d++,i-=a.getLineLength(d)+1;for(;c>0;)l++,c-=a.getLineLength(l)+1;return{message:t,severity:e,startLineNumber:d,endLineNumber:l,startColumn:i+a.getLineLength(d)+2,endColumn:c+a.getLineLength(l)+2}};function Qn(e){const[t,a]=(0,s.useState)(""),{query:r,onChange:n,onRunQuery:d,placeholder:l}=e,i=wn(e.datasource,a),c=(0,T.$j)(),u=In(c,l),p=(0,s.useRef)(r);p.current=r;const m=S=>{n({...p.current,query:S})},g=(0,s.useRef)(d);g.current=d;const O=(0,s.useRef)();return s.createElement(s.Fragment,null,s.createElement(da.B,{value:r.query||"",language:Fe,onBlur:m,onChange:m,containerStyles:u.queryField,readOnly:e.readOnly,monacoOptions:{folding:!1,fontSize:14,lineNumbers:"off",overviewRulerLanes:0,renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,wordWrap:"on"},onBeforeEditorMount:Cn,onEditorDidMount:(S,y)=>{e.readOnly||(i(S,y,Rn(S)),xn(S,y,()=>g.current()),bn(S,y,u)),Pn(S);const z=S.getModel();if(z){const _=Da(z.getValue());Mt(y,z,_)}S.onDidChangeModelContent(_=>{const v=S.getModel();if(!v)return;window.clearTimeout(O.current);const I=Da(v.getValue()),L=_.changes[0].rangeOffset;Mt(y,v,I.filter(E=>!(E.from<=L&&L<=E.to))),O.current=window.setTimeout(()=>{Mt(y,v,I)},500)})}}),t&&s.createElement(Hs,{severity:"error",text:t}))}function bn(e,t,a){const r=[{range:new t.Range(1,1,1,1),options:{className:a.placeholder,isWholeLine:!0}}];let n=[];const d=()=>{const l=e.getModel();if(!l)return;const i=l.getValueLength()===0?r:[];n=l.deltaDecorations(n,i)};d(),e.onDidChangeModelContent(d)}function xn(e,t,a){e.addAction({id:"run-query",label:"Run Query",keybindings:[t.KeyMod.Shift|t.KeyCode.Enter],contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(){a()}})}function Rn(e){return e.addCommand(0,function(t,a,r){const n={datasourceType:"tempo",type:r};r!=="TAG_VALUE"&&(n.label=a),(0,D.rR)("grafana_traces_traceql_completion",n)})}function Pn(e){const t=e.getDomNode(),a=()=>{if(t){const r=Math.min(1e3,e.getContentHeight()),n=parseInt(t.style.width,10);t.style.width=`${n}px`,t.style.height=`${r}px`,e.layout({width:n,height:r})}};e.onDidContentSizeChange(a),a()}function wn(e,t){const a=(0,s.useRef)(new ge({languageProvider:e.languageProvider}));(0,s.useEffect)(()=>{(async()=>{try{await e.languageProvider.start()}catch(d){d instanceof Error&&(console.error(d),t(d.message))}})()},[e,t]);const r=(0,s.useRef)(null);return(0,s.useEffect)(()=>()=>{r.current?.()},[]),(n,d,l)=>{a.current.editor=n,a.current.monaco=d,a.current.setRegisterInteractionCommandId(l);const{dispose:i}=d.languages.registerCompletionItemProvider(Fe,a.current);r.current=i}}let za=!1;const Fe="traceql";function Cn(e){if(!za){za=!0;const{aliases:t,extensions:a,mimetypes:r,def:n}=fr;e.languages.register({id:Fe,aliases:t,extensions:a,mimetypes:r}),e.languages.setMonarchTokensProvider(Fe,n.language),e.languages.setLanguageConfiguration(Fe,n.languageConfiguration)}}const In=(e,t)=>({queryField:(0,h.css)({borderRadius:e.shape.radius.default,border:`1px solid ${e.components.input.borderColor}`,flex:1}),placeholder:(0,h.css)({"::after":{content:`'${t}'`,fontFamily:e.typography.fontFamilyMonospace,opacity:.3}})});function Dn(e){const t=(0,T.of)(Nn),a=(0,q.defaults)(e.query,Bs),[r,n]=(0,s.useState)(()=>{const d=Ce(a.filters||[]);return d===a.query||d==="{}"});return s.createElement(s.Fragment,null,s.createElement(w.c,null,"Build complex queries using TraceQL to select a list of traces."," ",s.createElement("a",{rel:"noreferrer",target:"_blank",href:"https://grafana.com/docs/tempo/latest/traceql/"},"Documentation")),!r&&s.createElement("div",{className:t.copyContainer},s.createElement("span",null,"Continue editing the query from the Search tab?"),s.createElement(H.$n,{variant:"secondary",size:"sm",onClick:()=>{(0,D.rR)("grafana_traces_copy_to_traceql_clicked",{app:e.app??"",grafana_version:P.$.buildInfo.version,location:"traceql_tab"}),e.onClearResults(),e.onChange({...a,query:Ce(a.filters||[])}),n(!0)},style:{marginLeft:"10px"}},"Copy query from Search")),s.createElement(Qn,{placeholder:"Enter a TraceQL query or trace ID (run with Shift+Enter)",query:a,onChange:e.onChange,datasource:e.datasource,onRunQuery:e.onRunQuery}),s.createElement("div",{className:t.optionsContainer},s.createElement(Qt,{query:a,onChange:e.onChange})))}const Nn=e=>({optionsContainer:(0,h.css)({marginTop:"10px"}),copyContainer:(0,h.css)({backgroundColor:e.colors.background.secondary,padding:e.spacing(.5,1),fontSize:e.typography.body.fontSize})}),zn="traceql";class $n extends s.PureComponent{constructor(t){super(t),this.onChangeLinkedQuery=a=>{const{query:r,onChange:n}=this.props;n({...r,linkedQuery:{...a,refId:"linked"}})},this.onRunLinkedQuery=()=>{this.props.onRunQuery()},this.onClearResults=()=>{const{onChange:a,query:r,onRunQuery:n}=this.props;a({...r,queryType:"clear"}),n()},this.state={uploadModalOpen:!1}}async componentDidMount(){(!this.props.query.queryType||this.props.query.queryType==="clear")&&this.props.onChange({...this.props.query,queryType:zn})}render(){const{query:t,onChange:a,datasource:r,app:n}=this.props,d=r.getLokiSearchDS(),l=r.serviceMap?.datasourceUid;let i=[{value:"traceqlSearch",label:"Search"},{value:"traceql",label:"TraceQL"},{value:"serviceMap",label:"Service Graph"}];return d&&(r?.search?.hide?i.unshift({value:"search",label:"Search"}):i.push({value:"search",label:"Loki Search"})),(t.spanName||t.serviceName||t.search||t.maxDuration||t.minDuration||t.queryType==="nativeSearch")&&i.unshift({value:"nativeSearch",label:"[Deprecated] Search"}),s.createElement(s.Fragment,null,s.createElement(ae.a,{title:"Upload trace",isOpen:this.state.uploadModalOpen,onDismiss:()=>this.setState({uploadModalOpen:!1})},s.createElement("div",{className:(0,h.css)({padding:this.props.theme.spacing(2)})},s.createElement(oe.gH,{options:{multiple:!1},onLoad:c=>{if(typeof c!="string"&&c!==null)throw Error(`Unexpected result type: ${typeof c}`);this.props.datasource.uploadedJson=c,a({...t,queryType:"upload"}),this.setState({uploadModalOpen:!1}),this.props.onRunQuery()}}))),s.createElement(C.C,null,s.createElement(Q.I,{label:"Query type",grow:!0},s.createElement(N.Gy,{spacing:"sm",align:"center",justify:"space-between"},s.createElement(j.z,{options:i,value:t.queryType,onChange:c=>{(0,D.rR)("grafana_traces_query_type_changed",{datasourceType:"tempo",app:n??"",grafana_version:P.$.buildInfo.version,newQueryType:c,previousQueryType:t.queryType??""}),this.onClearResults(),a({...t,queryType:c})},size:"md"}),s.createElement(H.$n,{variant:"secondary",size:"sm",onClick:()=>{this.setState({uploadModalOpen:!0})}},"Import trace")))),t.queryType==="search"&&s.createElement(ka,{logsDatasourceUid:d,query:t,onRunQuery:this.onRunLinkedQuery,onChange:this.onChangeLinkedQuery}),t.queryType==="nativeSearch"&&s.createElement(ls,{datasource:this.props.datasource,query:t,onChange:a,onBlur:this.props.onBlur,onRunQuery:this.props.onRunQuery}),t.queryType==="traceqlSearch"&&s.createElement(Cs,{datasource:this.props.datasource,query:t,onChange:a,onBlur:this.props.onBlur,app:n,onClearResults:this.onClearResults}),t.queryType==="serviceMap"&&s.createElement(ks,{graphDatasourceUid:l,query:t,onChange:a}),t.queryType==="traceql"&&s.createElement(Dn,{datasource:this.props.datasource,query:t,onRunQuery:this.props.onRunQuery,onChange:a,app:n,onClearResults:this.onClearResults}))}}const Mn=(0,T.cV)($n);var An=o(68704),Ln=o(77657),Vn=o(17466),Fn=o(66025),$a=o(91062),Un=o(32346),dt=o(29020),Ue=o(35931),At=o(43549),jn=o(90057),Ma=o(16817),A=o(22391),Lt=o(55882),Vt=o(15292),Xn=o(63009),Wn=o(3988);function kn(e){const t=Yn(e.profileTypes);return s.createElement(Wn.v,{placeholder:e.placeholder,separator:"-",displayAllSelectedLevels:!0,initialValue:e.initialProfileTypeId,allowCustomValue:!0,onSelect:e.onChange,options:t,changeOnSelect:!1,width:e.width??26})}function Yn(e){return(0,s.useMemo)(()=>{if(!e)return[];let t=new Map;for(let a of e){let r=[];a.id.indexOf(":")>-1&&(r=a.id.split(":"));const[n,d]=r;t.has(n)||t.set(n,{label:n,value:n,items:[]}),t.get(n)?.items.push({label:d,value:a.id})}return Array.from(t.values())},[e])}function Hd(e){const[t,a]=useState();return useEffect(()=>{(async()=>{const r=await e.getProfileTypes();a(r)})()},[e]),t}function _n({options:e,onOptionsChange:t}){const a=(0,s.useMemo)(()=>["grafana-pyroscope-datasource"],[]),[r,n]=(0,s.useState)([]),d=(0,s.useMemo)(()=>{let c=r.length===0?"No profile types found":"Select profile type";return e.jsonData.tracesToProfiles?.datasourceUid||(c="Please select profiling data source"),c},[e.jsonData.tracesToProfiles?.datasourceUid,r]),{value:l}=(0,Ma.A)(async()=>await(0,ne.l)().get(e.jsonData.tracesToProfiles?.datasourceUid),[e.jsonData.tracesToProfiles?.datasourceUid]),{value:i}=(0,Ma.A)(async()=>{if(l instanceof Zt.iy&&a.includes(l.type)&&l.uid===e.jsonData.tracesToProfiles?.datasourceUid)return await l?.getResource("profileTypes")},[l]);return(0,s.useEffect)(()=>{n(i??[])},[i]),s.createElement("div",{className:(0,h.css)({width:"100%"})},s.createElement(C.C,null,s.createElement(Q.I,{tooltip:"The profiles data source the trace is going to navigate to",label:"Data source",labelWidth:26},s.createElement(Lt.s,{inputId:"trace-to-profiles-data-source-picker",filter:c=>a.includes(c.type),current:e.jsonData.tracesToProfiles?.datasourceUid,noDefault:!0,width:40,onChange:c=>{(0,A.lO)({onOptionsChange:t,options:e},"tracesToProfiles",{...e.jsonData.tracesToProfiles,datasourceUid:c.uid})}}))),s.createElement(C.C,null,s.createElement(Q.I,{tooltip:"Tags that will be used in the query. Default tags: 'service.name', 'service.namespace'",label:"Tags",labelWidth:26},s.createElement(Xn.l,{values:e.jsonData.tracesToProfiles?.tags??[],onChange:c=>{(0,A.lO)({onOptionsChange:t,options:e},"tracesToProfiles",{...e.jsonData.tracesToProfiles,tags:c})}}))),s.createElement(C.C,null,s.createElement(Q.I,{tooltip:"Profile type that will be used in the query",label:"Profile type",labelWidth:26},s.createElement(kn,{profileTypes:r,placeholder:d,initialProfileTypeId:e.jsonData.tracesToProfiles?.profileTypeId,onChange:c=>{(0,A.lO)({onOptionsChange:t,options:e},"tracesToProfiles",{...e.jsonData.tracesToProfiles,profileTypeId:c})},width:40}))),s.createElement(C.C,null,s.createElement(Q.I,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26},s.createElement(Vt.K,{id:"profilesCustomQuerySwitch",value:e.jsonData.tracesToProfiles?.customQuery,onChange:c=>(0,A.lO)({onOptionsChange:t,options:e},"tracesToProfiles",{...e.jsonData.tracesToProfiles,customQuery:c.currentTarget.checked})}))),e.jsonData.tracesToProfiles?.customQuery&&s.createElement(Q.I,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to profiles data source. Interpolate tags using the `$__tags` keyword",grow:!0},s.createElement(ze.p,{label:"Query",type:"text",allowFullScreen:!0,value:e.jsonData.tracesToProfiles?.query||"",onChange:c=>(0,A.lO)({onOptionsChange:t,options:e},"tracesToProfiles",{...e.jsonData.tracesToProfiles,query:c.currentTarget.value})})))}const Bn=({options:e,onOptionsChange:t})=>s.createElement($a.A,{title:"Trace to profiles",description:s.createElement(Ue.H,{description:"Navigate from a trace span to the selected data source's profiles.",suffix:`${e.type}/configure-tempo-data-source/#trace-to-profiles`,feature:"trace to profiles"}),isCollapsible:!0,isInitiallyOpen:!0},s.createElement(_n,{options:e,onOptionsChange:t}));var Gn=o(33309),Zn=o(61653),Ne=o(25994),qn=o(17081),Aa=o(20323);function Kn({options:e,onOptionsChange:t}){const a=(0,T.of)(lt),r=d=>`Time shift for ${d} of search`,n=d=>`Shifts the ${d} of the time range when searching by TraceID. Searching can return traces that do not fully fall into the search time range, so we recommend using higher time shifts for longer traces. Default: 30m (Time units can be used here, for example: 5s, 1m, 3h`;return s.createElement("div",{className:a.container},s.createElement(Q.I,{label:"Use time range in query",tooltip:"The time range can be used when there are performance issues or timeouts since it will narrow down the search to the defined range. Default: disabled",labelWidth:26},s.createElement(Vt.K,{id:"enable-time-shift",value:e.jsonData.traceQuery?.timeShiftEnabled||!1,onChange:d=>{(0,A.lO)({onOptionsChange:t,options:e},"traceQuery",{...e.jsonData.traceQuery,timeShiftEnabled:d.currentTarget.checked})}})),s.createElement(Aa.e,{label:r("start"),tooltip:n("start"),value:e.jsonData.traceQuery?.spanStartTimeShift||"",disabled:!e.jsonData.traceQuery?.timeShiftEnabled,onChange:d=>{(0,A.lO)({onOptionsChange:t,options:e},"traceQuery",{...e.jsonData.traceQuery,spanStartTimeShift:d})},isInvalidError:At.FJ}),s.createElement(Aa.e,{label:r("end"),tooltip:n("end"),value:e.jsonData.traceQuery?.spanEndTimeShift||"",disabled:!e.jsonData.traceQuery?.timeShiftEnabled,onChange:d=>{(0,A.lO)({onOptionsChange:t,options:e},"traceQuery",{...e.jsonData.traceQuery,spanEndTimeShift:d})},isInvalidError:At.FJ}))}const lt=e=>({infoText:(0,h.css)({paddingBottom:e.spacing(2),color:e.colors.text.secondary}),container:(0,h.css)({width:"100%"}),row:(0,h.css)({alignItems:"baseline"})});function Hn({options:e,onOptionsChange:t}){const a=(0,T.of)(lt),r=e.jsonData.tracesToLogs?.lokiSearch!==!1?e.jsonData.tracesToLogs?.datasourceUid:void 0;return r&&e.jsonData.lokiSearch===void 0&&(0,A.lO)({onOptionsChange:t,options:e},"lokiSearch",{datasourceUid:r}),s.createElement("div",{className:a.container},s.createElement(C.C,{className:a.row},s.createElement(Q.I,{tooltip:"The Loki data source with the service graph data",label:"Data source",labelWidth:26},s.createElement(Lt.s,{inputId:"loki-search-data-source-picker",pluginId:"loki",current:e.jsonData.lokiSearch?.datasourceUid,noDefault:!0,width:40,onChange:n=>(0,A.lO)({onOptionsChange:t,options:e},"lokiSearch",{datasourceUid:n.uid})})),e.jsonData.lokiSearch?.datasourceUid?s.createElement(H.$n,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,A.lO)({onOptionsChange:t,options:e},"lokiSearch",{datasourceUid:void 0})}},"Clear"):null))}function Jn({options:e,onOptionsChange:t}){const a=(0,T.of)(lt);return s.createElement("div",{className:a.container},s.createElement(C.C,{className:a.row},s.createElement(Q.I,{tooltip:"The Prometheus data source with the service graph data",label:"Data source",labelWidth:26},s.createElement(Lt.s,{inputId:"service-graph-data-source-picker",pluginId:"prometheus",current:e.jsonData.serviceMap?.datasourceUid,noDefault:!0,width:40,onChange:r=>(0,A.lO)({onOptionsChange:t,options:e},"serviceMap",{datasourceUid:r.uid})})),e.jsonData.serviceMap?.datasourceUid?s.createElement(H.$n,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,A.lO)({onOptionsChange:t,options:e},"serviceMap",{datasourceUid:void 0})}},"Clear"):null))}function ed({options:e,onOptionsChange:t,datasource:a}){const r=async()=>{if(!a)throw new Error("Unable to retrieve datasource");try{await a.languageProvider.start()}catch(p){throw new Error(G(p.data.message,"Unable to query Tempo"))}},{error:n,loading:d}=(0,f.A)(r,[a,e]),l=(0,s.useCallback)(p=>{let m=e.jsonData.search?.filters;m||=[];const g=m.findIndex(O=>O.id===p.id);g>=0?m=ft(m,g,p):m.push(p),(0,A.lO)({onOptionsChange:t,options:e},"search",{...e.jsonData.search,filters:m})},[t,e]),i=p=>{(0,A.lO)({onOptionsChange:t,options:e},"search",{...e.jsonData.search,filters:e.jsonData.search?.filters?.filter(m=>m.id!==p.id)})};(0,s.useEffect)(()=>{e.jsonData.search?.filters||(0,A.lO)({onOptionsChange:t,options:e},"search",{...e.jsonData.search,filters:[{id:"service-name",tag:"service.name",operator:"=",scope:R.d.Resource},{id:"span-name",tag:"name",operator:"=",scope:R.d.Span}]})},[t,e]);const c=["duration"],u=e.jsonData.search?.filters?.find(p=>!p.tag);return s.createElement(s.Fragment,null,a?s.createElement(ga,{updateFilter:l,deleteFilter:i,filters:e.jsonData.search?.filters||[],datasource:a,setError:()=>{},staticTags:c,isTagsLoading:d,hideValues:!0,query:"{}"}):s.createElement("div",null,"Invalid data source, please create a valid data source and try again"),n&&s.createElement(Se.F,{title:"Unable to fetch TraceQL tags",severity:"error",topSpacing:1},n.message),u&&s.createElement(Se.F,{title:"Please ensure each filter has a selected tag",severity:"warning",topSpacing:1}))}function td({options:e,onOptionsChange:t}){const a=(0,T.of)(lt),r=(0,ne.l)(),n=async()=>await r.get({type:e.type,uid:e.uid}),{value:d}=(0,f.A)(n,[r,e]);return s.createElement("div",{className:a.container},s.createElement(C.C,{className:a.row},s.createElement(Q.I,{tooltip:"Removes the search tab from the query editor",label:"Hide search",labelWidth:26},s.createElement(Vt.K,{id:"hideSearch",value:e.jsonData.search?.hide,onChange:l=>(0,A.lO)({onOptionsChange:t,options:e},"search",{...e.jsonData.search,hide:l.currentTarget.checked})}))),s.createElement(C.C,{className:a.row},s.createElement(Q.I,{tooltip:"Configures which fields are available in the UI",label:"Static filters",labelWidth:26},s.createElement(ed,{datasource:d,options:e,onOptionsChange:t}))))}const ad=({options:e,onOptionsChange:t})=>{const a=(0,T.of)(rd);return s.createElement("div",{className:a.container},s.createElement(An.I,{dataSourceName:"Tempo",docsLink:"https://grafana.com/docs/grafana/latest/datasources/tempo",hasRequiredFields:!1}),s.createElement(Ne.c,{spacing:4}),s.createElement(Ln.u,{config:e,onChange:t,urlPlaceholder:"http://localhost:3200"}),s.createElement(Ne.c,{spacing:4}),s.createElement(Vn.N,{...(0,Fn.pe)({config:e,onChange:t})}),s.createElement(Ne.c,{spacing:4}),s.createElement(At.T0,{options:e,onOptionsChange:t}),s.createElement(Ne.c,{spacing:4}),P.$.featureToggles.traceToMetrics?s.createElement(s.Fragment,null,s.createElement(jn.$,{options:e,onOptionsChange:t}),s.createElement(Ne.c,{spacing:4})):null,s.createElement(Bn,{options:e,onOptionsChange:t}),s.createElement(Ne.c,{spacing:4}),s.createElement($a.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!1},s.createElement(ca.B,{gap:5,direction:"column"},s.createElement(Un.g,{config:e,onChange:t}),P.$.secureSocksDSProxyEnabled&&s.createElement(s.Fragment,null,s.createElement(qn.Y,{options:e,onOptionsChange:t})),s.createElement(dt.I,{title:"Service graph",description:s.createElement(Ue.H,{description:"Select a Prometheus data source that contains the service graph data.",suffix:"tempo/configure-tempo-data-source/#service-graph",feature:"the service graph"})},s.createElement(Jn,{options:e,onOptionsChange:t})),s.createElement(Gn.m,{options:e,onOptionsChange:t}),s.createElement(dt.I,{title:"Tempo search",description:s.createElement(Ue.H,{description:"Modify how traces are searched.",suffix:"tempo/configure-tempo-data-source/#tempo-search",feature:"Tempo search"})},s.createElement(td,{options:e,onOptionsChange:t})),s.createElement(dt.I,{title:"Loki search",description:s.createElement(Ue.H,{description:"Select a Loki data source to search for traces. Derived fields must be configured in the Loki data source.",suffix:"tempo/configure-tempo-data-source/#loki-search",feature:"Loki search"})},s.createElement(Hn,{options:e,onOptionsChange:t})),s.createElement(dt.I,{title:"TraceID query",description:s.createElement(Ue.H,{description:"Modify how TraceID queries are run.",suffix:"tempo/configure-tempo-data-source/#traceid-query",feature:"the TraceID query"})},s.createElement(Kn,{options:e,onOptionsChange:t})),s.createElement(Zn.NI,{options:e,onOptionsChange:t}))))},rd=e=>({container:(0,h.css)({label:"container",marginBottom:e.spacing(2),maxWidth:"900px"})});var sd=o(17346);const nd=({payload:{dashboardId:e,orgId:t,grafanaVersion:a,queries:r}})=>{try{const n=r[sd.id];if(!n?.length)return;let d={grafana_version:a,dashboard_id:e,org_id:t,native_search_query_count:0,search_query_count:0,service_map_query_count:0,traceql_query_count:0,upload_query_count:0,native_search_queries_with_template_variables_count:0,search_queries_with_template_variables_count:0,service_map_queries_with_template_variables_count:0,traceql_queries_with_template_variables_count:0};for(const l of n)l.hide||(l.queryType==="nativeSearch"?(d.native_search_query_count++,(l.serviceName&&Oe(l.serviceName)||l.spanName&&Oe(l.spanName)||l.search&&Oe(l.search)||l.minDuration&&Oe(l.minDuration)||l.maxDuration&&Oe(l.maxDuration))&&d.native_search_queries_with_template_variables_count++):l.queryType==="search"?(d.search_query_count++,l.linkedQuery&&l.linkedQuery.expr&&Oe(l.linkedQuery.expr)&&d.search_queries_with_template_variables_count++):l.queryType==="serviceMap"?(d.service_map_query_count++,l.serviceMapQuery&&Oe(l.serviceMapQuery)&&d.service_map_queries_with_template_variables_count++):l.queryType==="traceql"?(d.traceql_query_count++,Oe(l.query)&&d.traceql_queries_with_template_variables_count++):l.queryType==="upload"&&d.upload_query_count++);(0,D.rR)("grafana_tempo_dashboard_loaded",d)}catch(n){console.error("error in tempo tracking handler",n)}},Oe=e=>(Array.isArray(e)?e:[e]).some(t=>(0,ve.w)().containsTemplate(t)),dd=new V.tD(Yr).setQueryEditor(Mn).setConfigEditor(ad).setQueryEditorHelp(te);(0,F.J7)().subscribe(b.gc,nd)}}]);

//# sourceMappingURL=3543.eecef49ce94da5ee0418.js.map