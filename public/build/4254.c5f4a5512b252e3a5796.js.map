{"version":3,"file":"4254.c5f4a5512b252e3a5796.js","mappings":"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ClG,MAAO,CACL,MAAOrP,GAAS,CACd,OAAQ,GACR,OAAQ,CAAC,EACT,WAAY,CAAC,CACf,EACA,cAAe,GACf,oBAAqBqP,GAAuB,GAC5C,iBAAkB,GAClB,gBAAiB,GACjB,aAAc,CAAC,CACjB,CACF,CAcO,SAASH,GAAkBnC,EAAgCuC,EAAkC,CAClG,MAAO,CACL,eAAAvC,EACA,OAAQ,GACR,YAAa,CAAC,EACd,UAAWuC,GAAa,GACxB,qBAAsB,EACxB,CACF,CCrFO,MAAMC,GAAmC,CAC9C,CACE,SAAU,aACV,YAAa,6BACf,EACA,CACE,SAAU,yBACV,YAAa,8DACf,EACA,CACE,SAAU,2BACV,YAAa,oEACf,EACA,CACE,SAAU,4CACV,YACE,qHACJ,EACA,CACE,SAAU,oBACV,YAAa,0CACf,EACA,CACE,SAAU,eACV,YAAa,6BACf,EACA,CACE,SAAU,kCACV,YAAa,mDACf,EACA,CACE,SAAU,0BACV,YAAa,wFACf,EACA,CACE,SAAU,kCACV,YAAa,oCACf,EACA,CACE,SAAU,iCACV,YAAa,uEACf,EACA,CACE,SAAU,8CACV,YAAa,uFACf,EACA,CACE,SAAU,0BACV,YAAa,iDACf,EACA,CACE,SAAU,kBACV,YAAa,4EACf,EACA,CACE,SAAU,mBACV,YAAa,mDACf,EACA,CACE,SAAU,kBACV,YAAa,mBACf,EACA,CACE,SAAU,0CACV,YAAa,mDACf,EACA,CACE,SAAU,kCACV,YAAa,uDACf,CACF,EAEaC,GAAmC,CAC9C,CACE,SAAU,mCACV,YACE,8GACJ,EACA,CACE,SAAU,uBACV,YAAa,uDACf,EACA,CACE,SAAU,uCACV,YACE,wHACJ,EACA,CACE,SAAU,4BACV,YAAa,+EACf,EACA,CACE,SAAU,iCACV,YAAa,4EACf,EACA,CACE,SAAU,2BACV,YAAa,uDACf,EACA,CACE,SAAU,oCACV,YAAa,0FACf,EACA,CACE,SAAU,wBACV,YAAa,8DACf,EACA,CACE,SAAU,mCACV,YACE,kIACJ,EACA,CACE,SAAU,2CACV,YAAa,kEACf,EACA,CACE,SAAU,wDACV,YAAa,iDACf,EACA,CACE,SAAU,8CACV,YAAa,qEACf,EACA,CACE,SAAU,4BACV,YAAa,mEACf,EACA,CACE,SAAU,4BACV,YAAa,8EACf,EACA,CACE,SAAU,qCACV,YAAa,iDACf,CACF,EAEaC,GAAqC,CAChD,CACE,SAAU,2DACV,YACE,4KACJ,EACA,CACE,SAAU,gDACV,YAAa,6DACf,EACA,CACE,SAAU,2DACV,YAAa,6FACf,EACA,CACE,SAAU,oCACV,YAAa,6BACf,CACF,EAEaC,GAAiC,CAC5C,CACE,SAAU,yBACV,YAAa,sDACf,EACA,CACE,SAAU,kBACV,YAAa,4DACf,EACA,CACE,SAAU,0BACV,YAAa,kGACf,EACA,CACE,SAAU,kBACV,YAAa,uDACf,EACA,CACE,SAAU,kBACV,YAAa,sDACf,EACA,CACE,SAAU,kBACV,YAAa,sFACf,EACA,CACE,SAAU,kBACV,YAAa,yCACf,EACA,CACE,SAAU,mBACV,YAAa,4CACf,EACA,CACE,SAAU,gCACV,YAAa,yCACf,EACA,CACE,SAAU,gCACV,YAAa,uDACf,EACA,CACE,SAAU,qCACV,YAAa,oDACf,EACA,CACE,SAAU,wBACV,YAAa,6FACf,EACA,CACE,SAAU,4CACV,YACE,+GACJ,EACA,CACE,SAAU,gCACV,YAAa,uEACf,EACA,CACE,SAAU,kBACV,YAAa,qCACf,EACA,CACE,SAAU,kBACV,YAAa,kDACf,EACA,CACE,SAAU,2CACV,YAAa,oDACf,EACA,CACE,SAAU,sBACV,YAAa,yDACf,EACA,CACE,SAAU,yBACV,YAAa,+DACf,EACA,CACE,SAAU,kCACV,YAAa,sEACf,EACA,CACE,SAAU,qCACV,YAAa,8CACf,EACA,CACE,SAAU,mCACV,YAAa,wEACf,EACA,CACE,SAAU,8BACV,YACE,iHACJ,EACA,CACE,SAAU,uBACV,YAAa,6CACf,EACA,CACE,SAAU,gCACV,YAAa,uDACf,EACA,CACE,SAAU,qCACV,YAAa,iEACf,CACF,EAEA,SAASC,EAAgBC,EAA4BC,EAAgBjB,EAAiC,CACpG,MAAO,CACL,MAAOgB,EA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","sources":["webpack://grafana/./node_modules/@grafana/experimental/dist/esm/QueryEditor/EditorHeader.js","webpack://grafana/./node_modules/@grafana/experimental/dist/esm/QueryEditor/FlexItem.js","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromCheatSheet.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/QueryPattern.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/QueryPatternsModal.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/hooks/useFlag.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/QueryEditorModeToggle.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/QueryHeaderSwitch.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/state.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationInfoButton.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationHeader.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationParamEditor.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationEditor.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationList.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/QueryBuilderHints.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/NestedQuery.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/NestedQueryList.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/promQail/QuerySuggestionItem.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/promQail/types.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/promQail/QuerySuggestionContainer.tsx","webpack://grafana/./node_modules/@grafana/experimental/dist/esm/llms/vector.js","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/promQail/prompts.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/promQail/state/state.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/promQail/state/templates.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/promQail/state/helpers.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/promQail/PromQail.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/promQail/QueryAssistantButton.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryBuilder.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/QueryPreview.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryBuilderContainer.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromExemplarField.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromExploreExtraField.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/QueryOptionGroup.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryLegendEditor.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryBuilderOptions.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryEditorSelector.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromQueryEditorForAlerting.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromQueryEditorByApp.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/module.ts"],"sourcesContent":["import { css } from '@emotion/css';\nimport React__default from 'react';\nimport { useStyles2 } from '@grafana/ui';\n\nconst EditorHeader = ({ children }) => {\n  const styles = useStyles2(getStyles);\n  return /* @__PURE__ */ React__default.createElement(\"div\", { className: styles.root }, children);\n};\nconst getStyles = (theme) => ({\n  root: css({\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    alignItems: \"center\",\n    gap: theme.spacing(3),\n    minHeight: theme.spacing(4)\n  })\n});\n\nexport { EditorHeader };\n//# sourceMappingURL=EditorHeader.js.map\n","import React__default from 'react';\n\nconst FlexItem = ({ grow, shrink }) => {\n  return /* @__PURE__ */ React__default.createElement(\"div\", { style: { display: \"block\", flexGrow: grow, flexShrink: shrink } });\n};\n\nexport { FlexItem };\n//# sourceMappingURL=FlexItem.js.map\n","import React from 'react';\n\nimport { QueryEditorHelpProps } from '@grafana/data';\n\nimport { PromQuery } from '../types';\n\nconst CHEAT_SHEET_ITEMS = [\n  {\n    title: 'Request Rate',\n    expression: 'rate(http_request_total[5m])',\n    label:\n      'Given an HTTP request counter, this query calculates the per-second average request rate over the last 5 minutes.',\n  },\n  {\n    title: '95th Percentile of Request Latencies',\n    expression: 'histogram_quantile(0.95, sum(rate(prometheus_http_request_duration_seconds_bucket[5m])) by (le))',\n    label: 'Calculates the 95th percentile of HTTP request rate over 5 minute windows.',\n  },\n  {\n    title: 'Alerts Firing',\n    expression: 'sort_desc(sum(sum_over_time(ALERTS{alertstate=\"firing\"}[24h])) by (alertname))',\n    label: 'Sums up the alerts that have been firing over the last 24 hours.',\n  },\n  {\n    title: 'Step',\n    label:\n      'Defines the graph resolution using a duration format (15s, 1m, 3h, ...). Small steps create high-resolution graphs but can be slow over larger time ranges. Using a longer step lowers the resolution and smooths the graph by producing fewer datapoints. If no step is given the resolution is calculated automatically.',\n  },\n];\n\nconst PromCheatSheet = (props: QueryEditorHelpProps<PromQuery>) => (\n  <div>\n    <h2>PromQL Cheat Sheet</h2>\n    {CHEAT_SHEET_ITEMS.map((item, index) => (\n      <div className=\"cheat-sheet-item\" key={index}>\n        <div className=\"cheat-sheet-item__title\">{item.title}</div>\n        {item.expression ? (\n          <button\n            type=\"button\"\n            className=\"cheat-sheet-item__example\"\n            onClick={(e) => props.onClickExample({ refId: 'A', expr: item.expression })}\n          >\n            <code>{item.expression}</code>\n          </button>\n        ) : null}\n        <div className=\"cheat-sheet-item__label\">{item.label}</div>\n      </div>\n    ))}\n  </div>\n);\n\nexport default PromCheatSheet;\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Card, useStyles2 } from '@grafana/ui';\nimport { RawQuery } from 'app/plugins/datasource/prometheus/querybuilder/shared/RawQuery';\n\nimport promqlGrammar from '../promql';\n\nimport { promQueryModeller } from './PromQueryModeller';\nimport { PromQueryPattern } from './types';\n\ntype Props = {\n  pattern: PromQueryPattern;\n  hasNewQueryOption: boolean;\n  hasPreviousQuery: boolean | string;\n  selectedPatternName: string | null;\n  setSelectedPatternName: (name: string | null) => void;\n  onPatternSelect: (pattern: PromQueryPattern, selectAsNewQuery?: boolean) => void;\n};\n\nexport const QueryPattern = (props: Props) => {\n  const { pattern, onPatternSelect, hasNewQueryOption, hasPreviousQuery, selectedPatternName, setSelectedPatternName } =\n    props;\n\n  const styles = useStyles2(getStyles);\n  const lang = { grammar: promqlGrammar, name: 'promql' };\n\n  return (\n    <Card className={styles.card}>\n      <Card.Heading>{pattern.name}</Card.Heading>\n      <div className={styles.rawQueryContainer}>\n        <RawQuery\n          aria-label={`${pattern.name} raw query`}\n          query={promQueryModeller.renderQuery({\n            labels: [],\n            operations: pattern.operations,\n            binaryQueries: pattern.binaryQueries,\n          })}\n          lang={lang}\n          className={styles.rawQuery}\n        />\n      </div>\n      <Card.Actions>\n        {selectedPatternName !== pattern.name ? (\n          <Button\n            size=\"sm\"\n            aria-label=\"use this query button\"\n            onClick={() => {\n              if (hasPreviousQuery) {\n                // If user has previous query, we need to confirm that they want to apply this query pattern\n                setSelectedPatternName(pattern.name);\n              } else {\n                onPatternSelect(pattern);\n              }\n            }}\n          >\n            Use this query\n          </Button>\n        ) : (\n          <>\n            <div className={styles.spacing}>\n              {`If you would like to use this query, ${\n                hasNewQueryOption\n                  ? 'you can either apply this query pattern or create a new query'\n                  : 'this query pattern will be applied to your current query'\n              }.`}\n            </div>\n            <Button size=\"sm\" aria-label=\"back button\" fill=\"outline\" onClick={() => setSelectedPatternName(null)}>\n              Back\n            </Button>\n            <Button\n              size=\"sm\"\n              aria-label=\"apply query starter button\"\n              onClick={() => {\n                onPatternSelect(pattern);\n              }}\n            >\n              Apply query\n            </Button>\n            {hasNewQueryOption && (\n              <Button\n                size=\"sm\"\n                aria-label=\"create new query button\"\n                onClick={() => {\n                  onPatternSelect(pattern, true);\n                }}\n              >\n                Create new query\n              </Button>\n            )}\n          </>\n        )}\n      </Card.Actions>\n    </Card>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    card: css`\n      width: 49.5%;\n      display: flex;\n      flex-direction: column;\n    `,\n    rawQueryContainer: css`\n      flex-grow: 1;\n    `,\n    rawQuery: css`\n      background-color: ${theme.colors.background.primary};\n      padding: ${theme.spacing(1)};\n      margin-top: ${theme.spacing(1)};\n    `,\n    spacing: css`\n      margin-bottom: ${theme.spacing(1)};\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport { capitalize } from 'lodash';\nimport React, { useMemo, useState } from 'react';\n\nimport { CoreApp, DataQuery, GrafanaTheme2 } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Button, Collapse, Modal, useStyles2 } from '@grafana/ui';\nimport { getNextRefIdChar } from 'app/core/utils/query';\n\nimport { PromQuery } from '../types';\n\nimport { promQueryModeller } from './PromQueryModeller';\nimport { QueryPattern } from './QueryPattern';\nimport { buildVisualQueryFromString } from './parsing';\nimport { PromQueryPattern, PromQueryPatternType } from './types';\n\ntype Props = {\n  isOpen: boolean;\n  query: PromQuery;\n  queries: DataQuery[] | undefined;\n  app?: CoreApp;\n  onClose: () => void;\n  onChange: (query: PromQuery) => void;\n  onAddQuery?: (query: PromQuery) => void;\n};\n\nexport const QueryPatternsModal = (props: Props) => {\n  const { isOpen, onClose, onChange, onAddQuery, query, queries, app } = props;\n  const [openTabs, setOpenTabs] = useState<string[]>([]);\n  const [selectedPatternName, setSelectedPatternName] = useState<string | null>(null);\n\n  const styles = useStyles2(getStyles);\n  const hasNewQueryOption = !!onAddQuery;\n  const hasPreviousQuery = useMemo(() => {\n    const visualQuery = buildVisualQueryFromString(query.expr ?? '');\n    // has anything entered in the query, metric, labels, operations, or binary queries\n    const hasOperations = visualQuery.query.operations.length > 0,\n      hasMetric = visualQuery.query.metric,\n      hasLabels = visualQuery.query.labels.length > 0,\n      hasBinaryQueries = visualQuery.query.binaryQueries ? visualQuery.query.binaryQueries.length > 0 : false;\n\n    return hasOperations || hasMetric || hasLabels || hasBinaryQueries;\n  }, [query.expr]);\n\n  const onPatternSelect = (pattern: PromQueryPattern, selectAsNewQuery = false) => {\n    const visualQuery = buildVisualQueryFromString(selectAsNewQuery ? '' : query.expr);\n    reportInteraction('grafana_prom_kickstart_your_query_selected', {\n      app: app ?? '',\n      editorMode: query.editorMode,\n      selectedPattern: pattern.name,\n      preSelectedOperationsCount: visualQuery.query.operations.length,\n      preSelectedLabelsCount: visualQuery.query.labels.length,\n      createNewQuery: hasNewQueryOption && selectAsNewQuery,\n    });\n\n    visualQuery.query.operations = pattern.operations;\n    visualQuery.query.binaryQueries = pattern.binaryQueries;\n    if (hasNewQueryOption && selectAsNewQuery) {\n      onAddQuery({\n        ...query,\n        refId: getNextRefIdChar(queries ?? [query]),\n        expr: promQueryModeller.renderQuery(visualQuery.query),\n      });\n    } else {\n      onChange({\n        ...query,\n        expr: promQueryModeller.renderQuery(visualQuery.query),\n      });\n    }\n    setSelectedPatternName(null);\n    onClose();\n  };\n\n  return (\n    <Modal aria-label=\"Kick start your query modal\" isOpen={isOpen} title=\"Kick start your query\" onDismiss={onClose}>\n      <div className={styles.spacing}>\n        Kick start your query by selecting one of these queries. You can then continue to complete your query.\n      </div>\n      {Object.values(PromQueryPatternType).map((patternType) => {\n        return (\n          <Collapse\n            aria-label={`open and close ${patternType} query starter card`}\n            key={patternType}\n            label={`${capitalize(patternType)} query starters`}\n            isOpen={openTabs.includes(patternType)}\n            collapsible={true}\n            onToggle={() =>\n              setOpenTabs((tabs) =>\n                // close tab if it's already open, otherwise open it\n                tabs.includes(patternType) ? tabs.filter((t) => t !== patternType) : [...tabs, patternType]\n              )\n            }\n          >\n            <div className={styles.cardsContainer}>\n              {promQueryModeller\n                .getQueryPatterns()\n                .filter((pattern) => pattern.type === patternType)\n                .map((pattern) => (\n                  <QueryPattern\n                    key={pattern.name}\n                    pattern={pattern}\n                    hasNewQueryOption={hasNewQueryOption}\n                    hasPreviousQuery={hasPreviousQuery}\n                    onPatternSelect={onPatternSelect}\n                    selectedPatternName={selectedPatternName}\n                    setSelectedPatternName={setSelectedPatternName}\n                  />\n                ))}\n            </div>\n          </Collapse>\n        );\n      })}\n      <Button aria-label=\"close kick start your query modal\" variant=\"secondary\" onClick={onClose}>\n        Close\n      </Button>\n    </Modal>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    cardsContainer: css`\n      display: flex;\n      flex-direction: row;\n      flex-wrap: wrap;\n      justify-content: space-between;\n    `,\n    spacing: css`\n      margin-bottom: ${theme.spacing(1)};\n    `,\n  };\n};\n","import { useCallback, useState } from 'react';\n\nimport store from '../../../../../core/store';\n\nexport const promQueryEditorExplainKey = 'PrometheusQueryEditorExplainDefault';\n\nexport type QueryEditorFlags = typeof promQueryEditorExplainKey;\n\nfunction getFlagValue(key: QueryEditorFlags, defaultValue = false): boolean {\n  const val = store.get(key);\n  return val === undefined ? defaultValue : Boolean(parseInt(val, 10));\n}\n\nfunction setFlagValue(key: QueryEditorFlags, value: boolean) {\n  store.set(key, value ? '1' : '0');\n}\n\ntype UseFlagHookReturnType = { flag: boolean; setFlag: (val: boolean) => void };\n\n/**\n *\n * Use and store value of explain switch in local storage.\n * Needs to be a hook with local state to trigger re-renders.\n */\nexport function useFlag(key: QueryEditorFlags, defaultValue = false): UseFlagHookReturnType {\n  const [flag, updateFlag] = useState(getFlagValue(key, defaultValue));\n  const setter = useCallback(\n    (value: boolean) => {\n      setFlagValue(key, value);\n      updateFlag(value);\n    },\n    [key]\n  );\n\n  return { flag, setFlag: setter };\n}\n","import React from 'react';\n\nimport { RadioButtonGroup } from '@grafana/ui';\n\nimport { QueryEditorMode } from './types';\n\nexport interface Props {\n  mode: QueryEditorMode;\n  onChange: (mode: QueryEditorMode) => void;\n}\n\nconst editorModes = [\n  { label: 'Builder', value: QueryEditorMode.Builder },\n  { label: 'Code', value: QueryEditorMode.Code },\n];\n\nexport function QueryEditorModeToggle({ mode, onChange }: Props) {\n  return (\n    <div data-testid={'QueryEditorModeToggle'}>\n      <RadioButtonGroup options={editorModes} size=\"sm\" value={mode} onChange={onChange} />\n    </div>\n  );\n}\n","import { css } from '@emotion/css';\nimport { uniqueId } from 'lodash';\nimport React, { HTMLProps, useRef } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Switch, useStyles2, Stack } from '@grafana/ui';\n\nexport interface Props extends Omit<HTMLProps<HTMLInputElement>, 'value' | 'ref'> {\n  value?: boolean;\n  label: string;\n}\n\nexport function QueryHeaderSwitch({ label, ...inputProps }: Props) {\n  const dashedLabel = label.replace(' ', '-');\n  const switchIdRef = useRef(uniqueId(`switch-${dashedLabel}`));\n  const styles = useStyles2(getStyles);\n\n  return (\n    <Stack gap={1}>\n      <label htmlFor={switchIdRef.current} className={styles.switchLabel}>\n        {label}\n      </label>\n      <Switch {...inputProps} id={switchIdRef.current} />\n    </Stack>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    switchLabel: css({\n      color: theme.colors.text.secondary,\n      cursor: 'pointer',\n      fontSize: theme.typography.bodySmall.fontSize,\n      '&:hover': {\n        color: theme.colors.text.primary,\n      },\n    }),\n  };\n};\n","import { CoreApp } from '@grafana/data';\nimport store from 'app/core/store';\n\nimport { LegendFormatMode, PromQuery } from '../types';\n\nimport { QueryEditorMode } from './shared/types';\n\nconst queryEditorModeDefaultLocalStorageKey = 'PrometheusQueryEditorModeDefault';\n\nexport function changeEditorMode(query: PromQuery, editorMode: QueryEditorMode, onChange: (query: PromQuery) => void) {\n  // If empty query store new mode as default\n  if (query.expr === '') {\n    store.set(queryEditorModeDefaultLocalStorageKey, editorMode);\n  }\n\n  onChange({ ...query, editorMode });\n}\n\nfunction getDefaultEditorMode(expr: string, defaultEditor: QueryEditorMode = QueryEditorMode.Builder): QueryEditorMode {\n  // If we already have an expression default to code view\n  if (expr != null && expr !== '') {\n    return QueryEditorMode.Code;\n  }\n\n  const value: QueryEditorMode = store.get(queryEditorModeDefaultLocalStorageKey);\n  switch (value) {\n    case QueryEditorMode.Builder:\n    case QueryEditorMode.Code:\n      return value;\n    default:\n      return defaultEditor;\n  }\n}\n\n/**\n * Returns query with defaults, and boolean true/false depending on change was required\n */\nexport function getQueryWithDefaults(\n  query: PromQuery & { expr?: string },\n  app: CoreApp | undefined,\n  defaultEditor?: QueryEditorMode\n): PromQuery {\n  let result = query;\n\n  if (!query.editorMode) {\n    result = { ...query, editorMode: getDefaultEditorMode(query.expr, defaultEditor) };\n  }\n\n  // default query expr is now empty string, set in getDefaultQuery\n  // While expr is required in the types, it is not always defined at runtime, so we need to check for undefined and default to an empty string to prevent runtime errors\n  if (!query.expr) {\n    result = { ...result, expr: '', legendFormat: LegendFormatMode.Auto };\n  }\n\n  if (query.range == null && query.instant == null) {\n    // Default to range query\n    result = { ...result, range: true };\n\n    // In explore we default to both instant & range\n    if (app === CoreApp.Explore) {\n      result.instant = true;\n    }\n  }\n\n  // Unified Alerting does not support \"both\" for query type  fall back to \"range\".\n  const isBothInstantAndRange = query.instant && query.range;\n  if (app === CoreApp.UnifiedAlerting && isBothInstantAndRange) {\n    result = { ...result, instant: false, range: true };\n  }\n\n  return result;\n}\n","import { css } from '@emotion/css';\nimport {\n  autoUpdate,\n  flip,\n  offset,\n  shift,\n  useClick,\n  useDismiss,\n  useFloating,\n  useInteractions,\n} from '@floating-ui/react';\nimport React, { useState } from 'react';\n\nimport { GrafanaTheme2, renderMarkdown } from '@grafana/data';\nimport { FlexItem } from '@grafana/experimental';\nimport { Button, Portal, useStyles2 } from '@grafana/ui';\n\nimport { QueryBuilderOperation, QueryBuilderOperationDef } from './types';\n\nexport interface Props {\n  operation: QueryBuilderOperation;\n  def: QueryBuilderOperationDef;\n}\n\nexport const OperationInfoButton = React.memo<Props>(({ def, operation }) => {\n  const styles = useStyles2(getStyles);\n  const [show, setShow] = useState(false);\n\n  // the order of middleware is important!\n  const middleware = [\n    offset(16),\n    flip({\n      fallbackAxisSideDirection: 'end',\n      // see https://floating-ui.com/docs/flip#combining-with-shift\n      crossAxis: false,\n      boundary: document.body,\n    }),\n    shift(),\n  ];\n\n  const { context, refs, floatingStyles } = useFloating({\n    open: show,\n    placement: 'top',\n    onOpenChange: setShow,\n    middleware,\n    whileElementsMounted: autoUpdate,\n  });\n\n  const click = useClick(context);\n  const dismiss = useDismiss(context);\n\n  const { getReferenceProps, getFloatingProps } = useInteractions([dismiss, click]);\n\n  return (\n    <>\n      <Button\n        title=\"Click to show description\"\n        ref={refs.setReference}\n        icon=\"info-circle\"\n        size=\"sm\"\n        variant=\"secondary\"\n        fill=\"text\"\n        {...getReferenceProps()}\n      />\n      {show && (\n        <Portal>\n          <div ref={refs.setFloating} style={floatingStyles} {...getFloatingProps()} className={styles.docBox}>\n            <div className={styles.docBoxHeader}>\n              <span>{def.renderer(operation, def, '<expr>')}</span>\n              <FlexItem grow={1} />\n              <Button\n                icon=\"times\"\n                onClick={() => setShow(false)}\n                fill=\"text\"\n                variant=\"secondary\"\n                title=\"Remove operation\"\n              />\n            </div>\n            <div\n              className={styles.docBoxBody}\n              dangerouslySetInnerHTML={{ __html: getOperationDocs(def, operation) }}\n            ></div>\n          </div>\n        </Portal>\n      )}\n    </>\n  );\n});\n\nOperationInfoButton.displayName = 'OperationDocs';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    docBox: css({\n      overflow: 'hidden',\n      background: theme.colors.background.primary,\n      border: `1px solid ${theme.colors.border.strong}`,\n      boxShadow: theme.shadows.z3,\n      maxWidth: '600px',\n      padding: theme.spacing(1),\n      borderRadius: theme.shape.radius.default,\n      zIndex: theme.zIndex.tooltip,\n    }),\n    docBoxHeader: css({\n      fontSize: theme.typography.h5.fontSize,\n      fontFamily: theme.typography.fontFamilyMonospace,\n      paddingBottom: theme.spacing(1),\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    docBoxBody: css({\n      // The markdown paragraph has a marginBottom this removes it\n      marginBottom: theme.spacing(-1),\n      color: theme.colors.text.secondary,\n    }),\n  };\n};\nfunction getOperationDocs(def: QueryBuilderOperationDef, op: QueryBuilderOperation): string {\n  return renderMarkdown(def.explainHandler ? def.explainHandler(op, def) : def.documentation ?? 'no docs');\n}\n","import { css } from '@emotion/css';\nimport React, { useState } from 'react';\nimport { DraggableProvided } from 'react-beautiful-dnd';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { FlexItem } from '@grafana/experimental';\nimport { Button, Select, useStyles2 } from '@grafana/ui';\n\nimport { OperationInfoButton } from './OperationInfoButton';\nimport { VisualQueryModeller, QueryBuilderOperation, QueryBuilderOperationDef } from './types';\n\nexport interface Props {\n  operation: QueryBuilderOperation;\n  def: QueryBuilderOperationDef;\n  index: number;\n  queryModeller: VisualQueryModeller;\n  dragHandleProps?: DraggableProvided['dragHandleProps'];\n  onChange: (index: number, update: QueryBuilderOperation) => void;\n  onRemove: (index: number) => void;\n}\n\ninterface State {\n  isOpen?: boolean;\n  alternatives?: Array<SelectableValue<QueryBuilderOperationDef>>;\n}\n\nexport const OperationHeader = React.memo<Props>(\n  ({ operation, def, index, onChange, onRemove, queryModeller, dragHandleProps }) => {\n    const styles = useStyles2(getStyles);\n    const [state, setState] = useState<State>({});\n\n    const onToggleSwitcher = () => {\n      if (state.isOpen) {\n        setState({ ...state, isOpen: false });\n      } else {\n        const alternatives = queryModeller\n          .getAlternativeOperations(def.alternativesKey!)\n          .map((alt) => ({ label: alt.name, value: alt }));\n        setState({ isOpen: true, alternatives });\n      }\n    };\n\n    return (\n      <div className={styles.header}>\n        {!state.isOpen && (\n          <>\n            <div {...dragHandleProps}>{def.name ?? def.id}</div>\n            <FlexItem grow={1} />\n            <div className={`${styles.operationHeaderButtons} operation-header-show-on-hover`}>\n              <Button\n                icon=\"angle-down\"\n                size=\"sm\"\n                onClick={onToggleSwitcher}\n                fill=\"text\"\n                variant=\"secondary\"\n                title=\"Click to view alternative operations\"\n              />\n              <OperationInfoButton def={def} operation={operation} />\n              <Button\n                icon=\"times\"\n                size=\"sm\"\n                onClick={() => onRemove(index)}\n                fill=\"text\"\n                variant=\"secondary\"\n                title=\"Remove operation\"\n              />\n            </div>\n          </>\n        )}\n        {state.isOpen && (\n          <div className={styles.selectWrapper}>\n            <Select\n              autoFocus\n              openMenuOnFocus\n              placeholder=\"Replace with\"\n              options={state.alternatives}\n              isOpen={true}\n              onCloseMenu={onToggleSwitcher}\n              onChange={(value) => {\n                if (value.value) {\n                  // Operation should exist if it is selectable\n                  const newDef = queryModeller.getOperationDef(value.value.id)!;\n\n                  // copy default params, and override with all current params\n                  const newParams = [...newDef.defaultParams];\n                  for (let i = 0; i < Math.min(operation.params.length, newParams.length); i++) {\n                    if (newDef.params[i].type === def.params[i].type) {\n                      newParams[i] = operation.params[i];\n                    }\n                  }\n\n                  const changedOp = { ...operation, params: newParams, id: value.value.id };\n                  onChange(index, def.changeTypeHandler ? def.changeTypeHandler(changedOp, newDef) : changedOp);\n                }\n              }}\n            />\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nOperationHeader.displayName = 'OperationHeader';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    header: css({\n      borderBottom: `1px solid ${theme.colors.border.medium}`,\n      padding: theme.spacing(0.5, 0.5, 0.5, 1),\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    operationHeaderButtons: css({\n      opacity: 1,\n    }),\n    selectWrapper: css({\n      paddingRight: theme.spacing(2),\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport React, { ComponentType } from 'react';\n\nimport { GrafanaTheme2, SelectableValue, toOption } from '@grafana/data';\nimport { AutoSizeInput, Button, Checkbox, Select, useStyles2, Stack } from '@grafana/ui';\n\nimport { getOperationParamId } from '../operationUtils';\nimport { QueryBuilderOperationParamDef, QueryBuilderOperationParamEditorProps } from '../shared/types';\n\nexport function getOperationParamEditor(\n  paramDef: QueryBuilderOperationParamDef\n): ComponentType<QueryBuilderOperationParamEditorProps> {\n  if (paramDef.editor) {\n    return paramDef.editor;\n  }\n\n  if (paramDef.options) {\n    return SelectInputParamEditor;\n  }\n\n  switch (paramDef.type) {\n    case 'boolean':\n      return BoolInputParamEditor;\n    case 'number':\n    case 'string':\n    default:\n      return SimpleInputParamEditor;\n  }\n}\n\nfunction SimpleInputParamEditor(props: QueryBuilderOperationParamEditorProps) {\n  return (\n    <AutoSizeInput\n      id={getOperationParamId(props.operationId, props.index)}\n      defaultValue={props.value?.toString()}\n      minWidth={props.paramDef.minWidth}\n      placeholder={props.paramDef.placeholder}\n      title={props.paramDef.description}\n      maxWidth={(props.paramDef.minWidth || 20) * 3}\n      onCommitChange={(evt) => {\n        props.onChange(props.index, evt.currentTarget.value);\n        if (props.paramDef.runQueryOnEnter && evt.type === 'keydown') {\n          props.onRunQuery();\n        }\n      }}\n    />\n  );\n}\n\nfunction BoolInputParamEditor(props: QueryBuilderOperationParamEditorProps) {\n  return (\n    <Checkbox\n      id={getOperationParamId(props.operationId, props.index)}\n      value={Boolean(props.value)}\n      onChange={(evt) => props.onChange(props.index, evt.currentTarget.checked)}\n    />\n  );\n}\n\nfunction SelectInputParamEditor({\n  paramDef,\n  value,\n  index,\n  operationId,\n  onChange,\n}: QueryBuilderOperationParamEditorProps) {\n  const styles = useStyles2(getStyles);\n  let selectOptions = paramDef.options as SelectableValue[];\n\n  if (!selectOptions[0]?.label) {\n    selectOptions = paramDef.options!.map((option) => ({\n      label: option.toString(),\n      value: option,\n    }));\n  }\n\n  let valueOption = selectOptions.find((x) => x.value === value) ?? toOption(value as string);\n\n  // If we have optional options param and don't have value, we want to render button with which we add optional options.\n  // This makes it easier to understand what needs to be selected and what is optional.\n  if (!value && paramDef.optional) {\n    return (\n      <div className={styles.optionalParam}>\n        <Button\n          size=\"sm\"\n          variant=\"secondary\"\n          title={`Add ${paramDef.name}`}\n          icon=\"plus\"\n          onClick={() => onChange(index, selectOptions[0].value)}\n        >\n          {paramDef.name}\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <Stack gap={0.5} direction=\"row\" alignItems=\"center\">\n      <Select\n        id={getOperationParamId(operationId, index)}\n        value={valueOption}\n        options={selectOptions}\n        placeholder={paramDef.placeholder}\n        allowCustomValue={true}\n        onChange={(value) => onChange(index, value.value!)}\n        width={paramDef.minWidth || 'auto'}\n      />\n      {paramDef.optional && (\n        <Button\n          data-testid={`operations.${index}.remove-param`}\n          size=\"sm\"\n          fill=\"text\"\n          icon=\"times\"\n          variant=\"secondary\"\n          title={`Remove ${paramDef.name}`}\n          onClick={() => onChange(index, '')}\n        />\n      )}\n    </Stack>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    optionalParam: css({\n      marginTop: theme.spacing(1),\n    }),\n  };\n};\n","import { css, cx } from '@emotion/css';\nimport React, { useEffect, useId, useState } from 'react';\nimport { Draggable } from 'react-beautiful-dnd';\n\nimport { DataSourceApi, GrafanaTheme2, TimeRange } from '@grafana/data';\nimport { Button, Icon, InlineField, Tooltip, useTheme2, Stack } from '@grafana/ui';\nimport { isConflictingFilter } from 'app/plugins/datasource/loki/querybuilder/operationUtils';\nimport { LokiOperationId } from 'app/plugins/datasource/loki/querybuilder/types';\n\nimport { getOperationParamId } from '../operationUtils';\n\nimport { OperationHeader } from './OperationHeader';\nimport { getOperationParamEditor } from './OperationParamEditor';\nimport {\n  QueryBuilderOperation,\n  QueryBuilderOperationDef,\n  QueryBuilderOperationParamDef,\n  QueryBuilderOperationParamValue,\n  VisualQueryModeller,\n} from './types';\n\nexport interface Props {\n  operation: QueryBuilderOperation;\n  index: number;\n  query: any;\n  datasource: DataSourceApi;\n  queryModeller: VisualQueryModeller;\n  onChange: (index: number, update: QueryBuilderOperation) => void;\n  onRemove: (index: number) => void;\n  onRunQuery: () => void;\n  flash?: boolean;\n  highlight?: boolean;\n  timeRange?: TimeRange;\n}\n\nexport function OperationEditor({\n  operation,\n  index,\n  onRemove,\n  onChange,\n  onRunQuery,\n  queryModeller,\n  query,\n  datasource,\n  flash,\n  highlight,\n  timeRange,\n}: Props) {\n  const def = queryModeller.getOperationDef(operation.id);\n  const shouldFlash = useFlash(flash);\n  const id = useId();\n\n  const isConflicting =\n    operation.id === LokiOperationId.LabelFilter && isConflictingFilter(operation, query.operations);\n\n  const theme = useTheme2();\n  const styles = getStyles(theme, isConflicting);\n\n  if (!def) {\n    return <span>Operation {operation.id} not found</span>;\n  }\n\n  const onParamValueChanged = (paramIdx: number, value: QueryBuilderOperationParamValue) => {\n    const update: QueryBuilderOperation = { ...operation, params: [...operation.params] };\n    update.params[paramIdx] = value;\n    callParamChangedThenOnChange(def, update, index, paramIdx, onChange);\n  };\n\n  const onAddRestParam = () => {\n    const update: QueryBuilderOperation = { ...operation, params: [...operation.params, ''] };\n    callParamChangedThenOnChange(def, update, index, operation.params.length, onChange);\n  };\n\n  const onRemoveRestParam = (paramIdx: number) => {\n    const update: QueryBuilderOperation = {\n      ...operation,\n      params: [...operation.params.slice(0, paramIdx), ...operation.params.slice(paramIdx + 1)],\n    };\n    callParamChangedThenOnChange(def, update, index, paramIdx, onChange);\n  };\n\n  const operationElements: React.ReactNode[] = [];\n\n  for (let paramIndex = 0; paramIndex < operation.params.length; paramIndex++) {\n    const paramDef = def.params[Math.min(def.params.length - 1, paramIndex)];\n    const Editor = getOperationParamEditor(paramDef);\n\n    operationElements.push(\n      <div className={styles.paramRow} key={`${paramIndex}-1`}>\n        {!paramDef.hideName && (\n          <div className={styles.paramName}>\n            <label htmlFor={getOperationParamId(id, paramIndex)}>{paramDef.name}</label>\n            {paramDef.description && (\n              <Tooltip placement=\"top\" content={paramDef.description} theme=\"info\">\n                <Icon name=\"info-circle\" size=\"sm\" className={styles.infoIcon} />\n              </Tooltip>\n            )}\n          </div>\n        )}\n        <div className={styles.paramValue}>\n          <Stack gap={0.5} direction=\"row\" alignItems=\"center\">\n            <Editor\n              index={paramIndex}\n              paramDef={paramDef}\n              value={operation.params[paramIndex]}\n              operation={operation}\n              operationId={id}\n              onChange={onParamValueChanged}\n              onRunQuery={onRunQuery}\n              query={query}\n              datasource={datasource}\n              timeRange={timeRange}\n            />\n            {paramDef.restParam && (operation.params.length > def.params.length || paramDef.optional) && (\n              <Button\n                data-testid={`operations.${index}.remove-rest-param`}\n                size=\"sm\"\n                fill=\"text\"\n                icon=\"times\"\n                variant=\"secondary\"\n                title={`Remove ${paramDef.name}`}\n                onClick={() => onRemoveRestParam(paramIndex)}\n              />\n            )}\n          </Stack>\n        </div>\n      </div>\n    );\n  }\n\n  // Handle adding button for rest params\n  let restParam: React.ReactNode | undefined;\n  if (def.params.length > 0) {\n    const lastParamDef = def.params[def.params.length - 1];\n    if (lastParamDef.restParam) {\n      restParam = renderAddRestParamButton(lastParamDef, onAddRestParam, index, operation.params.length, styles);\n    }\n  }\n\n  const isInvalid = (isDragging: boolean) => {\n    if (isDragging) {\n      return undefined;\n    }\n\n    return isConflicting ? true : undefined;\n  };\n\n  return (\n    <Draggable draggableId={`operation-${index}`} index={index}>\n      {(provided, snapshot) => (\n        <InlineField\n          error={'You have conflicting label filters'}\n          invalid={isInvalid(snapshot.isDragging)}\n          className={cx(styles.error, styles.cardWrapper)}\n        >\n          <div\n            className={cx(\n              styles.card,\n              (shouldFlash || highlight) && styles.cardHighlight,\n              isConflicting && styles.cardError\n            )}\n            ref={provided.innerRef}\n            {...provided.draggableProps}\n            data-testid={`operations.${index}.wrapper`}\n          >\n            <OperationHeader\n              operation={operation}\n              dragHandleProps={provided.dragHandleProps}\n              def={def}\n              index={index}\n              onChange={onChange}\n              onRemove={onRemove}\n              queryModeller={queryModeller}\n            />\n            <div className={styles.body}>{operationElements}</div>\n            {restParam}\n            {index < query.operations.length - 1 && (\n              <div className={styles.arrow}>\n                <div className={styles.arrowLine} />\n                <div className={styles.arrowArrow} />\n              </div>\n            )}\n          </div>\n        </InlineField>\n      )}\n    </Draggable>\n  );\n}\n\n/**\n * When flash is switched on makes sure it is switched of right away, so we just flash the highlight and then fade\n * out.\n * @param flash\n */\nfunction useFlash(flash?: boolean) {\n  const [keepFlash, setKeepFlash] = useState(true);\n  useEffect(() => {\n    let t: ReturnType<typeof setTimeout>;\n    if (flash) {\n      t = setTimeout(() => {\n        setKeepFlash(false);\n      }, 1000);\n    } else {\n      setKeepFlash(true);\n    }\n\n    return () => clearTimeout(t);\n  }, [flash]);\n\n  return keepFlash && flash;\n}\n\nfunction renderAddRestParamButton(\n  paramDef: QueryBuilderOperationParamDef,\n  onAddRestParam: () => void,\n  operationIndex: number,\n  paramIndex: number,\n  styles: OperationEditorStyles\n) {\n  return (\n    <div className={styles.restParam} key={`${paramIndex}-2`}>\n      <Button\n        size=\"sm\"\n        icon=\"plus\"\n        title={`Add ${paramDef.name}`.trimEnd()}\n        variant=\"secondary\"\n        onClick={onAddRestParam}\n        data-testid={`operations.${operationIndex}.add-rest-param`}\n      >\n        {paramDef.name}\n      </Button>\n    </div>\n  );\n}\n\nfunction callParamChangedThenOnChange(\n  def: QueryBuilderOperationDef,\n  operation: QueryBuilderOperation,\n  operationIndex: number,\n  paramIndex: number,\n  onChange: (index: number, update: QueryBuilderOperation) => void\n) {\n  if (def.paramChangedHandler) {\n    onChange(operationIndex, def.paramChangedHandler(paramIndex, operation, def));\n  } else {\n    onChange(operationIndex, operation);\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2, isConflicting: boolean) => {\n  return {\n    cardWrapper: css({\n      alignItems: 'stretch',\n    }),\n    error: css({\n      marginBottom: theme.spacing(1),\n    }),\n    card: css({\n      background: theme.colors.background.primary,\n      border: `1px solid ${theme.colors.border.medium}`,\n      cursor: 'grab',\n      borderRadius: theme.shape.radius.default,\n      position: 'relative',\n      transition: 'all 0.5s ease-in 0s',\n      height: isConflicting ? 'auto' : '100%',\n    }),\n    cardError: css({\n      boxShadow: `0px 0px 4px 0px ${theme.colors.warning.main}`,\n      border: `1px solid ${theme.colors.warning.main}`,\n    }),\n    cardHighlight: css({\n      boxShadow: `0px 0px 4px 0px ${theme.colors.primary.border}`,\n      border: `1px solid ${theme.colors.primary.border}`,\n    }),\n    infoIcon: css({\n      marginLeft: theme.spacing(0.5),\n      color: theme.colors.text.secondary,\n      ':hover': {\n        color: theme.colors.text.primary,\n      },\n    }),\n    body: css({\n      margin: theme.spacing(1, 1, 0.5, 1),\n      display: 'table',\n    }),\n    paramRow: css({\n      label: 'paramRow',\n      display: 'table-row',\n      verticalAlign: 'middle',\n    }),\n    paramName: css({\n      display: 'table-cell',\n      padding: theme.spacing(0, 1, 0, 0),\n      fontSize: theme.typography.bodySmall.fontSize,\n      fontWeight: theme.typography.fontWeightMedium,\n      verticalAlign: 'middle',\n      height: '32px',\n    }),\n    paramValue: css({\n      label: 'paramValue',\n      display: 'table-cell',\n      verticalAlign: 'middle',\n    }),\n    restParam: css({\n      padding: theme.spacing(0, 1, 1, 1),\n    }),\n    arrow: css({\n      position: 'absolute',\n      top: '0',\n      right: '-18px',\n      display: 'flex',\n    }),\n    arrowLine: css({\n      height: '2px',\n      width: '8px',\n      backgroundColor: theme.colors.border.strong,\n      position: 'relative',\n      top: '14px',\n    }),\n    arrowArrow: css({\n      width: 0,\n      height: 0,\n      borderTop: `5px solid transparent`,\n      borderBottom: `5px solid transparent`,\n      borderLeft: `7px solid ${theme.colors.border.strong}`,\n      position: 'relative',\n      top: '10px',\n    }),\n  };\n};\n\ntype OperationEditorStyles = ReturnType<typeof getStyles>;\n","import { css } from '@emotion/css';\nimport React, { useState } from 'react';\nimport { DragDropContext, Droppable, DropResult } from 'react-beautiful-dnd';\nimport { useMountedState, usePrevious } from 'react-use';\n\nimport { DataSourceApi, GrafanaTheme2, TimeRange } from '@grafana/data';\nimport { Button, Cascader, CascaderOption, useStyles2, Stack } from '@grafana/ui';\n\nimport { OperationEditor } from './OperationEditor';\nimport { QueryBuilderOperation, QueryWithOperations, VisualQueryModeller } from './types';\n\nexport interface Props<T extends QueryWithOperations> {\n  query: T;\n  datasource: DataSourceApi;\n  onChange: (query: T) => void;\n  onRunQuery: () => void;\n  queryModeller: VisualQueryModeller;\n  explainMode?: boolean;\n  highlightedOp?: QueryBuilderOperation;\n  timeRange?: TimeRange;\n}\n\nexport function OperationList<T extends QueryWithOperations>({\n  query,\n  datasource,\n  queryModeller,\n  onChange,\n  onRunQuery,\n  highlightedOp,\n  timeRange,\n}: Props<T>) {\n  const styles = useStyles2(getStyles);\n  const { operations } = query;\n\n  const opsToHighlight = useOperationsHighlight(operations);\n\n  const [cascaderOpen, setCascaderOpen] = useState(false);\n\n  const onOperationChange = (index: number, update: QueryBuilderOperation) => {\n    const updatedList = [...operations];\n    updatedList.splice(index, 1, update);\n    onChange({ ...query, operations: updatedList });\n  };\n\n  const onRemove = (index: number) => {\n    const updatedList = [...operations.slice(0, index), ...operations.slice(index + 1)];\n    onChange({ ...query, operations: updatedList });\n  };\n\n  const addOptions: CascaderOption[] = queryModeller.getCategories().map((category) => {\n    return {\n      value: category,\n      label: category,\n      items: queryModeller.getOperationsForCategory(category).map((operation) => ({\n        value: operation.id,\n        label: operation.name,\n        isLeaf: true,\n      })),\n    };\n  });\n\n  const onAddOperation = (value: string) => {\n    const operationDef = queryModeller.getOperationDef(value);\n    if (!operationDef) {\n      return;\n    }\n    onChange(operationDef.addOperationHandler(operationDef, query, queryModeller));\n    setCascaderOpen(false);\n  };\n\n  const onDragEnd = (result: DropResult) => {\n    if (!result.destination) {\n      return;\n    }\n\n    const updatedList = [...operations];\n    const element = updatedList[result.source.index];\n    updatedList.splice(result.source.index, 1);\n    updatedList.splice(result.destination.index, 0, element);\n    onChange({ ...query, operations: updatedList });\n  };\n\n  const onCascaderBlur = () => {\n    setCascaderOpen(false);\n  };\n\n  return (\n    <Stack gap={1} direction=\"column\">\n      <Stack gap={1}>\n        {operations.length > 0 && (\n          <DragDropContext onDragEnd={onDragEnd}>\n            <Droppable droppableId=\"sortable-field-mappings\" direction=\"horizontal\">\n              {(provided) => (\n                <div className={styles.operationList} ref={provided.innerRef} {...provided.droppableProps}>\n                  {operations.map((op, index) => {\n                    return (\n                      <OperationEditor\n                        key={op.id + JSON.stringify(op.params) + index}\n                        queryModeller={queryModeller}\n                        index={index}\n                        operation={op}\n                        query={query}\n                        datasource={datasource}\n                        onChange={onOperationChange}\n                        onRemove={onRemove}\n                        onRunQuery={onRunQuery}\n                        flash={opsToHighlight[index]}\n                        highlight={highlightedOp === op}\n                        timeRange={timeRange}\n                      />\n                    );\n                  })}\n                  {provided.placeholder}\n                </div>\n              )}\n            </Droppable>\n          </DragDropContext>\n        )}\n        <div className={styles.addButton}>\n          {cascaderOpen ? (\n            <Cascader\n              options={addOptions}\n              onSelect={onAddOperation}\n              onBlur={onCascaderBlur}\n              autoFocus={true}\n              alwaysOpen={true}\n              hideActiveLevelLabel={true}\n              placeholder={'Search'}\n            />\n          ) : (\n            <Button icon={'plus'} variant={'secondary'} onClick={() => setCascaderOpen(true)} title={'Add operation'}>\n              Operations\n            </Button>\n          )}\n        </div>\n      </Stack>\n    </Stack>\n  );\n}\n\n/**\n * Returns indexes of operations that should be highlighted. We check the diff of operations added but at the same time\n * we want to highlight operations only after the initial render, so we check for mounted state and calculate the diff\n * only after.\n * @param operations\n */\nfunction useOperationsHighlight(operations: QueryBuilderOperation[]) {\n  const isMounted = useMountedState();\n  const prevOperations = usePrevious(operations);\n\n  if (!isMounted()) {\n    return operations.map(() => false);\n  }\n\n  if (!prevOperations) {\n    return operations.map(() => true);\n  }\n\n  let newOps: boolean[] = [];\n\n  if (prevOperations.length - 1 === operations.length && operations.every((op) => prevOperations.includes(op))) {\n    // In case we remove one op and does not change any ops then don't highlight anything.\n    return operations.map(() => false);\n  }\n  if (prevOperations.length + 1 === operations.length && prevOperations.every((op) => operations.includes(op))) {\n    // If we add a single op just find it and highlight just that.\n    const newOp = operations.find((op) => !prevOperations.includes(op));\n    newOps = operations.map((op) => {\n      return op === newOp;\n    });\n  } else {\n    // Default diff of all ops.\n    newOps = operations.map((op, index) => {\n      return !isSameOp(op.id, prevOperations[index]?.id);\n    });\n  }\n  return newOps;\n}\n\nfunction isSameOp(op1?: string, op2?: string) {\n  return op1 === op2 || `__${op1}_by` === op2 || op1 === `__${op2}_by`;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    heading: css({\n      label: 'heading',\n      fontSize: 12,\n      fontWeight: theme.typography.fontWeightMedium,\n      marginBottom: 0,\n    }),\n    operationList: css({\n      label: 'operationList',\n      display: 'flex',\n      flexWrap: 'wrap',\n      gap: theme.spacing(2),\n    }),\n    addButton: css({\n      label: 'addButton',\n      width: 126,\n      paddingBottom: theme.spacing(1),\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport React, { useState, useEffect } from 'react';\n\nimport { GrafanaTheme2, PanelData, QueryHint } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Button, Tooltip, useStyles2 } from '@grafana/ui';\nimport { LokiDatasource } from 'app/plugins/datasource/loki/datasource';\n\nimport { PrometheusDatasource } from '../../datasource';\n\nimport { LokiAndPromQueryModellerBase, PromLokiVisualQuery } from './LokiAndPromQueryModellerBase';\n\nexport interface Props<T extends PromLokiVisualQuery> {\n  query: T;\n  datasource: PrometheusDatasource | LokiDatasource;\n  queryModeller: LokiAndPromQueryModellerBase;\n  buildVisualQueryFromString: (expr: string) => { query: T };\n  onChange: (update: T) => void;\n  data?: PanelData;\n}\n\nexport const QueryBuilderHints = <T extends PromLokiVisualQuery>({\n  datasource,\n  query: visualQuery,\n  onChange,\n  data,\n  queryModeller,\n  buildVisualQueryFromString,\n}: Props<T>) => {\n  const [hints, setHints] = useState<QueryHint[]>([]);\n  const styles = useStyles2(getStyles);\n\n  useEffect(() => {\n    const query = { expr: queryModeller.renderQuery(visualQuery), refId: '' };\n    // For now show only actionable hints\n    const hints = datasource.getQueryHints(query, data?.series || []).filter((hint) => hint.fix?.action);\n    setHints(hints);\n  }, [datasource, visualQuery, data, queryModeller]);\n\n  return (\n    <>\n      {hints.length > 0 && (\n        <div className={styles.container}>\n          {hints.map((hint) => {\n            return (\n              <Tooltip content={`${hint.label} ${hint.fix?.label}`} key={hint.type}>\n                <Button\n                  onClick={() => {\n                    reportInteraction('grafana_query_builder_hints_clicked', {\n                      hint: hint.type,\n                      datasourceType: datasource.type,\n                    });\n\n                    if (hint?.fix?.action) {\n                      const query = { expr: queryModeller.renderQuery(visualQuery), refId: '' };\n                      const newQuery = datasource.modifyQuery(query, hint.fix.action);\n                      const newVisualQuery = buildVisualQueryFromString(newQuery.expr);\n                      return onChange(newVisualQuery.query);\n                    }\n                  }}\n                  fill=\"outline\"\n                  size=\"sm\"\n                  className={styles.hint}\n                >\n                  hint: {hint.fix?.title || hint.fix?.action?.type.toLowerCase().replace('_', ' ')}\n                </Button>\n              </Tooltip>\n            );\n          })}\n        </div>\n      )}\n    </>\n  );\n};\n\nQueryBuilderHints.displayName = 'QueryBuilderHints';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    container: css`\n      display: flex;\n      align-items: start;\n    `,\n    hint: css`\n      margin-right: ${theme.spacing(1)};\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2, toOption } from '@grafana/data';\nimport { EditorRows, FlexItem } from '@grafana/experimental';\nimport { AutoSizeInput, IconButton, Select, useStyles2 } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../../datasource';\nimport { binaryScalarDefs } from '../binaryScalarOperations';\nimport { PromVisualQueryBinary } from '../types';\n\nimport { PromQueryBuilder } from './PromQueryBuilder';\n\nexport interface Props {\n  nestedQuery: PromVisualQueryBinary;\n  datasource: PrometheusDatasource;\n  index: number;\n  onChange: (index: number, update: PromVisualQueryBinary) => void;\n  onRemove: (index: number) => void;\n  onRunQuery: () => void;\n  showExplain: boolean;\n}\n\nexport const NestedQuery = React.memo<Props>((props) => {\n  const { nestedQuery, index, datasource, onChange, onRemove, onRunQuery, showExplain } = props;\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.card}>\n      <div className={styles.header}>\n        <div className={styles.name}>Operator</div>\n        <Select\n          width=\"auto\"\n          options={operators}\n          value={toOption(nestedQuery.operator)}\n          onChange={(value) => {\n            onChange(index, {\n              ...nestedQuery,\n              operator: value.value!,\n            });\n          }}\n        />\n        <div className={styles.name}>Vector matches</div>\n        <div className={styles.vectorMatchWrapper}>\n          <Select<PromVisualQueryBinary['vectorMatchesType']>\n            width=\"auto\"\n            value={nestedQuery.vectorMatchesType || 'on'}\n            allowCustomValue\n            options={[\n              { value: 'on', label: 'on' },\n              { value: 'ignoring', label: 'ignoring' },\n            ]}\n            onChange={(val) => {\n              onChange(index, {\n                ...nestedQuery,\n                vectorMatchesType: val.value,\n              });\n            }}\n          />\n          <AutoSizeInput\n            className={styles.vectorMatchInput}\n            minWidth={20}\n            defaultValue={nestedQuery.vectorMatches}\n            onCommitChange={(evt) => {\n              onChange(index, {\n                ...nestedQuery,\n                vectorMatches: evt.currentTarget.value,\n                vectorMatchesType: nestedQuery.vectorMatchesType || 'on',\n              });\n            }}\n          />\n        </div>\n        <FlexItem grow={1} />\n        <IconButton name=\"times\" size=\"sm\" onClick={() => onRemove(index)} tooltip=\"Remove match\" />\n      </div>\n      <div className={styles.body}>\n        <EditorRows>\n          <PromQueryBuilder\n            showExplain={showExplain}\n            query={nestedQuery.query}\n            datasource={datasource}\n            onRunQuery={onRunQuery}\n            onChange={(update) => {\n              onChange(index, { ...nestedQuery, query: update });\n            }}\n          />\n        </EditorRows>\n      </div>\n    </div>\n  );\n});\n\nconst operators = binaryScalarDefs.map((def) => ({ label: def.sign, value: def.sign }));\n\nNestedQuery.displayName = 'NestedQuery';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    card: css({\n      label: 'card',\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(0.5),\n    }),\n    header: css({\n      label: 'header',\n      padding: theme.spacing(0.5, 0.5, 0.5, 1),\n      gap: theme.spacing(1),\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    name: css({\n      label: 'name',\n      whiteSpace: 'nowrap',\n    }),\n    body: css({\n      label: 'body',\n      paddingLeft: theme.spacing(2),\n    }),\n    vectorMatchInput: css({\n      label: 'vectorMatchInput',\n      marginLeft: -1,\n    }),\n    vectorMatchWrapper: css({\n      label: 'vectorMatchWrapper',\n      display: 'flex',\n    }),\n  };\n};\n","import React from 'react';\n\nimport { Stack } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../../datasource';\nimport { PromVisualQuery, PromVisualQueryBinary } from '../types';\n\nimport { NestedQuery } from './NestedQuery';\n\nexport interface Props {\n  query: PromVisualQuery;\n  datasource: PrometheusDatasource;\n  onChange: (query: PromVisualQuery) => void;\n  onRunQuery: () => void;\n  showExplain: boolean;\n}\n\nexport function NestedQueryList(props: Props) {\n  const { query, datasource, onChange, onRunQuery, showExplain } = props;\n  const nestedQueries = query.binaryQueries ?? [];\n\n  const onNestedQueryUpdate = (index: number, update: PromVisualQueryBinary) => {\n    const updatedList = [...nestedQueries];\n    updatedList.splice(index, 1, update);\n    onChange({ ...query, binaryQueries: updatedList });\n  };\n\n  const onRemove = (index: number) => {\n    const updatedList = [...nestedQueries.slice(0, index), ...nestedQueries.slice(index + 1)];\n    onChange({ ...query, binaryQueries: updatedList });\n  };\n\n  return (\n    <Stack direction=\"column\" gap={1}>\n      {nestedQueries.map((nestedQuery, index) => (\n        <NestedQuery\n          key={index.toString()}\n          nestedQuery={nestedQuery}\n          index={index}\n          onChange={onNestedQueryUpdate}\n          datasource={datasource}\n          onRemove={onRemove}\n          onRunQuery={onRunQuery}\n          showExplain={showExplain}\n        />\n      ))}\n    </Stack>\n  );\n}\n","import { cx } from '@emotion/css';\nimport React, { FormEvent, useState } from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Button, RadioButtonList, Spinner, TextArea, Toggletip, useTheme2 } from '@grafana/ui';\n\nimport { buildVisualQueryFromString } from '../../parsing';\nimport { PromVisualQuery } from '../../types';\n\nimport { getStyles } from './PromQail';\nimport { QuerySuggestion } from './types';\n\nexport type Props = {\n  querySuggestion: QuerySuggestion;\n  order: number;\n  queryExplain: (idx: number) => void;\n  historical: boolean;\n  onChange: (query: PromVisualQuery) => void;\n  closeDrawer: () => void;\n  last: boolean;\n  prompt: string;\n  allSuggestions: string | undefined;\n};\n\nconst suggestionOptions: SelectableValue[] = [\n  { label: 'Yes', value: 'yes' },\n  { label: 'No', value: 'no' },\n];\nconst explationOptions: SelectableValue[] = [\n  { label: 'Too vague', value: 'too vague' },\n  { label: 'Too technical', value: 'too technical' },\n  { label: 'Inaccurate', value: 'inaccurate' },\n  { label: 'Other', value: 'other' },\n];\n\nexport function QuerySuggestionItem(props: Props) {\n  const { querySuggestion, order, queryExplain, historical, onChange, closeDrawer, last, allSuggestions, prompt } =\n    props;\n  const [showExp, updShowExp] = useState<boolean>(false);\n\n  const [gaveExplanationFeedback, updateGaveExplanationFeedback] = useState<boolean>(false);\n  const [gaveSuggestionFeedback, updateGaveSuggestionFeedback] = useState<boolean>(false);\n\n  const [suggestionFeedback, setSuggestionFeedback] = useState({\n    radioInput: '',\n    text: '',\n  });\n\n  const [explanationFeedback, setExplanationFeedback] = useState({\n    radioInput: '',\n    text: '',\n  });\n\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  const { query, explanation } = querySuggestion;\n\n  const feedbackToggleTip = (type: string) => {\n    const updateRadioFeedback = (value: string) => {\n      if (type === 'explanation') {\n        setExplanationFeedback({\n          ...explanationFeedback,\n          radioInput: value,\n        });\n      } else {\n        setSuggestionFeedback({\n          ...suggestionFeedback,\n          radioInput: value,\n        });\n      }\n    };\n\n    const updateTextFeedback = (e: FormEvent<HTMLTextAreaElement>) => {\n      if (type === 'explanation') {\n        setExplanationFeedback({\n          ...explanationFeedback,\n          text: e.currentTarget.value,\n        });\n      } else {\n        setSuggestionFeedback({\n          ...suggestionFeedback,\n          text: e.currentTarget.value,\n        });\n      }\n    };\n\n    const disabledButton = () =>\n      type === 'explanation' ? !explanationFeedback.radioInput : !suggestionFeedback.radioInput;\n\n    const questionOne =\n      type === 'explanation' ? 'Why was the explanation not helpful?' : 'Were the query suggestions helpful?';\n\n    return (\n      <div className={styles.suggestionFeedback}>\n        <div>\n          <div className={styles.feedbackQuestion}>\n            <h6>{questionOne}</h6>\n            <i>(Required)</i>\n          </div>\n          <RadioButtonList\n            name=\"default\"\n            options={type === 'explanation' ? explationOptions : suggestionOptions}\n            value={type === 'explanation' ? explanationFeedback.radioInput : suggestionFeedback.radioInput}\n            onChange={updateRadioFeedback}\n          />\n        </div>\n        <div className={cx(type === 'explanation' && styles.explationTextInput)}>\n          {type !== 'explanation' && (\n            <div className={styles.feedbackQuestion}>\n              <h6>How can we improve the query suggestions?</h6>\n            </div>\n          )}\n          <TextArea\n            type=\"text\"\n            aria-label=\"Promqail suggestion text\"\n            placeholder=\"Enter your feedback\"\n            value={type === 'explanation' ? explanationFeedback.text : suggestionFeedback.text}\n            onChange={updateTextFeedback}\n            cols={100}\n          />\n        </div>\n\n        <div className={styles.submitFeedback}>\n          <Button\n            variant=\"primary\"\n            size=\"sm\"\n            disabled={disabledButton()}\n            onClick={() => {\n              // submit the rudderstack event\n              if (type === 'explanation') {\n                explanationFeedbackEvent(\n                  explanationFeedback.radioInput,\n                  explanationFeedback.text,\n                  querySuggestion,\n                  historical,\n                  prompt\n                );\n                updateGaveExplanationFeedback(true);\n              } else {\n                suggestionFeedbackEvent(\n                  suggestionFeedback.radioInput,\n                  suggestionFeedback.text,\n                  allSuggestions ?? '',\n                  historical,\n                  prompt\n                );\n                updateGaveSuggestionFeedback(true);\n              }\n            }}\n          >\n            Submit\n          </Button>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <>\n      <div className={styles.querySuggestion}>\n        <div title={query} className={cx(styles.codeText, styles.longCode)}>\n          {`${order}.  ${query}`}\n        </div>\n        <div className={styles.useButton}>\n          <Button\n            variant=\"primary\"\n            size=\"sm\"\n            onClick={() => {\n              reportInteraction('grafana_prometheus_promqail_use_query_button_clicked', {\n                query: querySuggestion.query,\n              });\n              const pvq = buildVisualQueryFromString(querySuggestion.query);\n              // check for errors!\n              onChange(pvq.query);\n              closeDrawer();\n            }}\n          >\n            Use\n          </Button>\n        </div>\n      </div>\n      <div>\n        <Button\n          fill=\"text\"\n          variant=\"secondary\"\n          icon={showExp ? 'angle-up' : 'angle-down'}\n          onClick={() => {\n            updShowExp(!showExp);\n            queryExplain(order - 1);\n          }}\n          className={cx(styles.bodySmall)}\n          size=\"sm\"\n        >\n          Explainer\n        </Button>\n        {!showExp && order !== 5 && <div className={styles.textPadding}></div>}\n\n        {showExp && !querySuggestion.explanation && (\n          <div className={styles.center}>\n            <Spinner />\n          </div>\n        )}\n        {showExp && querySuggestion.explanation && (\n          <>\n            <div className={cx(styles.bodySmall, styles.explainPadding)}>\n              <div className={styles.textPadding}>This query is trying to answer the question:</div>\n              <div className={styles.textPadding}>{explanation}</div>\n              <div className={styles.textPadding}>\n                Learn more with this{' '}\n                <a\n                  className={styles.doc}\n                  href={'https://prometheus.io/docs/prometheus/latest/querying/examples/#query-examples'}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  Prometheus doc\n                </a>\n              </div>\n\n              <div className={cx(styles.rightButtons, styles.secondaryText)}>\n                Was this explanation helpful?\n                <div className={styles.floatRight}>\n                  {!gaveExplanationFeedback ? (\n                    <>\n                      <Button\n                        fill=\"outline\"\n                        variant=\"secondary\"\n                        size=\"sm\"\n                        className={styles.leftButton}\n                        onClick={() => {\n                          explanationFeedbackEvent('Yes', '', querySuggestion, historical, prompt);\n                          updateGaveExplanationFeedback(true);\n                        }}\n                      >\n                        Yes\n                      </Button>\n                      <Toggletip\n                        aria-label=\"Suggestion feedback\"\n                        content={feedbackToggleTip('explanation')}\n                        placement=\"bottom-end\"\n                        closeButton={true}\n                      >\n                        <Button variant=\"success\" size=\"sm\">\n                          No\n                        </Button>\n                      </Toggletip>\n                    </>\n                  ) : (\n                    'Thank you for your feedback!'\n                  )}\n                </div>\n              </div>\n            </div>\n\n            {!last && <hr />}\n          </>\n        )}\n        {last && (\n          <div className={cx(styles.feedbackStyle)}>\n            {!gaveSuggestionFeedback ? (\n              <Toggletip\n                aria-label=\"Suggestion feedback\"\n                content={feedbackToggleTip('suggestion')}\n                placement=\"bottom-end\"\n                closeButton={true}\n              >\n                <Button fill=\"outline\" variant=\"secondary\" size=\"sm\">\n                  Give feedback on suggestions\n                </Button>\n              </Toggletip>\n            ) : (\n              // do this weird thing because the toggle tip doesn't allow an extra close function\n              <Button fill=\"outline\" variant=\"secondary\" size=\"sm\" disabled={true}>\n                Thank you for your feedback!\n              </Button>\n            )}\n          </div>\n        )}\n      </div>\n    </>\n  );\n}\n\nfunction explanationFeedbackEvent(\n  radioInputFeedback: string,\n  textFeedback: string,\n  querySuggestion: QuerySuggestion,\n  historical: boolean,\n  prompt: string\n) {\n  const event = 'grafana_prometheus_promqail_explanation_feedback';\n\n  reportInteraction(event, {\n    helpful: radioInputFeedback,\n    textFeedback: textFeedback,\n    suggestionType: historical ? 'historical' : 'AI',\n    query: querySuggestion.query,\n    explanation: querySuggestion.explanation,\n    prompt: prompt,\n  });\n}\n\nfunction suggestionFeedbackEvent(\n  radioInputFeedback: string,\n  textFeedback: string,\n  allSuggestions: string,\n  historical: boolean,\n  prompt: string\n) {\n  const event = 'grafana_prometheus_promqail_suggestion_feedback';\n\n  reportInteraction(event, {\n    helpful: radioInputFeedback,\n    textFeedback: textFeedback,\n    suggestionType: historical ? 'historical' : 'AI',\n    allSuggestions: allSuggestions,\n    prompt: prompt,\n  });\n}\n","export type QuerySuggestion = {\n  query: string;\n  explanation: string;\n};\n\nexport enum SuggestionType {\n  Historical = 'historical',\n  AI = 'AI',\n}\n\nexport type Interaction = {\n  prompt: string;\n  suggestionType: SuggestionType;\n  suggestions: QuerySuggestion[];\n  isLoading: boolean;\n  explanationIsLoading: boolean;\n};\n","import { cx } from '@emotion/css';\nimport React, { useState } from 'react';\n\nimport { Button, useTheme2 } from '@grafana/ui';\n\nimport { PromVisualQuery } from '../../types';\n\nimport { getStyles, testIds } from './PromQail';\nimport { QuerySuggestionItem } from './QuerySuggestionItem';\nimport { QuerySuggestion, SuggestionType } from './types';\n\nexport type Props = {\n  querySuggestions: QuerySuggestion[];\n  suggestionType: SuggestionType;\n  closeDrawer: () => void;\n  nextInteraction: () => void;\n  queryExplain: (idx: number) => void;\n  onChange: (query: PromVisualQuery) => void;\n  prompt: string;\n};\n\nexport function QuerySuggestionContainer(props: Props) {\n  const { suggestionType, querySuggestions, closeDrawer, nextInteraction, queryExplain, onChange, prompt } = props;\n\n  const [hasNextInteraction, updateHasNextInteraction] = useState<boolean>(false);\n\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  let text, secondaryText, refineText;\n\n  if (suggestionType === SuggestionType.Historical) {\n    text = `Here are ${querySuggestions.length} query suggestions:`;\n    refineText = 'I want to write a prompt';\n  } else if (suggestionType === SuggestionType.AI) {\n    text = text = 'Here is your query suggestion:';\n    secondaryText =\n      'This query is based off of natural language descriptions of the most commonly used PromQL queries.';\n    refineText = 'Refine prompt';\n  }\n\n  return (\n    <>\n      {suggestionType === SuggestionType.Historical ? (\n        <div className={styles.bottomMargin}>{text}</div>\n      ) : (\n        <>\n          <div className={styles.textPadding}>{text}</div>\n          <div className={cx(styles.secondaryText, styles.bottomMargin)}>{secondaryText}</div>\n        </>\n      )}\n\n      <div className={styles.infoContainerWrapper}>\n        <div className={styles.infoContainer}>\n          {querySuggestions.map((qs: QuerySuggestion, idx: number) => {\n            return (\n              <QuerySuggestionItem\n                historical={suggestionType === SuggestionType.Historical}\n                querySuggestion={qs}\n                key={idx}\n                order={idx + 1}\n                queryExplain={queryExplain}\n                onChange={onChange}\n                closeDrawer={closeDrawer}\n                last={idx === querySuggestions.length - 1}\n                // for feedback rudderstack events\n                allSuggestions={querySuggestions.reduce((acc: string, qs: QuerySuggestion) => {\n                  return acc + '$$' + qs.query;\n                }, '')}\n                prompt={prompt ?? ''}\n              />\n            );\n          })}\n        </div>\n      </div>\n      {!hasNextInteraction && (\n        <div className={styles.nextInteractionHeight}>\n          <div className={cx(styles.afterButtons, styles.textPadding)}>\n            <Button\n              onClick={() => {\n                updateHasNextInteraction(true);\n                nextInteraction();\n              }}\n              data-testid={testIds.refinePrompt}\n              fill=\"outline\"\n              variant=\"secondary\"\n              size=\"md\"\n            >\n              {refineText}\n            </Button>\n          </div>\n          <div className={cx(styles.textPadding, styles.floatRight)}>\n            <Button fill=\"outline\" variant=\"secondary\" size=\"md\" onClick={closeDrawer}>\n              Cancel\n            </Button>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n","import { getBackendSrv, logDebug } from '@grafana/runtime';\nimport { LLM_PLUGIN_ROUTE, setLLMPluginVersion } from './constants.js';\n\nasync function search(request) {\n  const response = await getBackendSrv().post(\n    \"/api/plugins/grafana-llm-app/resources/vector/search\",\n    request,\n    {\n      headers: { \"Content-Type\": \"application/json\" }\n    }\n  );\n  return response.results;\n}\nlet loggedWarning = false;\nconst health = async () => {\n  try {\n    const settings = await getBackendSrv().get(`${LLM_PLUGIN_ROUTE}/settings`, void 0, void 0, {\n      showSuccessAlert: false,\n      showErrorAlert: false\n    });\n    if (!settings.enabled) {\n      return { enabled: false, ok: false, error: \"The Grafana LLM plugin is not enabled.\" };\n    }\n  } catch (e) {\n    logDebug(String(e));\n    logDebug(\n      \"Failed to check if the vector service is enabled. This is expected if the Grafana LLM plugin is not installed, and the above error can be ignored.\"\n    );\n    loggedWarning = true;\n    return { enabled: false, ok: false, error: \"The Grafana LLM plugin is not installed.\" };\n  }\n  let response;\n  try {\n    response = await getBackendSrv().get(`${LLM_PLUGIN_ROUTE}/health`, void 0, void 0, {\n      showSuccessAlert: false,\n      showErrorAlert: false\n    });\n  } catch (e) {\n    if (!loggedWarning) {\n      logDebug(String(e));\n      logDebug(\n        \"Failed to check if vector service is enabled. This is expected if the Grafana LLM plugin is not installed, and the above error can be ignored.\"\n      );\n      loggedWarning = true;\n    }\n    return { enabled: false, ok: false, error: \"The Grafana LLM plugin is not installed.\" };\n  }\n  const { details } = response;\n  if ((details == null ? void 0 : details.version) !== void 0) {\n    setLLMPluginVersion(details.version);\n  }\n  if ((details == null ? void 0 : details.vector) === void 0) {\n    return { enabled: false, ok: false, error: \"The Grafana LLM plugin is outdated; please update it.\" };\n  }\n  return typeof details.vector === \"boolean\" ? { enabled: details.vector, ok: details.vector } : details.vector;\n};\nconst enabled = async () => {\n  const healthDetails = await health();\n  return healthDetails.enabled && healthDetails.ok;\n};\n\nexport { enabled, health, search };\n//# sourceMappingURL=vector.js.map\n","export const ExplainSystemPrompt = `You are an expert in Prometheus, the event monitoring and alerting application.\n\nYou are given relevant PromQL documentation, a type and description for a Prometheus metric, and a PromQL query on that metric. Using the provided information for reference, please explain what the output of a given query is in 1 sentences. Do not walk through what the functions do separately, make your answer concise. \n\nInput will be in the form:\n\n\nPromQL Documentation:\n<PromQL documentation>\n\nPromQL Metrics Metadata:\n<metric_name>(<metric type of the metric queried>): <description of what the metric means>\n\nPromQL Expression: \n<PromQL query>\n\nExamples of input and output\n----------\nPromQL Documentation:\nA counter is a cumulative metric that represents a single monotonically increasing counter whose value can only increase or be reset to zero on restart. For example, you can use a counter to represent the number of requests served, tasks completed, or errors.\ntopk (largest k elements by sample value)\nsum (calculate sum over dimensions)\nrate(v range-vector) calculates the per-second average rate of increase of the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. \n\nPromQL Metrics Metadata:\ntraces_exporter_sent_spans(counter): Number of spans successfully sent to destination.\n\nPromQL Expression:\ntopk(3, sum by(cluster) (rate(traces_exporter_sent_spans{exporter=\"otlp\"}[5m])))\n\nThis query is trying to answer the question:\nWhat is the top 3 clusters that have successfully sent the most number of spans to the destination?\n`;\n\nexport type ExplainUserPromptParams = {\n  documentation: string;\n  metricName: string;\n  metricType: string;\n  metricMetadata: string;\n  query: string;\n};\n\nexport function GetExplainUserPrompt({\n  documentation,\n  metricName,\n  metricType,\n  metricMetadata,\n  query,\n}: ExplainUserPromptParams): string {\n  if (documentation === '') {\n    documentation = 'No documentation provided.';\n  }\n  if (metricMetadata === '') {\n    metricMetadata = 'No description provided.';\n  }\n  return `\n        PromQL Documentation: \n        ${documentation}\n\n        PromQL Metrics Metadata:\n        ${metricName}(${metricType}): ${metricMetadata}\n\n        PromQL Expression: \n        ${query}\n\n        This query is trying to answer the question:\n    `;\n}\n\nexport const SuggestSystemPrompt = `You are a Prometheus Query Language (PromQL) expert assistant inside Grafana.\nWhen the user asks a question, respond with a valid PromQL query and only the query.\n\nTo help you answer the question, you will receive:\n- List of potentially relevant PromQL templates with descriptions, ranked by semantic search score\n- Prometheus metric\n- Metric type\n- Available Prometheus metric labels\n- User question\n\nPolicy:\n- Do not invent labels names, you can only use the available labels\n- For rate queries, use the $__rate_interval variable`;\n\n// rewrite with a type\nexport type SuggestUserPromptParams = {\n  promql: string;\n  question: string;\n  metricType: string;\n  labels: string;\n  templates: string;\n};\n\nexport function GetSuggestUserPrompt({\n  promql,\n  question,\n  metricType,\n  labels,\n  templates,\n}: SuggestUserPromptParams): string {\n  if (templates === '') {\n    templates = 'No templates provided.';\n  } else {\n    templates = templates.replace(/\\n/g, '\\n  ');\n  }\n  return `Relevant PromQL templates:\n  ${templates}\n  \n  Prometheus metric: ${promql}\n  Metric type: ${metricType}\n  Available Prometheus metric labels: ${labels}\n  User question: ${question}\n  \n  \\`\\`\\`promql`;\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport { PromVisualQuery } from '../../../types';\nimport { Interaction, SuggestionType } from '../types';\n\nexport const stateSlice = createSlice({\n  name: 'metrics-modal-state',\n  initialState: initialState(),\n  reducers: {\n    showExplainer: (state, action: PayloadAction<boolean>) => {\n      state.showExplainer = action.payload;\n    },\n    showStartingMessage: (state, action: PayloadAction<boolean>) => {\n      state.showStartingMessage = action.payload;\n    },\n    indicateCheckbox: (state, action: PayloadAction<boolean>) => {\n      state.indicateCheckbox = action.payload;\n    },\n    askForQueryHelp: (state, action: PayloadAction<boolean>) => {\n      state.askForQueryHelp = action.payload;\n    },\n    /*\n     * start working on a collection of interactions\n     * {\n     *  askForhelp y n\n     *  prompt question\n     *  queries querySuggestions\n     * }\n     *\n     */\n    addInteraction: (state, action: PayloadAction<{ suggestionType: SuggestionType; isLoading: boolean }>) => {\n      // AI or Historical?\n      const interaction = createInteraction(action.payload.suggestionType, action.payload.isLoading);\n      const interactions = state.interactions;\n      state.interactions = interactions.concat([interaction]);\n    },\n    updateInteraction: (state, action: PayloadAction<{ idx: number; interaction: Interaction }>) => {\n      // update the interaction by index\n      // will most likely be the last interaction but we might update previous by giving them cues of helpful or not\n      const index = action.payload.idx;\n      const updInteraction = action.payload.interaction;\n\n      state.interactions = state.interactions.map((interaction: Interaction, idx: number) => {\n        if (idx === index) {\n          return updInteraction;\n        }\n\n        return interaction;\n      });\n    },\n  },\n});\n\n/**\n * Initial state for PromQAIL\n * @param query the prometheus query with metric and possible labels\n */\nexport function initialState(query?: PromVisualQuery, showStartingMessage?: boolean): PromQailState {\n  return {\n    query: query ?? {\n      metric: '',\n      labels: [],\n      operations: [],\n    },\n    showExplainer: false,\n    showStartingMessage: showStartingMessage ?? true,\n    indicateCheckbox: false,\n    askForQueryHelp: false,\n    interactions: [],\n  };\n}\n\n/**\n * The PromQAIL state object\n */\nexport interface PromQailState {\n  query: PromVisualQuery;\n  showExplainer: boolean;\n  showStartingMessage: boolean;\n  indicateCheckbox: boolean;\n  askForQueryHelp: boolean;\n  interactions: Interaction[];\n}\n\nexport function createInteraction(suggestionType: SuggestionType, isLoading?: boolean): Interaction {\n  return {\n    suggestionType: suggestionType,\n    prompt: '',\n    suggestions: [],\n    isLoading: isLoading ?? false,\n    explanationIsLoading: false,\n  };\n}\n","import { QuerySuggestion } from '../types';\n\ninterface TemplateData {\n  template: string;\n  description: string;\n}\n\nexport const generalTemplates: TemplateData[] = [\n  {\n    template: 'metric_a{}',\n    description: 'Get the data for \"metric_a\"',\n  },\n  {\n    template: 'avg by(c) (metric_a{})',\n    description: 'Average of all series in \"metric_a\" grouped by the label \"c\"',\n  },\n  {\n    template: 'count by(d) (metric_a{})',\n    description: 'Number of series in the metric \"metric_a\" grouped by the label \"d\"',\n  },\n  {\n    template: 'sum by(g) (sum_over_time(metric_a{}[1h]))',\n    description:\n      'For each series in the metric \"metric_a\", sum all values over 1 hour, then group those series by label \"g\" and sum.',\n  },\n  {\n    template: 'count(metric_a{})',\n    description: 'Count of series in the metric \"metric_a\"',\n  },\n  {\n    template: '(metric_a{})',\n    description: 'Get the data for \"metric_a\"',\n  },\n  {\n    template: 'count_over_time(metric_a{}[1h])',\n    description: 'Number of series of metric_a in a 1 hour interval',\n  },\n  {\n    template: 'changes(metric_a{}[1m])',\n    description: 'Number of times the values of each series in metric_a have changed in 1 minute periods',\n  },\n  {\n    template: 'count(count by(g) (metric_a{}))',\n    description: 'Total number of series in metric_a',\n  },\n  {\n    template: 'last_over_time(metric_a{}[1h])',\n    description: 'For each series in metric_a, get the last value in the 1 hour period.',\n  },\n  {\n    template: 'sum by(g) (count_over_time(metric_a{}[1h]))',\n    description: 'Grouped sum over the label \"g\" of the number of series of metric_a in a 1 hour period',\n  },\n  {\n    template: 'count(metric_a{} == 99)',\n    description: 'Number of series of metric_a that have value 99',\n  },\n  {\n    template: 'min(metric_a{})',\n    description: 'At each timestamp, find the minimum of all series of the metric \"metric_a\"',\n  },\n  {\n    template: 'metric_a{} != 99',\n    description: 'Series of metric_a which do not have the value 99',\n  },\n  {\n    template: 'metric_a{} - 99',\n    description: 'metric_a minus 99',\n  },\n  {\n    template: 'quantile_over_time(0.99,metric_a{}[1h])',\n    description: 'The 99th quantile of values of metric_a in 1 hour',\n  },\n  {\n    template: 'count_values(\"aaaa\",metric_a{})',\n    description: 'Count number of label values for a label named \"aaaa\"',\n  },\n];\n\nexport const counterTemplates: TemplateData[] = [\n  {\n    template: 'sum by(d) (rate(metric_a{}[1h]))',\n    description:\n      'Sum of the rate of increase or decrease of the metric \"metric_a\" per 1 hour period, grouped by the label \"d\"',\n  },\n  {\n    template: 'rate(metric_a{}[1m])',\n    description: 'Rate of change of the metric \"metric_a\" over 1 minute',\n  },\n  {\n    template: 'sum by(a) (increase(metric_a{}[5m]))',\n    description:\n      'Taking the metric \"metric_a\" find the increase in 5 minute periods of each series and aggregate sum over the label \"a\"',\n  },\n  {\n    template: 'sum(rate(metric_a{}[1m]))',\n    description: 'Total rate of change of all series of metric \"metric_a\" in 1 minute intervals',\n  },\n  {\n    template: 'sum(increase(metric_a{}[10m]))',\n    description: 'Total increase for each series of metric \"metric_a\" in 10 minute intervals',\n  },\n  {\n    template: 'increase(metric_a{}[1h])',\n    description: 'Increase in all series of \"metric_a\" in 1 hour period',\n  },\n  {\n    template: 'sum by(d) (irate(metric_a{}[1h]))',\n    description: 'Sum of detailed rate of change of the metric \"metric_a\" over 1 hour grouped by label \"d\"',\n  },\n  {\n    template: 'irate(metric_a{}[1h])',\n    description: 'Detailed rate of change of the metric \"metric_a\" over 1 hour',\n  },\n  {\n    template: 'avg by(d) (rate(metric_a{}[1h]))',\n    description:\n      'Taking the rate of change of the metric \"metric_a\" in a 1 hour period, group by the label \"d\" and find the average of each group',\n  },\n  {\n    template: 'topk(5,sum by(g) (rate(metric_a{}[1h])))',\n    description: 'Top 5 of the summed groups \"g\" of the rate of change of metric_a',\n  },\n  {\n    template: 'sum(rate(metric_a{}[1h])) / sum(rate(metric_a{}[1h]))',\n    description: 'Relative sums of metric_a with different labels',\n  },\n  {\n    template: 'histogram_quantile(99,rate(metric_a{}[1h]))',\n    description: '99th percentile of the rate of change of metric_a in 1 hour periods',\n  },\n  {\n    template: 'avg(rate(metric_a{}[1m]))',\n    description: 'Average of the rate of all series of metric_a in 1 minute periods',\n  },\n  {\n    template: 'rate(metric_a{}[5m]) > 99',\n    description: 'Show series of metric_a only if their rate over 5 minutes is greater than 99',\n  },\n  {\n    template: 'count by(g) (rate(metric_a{}[1h]))',\n    description: 'Count of series of metric_a over all labels \"g\"',\n  },\n];\n\nexport const histogramTemplates: TemplateData[] = [\n  {\n    template: 'histogram_quantile(99,sum by(le) (rate(metric_a{}[1h])))',\n    description:\n      'Calculate the rate at which the metric \"metric_a\" is increasing or decreasing, summed over each bucket label \"le\", and then calculates the 99th percentile of those rates.',\n  },\n  {\n    template: 'histogram_quantile(99,sum by(g) (metric_a{}))',\n    description: '99th percentile of the sum of metric_a grouped by label \"g\"',\n  },\n  {\n    template: 'histogram_quantile(99,sum by(g) (irate(metric_a{}[1h])))',\n    description: '99th percentile of the grouped by \"g\" sum of the rate of each series in metric_a in an hour',\n  },\n  {\n    template: 'histogram_quantile(99,metric_a{})',\n    description: '99th percentile of metric_a',\n  },\n];\n\nexport const gaugeTemplates: TemplateData[] = [\n  {\n    template: 'sum by(c) (metric_a{})',\n    description: 'Sum the metric \"metric_a\" by each value in label \"c\"',\n  },\n  {\n    template: 'sum(metric_a{})',\n    description: 'Total sum of all the series of the metric named \"metric_a\"',\n  },\n  {\n    template: 'max by(dd) (metric_a{})',\n    description: 'Grouping the series the metric \"metric_a\" by the label \"dd\", get the maximum value of each group',\n  },\n  {\n    template: 'max(metric_a{})',\n    description: 'Maximum value of all series of the metric \"metric_a\" ',\n  },\n  {\n    template: 'avg(metric_a{})',\n    description: 'Average value of all the series of metric \"metric_a\"',\n  },\n  {\n    template: 'metric_a{} > 99',\n    description: 'Show only the series of metric \"metric_a\" which currently have value greater than 99',\n  },\n  {\n    template: 'metric_a{} / 99',\n    description: 'Values for \"metric_a\" all divided by 99',\n  },\n  {\n    template: 'metric_a{} == 99',\n    description: 'Show series of metric_a that have value 99',\n  },\n  {\n    template: 'sum_over_time(metric_a{}[1h])',\n    description: 'Sum each series of metric_a over 1 hour',\n  },\n  {\n    template: 'avg_over_time(metric_a{}[1h])',\n    description: 'Average of each series of metric_a in a 1 hour period',\n  },\n  {\n    template: 'sum(sum_over_time(metric_a{}[1h]))',\n    description: 'Sum of all values in all series in a 1 hour period',\n  },\n  {\n    template: 'delta(metric_a{}[1m])',\n    description: 'Span or delta (maximum - minimum) of values of the metric \"metric_a\" in a 1 minute period. ',\n  },\n  {\n    template: 'avg by(g) (avg_over_time(metric_a{}[1h]))',\n    description:\n      'For 1 hour, take each series and find the average, then group by label \"g\" and find the average of each group',\n  },\n  {\n    template: 'max_over_time(metric_a{}[1h])',\n    description: 'Maximum values of each series in metric \"metric_a\" in a 1 hour period',\n  },\n  {\n    template: 'metric_a{} * 99',\n    description: 'Values of metric_a multiplied by 99',\n  },\n  {\n    template: 'metric_a{} < 99',\n    description: 'Series of metric_a that have values less than 99',\n  },\n  {\n    template: 'max by() (max_over_time(metric_a{}[1h]))',\n    description: 'Find maximum value of all series in 1 hour periods',\n  },\n  {\n    template: 'topk(99,metric_a{})',\n    description: 'First 5 series of metric_a that have the highest values',\n  },\n  {\n    template: 'min by(g) (metric_a{})',\n    description: 'Minimum values of the series of metric_a grouped by label \"g\"',\n  },\n  {\n    template: 'topk(10,sum by(g) (metric_a{}))',\n    description: \"Top 10 of the series of metric_a grouped and summed by the label 'g'\",\n  },\n  {\n    template: 'avg(avg_over_time(metric_a{}[1h]))',\n    description: 'Average of all values inside a 1 hour period',\n  },\n  {\n    template: 'quantile by(h) (0.95,metric_a{})',\n    description: 'Calculate 95th percentile of metric_a when aggregated by the label \"h\"',\n  },\n  {\n    template: 'avg by(g) (metric_a{} > 99)',\n    description:\n      'Taking all series of metric_a with value greater than 99, group by label \"g\" and find the average of each group',\n  },\n  {\n    template: 'sum(metric_a{}) / 99',\n    description: 'Sum of all series of metric_a divided by 99',\n  },\n  {\n    template: 'count(sum by(g) (metric_a{}))',\n    description: 'Number of series of metric_a grouped by the label \"g\"',\n  },\n  {\n    template: 'max(max_over_time(metric_a{}[1h]))',\n    description: 'Find the max value of all series of metric_a in a 1 hour period',\n  },\n];\n\nfunction processTemplate(templateData: TemplateData, metric: string, labels: string): QuerySuggestion {\n  return {\n    query: templateData.template.replace('metric_a', metric).replace('{}', labels),\n    explanation: templateData.description.replace('metric_a', metric),\n  };\n}\n\nexport function getTemplateSuggestions(metricName: string, metricType: string, labels: string): QuerySuggestion[] {\n  let templateSuggestions: QuerySuggestion[] = [];\n  switch (metricType) {\n    case 'counter':\n      templateSuggestions = templateSuggestions.concat(\n        counterTemplates\n          .map((t) => processTemplate(t, metricName, labels))\n          .sort(() => Math.random() - 0.5)\n          .slice(0, 2)\n      );\n      templateSuggestions = templateSuggestions.concat(\n        generalTemplates\n          .map((t) => processTemplate(t, metricName, labels))\n          .sort(() => Math.random() - 0.5)\n          .slice(0, 3)\n      );\n      break;\n    case 'gauge':\n      templateSuggestions = templateSuggestions.concat(\n        gaugeTemplates\n          .map((t) => processTemplate(t, metricName, labels))\n          .sort(() => Math.random() - 0.5)\n          .slice(0, 2)\n      );\n      templateSuggestions = templateSuggestions.concat(\n        generalTemplates\n          .map((t) => processTemplate(t, metricName, labels))\n          .sort(() => Math.random() - 0.5)\n          .slice(0, 3)\n      );\n      break;\n    case 'histogram':\n      templateSuggestions = templateSuggestions.concat(\n        histogramTemplates\n          .map((t) => processTemplate(t, metricName, labels))\n          .sort(() => Math.random() - 0.5)\n          .slice(0, 2)\n      );\n      templateSuggestions = templateSuggestions.concat(\n        generalTemplates\n          .map((t) => processTemplate(t, metricName, labels))\n          .sort(() => Math.random() - 0.5)\n          .slice(0, 3)\n      );\n      break;\n    default:\n      templateSuggestions = templateSuggestions.concat(\n        generalTemplates\n          .map((t) => processTemplate(t, metricName, labels))\n          .sort(() => Math.random() - 0.5)\n          .slice(0, 5)\n      );\n      break;\n  }\n  return templateSuggestions;\n}\n","import { AnyAction } from 'redux';\n\nimport { llms } from '@grafana/experimental';\nimport { reportInteraction } from '@grafana/runtime';\nimport { PrometheusDatasource } from 'app/plugins/datasource/prometheus/datasource';\nimport { getMetadataHelp, getMetadataType } from 'app/plugins/datasource/prometheus/language_provider';\n\nimport { promQueryModeller } from '../../../PromQueryModeller';\nimport { buildVisualQueryFromString } from '../../../parsing';\nimport { PromVisualQuery } from '../../../types';\nimport {\n  ExplainSystemPrompt,\n  GetExplainUserPrompt,\n  SuggestSystemPrompt,\n  GetSuggestUserPrompt,\n  SuggestUserPromptParams,\n} from '../prompts';\nimport { Interaction, QuerySuggestion, SuggestionType } from '../types';\n\nimport { createInteraction, stateSlice } from './state';\nimport { getTemplateSuggestions } from './templates';\n\nconst OPENAI_MODEL_NAME = 'gpt-3.5-turbo-1106';\nconst promQLTemplatesCollection = 'grafana.promql.templates';\n// actions to update the state\nconst { updateInteraction } = stateSlice.actions;\n\ninterface TemplateSearchResult {\n  description: string | null;\n  metric_type: string | null;\n  promql: string | null;\n}\n\nexport function getExplainMessage(\n  query: string,\n  metric: string,\n  datasource: PrometheusDatasource\n): llms.openai.Message[] {\n  let metricMetadata = '';\n  let metricType = '';\n\n  const pvq = buildVisualQueryFromString(query);\n\n  if (datasource.languageProvider.metricsMetadata) {\n    metricType = getMetadataType(metric, datasource.languageProvider.metricsMetadata) ?? '';\n    metricMetadata = getMetadataHelp(metric, datasource.languageProvider.metricsMetadata) ?? '';\n  }\n\n  const documentationBody = pvq.query.operations\n    .map((op) => {\n      const def = promQueryModeller.getOperationDef(op.id);\n      if (!def) {\n        return '';\n      }\n      const title = def.renderer(op, def, '<expr>');\n      const body = def.explainHandler ? def.explainHandler(op, def) : def.documentation;\n\n      if (!body) {\n        return '';\n      }\n      return `### ${title}:\\n${body}`;\n    })\n    .filter((item) => item !== '')\n    .join('\\n');\n\n  return [\n    { role: 'system', content: ExplainSystemPrompt },\n    {\n      role: 'user',\n      content: GetExplainUserPrompt({\n        documentation: documentationBody,\n        metricName: metric,\n        metricType: metricType,\n        metricMetadata: metricMetadata,\n        query: query,\n      }),\n    },\n  ];\n}\n\nfunction getSuggestMessages({\n  promql,\n  question,\n  metricType,\n  labels,\n  templates,\n}: SuggestUserPromptParams): llms.openai.Message[] {\n  return [\n    { role: 'system', content: SuggestSystemPrompt },\n    { role: 'user', content: GetSuggestUserPrompt({ promql, question, metricType, labels, templates }) },\n  ];\n}\n\n/**\n * Calls the API and adds suggestions to the interaction\n *\n * @param dispatch\n * @param idx\n * @param interaction\n * @returns\n */\nexport async function promQailExplain(\n  dispatch: React.Dispatch<AnyAction>,\n  idx: number,\n  query: PromVisualQuery,\n  interaction: Interaction,\n  suggIdx: number,\n  datasource: PrometheusDatasource\n) {\n  const suggestedQuery = interaction.suggestions[suggIdx].query;\n\n  const promptMessages = getExplainMessage(suggestedQuery, query.metric, datasource);\n  const interactionToUpdate = interaction;\n\n  return llms.openai\n    .streamChatCompletions({\n      model: OPENAI_MODEL_NAME,\n      messages: promptMessages,\n      temperature: 0,\n    })\n    .pipe(llms.openai.accumulateContent())\n    .subscribe((response) => {\n      const updatedSuggestions = interactionToUpdate.suggestions.map((sg: QuerySuggestion, sidx: number) => {\n        if (suggIdx === sidx) {\n          return {\n            query: interactionToUpdate.suggestions[suggIdx].query,\n            explanation: response,\n          };\n        }\n\n        return sg;\n      });\n\n      const payload = {\n        idx,\n        interaction: {\n          ...interactionToUpdate,\n          suggestions: updatedSuggestions,\n          explanationIsLoading: false,\n        },\n      };\n      dispatch(updateInteraction(payload));\n    });\n}\n\n/**\n * Check if sublist is fully contained in the superlist\n *\n * @param sublist\n * @param superlist\n * @returns true if fully contained, else false\n */\nfunction isContainedIn(sublist: string[], superlist: string[]): boolean {\n  for (const item of sublist) {\n    if (!superlist.includes(item)) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Guess the type of a metric, based on its name and its relation to other metrics available\n *\n * @param metric     - name of metric whose type to guess\n * @param allMetrics - list of all available metrics\n * @returns          - the guess of the type (string): counter,gauge,summary,histogram,'histogram,summary'\n */\nexport function guessMetricType(metric: string, allMetrics: string[]): string {\n  const synthetic_metrics = new Set<string>([\n    'up',\n    'scrape_duration_seconds',\n    'scrape_samples_post_metric_relabeling',\n    'scrape_series_added',\n    'scrape_samples_scraped',\n    'ALERTS',\n    'ALERTS_FOR_STATE',\n  ]);\n\n  if (synthetic_metrics.has(metric)) {\n    // these are all known to be counters\n    return 'counter';\n  }\n  if (metric.startsWith(':')) {\n    // probably recording rule\n    return 'gauge';\n  }\n  if (metric.endsWith('_info')) {\n    // typically series of 1s only, the labels are the useful part. TODO: add 'info' type\n    return 'counter';\n  }\n\n  if (metric.endsWith('_created') || metric.endsWith('_total')) {\n    // prometheus naming style recommends counters to have these suffixes.\n    return 'counter';\n  }\n\n  const underscoreIndex = metric.lastIndexOf('_');\n  if (underscoreIndex < 0) {\n    // No underscores in the name at all, very little info to go on. Guess\n    return 'gauge';\n  }\n\n  // See if the suffix is histogram-y or summary-y\n  const [root, suffix] = [metric.slice(0, underscoreIndex), metric.slice(underscoreIndex + 1)];\n\n  if (['bucket', 'count', 'sum'].includes(suffix)) {\n    // Might be histogram + summary\n    let familyMetrics = [`${root}_bucket`, `${root}_count`, `${root}_sum`, root];\n    if (isContainedIn(familyMetrics, allMetrics)) {\n      return 'histogram,summary';\n    }\n\n    // Might be a histogram, if so all these metrics should exist too:\n    familyMetrics = [`${root}_bucket`, `${root}_count`, `${root}_sum`];\n    if (isContainedIn(familyMetrics, allMetrics)) {\n      return 'histogram';\n    }\n\n    // Or might be a summary\n    familyMetrics = [`${root}_sum`, `${root}_count`, root];\n    if (isContainedIn(familyMetrics, allMetrics)) {\n      return 'summary';\n    }\n\n    // Otherwise it's probably just a counter!\n    return 'counter';\n  }\n\n  // One case above doesn't catch: summary or histogram,summary where the non-suffixed metric is chosen\n  const familyMetrics = [`${metric}_sum`, `${metric}_count`, metric];\n  if (isContainedIn(familyMetrics, allMetrics)) {\n    if (allMetrics.includes(`${metric}_bucket`)) {\n      return 'histogram,summary';\n    } else {\n      return 'summary';\n    }\n  }\n\n  // All else fails, guess gauge\n  return 'gauge';\n}\n\n/**\n * Generate a suitable filter structure for the VectorDB call\n * @param types: list of metric types to include in the result\n * @returns the structure to pass to the vectorDB call.\n */\nfunction generateMetricTypeFilters(types: string[]) {\n  return types.map((type) => ({\n    metric_type: {\n      $eq: type,\n    },\n  }));\n}\n\n/**\n * Taking in a metric name, try to guess its corresponding metric _family_ name\n * @param metric name\n * @returns metric family name\n */\nfunction guessMetricFamily(metric: string): string {\n  if (metric.endsWith('_bucket') || metric.endsWith('_count') || metric.endsWith('_sum')) {\n    return metric.slice(0, metric.lastIndexOf('_'));\n  }\n  return metric;\n}\n\n/**\n * Check if the LLM plugin is enabled.\n * Used in the PromQueryBuilder to enable/disable the button based on openai and vector db checks\n * @returns true if the LLM plugin is enabled.\n */\nexport async function isLLMPluginEnabled(): Promise<boolean> {\n  // Check if the LLM plugin is enabled.\n  // If not, we won't be able to make requests, so return early.\n  const openaiEnabled = llms.openai.health().then((response) => response.ok);\n  const vectorEnabled = llms.vector.health().then((response) => response.ok);\n  // combine 2 promises\n  return Promise.all([openaiEnabled, vectorEnabled]).then((results) => {\n    return results.every((result) => result);\n  });\n}\n\n/**\n * Calls the API and adds suggestions to the interaction\n *\n * @param dispatch\n * @param idx\n * @param interaction\n * @returns\n */\nexport async function promQailSuggest(\n  dispatch: React.Dispatch<AnyAction>,\n  idx: number,\n  query: PromVisualQuery,\n  labelNames: string[],\n  datasource: PrometheusDatasource,\n  interaction?: Interaction\n) {\n  const interactionToUpdate = interaction ? interaction : createInteraction(SuggestionType.Historical);\n\n  // Decide metric type\n  let metricType = '';\n  // Makes sure we loaded the metadata for metrics. Usually this is done in the start() method of the\n  // provider but we only need the metadata here.\n  if (!datasource.languageProvider.metricsMetadata) {\n    await datasource.languageProvider.loadMetricsMetadata();\n  }\n  if (datasource.languageProvider.metricsMetadata) {\n    // `datasource.languageProvider.metricsMetadata` is a list of metric family names (with desired type)\n    // from the datasource metadata endoint, but unfortunately the expanded _sum, _count, _bucket raw\n    // metric names are also generated and populating this list (all of type counter). We want the metric\n    // family type, so need to guess the metric family name from the chosen metric name, and test if that\n    // metric family has a type specified.\n    const metricFamilyGuess = guessMetricFamily(query.metric);\n    metricType = getMetadataType(metricFamilyGuess, datasource.languageProvider.metricsMetadata) ?? '';\n  }\n  if (metricType === '') {\n    // fallback to heuristic guess\n    metricType = guessMetricType(query.metric, datasource.languageProvider.metrics);\n  }\n\n  if (interactionToUpdate.suggestionType === SuggestionType.Historical) {\n    return new Promise<void>((resolve) => {\n      return setTimeout(() => {\n        const suggestions = getTemplateSuggestions(\n          query.metric,\n          metricType,\n          promQueryModeller.renderLabels(query.labels)\n        );\n\n        const payload = {\n          idx,\n          interaction: { ...interactionToUpdate, suggestions: suggestions, isLoading: false },\n        };\n        dispatch(updateInteraction(payload));\n        resolve();\n      }, 1000);\n    });\n  } else {\n    type SuggestionBody = {\n      metric: string;\n      labels: string;\n      prompt?: string;\n    };\n\n    // get all available labels\n    const metricLabels = await datasource.languageProvider.fetchLabelsWithMatch(query.metric);\n\n    let feedTheAI: SuggestionBody = {\n      metric: query.metric,\n      // drop __name__ label because it's not useful\n      labels: Object.keys(metricLabels)\n        .filter((label) => label !== '__name__')\n        .join(','),\n    };\n\n    // @ts-ignore llms types issue\n    let results: Array<llms.vector.SearchResult<TemplateSearchResult>> = [];\n    if (interaction?.suggestionType === SuggestionType.AI) {\n      feedTheAI = { ...feedTheAI, prompt: interaction.prompt };\n\n      // @ts-ignore llms types issue\n      results = await llms.vector.search<TemplateSearchResult>({\n        query: interaction.prompt,\n        collection: promQLTemplatesCollection,\n        topK: 5,\n        filter: {\n          $or: generateMetricTypeFilters(metricType.split(',').concat(['*'])),\n        },\n      });\n      reportInteraction('grafana_prometheus_promqail_vector_results', {\n        metric: query.metric,\n        prompt: interaction.prompt,\n        results: results,\n      });\n      // TODO: handle errors from vector search\n    }\n\n    const resultsString = results\n      .map((r) => {\n        return `${r.payload.promql} | ${r.payload.description} (score=${(r.score * 100).toFixed(1)})`;\n      })\n      .join('\\n');\n\n    const promptMessages = getSuggestMessages({\n      promql: query.metric,\n      question: interaction ? interaction.prompt : '',\n      metricType: metricType,\n      labels: labelNames.join(', '),\n      templates: resultsString,\n    });\n\n    return llms.openai\n      .streamChatCompletions({\n        model: OPENAI_MODEL_NAME,\n        messages: promptMessages,\n        temperature: 0.5,\n      })\n      .pipe(llms.openai.accumulateContent())\n      .subscribe((response) => {\n        const payload = {\n          idx,\n          interaction: {\n            ...interactionToUpdate,\n            suggestions: [\n              {\n                query: response,\n                explanation: '',\n              },\n            ],\n            isLoading: false,\n          },\n        };\n        dispatch(updateInteraction(payload));\n      });\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport React, { useEffect, useReducer, useRef, useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Alert, Button, Checkbox, Input, Spinner, useTheme2 } from '@grafana/ui';\nimport store from 'app/core/store';\n\nimport { PrometheusDatasource } from '../../../datasource';\nimport { PromVisualQuery } from '../../types';\n\nimport { QuerySuggestionContainer } from './QuerySuggestionContainer';\n// @ts-ignore until we can get these added for icons\nimport AI_Logo_color from './resources/AI_Logo_color.svg';\nimport { promQailExplain, promQailSuggest } from './state/helpers';\nimport { initialState, stateSlice } from './state/state';\nimport { Interaction, SuggestionType } from './types';\n\n// actions to update the state\nconst { showStartingMessage, indicateCheckbox, addInteraction, updateInteraction } = stateSlice.actions;\n\nexport type PromQailProps = {\n  query: PromVisualQuery;\n  closeDrawer: () => void;\n  onChange: (query: PromVisualQuery) => void;\n  datasource: PrometheusDatasource;\n};\n\nconst SKIP_STARTING_MESSAGE = 'SKIP_STARTING_MESSAGE';\n\nexport const PromQail = (props: PromQailProps) => {\n  const { query, closeDrawer, onChange, datasource } = props;\n  const skipStartingMessage = store.getBool(SKIP_STARTING_MESSAGE, false);\n\n  const [state, dispatch] = useReducer(stateSlice.reducer, initialState(query, !skipStartingMessage));\n\n  const [labelNames, setLabelNames] = useState<string[]>([]);\n\n  const suggestions = state.interactions.reduce((acc, int) => acc + int.suggestions.length, 0);\n\n  const responsesEndRef = useRef(null);\n\n  const scrollToBottom = () => {\n    if (responsesEndRef) {\n      // @ts-ignore for React.MutableRefObject\n      responsesEndRef?.current?.scrollIntoView({ behavior: 'smooth' });\n    }\n  };\n\n  useEffect(() => {\n    // only scroll when an interaction has been added or the suggestions have been updated\n    scrollToBottom();\n  }, [state.interactions.length, suggestions]);\n\n  useEffect(() => {\n    const fetchLabels = async () => {\n      let labelsIndex: Record<string, string[]> = await datasource.languageProvider.fetchLabelsWithMatch(query.metric);\n      setLabelNames(Object.keys(labelsIndex));\n    };\n    fetchLabels();\n  }, [query, datasource]);\n\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  return (\n    <div className={styles.containerPadding}>\n      {/* Query Advisor */}\n      {/* header */}\n      <div className={styles.header}>\n        <h3>Query advisor</h3>\n        <Button icon=\"times\" fill=\"text\" variant=\"secondary\" onClick={closeDrawer} />\n      </div>\n      {/* Starting message */}\n      <div>\n        <div className={styles.iconSection}>\n          <img src={AI_Logo_color} alt=\"AI logo color\" /> Assistant\n        </div>\n        {state.showStartingMessage ? (\n          <>\n            <div className={styles.dataList}>\n              <ol>\n                <li className={styles.textPadding}>\n                  Query Advisor suggests queries based on a metric and requests you type in.\n                </li>\n                <li className={styles.textPadding}>\n                  Query Advisor sends Prometheus metrics, labels and metadata to the LLM provider you&#39;ve configured.\n                  Be sure to align its usage with your company&#39;s internal policies.\n                </li>\n                <li className={styles.textPadding}>\n                  An AI-suggested query may not fully answer your question. Always take a moment to understand a query\n                  before you use it.\n                </li>\n              </ol>\n            </div>\n            <Alert\n              title={''}\n              severity={'info'}\n              key={'promqail-llm-app'}\n              className={cx(styles.textPadding, styles.noMargin)}\n            >\n              Query Advisor is currently in Private Preview. Feedback is appreciated and can be provided on explanations\n              and suggestions.\n            </Alert>\n\n            {/* don't show this message again, store in localstorage */}\n            <div className={styles.textPadding}>\n              <Checkbox\n                checked={state.indicateCheckbox}\n                value={state.indicateCheckbox}\n                onChange={() => {\n                  const val = store.getBool(SKIP_STARTING_MESSAGE, false);\n                  store.set(SKIP_STARTING_MESSAGE, !val);\n                  dispatch(indicateCheckbox(!val));\n                }}\n                label=\"Don't show this message again\"\n              />\n            </div>\n            <div className={styles.rightButtonsWrapper}>\n              <div className={styles.rightButtons}>\n                <Button className={styles.leftButton} fill=\"outline\" variant=\"secondary\" onClick={closeDrawer}>\n                  Cancel\n                </Button>\n                <Button\n                  fill=\"solid\"\n                  variant=\"primary\"\n                  onClick={() => dispatch(showStartingMessage(false))}\n                  data-testid={testIds.securityInfoButton}\n                >\n                  Continue\n                </Button>\n              </div>\n            </div>\n          </>\n        ) : (\n          <div className={styles.bodySmall}>\n            {/* MAKE THIS TABLE RESPONSIVE */}\n            {/* FIT SUPER LONG METRICS AND LABELS IN HERE */}\n            <div className={styles.textPadding}>Here is the metric you have selected:</div>\n            <div className={styles.infoContainerWrapper}>\n              <div className={styles.infoContainer}>\n                <table className={styles.metricTable}>\n                  <tbody>\n                    <tr>\n                      <td className={styles.metricTableName}>metric</td>\n                      <td className={styles.metricTableValue}>{state.query.metric}</td>\n                      <td>\n                        <Button\n                          fill=\"outline\"\n                          variant=\"secondary\"\n                          onClick={closeDrawer}\n                          className={styles.metricTableButton}\n                          size={'sm'}\n                        >\n                          Choose new metric\n                        </Button>\n                      </td>\n                    </tr>\n                    {state.query.labels.map((label, idx) => {\n                      const text = idx === 0 ? 'labels' : '';\n                      return (\n                        <tr key={`${label.label}-${idx}`}>\n                          <td>{text}</td>\n                          <td className={styles.metricTableValue}>{`${label.label}${label.op}${label.value}`}</td>\n                          <td> </td>\n                        </tr>\n                      );\n                    })}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n\n            {/* Ask if you know what you want to query? */}\n            {!state.askForQueryHelp && state.interactions.length === 0 && (\n              <>\n                <div className={styles.queryQuestion}>Do you know what you want to query?</div>\n                <div className={styles.rightButtonsWrapper}>\n                  <div className={styles.rightButtons}>\n                    <Button\n                      className={styles.leftButton}\n                      fill=\"solid\"\n                      variant=\"secondary\"\n                      data-testid={testIds.clickForHistorical}\n                      onClick={() => {\n                        const isLoading = true;\n                        const suggestionType = SuggestionType.Historical;\n                        dispatch(addInteraction({ suggestionType, isLoading }));\n                        reportInteraction('grafana_prometheus_promqail_know_what_you_want_to_query', {\n                          promVisualQuery: query,\n                          doYouKnow: 'no',\n                        });\n                        promQailSuggest(dispatch, 0, query, labelNames, datasource);\n                      }}\n                    >\n                      No\n                    </Button>\n                    <Button\n                      fill=\"solid\"\n                      variant=\"primary\"\n                      data-testid={testIds.clickForAi}\n                      onClick={() => {\n                        reportInteraction('grafana_prometheus_promqail_know_what_you_want_to_query', {\n                          promVisualQuery: query,\n                          doYouKnow: 'yes',\n                        });\n                        const isLoading = false;\n                        const suggestionType = SuggestionType.AI;\n                        dispatch(addInteraction({ suggestionType, isLoading }));\n                      }}\n                    >\n                      Yes\n                    </Button>\n                  </div>\n                </div>\n              </>\n            )}\n\n            {state.interactions.map((interaction: Interaction, idx: number) => {\n              return (\n                <div key={idx}>\n                  {interaction.suggestionType === SuggestionType.AI ? (\n                    <>\n                      <div className={styles.textPadding}>What kind of data do you want to see with your metric?</div>\n                      <div className={cx(styles.secondaryText, styles.bottomMargin)}>\n                        <div>You do not need to enter in a metric or a label again in the prompt.</div>\n                        <div>Example: I want to monitor request latency, not errors.</div>\n                      </div>\n                      <div className={styles.inputPadding}>\n                        <Input\n                          value={interaction.prompt}\n                          spellCheck={false}\n                          placeholder=\"Enter prompt\"\n                          disabled={interaction.suggestions.length > 0}\n                          onChange={(e) => {\n                            const prompt = e.currentTarget.value;\n\n                            const payload = {\n                              idx: idx,\n                              interaction: { ...interaction, prompt },\n                            };\n\n                            dispatch(updateInteraction(payload));\n                          }}\n                        />\n                      </div>\n                      {interaction.suggestions.length === 0 ? (\n                        interaction.isLoading ? (\n                          <>\n                            <div className={styles.loadingMessageContainer}>\n                              Waiting for OpenAI <Spinner className={styles.floatRight} />\n                            </div>\n                          </>\n                        ) : (\n                          <>\n                            <div className={styles.rightButtonsWrapper}>\n                              <div className={styles.rightButtons}>\n                                <Button\n                                  className={styles.leftButton}\n                                  fill=\"outline\"\n                                  variant=\"secondary\"\n                                  onClick={closeDrawer}\n                                >\n                                  Cancel\n                                </Button>\n                                <Button\n                                  className={styles.leftButton}\n                                  fill=\"outline\"\n                                  variant=\"secondary\"\n                                  onClick={() => {\n                                    // JUST SUGGEST QUERIES AND SHOW THE LIST\n                                    const newInteraction: Interaction = {\n                                      ...interaction,\n                                      suggestionType: SuggestionType.Historical,\n                                      isLoading: true,\n                                    };\n\n                                    const payload = {\n                                      idx: idx,\n                                      interaction: newInteraction,\n                                    };\n\n                                    reportInteraction('grafana_prometheus_promqail_suggest_query_instead', {\n                                      promVisualQuery: query,\n                                    });\n\n                                    dispatch(updateInteraction(payload));\n                                    promQailSuggest(dispatch, idx, query, labelNames, datasource, newInteraction);\n                                  }}\n                                >\n                                  Suggest queries instead\n                                </Button>\n                                <Button\n                                  fill=\"solid\"\n                                  variant=\"primary\"\n                                  data-testid={testIds.submitPrompt + idx}\n                                  onClick={() => {\n                                    const newInteraction: Interaction = {\n                                      ...interaction,\n                                      isLoading: true,\n                                    };\n\n                                    const payload = {\n                                      idx: idx,\n                                      interaction: newInteraction,\n                                    };\n\n                                    reportInteraction('grafana_prometheus_promqail_prompt_submitted', {\n                                      promVisualQuery: query,\n                                      prompt: interaction.prompt,\n                                    });\n\n                                    dispatch(updateInteraction(payload));\n                                    // add the suggestions in the API call\n                                    promQailSuggest(dispatch, idx, query, labelNames, datasource, interaction);\n                                  }}\n                                >\n                                  Submit\n                                </Button>\n                              </div>\n                            </div>\n                          </>\n                        )\n                      ) : (\n                        // LIST OF SUGGESTED QUERIES FROM AI\n                        <QuerySuggestionContainer\n                          suggestionType={SuggestionType.AI}\n                          querySuggestions={interaction.suggestions}\n                          closeDrawer={closeDrawer}\n                          nextInteraction={() => {\n                            const isLoading = false;\n                            const suggestionType = SuggestionType.AI;\n                            dispatch(addInteraction({ suggestionType, isLoading }));\n                          }}\n                          queryExplain={(suggIdx: number) =>\n                            interaction.suggestions[suggIdx].explanation === ''\n                              ? promQailExplain(dispatch, idx, query, interaction, suggIdx, datasource)\n                              : interaction.suggestions[suggIdx].explanation\n                          }\n                          onChange={onChange}\n                          prompt={interaction.prompt ?? ''}\n                        />\n                      )}\n                    </>\n                  ) : // HISTORICAL SUGGESTIONS\n                  interaction.isLoading ? (\n                    <>\n                      <div className={styles.loadingMessageContainer}>\n                        Waiting for OpenAI <Spinner className={styles.floatRight} />\n                      </div>\n                    </>\n                  ) : (\n                    // LIST OF SUGGESTED QUERIES FROM HISTORICAL DATA\n                    <QuerySuggestionContainer\n                      suggestionType={SuggestionType.Historical}\n                      querySuggestions={interaction.suggestions}\n                      closeDrawer={closeDrawer}\n                      nextInteraction={() => {\n                        const isLoading = false;\n                        const suggestionType = SuggestionType.AI;\n                        dispatch(addInteraction({ suggestionType, isLoading }));\n                      }}\n                      queryExplain={(suggIdx: number) =>\n                        interaction.suggestions[suggIdx].explanation === ''\n                          ? promQailExplain(dispatch, idx, query, interaction, suggIdx, datasource)\n                          : interaction.suggestions[suggIdx].explanation\n                      }\n                      onChange={onChange}\n                      prompt={interaction.prompt ?? ''}\n                    />\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n      <div ref={responsesEndRef} />\n    </div>\n  );\n};\n\nexport const getStyles = (theme: GrafanaTheme2) => {\n  return {\n    sectionPadding: css({\n      padding: '20px',\n    }),\n    header: css({\n      display: 'flex',\n\n      button: {\n        marginLeft: 'auto',\n      },\n    }),\n    iconSection: css({\n      padding: '0 0 10px 0',\n      color: `${theme.colors.text.secondary}`,\n\n      img: {\n        paddingRight: '4px',\n      },\n    }),\n    rightButtonsWrapper: css({\n      display: 'flex',\n    }),\n    rightButtons: css({\n      marginLeft: 'auto',\n    }),\n    leftButton: css({\n      marginRight: '10px',\n    }),\n    dataList: css({\n      padding: '0px 28px 0px 28px',\n    }),\n    textPadding: css({\n      paddingBottom: '12px',\n    }),\n    containerPadding: css({\n      padding: '28px',\n    }),\n    infoContainer: css({\n      border: `${theme.colors.border.strong}`,\n      padding: '16px',\n      backgroundColor: `${theme.colors.background.secondary}`,\n      borderRadius: `8px`,\n      borderBottomLeftRadius: 0,\n    }),\n    infoContainerWrapper: css({\n      paddingBottom: '24px',\n    }),\n    metricTable: css({\n      width: '100%',\n    }),\n    metricTableName: css({\n      width: '15%',\n    }),\n    metricTableValue: css({\n      fontFamily: `${theme.typography.fontFamilyMonospace}`,\n      fontSize: `${theme.typography.bodySmall.fontSize}`,\n      overflow: 'scroll',\n      textWrap: 'nowrap',\n      maxWidth: '150px',\n      width: '60%',\n      maskImage: `linear-gradient(to right, rgba(0, 0, 0, 1) 90%, rgba(0, 0, 0, 0))`,\n    }),\n    metricTableButton: css({\n      float: 'right',\n    }),\n    queryQuestion: css({\n      textAlign: 'end',\n      padding: '8px 0',\n    }),\n    secondaryText: css({\n      color: `${theme.colors.text.secondary}`,\n    }),\n    loadingMessageContainer: css({\n      border: `${theme.colors.border.strong}`,\n      padding: `16px`,\n      backgroundColor: `${theme.colors.background.secondary}`,\n      marginBottom: `20px`,\n      borderRadius: `8px`,\n      color: `${theme.colors.text.secondary}`,\n      fontStyle: 'italic',\n    }),\n    floatRight: css({\n      float: 'right',\n    }),\n    codeText: css({\n      fontFamily: `${theme.typography.fontFamilyMonospace}`,\n      fontSize: `${theme.typography.bodySmall.fontSize}`,\n    }),\n    bodySmall: css({\n      fontSize: `${theme.typography.bodySmall.fontSize}`,\n    }),\n    explainPadding: css({\n      paddingLeft: '26px',\n    }),\n    bottomMargin: css({\n      marginBottom: '20px',\n    }),\n    topPadding: css({\n      paddingTop: '22px',\n    }),\n    doc: css({\n      textDecoration: 'underline',\n    }),\n    afterButtons: css({\n      display: 'flex',\n      justifyContent: 'flex-end',\n    }),\n    feedbackStyle: css({\n      margin: 0,\n      textAlign: 'right',\n      paddingTop: '22px',\n      paddingBottom: '22px',\n    }),\n    nextInteractionHeight: css({\n      height: '88px',\n    }),\n    center: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n    }),\n    inputPadding: css({\n      paddingBottom: '24px',\n    }),\n    querySuggestion: css({\n      display: 'flex',\n      flexWrap: 'nowrap',\n    }),\n    longCode: css({\n      width: '90%',\n      textWrap: 'nowrap',\n      overflow: 'scroll',\n      maskImage: `linear-gradient(to right, rgba(0, 0, 0, 1) 90%, rgba(0, 0, 0, 0))`,\n\n      div: {\n        display: 'inline-block',\n      },\n    }),\n    useButton: css({\n      marginLeft: 'auto',\n    }),\n    suggestionFeedback: css({\n      textAlign: 'left',\n    }),\n    feedbackQuestion: css({\n      display: 'flex',\n      padding: '8px 0px',\n      h6: { marginBottom: 0 },\n      i: {\n        marginTop: '1px',\n      },\n    }),\n    explationTextInput: css({\n      paddingLeft: '24px',\n    }),\n    submitFeedback: css({\n      padding: '16px 0',\n    }),\n    noMargin: css({\n      margin: 0,\n    }),\n    enableButtonTooltip: css({\n      padding: 8,\n    }),\n    enableButtonTooltipText: css({\n      color: `${theme.colors.text.secondary}`,\n      ul: {\n        marginLeft: 16,\n      },\n    }),\n    link: css({\n      color: `${theme.colors.text.link} !important`,\n    }),\n  };\n};\n\nexport const testIds = {\n  promQail: 'prom-qail',\n  securityInfoButton: 'security-info-button',\n  clickForHistorical: 'click-for-historical',\n  clickForAi: 'click-for-ai',\n  submitPrompt: 'submit-prompt',\n  refinePrompt: 'refine-prompt',\n};\n","import React from 'react';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Button, Tooltip, useTheme2 } from '@grafana/ui';\n\nimport { getStyles } from './PromQail';\nimport AI_Logo_color from './resources/AI_Logo_color.svg';\n\nexport type Props = {\n  llmAppEnabled: boolean;\n  metric: string;\n  setShowDrawer: (show: boolean) => void;\n};\n\nexport function QueryAssistantButton(props: Props) {\n  const { llmAppEnabled, metric, setShowDrawer } = props;\n\n  const llmAppDisabled = !llmAppEnabled;\n  const noMetricSelected = !metric;\n\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  const button = () => {\n    return (\n      <Button\n        variant={'secondary'}\n        onClick={() => {\n          reportInteraction('grafana_prometheus_promqail_ai_button_clicked', {\n            metric: metric,\n          });\n          setShowDrawer(true);\n        }}\n        disabled={!metric || !llmAppEnabled}\n        data-testid={selectors.components.DataSource.Prometheus.queryEditor.builder.queryAdvisor}\n      >\n        <img height={16} src={AI_Logo_color} alt=\"AI logo black and white\" />\n        {'\\u00A0'}Get query suggestions\n      </Button>\n    );\n  };\n\n  const selectMetricMessage = (\n    <Tooltip content={'First, select a metric.'} placement={'bottom-end'}>\n      {button()}\n    </Tooltip>\n  );\n\n  const llmAppMessage = (\n    <Tooltip\n      interactive={true}\n      placement={'auto-end'}\n      content={\n        <div className={styles.enableButtonTooltip}>\n          <h6>Query Advisor is disabled</h6>\n          <div className={styles.enableButtonTooltipText}>To enable Query Advisor you must:</div>\n          <div className={styles.enableButtonTooltipText}>\n            <ul>\n              <li>\n                <a\n                  href={'https://grafana.com/docs/grafana-cloud/alerting-and-irm/machine-learning/llm-plugin/'}\n                  target=\"_blank\"\n                  rel=\"noreferrer noopener\"\n                  className={styles.link}\n                >\n                  Install and enable the LLM plugin\n                </a>\n              </li>\n              <li>Select a metric</li>\n            </ul>\n          </div>\n        </div>\n      }\n    >\n      {button()}\n    </Tooltip>\n  );\n\n  if (llmAppDisabled) {\n    return llmAppMessage;\n  } else if (noMetricSelected) {\n    return selectMetricMessage;\n  } else {\n    return button();\n  }\n}\n","import { css } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\n\nimport { DataSourceApi, PanelData } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { EditorRow } from '@grafana/experimental';\nimport { config } from '@grafana/runtime';\nimport { Drawer } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../../datasource';\nimport promqlGrammar from '../../promql';\nimport { promQueryModeller } from '../PromQueryModeller';\nimport { buildVisualQueryFromString } from '../parsing';\nimport { OperationExplainedBox } from '../shared/OperationExplainedBox';\nimport { OperationList } from '../shared/OperationList';\nimport { OperationListExplained } from '../shared/OperationListExplained';\nimport { OperationsEditorRow } from '../shared/OperationsEditorRow';\nimport { QueryBuilderHints } from '../shared/QueryBuilderHints';\nimport { RawQuery } from '../shared/RawQuery';\nimport { QueryBuilderOperation } from '../shared/types';\nimport { PromVisualQuery } from '../types';\n\nimport { MetricsLabelsSection } from './MetricsLabelsSection';\nimport { NestedQueryList } from './NestedQueryList';\nimport { EXPLAIN_LABEL_FILTER_CONTENT } from './PromQueryBuilderExplained';\nimport { PromQail } from './promQail/PromQail';\nimport { QueryAssistantButton } from './promQail/QueryAssistantButton';\nimport { isLLMPluginEnabled } from './promQail/state/helpers';\n\nexport interface Props {\n  query: PromVisualQuery;\n  datasource: PrometheusDatasource;\n  onChange: (update: PromVisualQuery) => void;\n  onRunQuery: () => void;\n  data?: PanelData;\n  showExplain: boolean;\n}\n\n// initial commit for hackathon-2023-08-promqail\n// AI/ML + Prometheus\nconst prometheusPromQAIL = config.featureToggles.prometheusPromQAIL;\n\nexport const PromQueryBuilder = React.memo<Props>((props) => {\n  const { datasource, query, onChange, onRunQuery, data, showExplain } = props;\n  const [highlightedOp, setHighlightedOp] = useState<QueryBuilderOperation | undefined>();\n  const [showDrawer, setShowDrawer] = useState<boolean>(false);\n  const [llmAppEnabled, updateLlmAppEnabled] = useState<boolean>(false);\n\n  const lang = { grammar: promqlGrammar, name: 'promql' };\n\n  const initHints = datasource.getInitHints();\n\n  useEffect(() => {\n    async function checkLlms() {\n      const check = await isLLMPluginEnabled();\n      updateLlmAppEnabled(check);\n    }\n    checkLlms();\n  }, []);\n\n  return (\n    <>\n      {prometheusPromQAIL && showDrawer && (\n        <Drawer closeOnMaskClick={false} onClose={() => setShowDrawer(false)}>\n          <PromQail\n            query={query}\n            closeDrawer={() => setShowDrawer(false)}\n            onChange={onChange}\n            datasource={datasource}\n          />\n        </Drawer>\n      )}\n      <EditorRow>\n        <MetricsLabelsSection query={query} onChange={onChange} datasource={datasource} />\n      </EditorRow>\n      {initHints.length ? (\n        <div className=\"query-row-break\">\n          <div className=\"prom-query-field-info text-warning\">\n            {initHints[0].label}{' '}\n            {initHints[0].fix ? (\n              <button type=\"button\" className={'text-warning'}>\n                {initHints[0].fix.label}\n              </button>\n            ) : null}\n          </div>\n        </div>\n      ) : null}\n      {showExplain && (\n        <OperationExplainedBox\n          stepNumber={1}\n          title={<RawQuery query={`${query.metric} ${promQueryModeller.renderLabels(query.labels)}`} lang={lang} />}\n        >\n          {EXPLAIN_LABEL_FILTER_CONTENT}\n        </OperationExplainedBox>\n      )}\n      <OperationsEditorRow>\n        <OperationList<PromVisualQuery>\n          queryModeller={promQueryModeller}\n          // eslint-ignore\n          datasource={datasource as DataSourceApi}\n          query={query}\n          onChange={onChange}\n          onRunQuery={onRunQuery}\n          highlightedOp={highlightedOp}\n        />\n        {prometheusPromQAIL && (\n          <div\n            className={css({\n              padding: '0 0 0 6px',\n            })}\n          >\n            <QueryAssistantButton llmAppEnabled={llmAppEnabled} metric={query.metric} setShowDrawer={setShowDrawer} />\n          </div>\n        )}\n        <div data-testid={selectors.components.DataSource.Prometheus.queryEditor.builder.hints}>\n          <QueryBuilderHints<PromVisualQuery>\n            datasource={datasource}\n            query={query}\n            onChange={onChange}\n            data={data}\n            queryModeller={promQueryModeller}\n            buildVisualQueryFromString={buildVisualQueryFromString}\n          />\n        </div>\n      </OperationsEditorRow>\n      {showExplain && (\n        <OperationListExplained<PromVisualQuery>\n          lang={lang}\n          query={query}\n          stepNumber={2}\n          queryModeller={promQueryModeller}\n          onMouseEnter={(op) => setHighlightedOp(op)}\n          onMouseLeave={() => setHighlightedOp(undefined)}\n        />\n      )}\n      {query.binaryQueries && query.binaryQueries.length > 0 && (\n        <NestedQueryList\n          query={query}\n          datasource={datasource}\n          onChange={onChange}\n          onRunQuery={onRunQuery}\n          showExplain={showExplain}\n        />\n      )}\n    </>\n  );\n});\n\nPromQueryBuilder.displayName = 'PromQueryBuilder';\n","import React from 'react';\n\nimport { EditorFieldGroup, EditorRow } from '@grafana/experimental';\n\nimport promqlGrammar from '../../promql';\nimport { RawQuery } from '../shared/RawQuery';\n\nexport interface Props {\n  query: string;\n}\n\nexport function QueryPreview({ query }: Props) {\n  if (!query) {\n    return null;\n  }\n\n  return (\n    <EditorRow>\n      <EditorFieldGroup>\n        <RawQuery query={query} lang={{ grammar: promqlGrammar, name: 'promql' }} />\n      </EditorFieldGroup>\n    </EditorRow>\n  );\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport React, { useEffect, useReducer } from 'react';\n\nimport { PanelData } from '@grafana/data';\nimport { config } from '@grafana/runtime';\n\nimport { PrometheusDatasource } from '../../datasource';\nimport { PromQuery } from '../../types';\nimport { promQueryModeller } from '../PromQueryModeller';\nimport { buildVisualQueryFromString } from '../parsing';\nimport { PromVisualQuery } from '../types';\n\nimport { PromQueryBuilder } from './PromQueryBuilder';\nimport { QueryPreview } from './QueryPreview';\nimport { getSettings, MetricsModalSettings } from './metrics-modal/state/state';\n\nexport interface Props {\n  query: PromQuery;\n  datasource: PrometheusDatasource;\n  onChange: (update: PromQuery) => void;\n  onRunQuery: () => void;\n  data?: PanelData;\n  showExplain: boolean;\n}\n\nexport interface State {\n  visQuery?: PromVisualQuery;\n  expr: string;\n}\n\nconst prometheusMetricEncyclopedia = config.featureToggles.prometheusMetricEncyclopedia;\n/**\n * This component is here just to contain the translation logic between string query and the visual query builder model.\n */\nexport function PromQueryBuilderContainer(props: Props) {\n  const { query, onChange, onRunQuery, datasource, data, showExplain } = props;\n  const [state, dispatch] = useReducer(stateSlice.reducer, { expr: query.expr });\n  // Only rebuild visual query if expr changes from outside\n  useEffect(() => {\n    dispatch(exprChanged(query.expr));\n\n    if (prometheusMetricEncyclopedia) {\n      dispatch(\n        setMetricsModalSettings({\n          useBackend: query.useBackend ?? false,\n          disableTextWrap: query.disableTextWrap ?? false,\n          fullMetaSearch: query.fullMetaSearch ?? false,\n          includeNullMetadata: query.includeNullMetadata ?? true,\n        })\n      );\n    }\n  }, [query]);\n\n  useEffect(() => {\n    datasource.languageProvider.start(data?.timeRange);\n  }, [data?.timeRange, datasource.languageProvider]);\n\n  const onVisQueryChange = (visQuery: PromVisualQuery) => {\n    const expr = promQueryModeller.renderQuery(visQuery);\n    dispatch(visualQueryChange({ visQuery, expr }));\n\n    if (prometheusMetricEncyclopedia) {\n      const metricsModalSettings = getSettings(visQuery);\n      onChange({ ...props.query, expr: expr, ...metricsModalSettings });\n    } else {\n      onChange({ ...props.query, expr: expr });\n    }\n  };\n\n  if (!state.visQuery) {\n    return null;\n  }\n\n  return (\n    <>\n      <PromQueryBuilder\n        query={state.visQuery}\n        datasource={datasource}\n        onChange={onVisQueryChange}\n        onRunQuery={onRunQuery}\n        data={data}\n        showExplain={showExplain}\n      />\n      <QueryPreview query={query.expr} />\n    </>\n  );\n}\n\nconst initialState: State = {\n  expr: '',\n};\n\nconst stateSlice = createSlice({\n  name: 'prom-builder-container',\n  initialState,\n  reducers: {\n    visualQueryChange: (state, action: PayloadAction<{ visQuery: PromVisualQuery; expr: string }>) => {\n      state.expr = action.payload.expr;\n      state.visQuery = action.payload.visQuery;\n    },\n    exprChanged: (state, action: PayloadAction<string>) => {\n      if (!state.visQuery || state.expr !== action.payload) {\n        state.expr = action.payload;\n        const parseResult = buildVisualQueryFromString(action.payload ?? '');\n\n        state.visQuery = parseResult.query;\n      }\n    },\n    setMetricsModalSettings: (state, action: PayloadAction<MetricsModalSettings>) => {\n      if (state.visQuery && prometheusMetricEncyclopedia) {\n        state.visQuery.useBackend = action.payload.useBackend;\n        state.visQuery.disableTextWrap = action.payload.disableTextWrap;\n        state.visQuery.fullMetaSearch = action.payload.fullMetaSearch;\n        state.visQuery.includeNullMetadata = action.payload.includeNullMetadata;\n      }\n    },\n  },\n});\n\nconst { visualQueryChange, exprChanged, setMetricsModalSettings } = stateSlice.actions;\n","import { css, cx } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\nimport { usePrevious } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { IconButton, InlineLabel, Tooltip, useStyles2 } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../datasource';\nimport { PromQuery } from '../types';\n\ninterface Props {\n  onChange: (exemplar: boolean) => void;\n  datasource: PrometheusDatasource;\n  query: PromQuery;\n  'data-testid'?: string;\n}\n\nexport function PromExemplarField({ datasource, onChange, query, ...rest }: Props) {\n  const [error, setError] = useState<string | null>(null);\n  const styles = useStyles2(getStyles);\n  const prevError = usePrevious(error);\n\n  useEffect(() => {\n    if (!datasource.exemplarsAvailable) {\n      setError('Exemplars for this query are not available');\n      onChange(false);\n    } else if (query.instant && !query.range) {\n      setError('Exemplars are not available for instant queries');\n      onChange(false);\n    } else {\n      setError(null);\n      // If error is cleared, we want to change exemplar to true\n      if (prevError && !error) {\n        onChange(true);\n      }\n    }\n  }, [datasource.exemplarsAvailable, query.instant, query.range, onChange, prevError, error]);\n\n  const iconButtonStyles = cx(\n    {\n      [styles.activeIcon]: !!query.exemplar,\n    },\n    styles.eyeIcon\n  );\n\n  return (\n    <InlineLabel width=\"auto\" data-testid={rest['data-testid']}>\n      <Tooltip content={error ?? ''}>\n        <div className={styles.iconWrapper}>\n          Exemplars\n          <IconButton\n            name=\"eye\"\n            tooltip={!!query.exemplar ? 'Disable query with exemplars' : 'Enable query with exemplars'}\n            disabled={!!error}\n            className={iconButtonStyles}\n            onClick={() => {\n              onChange(!query.exemplar);\n            }}\n          />\n        </div>\n      </Tooltip>\n    </InlineLabel>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    eyeIcon: css`\n      margin-left: ${theme.spacing(2)};\n    `,\n    activeIcon: css`\n      color: ${theme.colors.primary.main};\n    `,\n    iconWrapper: css`\n      display: flex;\n      align-items: center;\n    `,\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { isEqual } from 'lodash';\nimport React, { memo, useCallback } from 'react';\nimport { usePrevious } from 'react-use';\n\nimport { InlineFormLabel, RadioButtonGroup } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../datasource';\nimport { PromQuery } from '../types';\n\nimport { PromExemplarField } from './PromExemplarField';\n\nexport interface PromExploreExtraFieldProps {\n  query: PromQuery;\n  onChange: (value: PromQuery) => void;\n  onRunQuery: () => void;\n  datasource: PrometheusDatasource;\n}\n\nexport const PromExploreExtraField = memo(({ query, datasource, onChange, onRunQuery }: PromExploreExtraFieldProps) => {\n  const rangeOptions = getQueryTypeOptions(true);\n  const prevQuery = usePrevious(query);\n\n  const onExemplarChange = useCallback(\n    (exemplar: boolean) => {\n      if (!isEqual(query, prevQuery) || exemplar !== query.exemplar) {\n        onChange({ ...query, exemplar });\n      }\n    },\n    [prevQuery, query, onChange]\n  );\n\n  function onChangeQueryStep(interval: string) {\n    onChange({ ...query, interval });\n  }\n\n  function onStepChange(e: React.SyntheticEvent<HTMLInputElement>) {\n    if (e.currentTarget.value !== query.interval) {\n      onChangeQueryStep(e.currentTarget.value);\n    }\n  }\n\n  function onReturnKeyDown(e: React.KeyboardEvent<HTMLInputElement>) {\n    if (e.key === 'Enter' && e.shiftKey) {\n      onRunQuery();\n    }\n  }\n\n  const onQueryTypeChange = getQueryTypeChangeHandler(query, onChange);\n\n  return (\n    <div aria-label=\"Prometheus extra field\" className=\"gf-form-inline\" data-testid={testIds.extraFieldEditor}>\n      {/*Query type field*/}\n      <div\n        data-testid={testIds.queryTypeField}\n        className={cx(\n          'gf-form explore-input-margin',\n          css`\n            flex-wrap: nowrap;\n          `\n        )}\n        aria-label=\"Query type field\"\n      >\n        <InlineFormLabel width=\"auto\">Query type</InlineFormLabel>\n\n        <RadioButtonGroup\n          options={rangeOptions}\n          value={query.range && query.instant ? 'both' : query.instant ? 'instant' : 'range'}\n          onChange={onQueryTypeChange}\n        />\n      </div>\n      {/*Step field*/}\n      <div\n        data-testid={testIds.stepField}\n        className={cx(\n          'gf-form',\n          css`\n            flex-wrap: nowrap;\n          `\n        )}\n        aria-label=\"Step field\"\n      >\n        <InlineFormLabel\n          width={6}\n          tooltip={\n            'Time units and built-in variables can be used here, for example: $__interval, $__rate_interval, 5s, 1m, 3h, 1d, 1y (Default if no unit is specified: s)'\n          }\n        >\n          Min step\n        </InlineFormLabel>\n        <input\n          type={'text'}\n          className=\"gf-form-input width-4\"\n          placeholder={'auto'}\n          onChange={onStepChange}\n          onKeyDown={onReturnKeyDown}\n          value={query.interval ?? ''}\n        />\n      </div>\n\n      <PromExemplarField onChange={onExemplarChange} datasource={datasource} query={query} />\n    </div>\n  );\n});\n\nPromExploreExtraField.displayName = 'PromExploreExtraField';\n\nexport function getQueryTypeOptions(includeBoth: boolean) {\n  const rangeOptions = [\n    { value: 'range', label: 'Range', description: 'Run query over a range of time' },\n    {\n      value: 'instant',\n      label: 'Instant',\n      description: 'Run query against a single point in time. For this query, the \"To\" time is used',\n    },\n  ];\n\n  if (includeBoth) {\n    rangeOptions.push({ value: 'both', label: 'Both', description: 'Run an Instant query and a Range query' });\n  }\n\n  return rangeOptions;\n}\n\nexport function getQueryTypeChangeHandler(query: PromQuery, onChange: (update: PromQuery) => void) {\n  return (queryType: string) => {\n    if (queryType === 'instant') {\n      onChange({ ...query, instant: true, range: false, exemplar: false });\n    } else if (queryType === 'range') {\n      onChange({ ...query, instant: false, range: true });\n    } else {\n      onChange({ ...query, instant: true, range: true });\n    }\n  };\n}\n\nexport const testIds = {\n  extraFieldEditor: 'prom-editor-extra-field',\n  stepField: 'prom-editor-extra-field-step',\n  queryTypeField: 'prom-editor-extra-field-query-type',\n};\n","import { css } from '@emotion/css';\nimport React from 'react';\nimport { useToggle } from 'react-use';\n\nimport { getValueFormat, GrafanaTheme2 } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { Collapse, Icon, Tooltip, useStyles2, Stack } from '@grafana/ui';\nimport { QueryStats } from 'app/plugins/datasource/loki/types';\n\nexport interface Props {\n  title: string;\n  collapsedInfo: string[];\n  queryStats?: QueryStats | null;\n  children: React.ReactNode;\n}\n\nexport function QueryOptionGroup({ title, children, collapsedInfo, queryStats }: Props) {\n  const [isOpen, toggleOpen] = useToggle(false);\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.wrapper}>\n      <Collapse\n        className={styles.collapse}\n        collapsible\n        isOpen={isOpen}\n        onToggle={toggleOpen}\n        label={\n          <Stack gap={0}>\n            <h6 className={styles.title}>{title}</h6>\n            {!isOpen && (\n              <div className={styles.description}>\n                {collapsedInfo.map((x, i) => (\n                  <span key={i}>{x}</span>\n                ))}\n              </div>\n            )}\n          </Stack>\n        }\n      >\n        <div className={styles.body}>{children}</div>\n      </Collapse>\n\n      {queryStats && config.featureToggles.lokiQuerySplitting && (\n        <Tooltip content=\"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part.\">\n          <Icon tabIndex={0} name=\"info-circle\" className={styles.tooltip} size=\"sm\" />\n        </Tooltip>\n      )}\n\n      {queryStats && <p className={styles.stats}>{generateQueryStats(queryStats)}</p>}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    collapse: css({\n      backgroundColor: 'unset',\n      border: 'unset',\n      marginBottom: 0,\n\n      ['> button']: {\n        padding: theme.spacing(0, 1),\n      },\n    }),\n    wrapper: css({\n      width: '100%',\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'baseline',\n    }),\n    title: css({\n      flexGrow: 1,\n      overflow: 'hidden',\n      fontSize: theme.typography.bodySmall.fontSize,\n      fontWeight: theme.typography.fontWeightMedium,\n      margin: 0,\n    }),\n    description: css({\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n      fontWeight: theme.typography.bodySmall.fontWeight,\n      paddingLeft: theme.spacing(2),\n      gap: theme.spacing(2),\n      display: 'flex',\n    }),\n    body: css({\n      display: 'flex',\n      gap: theme.spacing(2),\n      flexWrap: 'wrap',\n    }),\n    stats: css({\n      margin: '0px',\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n    tooltip: css({\n      marginRight: theme.spacing(0.25),\n    }),\n  };\n};\n\nconst generateQueryStats = (queryStats: QueryStats) => {\n  if (queryStats.message) {\n    return queryStats.message;\n  }\n\n  return `This query will process approximately ${convertUnits(queryStats)}.`;\n};\n\nconst convertUnits = (queryStats: QueryStats): string => {\n  const { text, suffix } = getValueFormat('bytes')(queryStats.bytes, 1);\n  return text + suffix;\n};\n","import React, { useRef } from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { EditorField } from '@grafana/experimental';\nimport { Select, AutoSizeInput } from '@grafana/ui';\n\nimport { LegendFormatMode } from '../../types';\n\nexport interface Props {\n  legendFormat: string | undefined;\n  onChange: (legendFormat: string) => void;\n  onRunQuery: () => void;\n}\n\nconst legendModeOptions = [\n  {\n    label: 'Auto',\n    value: LegendFormatMode.Auto,\n    description: 'Only includes unique labels',\n  },\n  { label: 'Verbose', value: LegendFormatMode.Verbose, description: 'All label names and values' },\n  { label: 'Custom', value: LegendFormatMode.Custom, description: 'Provide a naming template' },\n];\n\n/**\n * Tests for this component are on the parent level (PromQueryBuilderOptions).\n */\nexport const PromQueryLegendEditor = React.memo<Props>(({ legendFormat, onChange, onRunQuery }) => {\n  const mode = getLegendMode(legendFormat);\n  const inputRef = useRef<HTMLInputElement | null>(null);\n\n  const onLegendFormatChanged = (evt: React.FormEvent<HTMLInputElement>) => {\n    let newFormat = evt.currentTarget.value;\n    if (newFormat.length === 0) {\n      newFormat = LegendFormatMode.Auto;\n    }\n\n    if (newFormat !== legendFormat) {\n      onChange(newFormat);\n      onRunQuery();\n    }\n  };\n\n  const onLegendModeChanged = (value: SelectableValue<LegendFormatMode>) => {\n    switch (value.value!) {\n      case LegendFormatMode.Auto:\n        onChange(LegendFormatMode.Auto);\n        break;\n      case LegendFormatMode.Custom:\n        onChange('{{label_name}}');\n        setTimeout(() => {\n          inputRef.current?.focus();\n          inputRef.current?.setSelectionRange(2, 12, 'forward');\n        }, 10);\n        break;\n      case LegendFormatMode.Verbose:\n        onChange('');\n        break;\n    }\n    onRunQuery();\n  };\n\n  return (\n    <EditorField\n      label=\"Legend\"\n      tooltip=\"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname.\"\n      data-testid={selectors.components.DataSource.Prometheus.queryEditor.legend}\n    >\n      <>\n        {mode === LegendFormatMode.Custom && (\n          <AutoSizeInput\n            id=\"legendFormat\"\n            minWidth={22}\n            placeholder=\"auto\"\n            defaultValue={legendFormat}\n            onCommitChange={onLegendFormatChanged}\n            ref={inputRef}\n          />\n        )}\n        {mode !== LegendFormatMode.Custom && (\n          <Select\n            inputId=\"legend.mode\"\n            isSearchable={false}\n            placeholder=\"Select legend mode\"\n            options={legendModeOptions}\n            width={22}\n            onChange={onLegendModeChanged}\n            value={legendModeOptions.find((x) => x.value === mode)}\n          />\n        )}\n      </>\n    </EditorField>\n  );\n});\n\nPromQueryLegendEditor.displayName = 'PromQueryLegendEditor';\n\nfunction getLegendMode(legendFormat: string | undefined) {\n  // This special value means the new smart minimal series naming\n  if (legendFormat === LegendFormatMode.Auto) {\n    return LegendFormatMode.Auto;\n  }\n\n  // Missing or empty legend format is the old verbose behavior\n  if (legendFormat == null || legendFormat === '') {\n    return LegendFormatMode.Verbose;\n  }\n\n  return LegendFormatMode.Custom;\n}\n\nexport function getLegendModeLabel(legendFormat: string | undefined) {\n  const mode = getLegendMode(legendFormat);\n  if (mode !== LegendFormatMode.Custom) {\n    return legendModeOptions.find((x) => x.value === mode)?.label;\n  }\n  return legendFormat;\n}\n","import React, { SyntheticEvent } from 'react';\n\nimport { CoreApp, SelectableValue } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { EditorField, EditorRow, EditorSwitch } from '@grafana/experimental';\nimport { AutoSizeInput, RadioButtonGroup, Select } from '@grafana/ui';\n\nimport { getQueryTypeChangeHandler, getQueryTypeOptions } from '../../components/PromExploreExtraField';\nimport { PromQueryFormat } from '../../dataquery.gen';\nimport { PromQuery } from '../../types';\nimport { QueryOptionGroup } from '../shared/QueryOptionGroup';\n\nimport { FORMAT_OPTIONS, INTERVAL_FACTOR_OPTIONS } from './PromQueryEditorSelector';\nimport { getLegendModeLabel, PromQueryLegendEditor } from './PromQueryLegendEditor';\n\nexport interface UIOptions {\n  exemplars: boolean;\n  type: boolean;\n  format: boolean;\n  minStep: boolean;\n  legend: boolean;\n  resolution: boolean;\n}\n\nexport interface Props {\n  query: PromQuery;\n  app?: CoreApp;\n  onChange: (update: PromQuery) => void;\n  onRunQuery: () => void;\n}\n\nexport const PromQueryBuilderOptions = React.memo<Props>(({ query, app, onChange, onRunQuery }) => {\n  const onChangeFormat = (value: SelectableValue<PromQueryFormat>) => {\n    onChange({ ...query, format: value.value });\n    onRunQuery();\n  };\n\n  const onChangeStep = (evt: React.FormEvent<HTMLInputElement>) => {\n    onChange({ ...query, interval: evt.currentTarget.value });\n    onRunQuery();\n  };\n\n  const queryTypeOptions = getQueryTypeOptions(\n    app === CoreApp.Explore || app === CoreApp.Correlations || app === CoreApp.PanelEditor\n  );\n  const onQueryTypeChange = getQueryTypeChangeHandler(query, onChange);\n\n  const onExemplarChange = (event: SyntheticEvent<HTMLInputElement>) => {\n    const isEnabled = event.currentTarget.checked;\n    onChange({ ...query, exemplar: isEnabled });\n    onRunQuery();\n  };\n\n  const onIntervalFactorChange = (value: SelectableValue<number>) => {\n    onChange({ ...query, intervalFactor: value.value });\n    onRunQuery();\n  };\n\n  const formatOption = FORMAT_OPTIONS.find((option) => option.value === query.format) || FORMAT_OPTIONS[0];\n  const queryTypeValue = getQueryTypeValue(query);\n  const queryTypeLabel = queryTypeOptions.find((x) => x.value === queryTypeValue)!.label;\n\n  return (\n    <EditorRow>\n      <div data-testid={selectors.components.DataSource.Prometheus.queryEditor.options}>\n        <QueryOptionGroup\n          title=\"Options\"\n          collapsedInfo={getCollapsedInfo(query, formatOption.label!, queryTypeLabel, app)}\n        >\n          <PromQueryLegendEditor\n            legendFormat={query.legendFormat}\n            onChange={(legendFormat) => onChange({ ...query, legendFormat })}\n            onRunQuery={onRunQuery}\n          />\n          <EditorField\n            label=\"Min step\"\n            tooltip={\n              <>\n                An additional lower limit for the step parameter of the Prometheus query and for the{' '}\n                <code>$__interval</code> and <code>$__rate_interval</code> variables.\n              </>\n            }\n          >\n            <AutoSizeInput\n              id={selectors.components.DataSource.Prometheus.queryEditor.step}\n              type=\"text\"\n              aria-label=\"Set lower limit for the step parameter\"\n              placeholder={'auto'}\n              minWidth={10}\n              onCommitChange={onChangeStep}\n              defaultValue={query.interval}\n            />\n          </EditorField>\n          <EditorField label=\"Format\">\n            <Select\n              data-testid={selectors.components.DataSource.Prometheus.queryEditor.format}\n              value={formatOption}\n              allowCustomValue\n              onChange={onChangeFormat}\n              options={FORMAT_OPTIONS}\n            />\n          </EditorField>\n          <EditorField label=\"Type\" data-testid={selectors.components.DataSource.Prometheus.queryEditor.type}>\n            <RadioButtonGroup options={queryTypeOptions} value={queryTypeValue} onChange={onQueryTypeChange} />\n          </EditorField>\n          {shouldShowExemplarSwitch(query, app) && (\n            <EditorField label=\"Exemplars\">\n              <EditorSwitch\n                value={query.exemplar || false}\n                onChange={onExemplarChange}\n                id={selectors.components.DataSource.Prometheus.queryEditor.exemplars}\n              />\n            </EditorField>\n          )}\n          {query.intervalFactor && query.intervalFactor > 1 && (\n            <EditorField label=\"Resolution\">\n              <Select\n                aria-label=\"Select resolution\"\n                isSearchable={false}\n                options={INTERVAL_FACTOR_OPTIONS}\n                onChange={onIntervalFactorChange}\n                value={INTERVAL_FACTOR_OPTIONS.find((option) => option.value === query.intervalFactor)}\n              />\n            </EditorField>\n          )}\n        </QueryOptionGroup>\n      </div>\n    </EditorRow>\n  );\n});\n\nfunction shouldShowExemplarSwitch(query: PromQuery, app?: CoreApp) {\n  if (app === CoreApp.UnifiedAlerting || !query.range) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction getQueryTypeValue(query: PromQuery) {\n  return query.range && query.instant ? 'both' : query.instant ? 'instant' : 'range';\n}\n\nfunction getCollapsedInfo(query: PromQuery, formatOption: string, queryType: string, app?: CoreApp): string[] {\n  const items: string[] = [];\n\n  items.push(`Legend: ${getLegendModeLabel(query.legendFormat)}`);\n  items.push(`Format: ${formatOption}`);\n  items.push(`Step: ${query.interval ?? 'auto'}`);\n  items.push(`Type: ${queryType}`);\n\n  if (shouldShowExemplarSwitch(query, app)) {\n    if (query.exemplar) {\n      items.push(`Exemplars: true`);\n    } else {\n      items.push(`Exemplars: false`);\n    }\n  }\n  return items;\n}\n\nPromQueryBuilderOptions.displayName = 'PromQueryBuilderOptions';\n","import { isEqual, map } from 'lodash';\nimport React, { SyntheticEvent, useCallback, useEffect, useState } from 'react';\n\nimport { CoreApp, LoadingState, SelectableValue } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { EditorHeader, EditorRows, FlexItem } from '@grafana/experimental';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Button, ConfirmModal, Space } from '@grafana/ui';\n\nimport { PromQueryEditorProps } from '../../components/types';\nimport { PromQueryFormat } from '../../dataquery.gen';\nimport { PromQuery } from '../../types';\nimport { QueryPatternsModal } from '../QueryPatternsModal';\nimport { promQueryEditorExplainKey, useFlag } from '../hooks/useFlag';\nimport { buildVisualQueryFromString } from '../parsing';\nimport { QueryEditorModeToggle } from '../shared/QueryEditorModeToggle';\nimport { QueryHeaderSwitch } from '../shared/QueryHeaderSwitch';\nimport { QueryEditorMode } from '../shared/types';\nimport { changeEditorMode, getQueryWithDefaults } from '../state';\n\nimport { PromQueryBuilderContainer } from './PromQueryBuilderContainer';\nimport { PromQueryBuilderOptions } from './PromQueryBuilderOptions';\nimport { PromQueryCodeEditor } from './PromQueryCodeEditor';\n\nexport const FORMAT_OPTIONS: Array<SelectableValue<PromQueryFormat>> = [\n  { label: 'Time series', value: 'time_series' },\n  { label: 'Table', value: 'table' },\n  { label: 'Heatmap', value: 'heatmap' },\n];\n\nexport const INTERVAL_FACTOR_OPTIONS: Array<SelectableValue<number>> = map([1, 2, 3, 4, 5, 10], (value: number) => ({\n  value,\n  label: '1/' + value,\n}));\n\ntype Props = PromQueryEditorProps;\n\nexport const PromQueryEditorSelector = React.memo<Props>((props) => {\n  const {\n    onChange,\n    onRunQuery,\n    data,\n    app,\n    onAddQuery,\n    datasource: { defaultEditor },\n    queries,\n  } = props;\n\n  const [parseModalOpen, setParseModalOpen] = useState(false);\n  const [queryPatternsModalOpen, setQueryPatternsModalOpen] = useState(false);\n  const [dataIsStale, setDataIsStale] = useState(false);\n  const { flag: explain, setFlag: setExplain } = useFlag(promQueryEditorExplainKey);\n\n  const query = getQueryWithDefaults(props.query, app, defaultEditor);\n  // This should be filled in from the defaults by now.\n  const editorMode = query.editorMode!;\n\n  const onEditorModeChange = useCallback(\n    (newMetricEditorMode: QueryEditorMode) => {\n      reportInteraction('user_grafana_prometheus_editor_mode_clicked', {\n        newEditor: newMetricEditorMode,\n        previousEditor: query.editorMode ?? '',\n        newQuery: !query.expr,\n        app: app ?? '',\n      });\n\n      if (newMetricEditorMode === QueryEditorMode.Builder) {\n        const result = buildVisualQueryFromString(query.expr || '');\n        // If there are errors, give user a chance to decide if they want to go to builder as that can lose some data.\n        if (result.errors.length) {\n          setParseModalOpen(true);\n          return;\n        }\n      }\n      changeEditorMode(query, newMetricEditorMode, onChange);\n    },\n    [onChange, query, app]\n  );\n\n  useEffect(() => {\n    setDataIsStale(false);\n  }, [data]);\n\n  const onChangeInternal = (query: PromQuery) => {\n    if (!isEqual(query, props.query)) {\n      setDataIsStale(true);\n    }\n    onChange(query);\n  };\n\n  const onShowExplainChange = (e: SyntheticEvent<HTMLInputElement>) => {\n    setExplain(e.currentTarget.checked);\n  };\n\n  return (\n    <>\n      <ConfirmModal\n        isOpen={parseModalOpen}\n        title=\"Parsing error: Switch to the builder mode?\"\n        body=\"There is a syntax error, or the query structure cannot be visualized when switching to the builder mode. Parts of the query may be lost. \"\n        confirmText=\"Continue\"\n        onConfirm={() => {\n          changeEditorMode(query, QueryEditorMode.Builder, onChange);\n          setParseModalOpen(false);\n        }}\n        onDismiss={() => setParseModalOpen(false)}\n      />\n      <QueryPatternsModal\n        isOpen={queryPatternsModalOpen}\n        onClose={() => setQueryPatternsModalOpen(false)}\n        query={query}\n        queries={queries}\n        app={app}\n        onChange={onChange}\n        onAddQuery={onAddQuery}\n      />\n      <EditorHeader>\n        <Button\n          data-testid={selectors.components.QueryBuilder.queryPatterns}\n          variant=\"secondary\"\n          size=\"sm\"\n          onClick={() => setQueryPatternsModalOpen((prevValue) => !prevValue)}\n        >\n          Kick start your query\n        </Button>\n        <div data-testid={selectors.components.DataSource.Prometheus.queryEditor.explain}>\n          <QueryHeaderSwitch label=\"Explain\" value={explain} onChange={onShowExplainChange} />\n        </div>\n        <FlexItem grow={1} />\n        {app !== CoreApp.Explore && app !== CoreApp.Correlations && (\n          <Button\n            variant={dataIsStale ? 'primary' : 'secondary'}\n            size=\"sm\"\n            onClick={onRunQuery}\n            icon={data?.state === LoadingState.Loading ? 'spinner' : undefined}\n            disabled={data?.state === LoadingState.Loading}\n          >\n            Run queries\n          </Button>\n        )}\n        <div data-testid={selectors.components.DataSource.Prometheus.queryEditor.editorToggle}>\n          <QueryEditorModeToggle mode={editorMode} onChange={onEditorModeChange} />\n        </div>\n      </EditorHeader>\n      <Space v={0.5} />\n      <EditorRows>\n        {editorMode === QueryEditorMode.Code && (\n          <PromQueryCodeEditor {...props} query={query} showExplain={explain} onChange={onChangeInternal} />\n        )}\n        {editorMode === QueryEditorMode.Builder && (\n          <PromQueryBuilderContainer\n            query={query}\n            datasource={props.datasource}\n            onChange={onChangeInternal}\n            onRunQuery={props.onRunQuery}\n            data={data}\n            showExplain={explain}\n          />\n        )}\n        <PromQueryBuilderOptions query={query} app={props.app} onChange={onChange} onRunQuery={onRunQuery} />\n      </EditorRows>\n    </>\n  );\n});\n\nPromQueryEditorSelector.displayName = 'PromQueryEditorSelector';\n","import React from 'react';\n\nimport PromQueryField from './PromQueryField';\nimport { PromQueryEditorProps } from './types';\n\nexport function PromQueryEditorForAlerting(props: PromQueryEditorProps) {\n  const { datasource, query, range, data, onChange, onRunQuery } = props;\n\n  return (\n    <PromQueryField\n      datasource={datasource}\n      query={query}\n      onRunQuery={onRunQuery}\n      onChange={onChange}\n      history={[]}\n      range={range}\n      data={data}\n      data-testid={testIds.editor}\n    />\n  );\n}\n\nexport const testIds = {\n  editor: 'prom-editor-cloud-alerting',\n};\n","import React, { memo } from 'react';\n\nimport { CoreApp } from '@grafana/data';\n\nimport { PromQueryEditorSelector } from '../querybuilder/components/PromQueryEditorSelector';\n\nimport { PromQueryEditorForAlerting } from './PromQueryEditorForAlerting';\nimport { PromQueryEditorProps } from './types';\n\nexport function PromQueryEditorByApp(props: PromQueryEditorProps) {\n  const { app } = props;\n\n  switch (app) {\n    case CoreApp.CloudAlerting:\n      return <PromQueryEditorForAlerting {...props} />;\n    default:\n      return <PromQueryEditorSelector {...props} />;\n  }\n}\n\nexport default memo(PromQueryEditorByApp);\n","import { DataSourcePlugin } from '@grafana/data';\n\nimport PromCheatSheet from './components/PromCheatSheet';\nimport PromQueryEditorByApp from './components/PromQueryEditorByApp';\nimport { ConfigEditor } from './configuration/ConfigEditor';\nimport { PrometheusDatasource } from './datasource';\n\nexport const plugin = new DataSourcePlugin(PrometheusDatasource)\n  .setQueryEditor(PromQueryEditorByApp)\n  .setConfigEditor(ConfigEditor)\n  .setQueryEditorHelp(PromCheatSheet);\n"],"names":["EditorHeader","children","styles","getStyles","theme","FlexItem","grow","shrink","CHEAT_SHEET_ITEMS","props","item","index","e","QueryPattern","pattern","onPatternSelect","hasNewQueryOption","hasPreviousQuery","selectedPatternName","setSelectedPatternName","lang","promql","Card","RawQuery","Button","QueryPatternsModal","isOpen","onClose","onChange","onAddQuery","query","queries","app","openTabs","setOpenTabs","visualQuery","hasOperations","hasMetric","hasLabels","hasBinaryQueries","selectAsNewQuery","Modal","patternType","Collapse","tabs","t","promQueryEditorExplainKey","getFlagValue","key","defaultValue","val","store","setFlagValue","value","useFlag","flag","updateFlag","setter","editorModes","QueryEditorModeToggle","mode","RadioButtonGroup","QueryHeaderSwitch","label","inputProps","dashedLabel","switchIdRef","Stack","Switch","queryEditorModeDefaultLocalStorageKey","changeEditorMode","editorMode","getDefaultEditorMode","expr","defaultEditor","getQueryWithDefaults","result","isBothInstantAndRange","OperationInfoButton","def","operation","show","setShow","middleware","context","refs","floatingStyles","click","dismiss","getReferenceProps","getFloatingProps","Portal","getOperationDocs","op","OperationHeader","onRemove","queryModeller","dragHandleProps","state","setState","onToggleSwitcher","alternatives","alt","Select","newDef","newParams","i","changedOp","getOperationParamEditor","paramDef","SelectInputParamEditor","BoolInputParamEditor","SimpleInputParamEditor","AutoSizeInput","evt","Checkbox","operationId","selectOptions","option","valueOption","x","OperationEditor","onRunQuery","datasource","flash","highlight","timeRange","shouldFlash","useFlash","id","isConflicting","onParamValueChanged","paramIdx","update","callParamChangedThenOnChange","onAddRestParam","onRemoveRestParam","operationElements","paramIndex","Editor","Tooltip","Icon","restParam","lastParamDef","renderAddRestParamButton","isInvalid","isDragging","provided","snapshot","InlineField","keepFlash","setKeepFlash","operationIndex","OperationList","highlightedOp","operations","opsToHighlight","useOperationsHighlight","cascaderOpen","setCascaderOpen","onOperationChange","updatedList","addOptions","category","onAddOperation","operationDef","onDragEnd","element","onCascaderBlur","Cascader","isMounted","useMountedState","prevOperations","usePrevious","newOps","newOp","isSameOp","op1","op2","QueryBuilderHints","data","buildVisualQueryFromString","hints","setHints","hint","newQuery","newVisualQuery","NestedQuery","nestedQuery","showExplain","operators","IconButton","EditorRows","PromQueryBuilder","NestedQueryList","nestedQueries","onNestedQueryUpdate","suggestionOptions","explationOptions","QuerySuggestionItem","querySuggestion","order","queryExplain","historical","closeDrawer","last","allSuggestions","prompt","showExp","updShowExp","gaveExplanationFeedback","updateGaveExplanationFeedback","gaveSuggestionFeedback","updateGaveSuggestionFeedback","suggestionFeedback","setSuggestionFeedback","explanationFeedback","setExplanationFeedback","explanation","feedbackToggleTip","type","updateRadioFeedback","updateTextFeedback","disabledButton","questionOne","RadioButtonList","TextArea","explanationFeedbackEvent","suggestionFeedbackEvent","pvq","Spinner","Toggletip","radioInputFeedback","textFeedback","event","SuggestionType","QuerySuggestionContainer","suggestionType","querySuggestions","nextInteraction","hasNextInteraction","updateHasNextInteraction","text","secondaryText","refineText","qs","idx","acc","testIds","search","request","loggedWarning","health","response","details","enabled","healthDetails","ExplainSystemPrompt","GetExplainUserPrompt","documentation","metricName","metricType","metricMetadata","SuggestSystemPrompt","GetSuggestUserPrompt","question","labels","templates","stateSlice","initialState","action","interaction","createInteraction","interactions","updInteraction","showStartingMessage","isLoading","generalTemplates","counterTemplates","histogramTemplates","gaugeTemplates","processTemplate","templateData","metric","getTemplateSuggestions","templateSuggestions","OPENAI_MODEL_NAME","promQLTemplatesCollection","updateInteraction","getExplainMessage","documentationBody","title","body","getSuggestMessages","promQailExplain","dispatch","suggIdx","suggestedQuery","promptMessages","interactionToUpdate","updatedSuggestions","sg","sidx","payload","isContainedIn","sublist","superlist","guessMetricType","allMetrics","underscoreIndex","root","suffix","familyMetrics","generateMetricTypeFilters","types","guessMetricFamily","isLLMPluginEnabled","openaiEnabled","vectorEnabled","results","promQailSuggest","labelNames","metricFamilyGuess","resolve","suggestions","metricLabels","feedTheAI","resultsString","r","indicateCheckbox","addInteraction","SKIP_STARTING_MESSAGE","PromQail","skipStartingMessage","setLabelNames","int","responsesEndRef","scrollToBottom","labelsIndex","AI_Logo_color","Alert","Input","newInteraction","QueryAssistantButton","llmAppEnabled","setShowDrawer","llmAppDisabled","noMetricSelected","button","selectors","selectMetricMessage","llmAppMessage","prometheusPromQAIL","config","setHighlightedOp","showDrawer","updateLlmAppEnabled","initHints","checkLlms","check","Drawer","EditorRow","MetricsLabelsSection","OperationExplainedBox","OperationsEditorRow","OperationListExplained","QueryPreview","EditorFieldGroup","prometheusMetricEncyclopedia","PromQueryBuilderContainer","exprChanged","setMetricsModalSettings","onVisQueryChange","visQuery","visualQueryChange","metricsModalSettings","parseResult","PromExemplarField","rest","error","setError","prevError","iconButtonStyles","InlineLabel","PromExploreExtraField","rangeOptions","getQueryTypeOptions","prevQuery","onExemplarChange","exemplar","onChangeQueryStep","interval","onStepChange","onReturnKeyDown","onQueryTypeChange","getQueryTypeChangeHandler","includeBoth","queryType","QueryOptionGroup","collapsedInfo","queryStats","toggleOpen","useToggle","generateQueryStats","convertUnits","legendModeOptions","PromQueryLegendEditor","legendFormat","getLegendMode","inputRef","onLegendFormatChanged","newFormat","onLegendModeChanged","EditorField","getLegendModeLabel","PromQueryBuilderOptions","onChangeFormat","onChangeStep","queryTypeOptions","isEnabled","onIntervalFactorChange","formatOption","FORMAT_OPTIONS","queryTypeValue","getQueryTypeValue","queryTypeLabel","getCollapsedInfo","shouldShowExemplarSwitch","EditorSwitch","INTERVAL_FACTOR_OPTIONS","items","PromQueryEditorSelector","parseModalOpen","setParseModalOpen","queryPatternsModalOpen","setQueryPatternsModalOpen","dataIsStale","setDataIsStale","explain","setExplain","onEditorModeChange","newMetricEditorMode","onChangeInternal","onShowExplainChange","ConfirmModal","prevValue","Space","PromQueryCodeEditor","PromQueryEditorForAlerting","range","PromQueryField","PromQueryEditorByApp","ConfigEditor"],"sourceRoot":""}