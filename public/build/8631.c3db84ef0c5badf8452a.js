"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8631],{39592:(de,F,o)=>{o.d(F,{a:()=>_});var y=o(31733),O=o(76932),L=o(41164),s=o(98572),I=o(64516),Q=o(98463),$=Object.defineProperty,S=Object.defineProperties,x=Object.getOwnPropertyDescriptors,A=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,T=(b,g,N)=>g in b?$(b,g,{enumerable:!0,configurable:!0,writable:!0,value:N}):b[g]=N,v=(b,g)=>{for(var N in g||(g={}))j.call(g,N)&&T(b,N,g[N]);if(A)for(var N of A(g))R.call(g,N)&&T(b,N,g[N]);return b},E=(b,g)=>S(b,x(g));const _=({config:b,onChange:g,className:N})=>{const se=Z=>{g(E(v({},b),{jsonData:E(v({},b.jsonData),{keepCookies:Z})}))},z=Z=>{g(E(v({},b),{jsonData:E(v({},b.jsonData),{timeout:parseInt(Z.currentTarget.value,10)})}))},V={container:(0,O.css)({maxWidth:578})};return y.createElement(Q._,{title:"Advanced HTTP settings",className:(0,O.cx)(V.container,N)},y.createElement(L._,{htmlFor:"advanced-http-cookies",label:"Allowed cookies",labelWidth:24,tooltip:"Grafana proxy deletes forwarded cookies by default. Specify cookies by name that should be forwarded to the data source.",disabled:b.readOnly,grow:!0},y.createElement(s.B,{id:"advanced-http-cookies",placeholder:"New cookie (hit enter to add)",tags:b.jsonData.keepCookies,onChange:se})),y.createElement(L._,{htmlFor:"advanced-http-timeout",label:"Timeout",labelWidth:24,tooltip:"HTTP request timeout in seconds",disabled:b.readOnly,grow:!0},y.createElement(I.I,{id:"advanced-http-timeout",type:"number",min:0,placeholder:"Timeout in seconds","aria-label":"Timeout in seconds",value:b.jsonData.timeout,onChange:z})))}},84655:(de,F,o)=>{o.d(F,{i:()=>s});var y=o(76932),O=o(31733),L=o(76067);const s=({hideLine:Q=!1})=>{const $=(0,L.wW)(I);return Q?O.createElement("hr",{className:$.dividerHideLine}):O.createElement("hr",{className:$.divider})},I=Q=>({divider:(0,y.css)({margin:Q.spacing(4,0)}),dividerHideLine:(0,y.css)({border:"none",margin:Q.spacing(3,0)})})},36662:(de,F,o)=>{o.d(F,{I:()=>j});var y=o(76932),O=o(31733),L=o(44992),s=o(98463),I=o(76067),Q=o(47701),$=o(41164),S=o(76772),x=o(5936);function A({options:T,onOptionsChange:v}){const E=(0,I.wW)(R);return O.createElement("div",{className:E.container},O.createElement(Q.Z,{className:E.row},O.createElement($._,{tooltip:"Displays the node graph above the trace view. Default: disabled",label:"Enable node graph",labelWidth:26},O.createElement(S.x,{id:"enableNodeGraph",value:T.jsonData.nodeGraph?.enabled,onChange:_=>(0,L.tp)({onOptionsChange:v,options:T},"nodeGraph",{...T.jsonData.nodeGraph,enabled:_.currentTarget.checked})}))))}const j=({options:T,onOptionsChange:v})=>{let E=T.type;return E+=T.type==="tempo"?"/configure-tempo-data-source/#node-graph":"/#node-graph",O.createElement(s._,{title:"Node graph",description:O.createElement(x.W,{description:"Show or hide the node graph visualization.",suffix:E,feature:"the node graph"})},O.createElement(A,{options:T,onOptionsChange:v}))},R=T=>({infoText:(0,y.css)({label:"infoText",paddingBottom:T.spacing(2),color:T.colors.text.secondary}),container:(0,y.css)({label:"container",width:"100%"}),row:(0,y.css)({label:"row",alignItems:"baseline"})})},46898:(de,F,o)=>{o.d(F,{Y:()=>_});var y=o(76932),O=o(31733),L=o(44992),s=o(83717),I=o(76067),Q=o(47701),$=o(41164),S=o(51343),x=o(64516),A=o(79228),j=o(5936),R=o(4200),T=o(69256),v=o(42302);function E({options:g,onOptionsChange:N}){const se=(0,I.wW)(b);return O.createElement("div",{className:(0,y.css)({width:"100%"})},O.createElement(Q.Z,{className:se.row},O.createElement($._,{tooltip:"The Prometheus data source the trace is going to navigate to",label:"Data source",labelWidth:26},O.createElement(A.q,{inputId:"trace-to-metrics-data-source-picker",pluginId:"prometheus",current:g.jsonData.tracesToMetrics?.datasourceUid,noDefault:!0,width:40,onChange:z=>(0,L.tp)({onOptionsChange:N,options:g},"tracesToMetrics",{...g.jsonData.tracesToMetrics,datasourceUid:z.uid})})),g.jsonData.tracesToMetrics?.datasourceUid?O.createElement(S.zx,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,L.tp)({onOptionsChange:N,options:g},"tracesToMetrics",{...g.jsonData.tracesToMetrics,datasourceUid:void 0})}},"Clear"):null),O.createElement(Q.Z,null,O.createElement(R.w,{label:(0,v.mH)("start"),tooltip:(0,v.rr)("start","-2m"),value:g.jsonData.tracesToMetrics?.spanStartTimeShift||"",onChange:z=>{(0,L.tp)({onOptionsChange:N,options:g},"tracesToMetrics",{...g.jsonData.tracesToMetrics,spanStartTimeShift:z})},placeholder:"-2m",isInvalidError:v.Ny})),O.createElement(Q.Z,null,O.createElement(R.w,{label:(0,v.mH)("end"),tooltip:(0,v.rr)("end","2m"),value:g.jsonData.tracesToMetrics?.spanEndTimeShift||"",onChange:z=>{(0,L.tp)({onOptionsChange:N,options:g},"tracesToMetrics",{...g.jsonData.tracesToMetrics,spanEndTimeShift:z})},placeholder:"2m",isInvalidError:v.Ny})),O.createElement(Q.Z,null,O.createElement($._,{tooltip:"Tags that will be used in the metrics query",label:"Tags",labelWidth:26},O.createElement(T.a,{values:g.jsonData.tracesToMetrics?.tags??[],onChange:z=>(0,L.tp)({onOptionsChange:N,options:g},"tracesToMetrics",{...g.jsonData.tracesToMetrics,tags:z})}))),g.jsonData.tracesToMetrics?.queries?.map((z,V)=>O.createElement("div",{key:V,className:se.queryRow},O.createElement($._,{label:"Link Label",labelWidth:26,tooltip:"Descriptive label for the linked query"},O.createElement(x.I,{label:"Link Label",type:"text",allowFullScreen:!0,value:z.name,width:40,onChange:Z=>{const be=(g.jsonData.tracesToMetrics?.queries??[]).map((ie,ce)=>ce===V?{...ie,name:Z.currentTarget.value}:ie);(0,L.tp)({onOptionsChange:N,options:g},"tracesToMetrics",{...g.jsonData.tracesToMetrics,queries:be})}})),O.createElement($._,{label:"Query",labelWidth:10,tooltip:"The Prometheus query that will run when navigating from a trace to metrics. Interpolate tags using the `$__tags` keyword",grow:!0},O.createElement(x.I,{label:"Query",type:"text",allowFullScreen:!0,value:z.query,onChange:Z=>{const be=(g.jsonData.tracesToMetrics?.queries??[]).map((ie,ce)=>ce===V?{...ie,query:Z.currentTarget.value}:ie);(0,L.tp)({onOptionsChange:N,options:g},"tracesToMetrics",{...g.jsonData.tracesToMetrics,queries:be})}})),O.createElement(S.zx,{variant:"destructive",title:"Remove query",icon:"times",type:"button",onClick:()=>{const Z=g.jsonData.tracesToMetrics?.queries.filter((be,ie)=>ie!==V);(0,L.tp)({onOptionsChange:N,options:g},"tracesToMetrics",{...g.jsonData.tracesToMetrics,queries:Z})}}))),O.createElement(S.zx,{variant:"secondary",title:"Add query",icon:"plus",type:"button",onClick:()=>{(0,L.tp)({onOptionsChange:N,options:g},"tracesToMetrics",{...g.jsonData.tracesToMetrics,queries:[...g.jsonData.tracesToMetrics?.queries??[],{query:""}]})}},"Add query"))}const _=({options:g,onOptionsChange:N})=>{let se=g.type;return se+=g.type==="tempo"?"/configure-tempo-data-source/#trace-to-metrics":"/#trace-to-metrics",O.createElement(s.K,{title:"Trace to metrics",description:O.createElement(j.W,{description:"Navigate from a trace span to the selected data source's metrics.",suffix:se,feature:"trace to metrics"}),isCollapsible:!0,isInitiallyOpen:!0},O.createElement(E,{options:g,onOptionsChange:N}))},b=g=>({infoText:(0,y.css)`
    padding-bottom: ${g.spacing(2)};
    color: ${g.colors.text.secondary};
  `,row:(0,y.css)`
    label: row;
    align-items: baseline;
  `,queryRow:(0,y.css)`
    label: queryRow;
    display: flex;
    flex-flow: wrap;
  `})},96644:(de,F,o)=>{o.d(F,{n:()=>Q});var y=o(31733),O=o(69328);const L=y.lazy(()=>Promise.all([o.e(9207),o.e(8735),o.e(7142)]).then(o.bind(o,74897))),s=$=>y.createElement(y.Suspense,{fallback:null},y.createElement(L,{...$})),I=$=>{const S=(0,y.useRef)(null),{onRunQuery:x,onChange:A,...j}=$,R=v=>{S.current=v,A(v),x()},T=v=>{A(v)};return y.createElement(s,{onRunQuery:R,onBlur:T,onChange:A,...j})};class Q extends y.PureComponent{constructor(S){super(S),this._isMounted=!1,this.onChangeQuery=(x,A)=>{const{query:j,onChange:R,onRunQuery:T}=this.props;if(R){const v={...j,expr:x};R(v),A&&T&&T()}},this.state={labelsLoaded:!1}}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(this.props.range),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(S){const{range:x,datasource:{languageProvider:A}}=this.props;(0,O.rf)(x,S.range)&&A.fetchLabels({timeRange:x})}render(){const{ExtraFieldElement:S,query:x,datasource:A,history:j,onRunQuery:R,range:T}=this.props,v=this.props.placeholder??"Enter a Loki query (run with Shift+Enter)";return y.createElement(y.Fragment,null,y.createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"]},y.createElement("div",{className:"gf-form--grow flex-shrink-1 min-width-15"},y.createElement(I,{datasource:A,history:j??[],onChange:this.onChangeQuery,onRunQuery:R,initialValue:x.expr??"",placeholder:v,timeRange:T}))),S)}}},69328:(de,F,o)=>{o.d(F,{Hk:()=>A,U9:()=>$,_z:()=>j,aC:()=>R,iS:()=>S,k:()=>T,rf:()=>s,tU:()=>x});var y=o(76621);function O(v){return L(v/1e3)}function L(v){return Math.floor(v/60)}function s(v,E){if(v&&E){const _=O(v.from.valueOf())===O(E.from.valueOf()),b=O(v.to.valueOf())===O(E.to.valueOf());return!(_&&b)}return!1}const I=/[*+?()|\\.\[\]{}^$]/g;function Q(v){return v.replace(I,"\\$&")}function $(v){return v.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function S(v){return v.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function x(v){return $(Q(v))}function A(v,E){return j(E)?x(v):$(v)}function j(v){return!!(v&&(v.includes("=~")||v.includes("!~")))}function R(v){const E=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],_=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${E.join("|")})$`);return!!v.match(_)}function T(v,E,_){if(!E||_===void 0)return null;const b=E.fields.find(g=>g.name==="labelTypes")?.values[_];if(!b)return null;switch(b[v]){case"I":return y.JG.Indexed;case"S":return y.JG.StructuredMetadata;case"P":return y.JG.Parsed;default:return null}}},76621:(de,F,o)=>{o.d(F,{JG:()=>Q,sb:()=>s,EM:()=>O,Z3:()=>$,$o:()=>L});var y=(S=>(S.Builder="builder",S.Code="code",S))(y||{}),O=(S=>(S.Instant="instant",S.Range="range",S.Stream="stream",S))(O||{}),L=(S=>(S.DataSample="dataSample",S.LogsSample="logsSample",S.LogsVolume="logsVolume",S))(L||{}),s=(S=>(S.Backward="backward",S.Forward="forward",S))(s||{}),I=(S=>(S.Stream="streams",S.Vector="vector",S.Matrix="matrix",S))(I||{}),Q=(S=>(S.Indexed="I",S.StructuredMetadata="S",S.Parsed="P",S))(Q||{}),$=(S=>(S[S.LabelNames=0]="LabelNames",S[S.LabelValues=1]="LabelValues",S))($||{})},46675:(de,F,o)=>{o.d(F,{d:()=>j});var y=o(76932),O=o(31733),L=o(83870),s=o(86850),I=o(85498),Q=o(76067),$=o(27218),S=o(37739),x=o(58037),A=o(49311);function j({title:E,children:_,collapsedInfo:b,queryStats:g}){const[N,se]=(0,L.Z)(!1),z=(0,Q.wW)(R);return O.createElement("div",{className:z.wrapper},O.createElement($.U,{className:z.collapse,collapsible:!0,isOpen:N,onToggle:se,label:O.createElement(S.K,{gap:0},O.createElement("h6",{className:z.title},E),!N&&O.createElement("div",{className:z.description},b.map((V,Z)=>O.createElement("span",{key:Z},V))))},O.createElement("div",{className:z.body},_)),g&&I.config.featureToggles.lokiQuerySplitting&&O.createElement(x.u,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part."},O.createElement(A.J,{tabIndex:0,name:"info-circle",className:z.tooltip,size:"sm"})),g&&O.createElement("p",{className:z.stats},T(g)))}const R=E=>({collapse:(0,y.css)({backgroundColor:"unset",border:"unset",marginBottom:0,["> button"]:{padding:E.spacing(0,1)}}),wrapper:(0,y.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,y.css)({flexGrow:1,overflow:"hidden",fontSize:E.typography.bodySmall.fontSize,fontWeight:E.typography.fontWeightMedium,margin:0}),description:(0,y.css)({color:E.colors.text.secondary,fontSize:E.typography.bodySmall.fontSize,fontWeight:E.typography.bodySmall.fontWeight,paddingLeft:E.spacing(2),gap:E.spacing(2),display:"flex"}),body:(0,y.css)({display:"flex",gap:E.spacing(2),flexWrap:"wrap"}),stats:(0,y.css)({margin:"0px",color:E.colors.text.secondary,fontSize:E.typography.bodySmall.fontSize}),tooltip:(0,y.css)({marginRight:E.spacing(.25)})}),T=E=>E.message?E.message:`This query will process approximately ${v(E)}.`,v=E=>{const{text:_,suffix:b}=(0,s.Cf)("bytes")(E.bytes,1);return _+b}},8631:(de,F,o)=>{o.r(F),o.d(F,{plugin:()=>zs});var y=o(51023),O=o(93670),L=o(1727),s=o(31733),I=o(64704),Q=o(85498),$=o(94746);function S(){return(0,I.ff)("grafana_traces_cheatsheet_clicked",{datasourceType:"tempo",grafana_version:Q.config.buildInfo.version}),s.createElement(s.Fragment,null,s.createElement("h2",null,"Tempo Cheat Sheet"),s.createElement("p",null,s.createElement($.h,{href:"https://grafana.com/docs/tempo/latest/",external:!0},"Grafana Tempo")," ","is an open source, easy-to-use, and high-volume distributed tracing backend."),s.createElement("p",null,"Tempo implements"," ",s.createElement($.h,{href:"https://grafana.com/docs/tempo/latest/traceql",external:!0},"TraceQL"),", a traces-first query language inspired by LogQL and PromQL. This query language allows users to precisely and easily select spans and jump directly to the spans fulfilling the specified conditions."),s.createElement("p",null,"You can compose TraceQL queries using either the Search tab (the TraceQL query builder) or the TraceQL tab (the TraceQL query editor). Both of these methods let you build queries and drill-down into result sets. (",s.createElement($.h,{href:"https://grafana.com/docs/grafana/latest/datasources/tempo/query-editor/",external:!0},"Learn more"),")"))}var x=o(76932),A=o(5572),j=o(54679),R=o(47701),T=o(41164),v=o(79106),E=o(96856),_=o(51343),b=o(76067),g=o(2722),N=o(20888),se=o(96644),z=o(66261);const V=(e,t)=>{const a=e?` (${e})`:"";return`${t||"Error"}${a}. Please check the server logs for more details.`};async function Z(e){if(!e)return;const t=(0,z.F)();try{return await t.get(e)}catch(a){console.error("Failed to load data source",a);return}}function be({logsDatasourceUid:e,onChange:t,onRunQuery:a,query:r}){const n=(0,g.Z)(()=>Z(e),[e]);if(n.loading)return null;const l=n.value;return l?s.createElement(s.Fragment,null,s.createElement(N.W,null,"Tempo uses ",l.name," to find traces."),s.createElement(se.n,{datasource:l,onChange:t,onRunQuery:a,query:r.linkedQuery??{refId:"linked"},history:[]})):e?e&&!l?s.createElement("div",{className:"text-warning"},"Loki search datasource is configured but the data source no longer exists. Please configure existing data source to use the search."):null:s.createElement("div",{className:"text-warning"},"Please set up a Loki search datasource in the datasource settings.")}var ie=o(84275),ce=o(16528),Qe=o(69391),Oe=o(61129),ua=o(49596),xe=o(25111),ee=o(38834),Ce=o(64516),Rt=o(7939),ue=o(42876),pe=o(86573),te=o(69781),et=o(71892),k=o(86457),tt=o(57298),pa=o(27005),wt=o(26722),Dt=o(10790),ae=o(4558),Pe=o(56183),at=o(89582),Ct=o(76372),rt=o(96413),ma=o(74293),ga=o.n(ma),le=o(20298),It=o(17201),Ve=o(74011),fa=o(91977),ha=o(44343),re=o(85666),Oa=o(65821),Ie=o(71199),Ue=o(97001),M=o(3236);const va={wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,brackets:[["{","}"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}},Nt=["=","!=",">","<",">=","<=","=~","!~"],Sa=["=","!="],Ta=["=","!=","=~","!~"],ya=["=","!=",">","<",">=","<="],je=["duration","kind","name","rootName","rootServiceName","status","statusMessage","traceDuration"],Mt=["resource","span"],Ea=["avg","min","max","sum","count","by"],$t=je.concat(Mt),ba={ignoreCase:!1,defaultToken:"",tokenPostfix:".traceql",keywords:$t,operators:Nt,statusValues:["ok","unset","error","false","true"],functions:Ea,symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,tokenizer:{root:[[/\/\/.*/,"comment"],[/\/\*.*\*\//,"comment"],[/[0-9]+(.[0-9]+)?(us|Âµs|ns|ms|s|m|h)/,"number"],[/^\s*[0-9A-Fa-f]+\s*$/,"tag"],[`(?:${$t.join("|")})`,{cases:{"@keywords":"keyword","@default":"tag"}}],[/(?:\w|^[^{}()=~!<>&|," ]|"(?:\\"|\\\\|[^\\"])*")+/,{cases:{"@functions":"predefined","@statusValues":"type","@default":"tag"}}],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/([^\w])(")/,[{token:""},{token:"string",next:"@string_double"}]],[/([^\w])(')/,[{token:""},{token:"string",next:"@string_single"}]],[/[{}()\[\]]/,"delimiter.bracket"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?[fFdD]?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?[fFdD]?/,"number.float"],[/0(@octaldigits)[Ll]?/,"number.octal"],[/0[bB](@binarydigits)[Ll]?/,"number.binary"],[/(@digits)[fFdD]/,"number.float"],[/(@digits)[lL]?/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]]}},Qa={id:"traceql",extensions:[".traceql"],aliases:["tempo","traceql"],mimetypes:[],def:{language:ba,languageConfiguration:va}},xa={comment:{pattern:/\/\/.*/},"span-set":{pattern:/\{[^}]*}/,inside:{filter:{pattern:/([\w.\/-]+)?(\s*)(([!=+\-<>~]+)\s*("([^"\n&]+)?"?|([^"\n\s&|}]+))?)/g,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-z_.][\w./_-]*(?=\s*(=|!=|>|<|>=|<=|=~|!~))/,alias:"attr-name"},"label-value":{pattern:/("(?:\\.|[^\\"])*")|(\w+)/,alias:"attr-value"}}},punctuation:/[}{&|]/}},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,operator:new RegExp("/[-+*/=%^~]|&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?|","i"),punctuation:/[{};()`,.]/},Re=e=>`{${e.filter(t=>t.tag&&t.operator&&t.value?.length).map(t=>`${Lt(t)}${Ra(t,e)}${t.operator}${Pa(t)}`).join(" && ")}}`,Pa=e=>Array.isArray(e.value)&&e.value.length>1?`"${e.value.join("|")}"`:e.valueType==="string"?`"${e.value}"`:e.value,Lt=e=>je.find(t=>t===e.tag)?"":(e.scope===M.NM.Resource||e.scope===M.NM.Span?e.scope?.toLowerCase():"")+".",Ra=(e,t)=>{if(e.tag==="duration"){const a=t.find(r=>r.id==="duration-type");return a?a.value==="trace"?"traceDuration":"duration":e.tag}return e.tag},st=e=>Lt(e)+e.tag,wa=e=>e.tag==="name"?"Span Name":e.tag==="service.name"&&e.scope===M.NM.Resource?"Service Name":(0,te.startCase)(st(e)),Da=(e,t)=>[...je,...e].filter(a=>!t.includes(a)),Fe=e=>(0,te.uniq)(e.map(t=>t.name&&t.name!=="intrinsic"&&t.tags?t.tags:[]).flat()),Ca=e=>(0,te.uniq)(e.map(t=>t.tags?t.tags:[]).flat()),nt=(e,t)=>(0,te.uniq)(e.map(a=>a.name&&a.name===t&&a.tags?a.tags:[]).flat());function it(e,t,a){const r=e.slice(0);return r[t]=a,r}const zt=e=>{const t={label:e,value:e};switch(e){case"=":t.description="Equals";break;case"!=":t.description="Not equals";break;case">":t.description="Greater";break;case">=":t.description="Greater or Equal";break;case"<":t.description="Less";break;case"<=":t.description="Less or Equal";break;case"=~":t.description="Matches regex";break;case"!~":t.description="Does not match regex";break}return t};var lt=(e=>(e[e.LabelNames=0]="LabelNames",e[e.LabelValues=1]="LabelValues",e))(lt||{});const Ia=[{label:"Label names",value:0},{label:"Label values",value:1}],ot="TempoDatasourceVariableQueryEditor-VariableQuery",Na=({onChange:e,query:t,datasource:a})=>{const[r,n]=(0,s.useState)(t.label||""),[l,i]=(0,s.useState)(t.type),[d,c]=(0,s.useState)([]);(0,s.useEffect)(()=>{l===1&&a.labelNamesQuery().then(h=>{c(h.map(({text:f})=>({label:f,value:f})))})},[a,t,l]);const u=h=>{i(h.value),h.value!==void 0&&e({type:h.value,label:r,refId:ot})},m=h=>{const f=h.value||"";n(f),l!==void 0&&e({type:l,label:f,refId:ot})},p=()=>{l!==void 0&&e({type:l,label:r,refId:ot})};return s.createElement(s.Fragment,null,s.createElement(R.Z,null,s.createElement(T._,{label:"Query type",labelWidth:20},s.createElement(ee.Ph,{"aria-label":"Query type",onChange:u,onBlur:p,value:l,options:Ia,width:32}))),l===1&&s.createElement(R.Z,null,s.createElement(T._,{label:"Label",labelWidth:20},s.createElement(ee.Ph,{"aria-label":"Label",onChange:m,onBlur:p,value:{label:r,value:r},options:d,width:32,allowCustomValue:!0}))))};var K=o(19536);class At extends y.iL{constructor(t,a){super(),this.request=async(r,n={})=>(await this.datasource.metadataRequest(r,n))?.data,this.start=async()=>(this.startTask||(this.startTask=this.fetchTags().then(()=>[])),this.startTask),this.setV1Tags=r=>{this.tagsV1=r},this.setV2Tags=r=>{this.tagsV2=r},this.getTags=r=>this.tagsV2&&r?r===M.NM.Unscoped?Fe(this.tagsV2):nt(this.tagsV2,r):this.tagsV1?(this.tagsV1.find(n=>n==="status")||this.tagsV1.push("status"),this.tagsV1):[],this.getMetricsSummaryTags=r=>this.tagsV2&&r?r===M.NM.Unscoped?Fe(this.tagsV2):nt(this.tagsV2,r):this.tagsV1?this.tagsV1:[],this.getTraceqlAutocompleteTags=r=>{if(this.tagsV2){if(r){if(r===M.NM.Unscoped)return Fe(this.tagsV2)}else return Fe(this.tagsV2);return nt(this.tagsV2,r)}else if(this.tagsV1)return this.tagsV1.find(n=>n==="status")||this.tagsV1.push("status"),this.tagsV1;return[]},this.getAutocompleteTags=()=>this.tagsV2?Ca(this.tagsV2):this.tagsV1?(this.tagsV1.find(r=>r==="status.code")||this.tagsV1.push("status.code"),this.tagsV1):[],this.encodeTag=r=>encodeURIComponent(encodeURIComponent(r)),this.datasource=t,Object.assign(this,a)}async fetchTags(){let t,a;try{a=await this.request("/api/v2/search/tags",[])}catch{t=await this.request("/api/search/tags",[])}a&&a.scopes?this.setV2Tags(a.scopes):t&&this.setV1Tags(t.tagNames)}async getOptionsV1(t){const a=this.encodeTag(t),r=await this.request(`/api/search/tag/${a}/values`);let n=[];return r&&r.tagValues&&(n=r.tagValues.map(l=>({value:l,label:l}))),n}async getOptionsV2(t,a){const r=this.encodeTag(t),n=await this.request(`/api/v2/search/tag/${r}/values`,a?{q:a}:{});let l=[];return n&&n.tagValues&&n.tagValues.forEach(i=>{i.value&&l.push({type:i.type,value:i.value,label:i.value})}),l}}var _t=o(98147),Ma=o(47862);function $a(e,t,a){let r;if(!e.length)return Ne;const n={};e.forEach(i=>{const d=za(i.series,t);i.series.forEach(c=>{n[c.key]={name:`${c.key}`,type:re.fS.string,config:Aa(c,d,a),values:[]}})}),r=(0,_t.at)({name:"Metrics Summary",refId:"metrics-summary",fields:[...Object.values(n).sort((i,d)=>i.name.localeCompare(d.name)),{name:"kind",type:re.fS.string,config:{displayNameFromDS:"Kind",custom:{width:150}}},{name:"spanCount",type:re.fS.number,config:{displayNameFromDS:"Span count",custom:{width:150}}},{name:"errorPercentage",type:re.fS.number,config:{displayNameFromDS:"Error",unit:"percent",custom:{width:150}}},Xe("p50"),Xe("p90"),Xe("p95"),Xe("p99")],meta:{preferredVisualisationType:"table"}});const l=e.map(La);r.length=l.length;for(const i of l)for(const d of r.fields)d.values.push(i[d.name]);return r=(0,_t.aK)(r,0),[r]}const La=e=>{const t=e.errorSpanCount?ve(e.errorSpanCount)/ve(e.spanCount)*100:"0%",a={kind:"server",spanCount:ve(e.spanCount),errorPercentage:t,p50:ve(e.p50),p90:ve(e.p90),p95:ve(e.p95),p99:ve(e.p99)};return e.series.forEach(r=>{a[`${r.key}`]=_a(r)||""}),a},za=(e,t)=>{const a=e.map(l=>{const i=l.value.type===3||l.value.type===4,d=l.value.type===8||l.value.type===9,c=i||d?"":'"';return`${l.key}=${c}\${__data.fields["`+l.key+`"]}${c}`});let r="";const n=t.indexOf("}");if(n!==-1){const l=t.substring(n+1);r=t.substring(0,n),a.length>0&&(r+=t.replace(/\s/g,"").includes("{}")?"":" && ",r+=`${a.join(" && ")} && kind=server`,r+="}"),r+=`${l}`}else r=`{${a.join(" && ")} && kind=server} | ${t}`;return r},Aa=(e,t,a)=>{const r={displayNameFromDS:e.key,noValue:"<no value>",links:[{title:"Query in explore",url:"",internal:{datasourceUid:a.uid,datasourceName:a.name,query:{query:t,queryType:"traceql"}}}]};return e.value.type===7?{...r,unit:"ns"}:{...r}},Be="",_a=e=>{if(!e.value.type)return Be;switch(e.value.type){case 3:return e.value.n;case 4:return e.value.f;case 5:return e.value.s;case 6:return e.value.b;case 7:return e.value.d;case 8:return Wa(e.value.status);case 9:return Va(e.value.kind);default:return Be}},Wa=e=>{if(!e)return Be;switch(e){case 0:return"error";case 1:return"ok";default:return"unset"}},Va=e=>{if(!e)return Be;switch(e){case 1:return"internal";case 2:return"client";case 3:return"server";case 4:return"producer";case 5:return"consumer";default:return"unspecified"}},Xe=e=>({name:e,type:re.fS.number,config:{displayNameFromDS:e,unit:"ns",custom:{width:150}}}),ve=e=>{const t=parseInt(e,10);return isNaN(t)?0:t},Ne=new Ma.v({name:"Metrics Summary",refId:"metrics-summary",fields:[],meta:{preferredVisualisationType:"table"}});var Se=o(45563),Ua=o(99248),dt=o(79117),ja=o(4230),Fa=o(47423),Ba=o(24035);function Xa(){return(0,dt.Z)()}function ka(e,t,a,r){const n=a.range;let l,i=le.Gu.NotStarted;const d=performance.now();return(0,Ba.gj)().getStream({scope:ja.z.DataSource,namespace:t.uid,path:`search/${Xa()}`,data:{...e,SpansPerSpanSet:e.spss??Me,timeRange:{from:n.from.toISOString(),to:n.to.toISOString()}}}).pipe((0,Ua.o)(c=>{if("message"in c&&c?.message){const u=c.message.data.values[2][0];if(u===M.sY.Done||u===M.sY.Error)return!1}return!0},!0)).pipe((0,ae.U)(c=>{if("message"in c&&c?.message){const m=performance.now()-d,p=c.message.data.values[0][0],h=c.message.data.values[1][0],f=c.message.data.values[2][0],w=c.message.data.values[3][0];switch(f){case M.sY.Done:i=le.Gu.Done;break;case M.sY.Streaming:i=le.Gu.Streaming;break;case M.sY.Error:throw new Error(w)}l=[Ya(h,f,m),...(0,Se.KZ)(p,r,e.tableType)]}return{data:l||[],state:i}}))}function Ya(e,t,a){const r={steps:[{color:"blue",value:-1/0},{color:"green",value:75}],mode:Fa.H.Absolute};return{refId:"streaming-progress",name:"Streaming Progress",length:1,fields:[{name:"state",type:re.fS.string,values:[(0,te.capitalize)(t.toString())],config:{displayNameFromDS:"State"}},{name:"elapsedTime",type:re.fS.number,values:[a],config:{unit:"ms",displayNameFromDS:"Elapsed Time"}},{name:"totalBlocks",type:re.fS.number,values:[e.totalBlocks],config:{displayNameFromDS:"Total Blocks"}},{name:"completedJobs",type:re.fS.number,values:[e.completedJobs],config:{displayNameFromDS:"Completed Jobs"}},{name:"totalJobs",type:re.fS.number,values:[e.totalJobs],config:{displayNameFromDS:"Total Jobs"}},{name:"progress",type:re.fS.number,values:[t===M.sY.Done?100:(e.completedJobs||0)/(e.totalJobs||1)*100],config:{displayNameFromDS:"Progress",unit:"percent",min:0,max:100,custom:{cellOptions:{type:"gauge",mode:"gradient"}},thresholds:r}}],meta:{preferredVisualisationType:"table"}}}var Ga=o(90927);class Za extends Ga.Mg{constructor(t){super(),this.datasource=t,this.editor=Na}query(t){if(!this.datasource)throw new Error("Datasource not initialized");const a=this.datasource.executeVariableQuery(t.targets[0]);return(0,tt.D)(a).pipe((0,ae.U)(r=>({data:r})))}}const Te=20,Me=3;var Ka=(e=>(e.streaming="streaming",e))(Ka||{});const qa={streaming:"2.2.0"},Ha="2.1.0";class Ja extends Oa.CK{constructor(t,a=(0,Oe.J)()){super(t),this.instanceSettings=t,this.templateSrv=a,this.uploadedJson=null,this.init=async()=>{const r=await(0,et.n)(this._request("/api/status/buildinfo").pipe((0,ae.U)(n=>n),(0,Pe.K)(n=>(console.error("Failure in retrieving build information",n.data.message),(0,k.of)({error:n,data:{version:null}})))));this.tempoVersion=r.data.version},this.handleMetricsSummary=(r,n,l)=>{if((0,I.ff)("grafana_traces_metrics_summary_queried",{datasourceType:"tempo",app:l.app??"",grafana_version:Q.config.buildInfo.version,filterCount:r.groupBy?.length??0}),n==="{}")return(0,k.of)({error:{message:"Please ensure you do not have an empty query. This is so filters are applied and the metrics summary is not generated from all spans."},data:Ne});const i=r.groupBy?this.formatGroupBy(r.groupBy):"";return this._request("/api/metrics/summary",{q:n,groupBy:i,start:l.range.from.unix(),end:l.range.to.unix()}).pipe((0,ae.U)(d=>d.data.summaries?d.data.summaries.some(u=>u.series.length>0)?{data:$a(d.data.summaries,n,this.instanceSettings)}:{error:{message:V("No series data. Ensure you are using an up to date version of Tempo")},data:Ne}:{error:{message:V(`No summary data for '${i}'. Note: the metrics summary API only considers spans of kind = server. You can check if the attributes exist by running a TraceQL query like { attr_key = attr_value && kind = server }`)},data:Ne}),(0,Pe.K)(d=>(0,k.of)({error:{message:V(d.data.message)},data:Ne})))},this.formatGroupBy=r=>r?.filter(n=>n.tag).map(n=>n.scope===M.NM.Unscoped?`.${n.tag}`:n.scope!==M.NM.Intrinsic?`${n.scope}.${n.tag}`:n.tag).join(", "),this.hasGroupBy=r=>r.groupBy?.find(n=>n.tag),this.getLokiSearchDS=()=>{const r=this.tracesToLogs?.lokiSearch!==!1&&this.lokiSearch===void 0?this.tracesToLogs?.datasourceUid:void 0;return this.lokiSearch?.datasourceUid??r},this.tracesToLogs=t.jsonData.tracesToLogs,this.serviceMap=t.jsonData.serviceMap,this.search=t.jsonData.search,this.nodeGraph=t.jsonData.nodeGraph,this.lokiSearch=t.jsonData.lokiSearch,this.traceQuery=t.jsonData.traceQuery,this.languageProvider=new At(this),this.search?.filters||(this.search={...this.search,filters:[{id:"service-name",tag:"service.name",operator:"=",scope:M.NM.Resource},{id:"span-name",tag:"name",operator:"=",scope:M.NM.Span}]}),this.variables=new Za(this)}async executeVariableQuery(t){if(t.type===void 0)return new Promise(()=>[]);switch(t.type){case lt.LabelNames:return await this.labelNamesQuery();case lt.LabelValues:return this.labelValuesQuery(t.label);default:throw Error("Invalid query type",t.type)}}async labelNamesQuery(){return await this.languageProvider.fetchTags(),this.languageProvider.getAutocompleteTags().filter(a=>a!==void 0).map(a=>({text:a}))}async labelValuesQuery(t){if(!t)return[];let a;try{const r=(this.languageProvider.tagsV2||[]).flatMap(l=>l.tags.map(i=>({scope:l.name,name:i}))).find(l=>l.name===t)?.scope;if(!r)throw Error(`Scope for tag ${t} not found`);const n=r==="intrinsic"?t:`${r}.${t}`;a=await this.languageProvider.getOptionsV2(n)}catch{a=await this.languageProvider.getOptionsV1(t)}return a.filter(r=>r.value!==void 0).map(r=>({text:r.value}))}isFeatureAvailable(t){const a=this.tempoVersion??Ha;try{return ga().gte(a,qa[t])}catch{return!0}}query(t){const a=[],r=t.targets.filter(i=>!i.hide),n=(0,te.groupBy)(r,i=>i.queryType||"traceql");if(n.clear)return(0,k.of)({data:[],state:le.Gu.Done});const l=this.getLokiSearchDS();if(l&&n.search?.length>0){(0,I.ff)("grafana_traces_loki_search_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:Q.config.buildInfo.version,hasLinkedQueryExpr:!!(n.search[0].linkedQuery?.expr&&n.search[0].linkedQuery?.expr!=="")});const i=(0,Ue.ak)();a.push((0,tt.D)(i.get(l)).pipe((0,at.z)(d=>{const c={...t,targets:n.search.map(p=>p.linkedQuery)},m=d.instanceSettings.jsonData.derivedFields?.filter(p=>p.datasourceUid===this.uid&&p.matcherRegex).map(p=>p.matcherRegex)||[];return!m||m.length===0?(0,pa._)(()=>new Error("No Loki datasource configured for search. Set up Derived Fields for traces in a Loki datasource settings and link it to this Tempo datasource.")):d.query(c).pipe((0,ae.U)(p=>p.error?p:(0,Se.RY)(p,this.uid,this.name,m)))})))}if(n.nativeSearch?.length)try{(0,I.ff)("grafana_traces_search_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:Q.config.buildInfo.version,hasServiceName:!!n.nativeSearch[0].serviceName,hasSpanName:!!n.nativeSearch[0].spanName,resultLimit:n.nativeSearch[0].limit??"",hasSearch:!!n.nativeSearch[0].search,minDuration:n.nativeSearch[0].minDuration??"",maxDuration:n.nativeSearch[0].maxDuration??""});const i={startTime:t.range.from.unix(),endTime:t.range.to.unix()},d=this.applyVariables(n.nativeSearch[0],t.scopedVars),c=this.buildSearchQuery(d,i);a.push(this._request("/api/search",c).pipe((0,ae.U)(u=>({data:[(0,Se.n4)(u.data.traces,this.instanceSettings)]})),(0,Pe.K)(u=>(0,k.of)({error:{message:V(u.data.message)},data:[]}))))}catch(i){return(0,k.of)({error:{message:i instanceof Error?i.message:"Unknown error occurred"},data:[]})}if(n.traceql?.length)try{const d=this.applyVariables(n.traceql[0],t.scopedVars)?.query||"",c=/^[0-9A-Fa-f]*$/;d.trim().match(c)?((0,I.ff)("grafana_traces_traceID_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:Q.config.buildInfo.version,hasQuery:d!==""}),a.push(this.handleTraceIdQuery(t,n.traceql))):((0,I.ff)("grafana_traces_traceql_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:Q.config.buildInfo.version,query:d??"",streaming:Q.config.featureToggles.traceQLStreaming}),Q.config.featureToggles.traceQLStreaming&&this.isFeatureAvailable("streaming")?a.push(this.handleStreamingSearch(t,n.traceql,d)):a.push(this._request("/api/search",{q:d,limit:t.targets[0].limit??Te,spss:t.targets[0].spss??Me,start:t.range.from.unix(),end:t.range.to.unix()}).pipe((0,ae.U)(u=>({data:(0,Se.KZ)(u.data.traces,this.instanceSettings,n.traceql[0].tableType)})),(0,Pe.K)(u=>(0,k.of)({error:{message:V(u.data.message)},data:[]})))))}catch(i){return(0,k.of)({error:{message:i instanceof Error?i.message:"Unknown error occurred"},data:[]})}if(n.traceqlSearch?.length)try{if(Q.config.featureToggles.metricsSummary){const d=n.traceqlSearch.find(c=>this.hasGroupBy(c));d&&a.push(this.handleMetricsSummary(d,Re(d.filters),t))}const i=Q.config.featureToggles.metricsSummary?n.traceqlSearch.filter(d=>!this.hasGroupBy(d)):n.traceqlSearch;if(i.length>0){const d=Re(i[0].filters),c=this.templateSrv.replace(d,t.scopedVars);(0,I.ff)("grafana_traces_traceql_search_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:Q.config.buildInfo.version,query:c??"",streaming:Q.config.featureToggles.traceQLStreaming}),Q.config.featureToggles.traceQLStreaming&&this.isFeatureAvailable("streaming")?a.push(this.handleStreamingSearch(t,i,c)):a.push(this._request("/api/search",{q:c,limit:t.targets[0].limit??Te,spss:t.targets[0].spss??Me,start:t.range.from.unix(),end:t.range.to.unix()}).pipe((0,ae.U)(u=>({data:(0,Se.KZ)(u.data.traces,this.instanceSettings,n.traceqlSearch[0].tableType)})),(0,Pe.K)(u=>(0,k.of)({error:{message:V(u.data.message)},data:[]}))))}}catch(i){return(0,k.of)({error:{message:i instanceof Error?i.message:"Unknown error occurred"},data:[]})}if(n.upload?.length)if(this.uploadedJson){(0,I.ff)("grafana_traces_json_file_uploaded",{datasourceType:"tempo",app:t.app??"",grafana_version:Q.config.buildInfo.version});const i=JSON.parse(this.uploadedJson),d=i.batches,c=Array.isArray(i)&&i.some(u=>u?.meta?.preferredVisualisationType==="nodeGraph");d?a.push((0,k.of)((0,Se.IM)(i.batches,this.nodeGraph?.enabled))):c?a.push((0,k.of)({data:i,state:le.Gu.Done})):a.push((0,k.of)({error:{message:"Unable to parse uploaded data."},data:[]}))}else a.push((0,k.of)({data:[],state:le.Gu.Done}));if(this.serviceMap?.datasourceUid&&n.serviceMap?.length>0){(0,I.ff)("grafana_traces_service_graph_queried",{datasourceType:"tempo",app:t.app??"",grafana_version:Q.config.buildInfo.version,hasServiceMapQuery:!!n.serviceMap[0].serviceMapQuery});const i=this.serviceMap.datasourceUid,d=this.uid;a.push(er(t,i,d).pipe((0,Ct.b)(c=>tr(t,c,i).pipe((0,Ct.b)(u=>ar(t,u,i,d))))))}return(0,wt.T)(...a)}applyTemplateVariables(t,a){return this.applyVariables(t,a)}interpolateVariablesInQueries(t,a){return!t||t.length===0?[]:t.map(r=>({...r,datasource:this.getRef(),...this.applyVariables(r,a)}))}applyVariables(t,a){const r={...t};return t.linkedQuery&&(r.linkedQuery={...t.linkedQuery,expr:this.templateSrv.replace(t.linkedQuery?.expr??"",a)}),{...r,query:this.templateSrv.replace(t.query??"",a,Ie.b8.Pipe),serviceName:this.templateSrv.replace(t.serviceName??"",a),spanName:this.templateSrv.replace(t.spanName??"",a),search:this.templateSrv.replace(t.search??"",a),minDuration:this.templateSrv.replace(t.minDuration??"",a),maxDuration:this.templateSrv.replace(t.maxDuration??"",a),serviceMapQuery:this.templateSrv.replace(t.serviceMapQuery??"",a)}}handleTraceIdQuery(t,a){const r=a.filter(l=>l.query).map(l=>({...l,query:l.query?.trim(),queryType:"traceId"}));if(!r.length)return Dt.E;const n=this.traceIdQueryRequest(t,r);return super.query(n).pipe((0,ae.U)(l=>l.error?l:(0,Se.Jk)(l,this.instanceSettings,this.nodeGraph?.enabled)))}traceIdQueryRequest(t,a){const r={...t,targets:a};return this.traceQuery?.timeShiftEnabled?r.range=t.range&&{...t.range,from:t.range.from.subtract(It.intervalToMs(this.traceQuery?.spanStartTimeShift||"30m"),"milliseconds"),to:t.range.to.add(It.intervalToMs(this.traceQuery?.spanEndTimeShift||"30m"),"milliseconds")}:r.range={from:(0,Ve.CQ)(0),to:(0,Ve.CQ)(0),raw:{from:(0,Ve.CQ)(0),to:(0,Ve.CQ)(0)}},r}handleStreamingSearch(t,a,r){return r===""?Dt.E:(0,wt.T)(...a.map(n=>ka({...n,query:r},this,t,this.instanceSettings)))}async metadataRequest(t,a={}){return await(0,et.n)(this._request(t,a,{method:"GET",hideFromInspector:!0}))}_request(t,a,r){const n=a?fa.Cj.serializeParams(a):"",l=`${this.instanceSettings.url}${t}${n.length?`?${n}`:""}`,i={...r,url:l};return(0,Qe.i)().fetch(i)}async testDatasource(){const t={headers:{},method:"GET",url:`${this.instanceSettings.url}/api/echo`};return await(0,et.n)((0,Qe.i)().fetch(t).pipe((0,at.z)(()=>(0,k.of)({status:"success",message:"Data source successfully connected."})),(0,Pe.K)(a=>(0,k.of)({status:"error",message:V(a.data.message,"Unable to connect with Tempo")}))))}getQueryDisplayText(t){if(t.queryType==="nativeSearch"){let a=[];for(const r of["serviceName","spanName","search","minDuration","maxDuration","limit"])t.hasOwnProperty(r)&&t[r]&&a.push(`${(0,te.startCase)(r)}: ${t[r]}`);return a.join(", ")}return t.query??""}buildSearchQuery(t,a){let r=t.search??"",n=(0,te.pick)(t,["minDuration","maxDuration","limit"]);if(n=(0,te.pickBy)(n,te.identity),t.serviceName&&(r+=` service.name="${t.serviceName}"`),t.spanName&&(r+=` name="${t.spanName}"`),n.limit||(n.limit=Te),n.minDuration){if(n.minDuration=this.templateSrv.replace(n.minDuration??""),!(0,ce.IA)(n.minDuration))throw new Error("Please enter a valid min duration.");n.minDuration=n.minDuration.replace(/\s/g,"")}if(n.maxDuration){if(n.maxDuration=this.templateSrv.replace(n.maxDuration??""),!(0,ce.IA)(n.maxDuration))throw new Error("Please enter a valid max duration.");n.maxDuration=n.maxDuration.replace(/\s/g,"")}if(!Number.isInteger(n.limit)||n.limit<=0)throw new Error("Please enter a valid limit.");let l={tags:r,...n};return a&&(l.start=a.startTime,l.end=a.endTime),l}}function ct(e,t){return(0,tt.D)((0,Ue.ak)().get(t)).pipe((0,at.z)(a=>a.query(e)))}function er(e,t,a){const r=ut(e);return ct(r,t).pipe((0,rt.q)(),(0,ae.U)(n=>{const l=n.find(m=>!!m.error);if(l)throw new Error(V(l.error?.message));const{nodes:i,edges:d}=(0,K.BC)(n,e.range);if(i.fields.length>0&&d.fields.length>0){const m=i.fields[0].values.length,p=d.fields[0].values.length;(0,I.ff)("grafana_traces_service_graph_size",{datasourceType:"tempo",grafana_version:Q.config.buildInfo.version,nodeLength:m,edgeLength:p})}const{serviceMapIncludeNamespace:c,refId:u}=e.targets[0];return i.refId=u,d.refId=u,c?(i.fields[0].config=ke(t,a,"__data.fields.title","__data.fields[0]",void 0,{targetNamespace:"__data.fields.subtitle"}),d.fields[0].config=ke(t,a,"__data.fields.targetName","__data.fields.target","__data.fields.sourceName",{targetNamespace:"__data.fields.targetNamespace",sourceNamespace:"__data.fields.sourceNamespace"})):(i.fields[0].config=ke(t,a,"__data.fields.id","__data.fields[0]"),d.fields[0].config=ke(t,a,"__data.fields.target","__data.fields.target","__data.fields.source")),{nodes:i,edges:d,state:le.Gu.Done}}))}function tr(e,t,a){const r=ut(e);return r.targets=Ut([ye(K.rB,K.T1,e)]),ct(r,a).pipe((0,rt.q)(),(0,ae.U)(n=>{const l=n.find(i=>!!i.error);if(l)throw new Error(V(l.error?.message));return{rates:n[0]?.data??[],nodes:t.nodes,edges:t.edges}}))}function ar(e,t,a,r){let n=[],l="",i=[],d=[];if(t.rates[0]&&e.app===ha.zj.Explore){const m=t.rates[0].fields.find(p=>p.name==="span_name");m&&m.values&&(d=m.values)}else t.rates&&t.rates.map(m=>{const p=m.fields.find(h=>h.labels?.span_name);p&&d.push(p.labels?.span_name)});const c=rr(d);c.length>0&&(l=ye(K.$C,'span_name=~"'+c.join("|")+'"',e),n.push(l),c.map(m=>{const p=ye(K.vO,'span_name=~"'+m+'"',e);i.push(p),n.push(p)}));const u=ut(e);return u.targets=Ut(n),ct(u,a).pipe((0,rt.q)(),(0,ae.U)(m=>{const p=m.find(f=>!!f.error);if(p)throw new Error(V(p.error?.message));const h=sr(e,t,m[0],l,i,a,r);return h.fields.length===0?{data:[t.nodes,t.edges],state:le.Gu.Done}:{data:[h,t.nodes,t.edges],state:le.Gu.Done}}))}function we(e,t,a,r){return{url:"",title:e,internal:{query:{expr:t,range:!r,exemplar:!r,instant:r},datasourceUid:a,datasourceName:(0,Ue.ak)().getDataSourceSettingsByUid(a)?.name??""}}}function rr(e){return e.map(t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\\\$&"))}function ke(e,t,a,r,n,l){let i=n?`client="\${${n}}",`:"",d=`server="\${${a}}"`,c="server";if(l!==void 0){const{targetNamespace:u}=l;if(d+=`,server_service_namespace="\${${u}}"`,c+=", server_service_namespace",i){const{sourceNamespace:m}=l;i+=`client_service_namespace="\${${m}}",`,c+=", client_service_namespace"}}return{links:[we("Request rate",`sum by (client, ${c})(rate(${K.Yt}{${i}${d}}[$__rate_interval]))`,e,!1),we("Request histogram",`histogram_quantile(0.9, sum(rate(${K.NZ}{${i}${d}}[$__rate_interval])) by (le, client, ${c}))`,e,!1),we("Failed request rate",`sum by (client, ${c})(rate(${K.yf}{${i}${d}}[$__rate_interval]))`,e,!1),Wt("View traces",`\${${r}}`,"",t)]}}function Wt(e,t,a,r){let n={refId:"A",queryType:"traceqlSearch",filters:[]};return t!==""&&n.filters.push({id:"service-name",scope:M.NM.Resource,tag:"service.name",value:t,operator:"=",valueType:"string"}),a!==""&&n.filters.push({id:"span-name",scope:M.NM.Span,tag:"name",value:a,operator:"=",valueType:"string"}),{url:"",title:e,internal:{query:n,datasourceUid:r,datasourceName:(0,Ue.ak)().getDataSourceSettingsByUid(r)?.name??""}}}function ut(e){return{...e,targets:K.t3.map(t=>{const{serviceMapQuery:a,serviceMapIncludeNamespace:r}=e.targets[0];return{format:"table",refId:t,expr:`sum by (client, server${r?", client_service_namespace, server_service_namespace":""}) (rate(${t}${a||""}[$__range]))`,instant:!0}})}}function sr(e,t,a,r,n,l,i){let d={fields:[]};const c=t.rates.filter(p=>p.refId===ye(K.rB,K.T1,e)),u=a.data.filter(p=>p.refId===r),m=a.data.filter(p=>n.includes(p.refId??""));if(c.length>0&&c[0].fields?.length>2&&(d.fields.push({...c[0].fields[1],name:"Name",config:{filterable:!1}}),d.fields.push({...c[0].fields[2],name:"Rate",config:{links:[we("Rate",pt(ye(K.rB,'span_name="${__data.fields[0]}"',e)),l,!1)],decimals:2}}),d.fields.push({...c[0].fields[2],name:"  ",labels:null,config:{color:{mode:"continuous-BlPu"},custom:{cellOptions:{mode:Ie.QH.Lcd,type:Ie.h2.Gauge}},decimals:3}})),u.length>0&&u[0].fields?.length>2){const p=u[0].fields[1]?.values??[],h=u[0].fields[2]?.values??[];let f={};p.map((U,q)=>{f[U]={value:h[q]}});const w=Vt({...c},f);d.fields.push({...u[0].fields[2],name:"Error Rate",values:w,config:{links:[we("Error Rate",pt(ye(K.$C,'span_name="${__data.fields[0]}"',e)),l,!1)],decimals:2}}),d.fields.push({...u[0].fields[2],name:"   ",values:w,labels:null,config:{color:{mode:"continuous-RdYlGr"},custom:{cellOptions:{mode:Ie.QH.Lcd,type:Ie.h2.Gauge}},decimals:3}})}if(m.length>0){let p={};m.forEach(h=>{if(h.fields.length>1){const f=h.refId?.includes('span_name=~"')?'span_name=~"':'span_name="',w=h.refId?.split(f)[1].split('"}')[0];p[w]={value:h.fields[1].values[0]}}}),Object.keys(p).length>0&&d.fields.push({...m[0].fields[1],name:"Duration (p90)",values:Vt({...c},p),config:{links:[we("Duration",pt(ye(K.vO,'span_name="${__data.fields[0]}"',e)),l,!1)],unit:"s"}})}return d.fields.length>0&&d.fields[0].values&&d.fields.push({name:"Links",type:re.fS.string,values:d.fields[0].values.map(()=>"Tempo"),config:{links:[Wt("Tempo","","${__data.fields[0]}",i)]}}),d}function ye(e,t,a){let r=a.targets[0]?.serviceMapQuery??"";const n=r.match(/^{(.*)}$/);n?.length&&(r=n[1]),r=r.replace("client","service").replace("server","service");const l=r.includes("span_name")?e.params.concat(r):e.params.concat(r).concat(t).filter(i=>i);return e.expr.replace("{}","{"+l.join(",")+"}")}function pt(e){return e=e.replace("topk(5, ","").replace(" by (span_name))",""),e.replace("__range","__rate_interval")}function Vt(e,t){const a=e[0]?.fields[1]?.values??[];let r=[];for(let n=0;n<a.length;n++)Object.keys(t).includes(a[n])?r.push(t[a[n]].value):r.push("0");return r}function Ut(e){return e.map(t=>({refId:t,expr:t,instant:!0}))}var jt=o(73642),De=o(43025);class nr{constructor(t){this.triggerCharacters=["="," "],this.cachedValues={},this.languageProvider=t.languageProvider}provideCompletionItems(t,a){if(!(this.monaco&&this.editor))throw new Error("provideCompletionItems called before CompletionProvider was initialized");if(this.editor.getModel()?.id!==t.id)return{suggestions:[]};const{range:r,offset:n}=lr(this.monaco,t,a),l=this.getSituation(t.getValue(),n);return this.getCompletions(l).then(d=>{const c=d.length.toString().length;return{suggestions:d.map((m,p)=>({kind:ir(m.type,this.monaco),label:m.label,insertText:m.insertText,sortText:p.toString().padStart(c,"0"),range:r}))}})}async getTagValues(t){let a;return this.cachedValues.hasOwnProperty(t)?a=this.cachedValues[t]:(a=await this.languageProvider.getOptionsV1(t),this.cachedValues[t]=a),a}async getCompletions(t){switch(t.type){case"UNKNOWN":return[];case"EMPTY":return this.getTagsCompletions();case"IN_NAME":return this.getTagsCompletions();case"IN_VALUE":const a=await this.getTagValues(t.tagName),r=[],n=l=>`"${l.label}"`;return a.forEach(l=>{l?.label&&r.push({label:l.label,insertText:n(l),type:"TAG_VALUE"})}),r;default:throw new Error(`Unexpected situation ${t}`)}}getTagsCompletions(){return this.languageProvider.getAutocompleteTags().sort((a,r)=>a.localeCompare(r,void 0,{sensitivity:"accent"})).map(a=>({label:a,insertText:a,type:"TAG_NAME"}))}getSituation(t,a){if(t===""||a===0||t[t.length-1]===" ")return{type:"EMPTY"};const r=t.substring(0,a),n=/(?<key>[^= ]+)(?<equals>=)?(?<value>([^ "]+)|"([^"]*)")?/,l=r.match(new RegExp(n,"g"));if(l?.length){const d=l[l.length-1].match(n);if(d){const c=d.groups?.key,u=d.groups?.equals;return c?u?{type:"IN_VALUE",tagName:c}:{type:"IN_NAME"}:{type:"EMPTY"}}}return{type:"EMPTY"}}}function ir(e,t){switch(e){case"TAG_NAME":return t.languages.CompletionItemKind.Enum;case"KEYWORD":return t.languages.CompletionItemKind.Keyword;case"OPERATOR":return t.languages.CompletionItemKind.Operator;case"TAG_VALUE":return t.languages.CompletionItemKind.EnumMember;case"SCOPE":return t.languages.CompletionItemKind.Class;default:throw new Error(`Unexpected CompletionType: ${e}`)}}function lr(e,t,a){const r=t.getWordAtPosition(a),n=r!=null?e.Range.lift({startLineNumber:a.lineNumber,endLineNumber:a.lineNumber,startColumn:r.startColumn,endColumn:r.endColumn}):e.Range.fromPositions(a),l={column:a.column,lineNumber:a.lineNumber};return{offset:t.getOffsetAt(l),range:n}}const or={id:"tagsfield",extensions:[".tagsfield"],aliases:["tagsfield"],mimetypes:[],def:{language:{ignoreCase:!1,defaultToken:"",tokenPostfix:".tagsfield",operators:["="],symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,integersuffix:/(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,floatsuffix:/[fFlL]?/,tokenizer:{root:[[/[a-z_.][\w./_-]*(?=\s*(=|!=|>|<|>=|<=|=~|!~))/,"tag"],[/[a-zA-Z_.]\w*/,{cases:{"@default":"identifier"}}],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/\d+/,"number"],[/\d*\d+[eE]([\-+]?\d+)?(@floatsuffix)/,"number.float"],[/\d*\.\d+([eE][\-+]?\d+)?(@floatsuffix)/,"number.float"],[/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/,"number.hex"],[/0[0-7']*[0-7](@integersuffix)/,"number.octal"],[/0[bB][0-1']*[0-1](@integersuffix)/,"number.binary"],[/\d[\d']*\d(@integersuffix)/,"number"],[/\d(@integersuffix)/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],clauses:[[/[^(,)]/,"tag"],[/\)/,"identifier","@pop"]],whitespace:[[/[ \t\r\n]+/,"white"]]}},languageConfiguration:{wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,brackets:[["{","}"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}}}};function dr(e){const{onChange:t,onBlur:a,placeholder:r}=e,n=pr(e.datasource),l=(0,b.l4)(),i=gr(l,r);return s.createElement(jt.p,{value:e.value,language:$e,onBlur:a,onChange:t,containerStyles:i.queryField,monacoOptions:{folding:!1,fontSize:14,lineNumbers:"off",overviewRulerLanes:0,renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,wordWrap:"on"},onBeforeEditorMount:mr,onEditorDidMount:(d,c)=>{n(d,c),cr(d,c,i),ur(d)}})}function cr(e,t,a){const r=[{range:new t.Range(1,1,1,1),options:{className:a.placeholder,isWholeLine:!0}}];let n=[];const l=()=>{const i=e.getModel();if(!i)return;const d=i.getValueLength()===0?r:[];n=i.deltaDecorations(n,d)};l(),e.onDidChangeModelContent(l)}function ur(e){const t=e.getDomNode(),a=()=>{if(t){const r=Math.min(1e3,e.getContentHeight()),n=parseInt(t.style.width,10);t.style.width=`${n}px`,t.style.height=`${r}px`,e.layout({width:n,height:r})}};e.onDidContentSizeChange(a),a()}function pr(e){const t=(0,s.useRef)(new nr({languageProvider:e.languageProvider}));(0,s.useEffect)(()=>{(async()=>{try{await e.languageProvider.start()}catch(n){n instanceof Error&&(0,pe.WI)((0,De.$l)((0,ue.t_)("Error",n)))}})()},[e]);const a=(0,s.useRef)(null);return(0,s.useEffect)(()=>()=>{a.current?.()},[]),(r,n)=>{t.current.editor=r,t.current.monaco=n;const{dispose:l}=n.languages.registerCompletionItemProvider($e,t.current);a.current=l}}let Ft=!1;const $e="tagsfield";function mr(e){if(!Ft){Ft=!0;const{aliases:t,extensions:a,mimetypes:r,def:n}=or;e.languages.register({id:$e,aliases:t,extensions:a,mimetypes:r}),e.languages.setMonarchTokensProvider($e,n.language),e.languages.setLanguageConfiguration($e,n.languageConfiguration)}}const gr=(e,t)=>({queryField:(0,x.css)`
      border-radius: ${e.shape.radius.default};
      border: 1px solid ${e.components.input.borderColor};
      flex: 1;
    `,placeholder:(0,x.css)`
      ::after {
        content: '${t}';
        font-family: ${e.typography.fontFamilyMonospace};
        opacity: 0.3;
      }
    `}),Bt="e.g. 1.2s, 100ms",fr=({datasource:e,query:t,onChange:a,onBlur:r,onRunQuery:n})=>{const l=(0,b.wW)(hr),i=(0,s.useMemo)(()=>new At(e),[e]),[d,c]=(0,s.useState)(),[u,m]=(0,s.useState)(),[p,h]=(0,s.useState)(null),[f,w]=(0,s.useState)({}),[U,q]=(0,s.useState)({serviceName:!1,spanName:!1}),oe=(0,s.useCallback)(async(D,Y="")=>{const he=D==="serviceName"?"service.name":"name";q(G=>({...G,[D]:!0}));try{return(await i.getOptionsV1(he)).filter(C=>C.value?(0,ua.C)(C.value,Y).found:!1)}catch(G){return(0,Qe.kW)(G)&&G?.status===404?h(G):G instanceof Error&&(0,pe.WI)((0,Rt.$l)((0,ue.t_)("Error",G))),[]}finally{q(G=>({...G,[D]:!1}))}},[i]);(0,s.useEffect)(()=>{(async()=>{try{const[Y,he]=await Promise.all([oe("serviceName"),oe("spanName")]);t.serviceName&&(0,Oe.J)().containsTemplate(t.serviceName)&&Y.push((0,ie.E)(t.serviceName)),c(Y),t.spanName&&(0,Oe.J)().containsTemplate(t.spanName)&&he.push((0,ie.E)(t.spanName)),m(he)}catch(Y){(0,Qe.kW)(Y)&&Y?.status===404?h(Y):Y instanceof Error&&(0,pe.WI)((0,Rt.$l)((0,ue.t_)("Error",Y)))}})()},[i,oe,t.serviceName,t.spanName]);const P=D=>{D.key==="Enter"&&(D.shiftKey||D.ctrlKey)&&n()},W=(0,s.useCallback)(D=>{a({...t,search:D})},[a,t]),H=(0,Oe.J)();return s.createElement(s.Fragment,null,s.createElement("div",{className:l.container},s.createElement(xe.b,{title:"Deprecated query type",severity:"warning"},"This query type has been deprecated and will be removed in Grafana v10.3. Please migrate to another Tempo query type."),s.createElement(R.Z,null,s.createElement(T._,{label:"Service Name",labelWidth:14,grow:!0},s.createElement(ee.Ph,{inputId:"service",options:d,onOpenMenu:()=>{oe("serviceName")},isLoading:U.serviceName,value:d?.find(D=>D?.value===t.serviceName)||t.serviceName,onChange:D=>{a({...t,serviceName:D?.value})},placeholder:"Select a service",isClearable:!0,onKeyDown:P,"aria-label":"select-service-name",allowCustomValue:!0}))),s.createElement(R.Z,null,s.createElement(T._,{label:"Span Name",labelWidth:14,grow:!0},s.createElement(ee.Ph,{inputId:"spanName",options:u,onOpenMenu:()=>{oe("spanName")},isLoading:U.spanName,value:u?.find(D=>D?.value===t.spanName)||t.spanName,onChange:D=>{a({...t,spanName:D?.value})},placeholder:"Select a span",isClearable:!0,onKeyDown:P,"aria-label":"select-span-name",allowCustomValue:!0}))),s.createElement(R.Z,null,s.createElement(T._,{label:"Tags",labelWidth:14,grow:!0,tooltip:"Values should be in logfmt."},s.createElement(dr,{placeholder:"http.status_code=200 error=true",value:t.search||"",onChange:W,onBlur:r,datasource:e}))),s.createElement(R.Z,null,s.createElement(T._,{label:"Min Duration",invalid:!!f.minDuration,labelWidth:14,grow:!0},s.createElement(Ce.I,{id:"minDuration",value:t.minDuration||"",placeholder:Bt,onBlur:()=>{const D=H.replace(t.minDuration??"");t.minDuration&&!(0,ce.IA)(D)?w({...f,minDuration:!0}):w({...f,minDuration:!1})},onChange:D=>a({...t,minDuration:D.currentTarget.value}),onKeyDown:P}))),s.createElement(R.Z,null,s.createElement(T._,{label:"Max Duration",invalid:!!f.maxDuration,labelWidth:14,grow:!0},s.createElement(Ce.I,{id:"maxDuration",value:t.maxDuration||"",placeholder:Bt,onBlur:()=>{const D=H.replace(t.maxDuration??"");t.maxDuration&&!(0,ce.IA)(D)?w({...f,maxDuration:!0}):w({...f,maxDuration:!1})},onChange:D=>a({...t,maxDuration:D.currentTarget.value}),onKeyDown:P}))),s.createElement(R.Z,null,s.createElement(T._,{label:"Limit",invalid:!!f.limit,labelWidth:14,grow:!0,tooltip:"Maximum number of returned results"},s.createElement(Ce.I,{id:"limit",value:t.limit||"",placeholder:`Default: ${Te}`,type:"number",onChange:D=>{let Y=D.currentTarget.value?parseInt(D.currentTarget.value,10):void 0;Y&&(!Number.isInteger(Y)||Y<=0)?w({...f,limit:!0}):w({...f,limit:!1}),a({...t,limit:D.currentTarget.value?parseInt(D.currentTarget.value,10):void 0})},onKeyDown:P})))),p?s.createElement(xe.b,{title:"Unable to connect to Tempo search",severity:"info",className:l.alert},"Please ensure that Tempo is configured with search enabled. If you would like to hide this tab, you can configure it in the ",s.createElement("a",{href:`/datasources/edit/${e.uid}`},"datasource settings"),"."):null)},hr=e=>({container:(0,x.css)`
    max-width: 500px;
  `,alert:(0,x.css)`
    max-width: 75ch;
    margin-top: ${e.spacing(2)};
  `});var Or=o(97523),vr=o(70605),mt=o(73375),Xt=o(1537),Sr=o(46675);const gt=s.memo(({onChange:e,query:t})=>{t.hasOwnProperty("limit")||(t.limit=Te),t.hasOwnProperty("tableType")||(t.tableType=M.Mt.Traces);const a=i=>{e({...t,limit:parseInt(i.currentTarget.value,10)})},r=i=>{e({...t,spss:parseInt(i.currentTarget.value,10)})},n=i=>{e({...t,tableType:i})},l=[`Limit: ${t.limit||Te}`,`Spans Limit: ${t.spss||Me}`,`Table Format: ${t.tableType===M.Mt.Traces?"Traces":"Spans"}`];return s.createElement(s.Fragment,null,s.createElement(vr.p,null,s.createElement(Sr.d,{title:"Options",collapsedInfo:l},s.createElement(mt.S,{label:"Limit",tooltip:"Maximum number of traces to return."},s.createElement(Xt.H,{className:"width-4",placeholder:"auto",type:"number",min:1,defaultValue:t.limit||Te,onCommitChange:a,value:t.limit})),s.createElement(mt.S,{label:"Span Limit",tooltip:"Maximum number of spans to return for each span set."},s.createElement(Xt.H,{className:"width-4",placeholder:"auto",type:"number",min:1,defaultValue:t.spss||Me,onCommitChange:r,value:t.spss})),s.createElement(mt.S,{label:"Table Format",tooltip:"How the query data should be displayed in the results table"},s.createElement(E.S,{options:[{label:"Traces",value:M.Mt.Traces},{label:"Spans",value:M.Mt.Spans}],value:t.tableType,onChange:n})))))});gt.displayName="TempoQueryBuilderOptions";const Tr=/^(\$\w+)|(\d+(?:\.\d)?\d*(?:us|Âµs|ns|ms|s|m|h))$/,yr=()=>({noBoxShadow:(0,x.css)`
    box-shadow: none;
    *:focus {
      box-shadow: none;
    }
  `}),kt=({filter:e,operators:t,updateFilter:a})=>{const r=(0,b.wW)(yr);let n=!1;return typeof e.value=="string"&&(n=e.value?!Tr.test(e.value.concat("")):!1),s.createElement(v.Lh,{spacing:"none"},s.createElement(ee.Ph,{className:r.noBoxShadow,inputId:`${e.id}-operator`,options:t.map(zt),value:e.operator,onChange:l=>{a({...e,operator:l?.value})},isClearable:!1,"aria-label":`select ${e.id} operator`,allowCustomValue:!0,width:8}),s.createElement(Ce.I,{className:r.noBoxShadow,value:e.value,onChange:l=>{a({...e,value:l.currentTarget.value})},placeholder:"e.g. 100ms, 1.2s","aria-label":`select ${e.id} value`,invalid:n,width:18}))};var Ye=o(30019);const Le=({label:e,tooltip:t,children:a})=>s.createElement(R.Z,null,s.createElement(T._,{label:e,labelWidth:28,grow:!0,tooltip:t},a)),Er=e=>{const{datasource:t,onChange:a,query:r,isTagsLoading:n}=e,l=(0,b.wW)(br),i=()=>(0,dt.Z)().slice(0,8);(0,s.useEffect)(()=>{(!r.groupBy||r.groupBy.length===0)&&a({...r,groupBy:[{id:i(),scope:M.NM.Span}]})},[a,r]);const d=h=>t.languageProvider.getMetricsSummaryTags(h.scope),c=()=>{m({id:i(),scope:M.NM.Span})},u=h=>{a({...r,groupBy:r.groupBy?.filter(f=>f.id!==h.id)})},m=h=>{const f={...r};f.groupBy||=[];const w=f.groupBy.findIndex(U=>U.id===h.id);w>=0?f.groupBy=it(f.groupBy,w,h):f.groupBy.push(h),a(f)},p=Object.values(M.NM).map(h=>({label:h,value:h}));return s.createElement(Le,{label:"Aggregate by",tooltip:"Select one or more tags to see the metrics summary. Note: the metrics summary API only considers spans of kind = server."},s.createElement(s.Fragment,null,r.groupBy?.map((h,f)=>s.createElement("div",{key:h.id},s.createElement(v.Lh,{spacing:"none",width:"auto"},s.createElement(ee.Ph,{"aria-label":`Select scope for filter ${f+1}`,onChange:w=>{m({...h,scope:w?.value,tag:""})},options:p,placeholder:"Select scope",value:h.scope}),s.createElement(ee.Ph,{"aria-label":`Select tag for filter ${f+1}`,isClearable:!0,isLoading:n,key:h.tag,onChange:w=>{m({...h,tag:w?.value})},options:d(h)?.map(w=>({label:w,value:w})),placeholder:"Select tag",value:h.tag||""}),s.createElement(Ye._,{"aria-label":`Remove tag for filter ${f+1}`,icon:"times",onClick:()=>u(h),tooltip:"Remove tag",variant:"secondary"}),f===(r.groupBy?.length??0)-1&&s.createElement("span",{className:l.addFilter},s.createElement(Ye._,{"aria-label":"Add tag",icon:"plus",onClick:()=>c(),tooltip:"Add tag",variant:"secondary"})))))))},br=e=>({addFilter:(0,x.css)`
    margin-left: ${e.spacing(2)};
  `}),Qr=()=>({dropdown:(0,x.css)`
    box-shadow: none;
  `}),ft=({filter:e,datasource:t,updateFilter:a,deleteFilter:r,isTagsLoading:n,tags:l,setError:i,hideScope:d,hideTag:c,hideValue:u,allowDelete:m,query:p})=>{const h=(0,b.wW)(Qr),f=(0,s.useMemo)(()=>st(e),[e]),[w,U]=(0,s.useState)(e.operator),[q,oe]=(0,s.useState)(e.value),P=async()=>{try{return e.tag?await t.languageProvider.getOptionsV2(f,p):[]}catch(C){(0,Qe.kW)(C)&&C?.status===404?i(C):C instanceof Error&&(0,pe.WI)((0,De.$l)((0,ue.t_)("Error",C)))}return[]},{loading:W,value:H}=(0,g.Z)(P,[f,t.languageProvider,i,p]);e.value&&!Array.isArray(e.value)&&H&&!H.find(C=>C.value===e.value)&&H.push({label:e.value.toString(),value:e.value.toString(),type:e.valueType}),(0,s.useEffect)(()=>{Array.isArray(e.value)&&e.value.length>1&&e.operator!=="=~"&&e.operator!=="!~"&&(U(e.operator),a({...e,operator:"=~"})),Array.isArray(e.value)&&e.value.length<=1&&(q?.length||0)>1&&a({...e,operator:w,value:e.value[0]})},[q,w,a,e]),(0,s.useEffect)(()=>{oe(e.value)},[e.value]);const D=Object.values(M.NM).filter(C=>C!==M.NM.Intrinsic).map(C=>({label:C,value:C})),Y=H?.filter(C=>C.type===H[0]?.type),he=H?.length===Y?.length?H?.[0]?.type:void 0;let G=Nt;switch(he){case"keyword":G=Sa;break;case"string":G=Ta;break;case"int":case"float":G=ya}const We=C=>{const Pt=(0,Oe.J)().getVariables();return[...C||[],...Pt.map(ca=>({label:`$${ca.name}`,value:`$${ca.name}`}))]};return s.createElement(v.Lh,{spacing:"none",width:"auto"},!d&&s.createElement(ee.Ph,{className:h.dropdown,inputId:`${e.id}-scope`,options:We(D),value:e.scope,onChange:C=>{a({...e,scope:C?.value})},placeholder:"Select scope","aria-label":`select ${e.id} scope`}),!c&&s.createElement(ee.Ph,{className:h.dropdown,inputId:`${e.id}-tag`,isLoading:n,options:We((e.tag!==void 0?(0,te.uniq)([e.tag,...l]):l).map(C=>({label:C,value:C}))),value:e.tag,onChange:C=>{a({...e,tag:C?.value})},placeholder:"Select tag",isClearable:!0,"aria-label":`select ${e.id} tag`,allowCustomValue:!0}),s.createElement(ee.Ph,{className:h.dropdown,inputId:`${e.id}-operator`,options:We(G.map(zt)),value:e.operator,onChange:C=>{a({...e,operator:C?.value})},isClearable:!1,"aria-label":`select ${e.id} operator`,allowCustomValue:!0,width:8}),!u&&s.createElement(ee.Ph,{className:h.dropdown,inputId:`${e.id}-value`,isLoading:W,options:We(H),value:e.value,onChange:C=>{Array.isArray(C)?a({...e,value:C.map(Pt=>Pt.value),valueType:C[0]?.type||he}):a({...e,value:C?.value,valueType:C?.type||he})},placeholder:"Select value",isClearable:!1,"aria-label":`select ${e.id} value`,allowCustomValue:!0,isMulti:!0,allowCreateWhileLoading:!0}),m&&s.createElement(Ye._,{variant:"secondary",icon:"times",onClick:()=>r?.(e),tooltip:"Remove tag","aria-label":`remove tag with ID ${e.id}`}))},xr=()=>({vertical:(0,x.css)`
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  `,horizontal:(0,x.css)`
    display: flex;
    flex-direction: row;
    gap: 1rem;
  `}),Yt=({updateFilter:e,deleteFilter:t,filters:a,datasource:r,setError:n,staticTags:l,isTagsLoading:i,hideValues:d,query:c})=>{const u=(0,b.wW)(xr),m=()=>(0,dt.Z)().slice(0,8),p=(0,s.useCallback)(()=>e({id:m(),operator:"=",scope:M.NM.Span}),[e]);(0,s.useEffect)(()=>{a?.length||p()},[a,p]);const h=f=>{const w=r.languageProvider.getTags(f.scope);return Da(w,l)};return s.createElement("div",{className:u.vertical},a?.map((f,w)=>s.createElement("div",{className:u.horizontal,key:f.id},s.createElement(ft,{filter:f,datasource:r,setError:n,updateFilter:e,tags:h(f),isTagsLoading:i,deleteFilter:t,allowDelete:!0,hideValue:d,query:c}),w===a.length-1&&s.createElement(Ye._,{variant:"secondary",icon:"plus",onClick:p,title:"Add tag"}))))},Pr=["min-duration","max-duration","status"],Rr=({datasource:e,query:t,onChange:a,onClearResults:r,app:n})=>{const l=(0,b.wW)(wr),[i,d]=(0,s.useState)(null),[c,u]=(0,s.useState)(!0),[m,p]=(0,s.useState)(""),h=(0,Oe.J)(),f=(0,s.useCallback)(P=>{const W={...t};W.filters||=[];const H=W.filters.findIndex(D=>D.id===P.id);H>=0?W.filters=it(W.filters,H,P):W.filters.push(P),a(W)},[a,t]),w=P=>{a({...t,filters:t.filters.filter(W=>W.id!==P.id)})};(0,s.useEffect)(()=>{p(Re(t.filters||[]))},[t]);const U=(0,s.useCallback)(P=>t.filters?.find(W=>W.id===P),[t.filters]);(0,s.useEffect)(()=>{(async()=>{try{await e.languageProvider.start(),u(!1)}catch(W){W instanceof Error&&(0,pe.WI)((0,De.$l)((0,ue.t_)("Error",W)))}})()},[e]),(0,s.useEffect)(()=>{e.search?.filters?.filter(P=>P.value).forEach(P=>{U(P.id)||f(P)})},[e.search?.filters,U,f]);const q=e.search?.filters?.map(P=>P.tag)||[];q.push("duration"),q.push("traceDuration");const oe=(t.filters||[]).filter(P=>!Pr.includes(P.id)&&(e.search?.filters?.findIndex(W=>W.id===P.id)||0)===-1&&P.id!=="duration-type");return s.createElement(s.Fragment,null,s.createElement("div",{className:l.container},s.createElement("div",null,e.search?.filters?.map(P=>P.tag&&s.createElement(Le,{key:P.id,label:wa(P),tooltip:`Filter your search by ${st(P)}. To modify the default filters shown for search visit the Tempo datasource configuration page.`},s.createElement(ft,{filter:U(P.id)||P,datasource:e,setError:d,updateFilter:f,tags:[],hideScope:!0,hideTag:!0,query:m}))),s.createElement(Le,{label:"Status"},s.createElement(ft,{filter:U("status")||{id:"status",tag:"status",scope:M.NM.Intrinsic,operator:"="},datasource:e,setError:d,updateFilter:f,tags:[],hideScope:!0,hideTag:!0,query:m})),s.createElement(Le,{label:"Duration",tooltip:"The trace or span duration, i.e. end - start time of the trace/span. Accepted units are ns, ms, s, m, h"},s.createElement(v.Lh,{spacing:"sm"},s.createElement(ee.Ph,{options:[{label:"span",value:"span"},{label:"trace",value:"trace"}],value:U("duration-type")?.value??"span",onChange:P=>{const W=U("duration-type")||{id:"duration-type",value:"span"};f({...W,value:P?.value})},"aria-label":"duration type"}),s.createElement(kt,{filter:U("min-duration")||{id:"min-duration",tag:"duration",operator:">",valueType:"duration"},operators:[">",">="],updateFilter:f}),s.createElement(kt,{filter:U("max-duration")||{id:"max-duration",tag:"duration",operator:"<",valueType:"duration"},operators:["<","<="],updateFilter:f}))),s.createElement(Le,{label:"Tags"},s.createElement(Yt,{filters:oe,datasource:e,setError:d,updateFilter:f,deleteFilter:w,staticTags:q,isTagsLoading:c,query:m})),Q.config.featureToggles.metricsSummary&&s.createElement(Er,{datasource:e,onChange:a,query:t,isTagsLoading:c})),s.createElement("div",{className:l.rawQueryContainer},s.createElement(Or.U,{query:h.replace(m),lang:{grammar:xa,name:"traceql"}}),s.createElement(_.zx,{variant:"secondary",size:"sm",onClick:()=>{(0,I.ff)("grafana_traces_copy_to_traceql_clicked",{app:n??"",grafana_version:Q.config.buildInfo.version,location:"search_tab"}),r();const P=Re(t.filters||[]);a({...t,query:P,queryType:"traceql"})}},"Edit in TraceQL")),s.createElement(gt,{onChange:a,query:t})),i?s.createElement(xe.b,{title:"Unable to connect to Tempo search",severity:"info",className:l.alert},"Please ensure that Tempo is configured with search enabled. If you would like to hide this tab, you can configure it in the ",s.createElement("a",{href:`/datasources/edit/${e.uid}`},"datasource settings"),"."):null)},wr=e=>({alert:(0,x.css)`
    max-width: 75ch;
    margin-top: ${e.spacing(2)};
  `,container:(0,x.css)`
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
    flex-direction: column;
  `,rawQueryContainer:(0,x.css)({alignItems:"center",backgroundColor:e.colors.background.secondary,display:"flex",justifyContent:"space-between",padding:e.spacing(1)})});var Dr=o(70666);function Cr({graphDatasourceUid:e,query:t,onChange:a}){const r=(0,b.wW)(Nr),n=(0,g.Z)(()=>Z(e),[e]),[l,i]=(0,s.useState)(void 0);if((0,s.useEffect)(()=>{async function u(m){const p=await m.getTagKeys({filters:[{key:"__name__",operator:"=~",value:"traces_service_graph_request_server_seconds_sum|traces_service_graph_request_total|traces_service_graph_request_failed_total",condition:""}]});i(!!p.length)}!n.loading&&n.value&&u(n.value)},[n]),n.loading)return null;const d=n.value;if(!e)return ht("No service graph datasource selected","Please set up a service graph datasource in the datasource settings",r);if(e&&!d)return ht("No service graph data found","Service graph datasource is configured but the data source no longer exists. Please configure existing data source to use the service graph functionality",r);const c=Ir(t.serviceMapQuery||"");return s.createElement("div",null,s.createElement(R.Z,null,s.createElement(T._,{label:"Filter",labelWidth:14,grow:!0},s.createElement(Dr.F,{datasource:{uid:e},filters:c,baseFilters:[{key:"__name__",operator:"=~",value:"traces_service_graph_request_total|traces_spanmetrics_calls_total",condition:""}],addFilter:u=>{a({...t,serviceMapQuery:Ot([...c,u])})},removeFilter:u=>{const m=[...c];m.splice(u,1),a({...t,serviceMapQuery:Ot(m)})},changeFilter:(u,m)=>{const p=[...c];p.splice(u,1,m),a({...t,serviceMapQuery:Ot(p)})}}))),l===!1?ht("No service graph data found","Please ensure that service graph metrics are set up correctly",r):null)}function ht(e,t,a){return s.createElement(xe.b,{title:e,severity:"info",className:a.alert},t," according to the"," ",s.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://grafana.com/docs/grafana/latest/datasources/tempo/service-graph/",className:a.link},"Tempo documentation"),".")}function Ir(e){let t,a=[];const r=/([\w_]+)(=|!=|<|>|=~|!~)"(.*?)"/g;for(;(t=r.exec(e))!==null;)a.push({key:t[1],operator:t[2],value:t[3],condition:""});return a}function Ot(e){return`{${e.map(t=>`${t.key}${t.operator}"${t.value}"`).join(",")}}`}const Nr=e=>({alert:(0,x.css)`
    max-width: 75ch;
    margin-top: ${e.spacing(2)};
  `,link:(0,x.css)`
    color: ${e.colors.text.link};
    text-decoration: underline;
  `}),Mr={};var $r=(e=>(e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.INTERNAL=1]="INTERNAL",e[e.SERVER=2]="SERVER",e[e.CLIENT=3]="CLIENT",e[e.PRODUCER=4]="PRODUCER",e[e.CONSUMER=5]="CONSUMER",e))($r||{}),Gt=o(25761);const Zt=Gt.WQ.deserialize({version:14,states:"/YO]QPOOP!^OPOOO]QPO'#CkO#QQPO'#CjO%eQQO'#ClOOQO'#DP'#DPOOQO'#DO'#DOO%lQPO'#DOO%qQSO'#C{OOQO'#C|'#C|O%yQPO'#C|O&UQPO'#DRO&ZQPO'#DSO&`QSO'#DUOOQO'#Cj'#CjQ&eQPOOOOQO'#C`'#C`P'SO!bO'#C^POOO)C>})C>}O'_QPO,59VO'fQSO,59hO'qQPO,59TO(cQPO,58zO(jQPO,59VO(jQPO,59VO(jQPO,59VO(jQPO,59VO(jQPO,59VO(jQPO,59VO(jQPO,59VOOQO'#Co'#CoOOQO'#Cu'#CuO(oQWO'#CuO)WQ`O'#CwO)]QPO'#CwO#[QQO'#CmO)bQWO,59WO#[QQO'#CmOOQO'#Cm'#CmOOQO,59W,59WO#[QQO,59jO)pQPO,59hO)pQPO,59gOOQO,59h,59hO#[QQO,59mO#[QQO,59nOOQO,59p,59pO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zO]QPO,58zPOOO'#DV'#DVP*eO!bO,58xPOOO,58x,58xOOQO1G.q1G.qOOQO1G/S1G/SOOQO1G.o1G.oOOQO1G.f1G.fO(jQPO'#CkO+bQPO1G.qO,ZQPO1G.qO,bQPO1G.qO-ZQPO1G.qO-bQPO1G.qO-iQPO1G.qO-pQ`O,59cOOQO,59c,59cO-{Q`O,59cO.QQWO,59XO#[QQO,59XO#[QQO,59XO#[QQO,59XOOQO1G.r1G.rO.`QWO,59XO.tQWO1G/UO)pQPO'#C|O/SQpO1G/RO/zQWO1G/XO0YQWO'#DTO0kQPO1G/YO1eQPO1G.fO2^QPO1G.fO2eQPO1G.fO3^QPO1G.fO3eQPO1G.fO3lQPO1G.fO4eQPO1G.fO4lQPO1G.fPOOO-E7T-E7TPOOO1G.d1G.dO4sQPO,59VOOQO1G.}1G.}O5_QPO1G.}OOQO1G.s1G.sO5uQWO1G.sO5|QWO1G.sOOQO7+$p7+$pO6TQSO,59hOOQO7+$s7+$sO#[QQO,59oOOQO7+$t7+$tO6]Q`O7+$iO6bQWO1G/ZOOQO<<HT<<HT",stateData:"7Q~O|OSPOS}PQ~OeXOfXOgXOhXO!RQO!USO!WYO!pUO!qTO!rTO!sTO!tTO!uZO!v[O!x]O~O}aO~OTgOUhOVjOWiOXkOYlO!TmOZ^X[^X~Oz^X!S^X~P!cOdnOenOfnOgnOhnOjpOmrOnrO!RsO!WuO!XuO!YnO!ZnO![nO!]nO!^nO!_nO!`nO!anO!bnO!cnO!dnO!enO!foO!goO!hoO!ioO!joO!koO!loO!moO!noO!oqO~O!VwO~P#[O!RxO~OqyOtzO~Oe{Of{Og{O~O!R|O~O!R}O~O!y!OO~OT!POU!QOV!ROW!SOX!TOY!UOZ!WO[!XO!T!VO~O!O!YO!P!YO!Q![O~O!S!]O~P!cOqyOtzO!S!^O~O!S!_OTSXUSXVSXWSXXSXYSXZSX[SX!TSX~O!S!`O~P&eO!R!aO~O!o!hOTiXYiXbiX!ViX!SiX!wiX~Ol!iO~O!o!jO~OT!mOY!nOb!lO!V!oO~OeXOfXOgXOhXO!R!rO!WYO!pUO!qTO!rTO!sTO!tTO~O!O!YO!P!YO!Q#QO~OUhOVjOWiOXkO!TmOY_iZ_i[_iz_i!S_i~OT_i~P*pOUhOT_iV_iX_iY_iZ_i[_iz_i!T_i!S_i~OW_i~P+iOWiO~P+iOUhOVjOWiOT_iY_iZ_i[_iz_i!T_i!S_i~OX_i~P,iOTgO~P*pOXkO~P,iOl#SOm#TOn#TO~Ol#SO~OT!mOY!nOb!lO!S#UO~OT!mOY!nOb!lO!Vaa!Saa!waa~OT!mOY!nOb!lO!S#XO~OqyOToiUoiVoiWoiXoiYoiZoi[oizoi!Toi!Soi~OT!mOY!nOb!lO!S#ZO~OT!mOY!nOb!lO!SwX!wwX~O!S#]O!w#[O~OU!QOV!ROW!SOX!TO!T!VOYSiZSi[SizSi!SSi~OTSi~P0sOU!QOTSiVSiXSiYSiZSi[SizSi!TSi!SSi~OW!SO~P1lOWSi~P1lOU!QOV!ROW!SOTSiYSiZSi[SizSi!TSi!SSi~OXSi~P2lOT!PO~P0sOX!TO~P2lOT!POU!QOV!ROW!SOX!TOY!UO!T!VO[SizSi!SSi~OZSi~P3sOZ!WO~P3sOTgOUhOVjOWiOXkOYlO!S!]O!TmO~O!o#^O~Ob!lOYai!Vai!Sai!wai~OTai~P5dOT!mO~P5dOqyO!S!^O~Ol#`O~OT!mOY!nOb!lO!Swi!wwi~OfgePqbjmjnln~",goto:"&tzPP{P!OPPPPPPPP!q#O#_$W$eP%TPPPPP%TP%TPPP$W%aP%y&ZP$W$W&k$W&nRbPQ_OQfQQ!`!QQ!w!PQ!x!RQ!y!SQ!z!TQ!{!UQ!|!VQ!}!WR#O!Xg`OQ!P!Q!R!S!T!U!V!W!Xd`O!P!Q!R!S!T!U!V!W!XReQdRO!P!Q!R!S!T!U!V!W!XQcQQ!]hQ!bgQ!ciQ!djQ!ekQ!flQ!gmR#R!ag^OQ!P!Q!R!S!T!U!V!W!XQtSQ!ksQ!puQ!qxQ!t|Q!u}Q#U!lQ#V!mQ#W!nR#_#[evSsux|}!l!m!n#[dWO!P!Q!R!S!T!U!V!W!XQdQQ!^yQ!szR#Y!rmXOQyz!P!Q!R!S!T!U!V!W!X!rmVOQyz!P!Q!R!S!T!U!V!W!X!rR!v}Q!ZaR#P!Z",nodeNames:"\u26A0 LineComment BlockComment TraceQL SpansetPipelineExpression And Gt Desc Lt Anc Or Pipe ExperimentalOp WrappedSpansetPipeline SpansetPipeline SpansetExpression SpansetFilter FieldExpression FieldOp Static String Integer Float Duration TemplateVariable IntrinsicField Parent AttributeField Identifier Resource Span ScalarFilter ScalarExpression ScalarOp Aggregate AggregateExpression ComparisonOp GroupOperation SelectOperation SelectArgs CoalesceOperation",maxTerm:87,skippedNodes:[0,1,2,41],repeatNodeCount:1,tokenData:"%%V~R!`X^%Tpq%Tqr%xrs'Qst(dtu*juv2cvw3_wx(dxy3jyz3wz{2c{|2c|}3|}!O4R!O!P4[!P!Q4a!Q![5[![!](d!]!^(d!^!_6]!_!`6q!`!a6{!a!b(d!b!c(d!c!}(d#Q#R7a#R#S(d#S#T(d#T#U7h#U#V:^#V#W<U#W#X!,U#X#Y!3p#Y#Z!8b#Z#](d#]#^!=S#^#_(d#_#`!Dn#`#a(d#a#b!Hb#b#c!MU#c#d#$v#d#e#&n#e#f(d#f#g#3Q#g#h#Kz#h#i$7u#i#j$FT#j#o(d#o#p%$g#p#q%$l#q#r%$y#r#s%%O#y#z%T$f$g%T#BY#BZ%T$IS$I_%T$I|$JO%T$JT$JU%T$KV$KW%T&FU&FV%T~%YY|~X^%Tpq%T#y#z%T$f$g%T#BY#BZ%T$IS$I_%T$I|$JO%T$JT$JU%T$KV$KW%T&FU&FV%T#Q%}S!XS!^!_&Z!_!`&h!`!a&o#r#s&w!d&`P[!d!^!_&c!d&hO[!dh&oOtWb`!d&tP[!d!`!a&c!|'QOtW[!db`t'TVOr'Qrs'js#O'Q#O#P*Z#P;'S'Q;'S;=`*d<%lO'Qt'qZdSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dp(iZlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dp)_VOr)[rs(ds#O)[#O#P)t#P;'S)[;'S;=`)}<%lO)[p)wQrs)[#O#P)[p*QP;=`<%l)[p*WP;=`<%l(dt*^Qrs'Q#O#P'Qt*gP;=`<%l'Qv*oelpOp(drs,Qst,jtu,juv,jwx,jz|,j}![(d![!],j!]!^,j!a!b,j!b!c,j!c!},j!}#Q(d#R#S,j#S#T,j#T#o,j#o#p-y#s;'S(d;'S;=`*T<%lO(dv,TVOr,Qrs,js#O,Q#O#P-j#P;'S,Q;'S;=`-s<%lO,Qv,qZhUlpOp,jrs,Qsv,jwx,jz|,j}!^,j!a#Q,j#R#o,j#s;'S,j;'S;=`-d<%lO,jv-gP;=`<%l,jv-mQrs,Q#O#P,Qv-vP;=`<%l,Qv-|^rs.xst/btu/buv/bwx/bz|/b![!]/b!]!^/b!a!b/b!b!c/b!c!}/b#R#S/b#S#T/b#T#o/bv.{VOr.xrs/bs#O.x#O#P2S#P;'S.x;'S;=`2]<%lO.xv/e^Op/brs.xsv/bwx/bz|/b}![/b![!]0a!]!^/b!a#Q/b#R#o/b#q#r1u#s;'S/b;'S;=`1|<%lO/bv0deOp/brs.xsv/bwx/bz|/b}!O/b!O!P0a!P!Q/b!Q![0a![!]0a!]!^/b!a!c/b!c!}0a!}#Q/b#R#S0a#S#T/b#T#o0a#q#r1u#s;'S/b;'S;=`1|<%lO/bv1|OhUlpv2PP;=`<%l/bv2VQrs.x#O#P.xv2`P;=`<%l.x#l2lZq!jb`lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~3bPvw3e~3jOT~^3oP!RUyz3rW3wO!yW~3|O!S~~4RO!w~#Q4[O!WUq!jb`~4aO!o~~4hQq!jb`z{4n!P!Q4s~4sO}~~4xSP~OY4sZ;'S4s;'S;=`5U<%lO4s~5XP;=`<%l4s~5aTe~!O!P5p!Q![5[#[#]6O#a#b6T#g#h6O~5sP!Q![5v~5{Pf~!Q![5v~6TOg~~6YPg~#g#h6O!|6fQtWW!db`!^!_6l!_!`&h!d6qOX!dh6xPtWb`#r#s&h!|7UQtWU!db`!_!`&h!`!a7[!d7aOV!d!z7hOq!jb`r7m]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k8f#k#o(d#s;'S(d;'S;=`*T<%lO(dr8k]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#Z(d#Z#[9d#[#o(d#s;'S(d;'S;=`*T<%lO(dr9kZ!sQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr:c]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#m(d#m#n;[#n#o(d#s;'S(d;'S;=`*T<%lO(dr;cZ!uQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dv<ZalpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#[(d#[#]=`#]#`(d#`#aEx#a#c(d#c#dJj#d#o(d#s;'S(d;'S;=`*T<%lO(dt=e]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^>^#^#o(d#s;'S(d;'S;=`*T<%lO(dt>c]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a?[#a#o(d#s;'S(d;'S;=`*T<%lO(dt?a]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#X@Y#X#o(d#s;'S(d;'S;=`*T<%lO(dt@_]lpOp(drs)[sv(dwx(dz|(d}!^(d!a!e(d!e!fAW!f#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dtA]]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#dBU#d#o(d#s;'S(d;'S;=`*T<%lO(dtBZ]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#jCS#j#o(d#s;'S(d;'S;=`*T<%lO(dtCX]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#cDQ#c#o(d#s;'S(d;'S;=`*T<%lO(dtDV]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#iEO#i#o(d#s;'S(d;'S;=`*T<%lO(dtEVZ!fSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dtE}]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^Fv#^#o(d#s;'S(d;'S;=`*T<%lO(dtF{]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#YGt#Y#o(d#s;'S(d;'S;=`*T<%lO(dtGy]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#cHr#c#o(d#s;'S(d;'S;=`*T<%lO(dtHw]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#iIp#i#o(d#s;'S(d;'S;=`*T<%lO(dtIwZ!cSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dvJoalpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#UKt#U#b(d#b#c!#d#c#i(d#i#j!)S#j#o(d#s;'S(d;'S;=`*T<%lO(drKy]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#aLr#a#o(d#s;'S(d;'S;=`*T<%lO(drLw]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#YMp#Y#o(d#s;'S(d;'S;=`*T<%lO(drMu]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#hNn#h#o(d#s;'S(d;'S;=`*T<%lO(drNs]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W! l#W#o(d#s;'S(d;'S;=`*T<%lO(dr! q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!!j#Y#o(d#s;'S(d;'S;=`*T<%lO(dr!!qZ!xQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!#i]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h!$b#h#o(d#s;'S(d;'S;=`*T<%lO(dt!$g]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j!%`#j#o(d#s;'S(d;'S;=`*T<%lO(dt!%e]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b!&^#b#o(d#s;'S(d;'S;=`*T<%lO(dt!&c]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!'[#Y#o(d#s;'S(d;'S;=`*T<%lO(dt!'a]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!(Y#g#o(d#s;'S(d;'S;=`*T<%lO(dt!(aZ!eSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr!)X]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!*Q#c#o(d#s;'S(d;'S;=`*T<%lO(dr!*V]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i!+O#i#o(d#s;'S(d;'S;=`*T<%lO(dr!+T[lpOp(drs)[sv(dwx(dxy!+yz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dQ!+|Pyz!,PQ!,UO!pQt!,Z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j!-S#j#o(d#s;'S(d;'S;=`*T<%lO(dt!-X]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!.Q#g#o(d#s;'S(d;'S;=`*T<%lO(dt!.V]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!/O#U#o(d#s;'S(d;'S;=`*T<%lO(dt!/T]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i!/|#i#o(d#s;'S(d;'S;=`*T<%lO(dt!0R]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^!0z#^#o(d#s;'S(d;'S;=`*T<%lO(dt!1P]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d!1x#d#o(d#s;'S(d;'S;=`*T<%lO(dt!1}]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!2v#c#o(d#s;'S(d;'S;=`*T<%lO(dt!2}Z!gSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!3u]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!4n#g#o(d#s;'S(d;'S;=`*T<%lO(dt!4s]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!5l#g#o(d#s;'S(d;'S;=`*T<%lO(dt!5q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d!6j#d#o(d#s;'S(d;'S;=`*T<%lO(dt!6o]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!7h#g#o(d#s;'S(d;'S;=`*T<%lO(dt!7oZ!^SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!8g]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!9`#U#o(d#s;'S(d;'S;=`*T<%lO(dt!9e]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a!:^#a#o(d#s;'S(d;'S;=`*T<%lO(dt!:c]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h!;[#h#o(d#s;'S(d;'S;=`*T<%lO(dt!;a]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!<Y#Y#o(d#s;'S(d;'S;=`*T<%lO(dt!<aZ!ZSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!=X]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!>Q#c#o(d#s;'S(d;'S;=`*T<%lO(dt!>V]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i!?O#i#o(d#s;'S(d;'S;=`*T<%lO(dt!?T]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y!?|#Y#o(d#s;'S(d;'S;=`*T<%lO(dt!@R]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g!@z#g#o(d#s;'S(d;'S;=`*T<%lO(dt!AP]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!Ax#c#o(d#s;'S(d;'S;=`*T<%lO(dt!A}]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!Bv#U#o(d#s;'S(d;'S;=`*T<%lO(dt!B{]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a!Ct#a#o(d#s;'S(d;'S;=`*T<%lO(dt!C{Z!aSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!Ds]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^!El#^#o(d#s;'S(d;'S;=`*T<%lO(dt!Eq]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!Fj#c#o(d#s;'S(d;'S;=`*T<%lO(dt!Fo]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#X!Gh#X#o(d#s;'S(d;'S;=`*T<%lO(dt!GoZ!hSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr!Hg_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!If#U#](d#]#^!K^#^#o(d#s;'S(d;'S;=`*T<%lO(dr!Ik]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#l(d#l#m!Jd#m#o(d#s;'S(d;'S;=`*T<%lO(dr!JkZ!qQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr!Kc]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c!L[#c#o(d#s;'S(d;'S;=`*T<%lO(dr!LcZ!rQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt!MZ_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U!NY#U#](d#]#^##O#^#o(d#s;'S(d;'S;=`*T<%lO(dt!N_]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b# W#b#o(d#s;'S(d;'S;=`*T<%lO(dt# ]]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#!U#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#!]Z!iSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt##T]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a##|#a#o(d#s;'S(d;'S;=`*T<%lO(dt#$TZ![SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#${]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#_(d#_#`#%t#`#o(d#s;'S(d;'S;=`*T<%lO(dt#%{Z!]SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~#&s_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U#'r#U#f(d#f#g#,d#g#o(d#s;'S(d;'S;=`*T<%lO(d~#'w]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g#(p#g#o(d#s;'S(d;'S;=`*T<%lO(d~#(u]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#)n#Y#o(d#s;'S(d;'S;=`*T<%lO(d~#)s]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c#*l#c#o(d#s;'S(d;'S;=`*T<%lO(d~#*q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i#+j#i#o(d#s;'S(d;'S;=`*T<%lO(d~#+qZj~lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#,i]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d#-b#d#o(d#s;'S(d;'S;=`*T<%lO(dt#-g]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#X#.`#X#o(d#s;'S(d;'S;=`*T<%lO(dt#.e]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j#/^#j#o(d#s;'S(d;'S;=`*T<%lO(dt#/c]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W#0[#W#o(d#s;'S(d;'S;=`*T<%lO(dt#0a]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#1Y#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#1_]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g#2W#g#o(d#s;'S(d;'S;=`*T<%lO(dt#2_Z!dSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~#3V_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#4U#Y#c(d#c#d#:r#d#o(d#s;'S(d;'S;=`*T<%lO(d~#4Z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h#5S#h#o(d#s;'S(d;'S;=`*T<%lO(d~#5X]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d#6Q#d#o(d#s;'S(d;'S;=`*T<%lO(d~#6V]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j#7O#j#o(d#s;'S(d;'S;=`*T<%lO(d~#7T]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g#7|#g#o(d#s;'S(d;'S;=`*T<%lO(d~#8R]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W#8z#W#o(d#s;'S(d;'S;=`*T<%lO(d~#9P]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#9x#Y#o(d#s;'S(d;'S;=`*T<%lO(d~#:PZm~lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#:w]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d#;p#d#o(d#s;'S(d;'S;=`*T<%lO(dt#;u]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i#<n#i#o(d#s;'S(d;'S;=`*T<%lO(dt#<s_lpOp(drs)[sv(dwx(dz|(d}!^(d!a!p(d!p!q#=r!q!u(d!u!v#Af!v#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#=w]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U#>p#U#o(d#s;'S(d;'S;=`*T<%lO(dt#>u]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b#?n#b#o(d#s;'S(d;'S;=`*T<%lO(dt#?s]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#@l#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#@sZ!jSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#Ak]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#Bd#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#Bi]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g#Cb#g#o(d#s;'S(d;'S;=`*T<%lO(dt#Cg]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k#D`#k#o(d#s;'S(d;'S;=`*T<%lO(dt#De]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^#E^#^#o(d#s;'S(d;'S;=`*T<%lO(dt#Ec]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W#F[#W#o(d#s;'S(d;'S;=`*T<%lO(dt#Fa]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#GY#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#G_]lpOp(drs)[sv(dwx(dz|(d}!^(d!a!p(d!p!q#HW!q#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt#H]]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U#IU#U#o(d#s;'S(d;'S;=`*T<%lO(dt#IZ]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b#JS#b#o(d#s;'S(d;'S;=`*T<%lO(dt#JX]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#KQ#Y#o(d#s;'S(d;'S;=`*T<%lO(dt#KXZ!kSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~#LPblpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y#MX#Y#d(d#d#e$'s#e#h(d#h#i$*i#i#j$5}#j#o(d#s;'S(d;'S;=`*T<%lO(dv#M^_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#`(d#`#a#N]#a#f(d#f#g$$P#g#o(d#s;'S(d;'S;=`*T<%lO(dr#Nb]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$ Z#Y#o(d#s;'S(d;'S;=`*T<%lO(dr$ `]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W$!X#W#o(d#s;'S(d;'S;=`*T<%lO(dr$!^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$#V#i#o(d#s;'S(d;'S;=`*T<%lO(dr$#^Z!vQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$$U]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#j(d#j#k$$}#k#o(d#s;'S(d;'S;=`*T<%lO(dt$%S]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$%{#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$&Q]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g$&y#g#o(d#s;'S(d;'S;=`*T<%lO(dt$'QZ!bSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~$'x]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$(q#U#o(d#s;'S(d;'S;=`*T<%lO(d~$(v]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c$)o#c#o(d#s;'S(d;'S;=`*T<%lO(d~$)vZn~lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$*n]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$+g#U#o(d#s;'S(d;'S;=`*T<%lO(dt$+l]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$,e#i#o(d#s;'S(d;'S;=`*T<%lO(dt$,j]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j$-c#j#o(d#s;'S(d;'S;=`*T<%lO(dt$-h]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h$.a#h#o(d#s;'S(d;'S;=`*T<%lO(dt$.h]!lSlpOp(drs)[sv(dwx(dz|(d}!^(d!a!o(d!o!p$/a!p#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$/f]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$0_#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$0d]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h$1]#h#o(d#s;'S(d;'S;=`*T<%lO(dt$1b]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h$2Z#h#o(d#s;'S(d;'S;=`*T<%lO(dt$2`]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$3X#U#o(d#s;'S(d;'S;=`*T<%lO(dt$3^]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#Z(d#Z#[$4V#[#o(d#s;'S(d;'S;=`*T<%lO(dt$4[]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$5T#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$5[Z!mSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dr$6S]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#a(d#a#b$6{#b#o(d#s;'S(d;'S;=`*T<%lO(dr$7SZ!tQlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$7z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g$8s#g#o(d#s;'S(d;'S;=`*T<%lO(dt$8x_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$9w#U#i(d#i#j$D]#j#o(d#s;'S(d;'S;=`*T<%lO(dt$9|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W$:u#W#o(d#s;'S(d;'S;=`*T<%lO(dt$:z]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$;s#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$;x]lpOp(drs)[sv(dwx(dz|(d}!^(d!a!f(d!f!g$<q!g#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$<v]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#i(d#i#j$=o#j#o(d#s;'S(d;'S;=`*T<%lO(dt$=t]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#f(d#f#g$>m#g#o(d#s;'S(d;'S;=`*T<%lO(dt$>r]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#T(d#T#U$?k#U#o(d#s;'S(d;'S;=`*T<%lO(dt$?p]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$@i#i#o(d#s;'S(d;'S;=`*T<%lO(dt$@n]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^$Ag#^#o(d#s;'S(d;'S;=`*T<%lO(dt$Al]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#c(d#c#d$Be#d#o(d#s;'S(d;'S;=`*T<%lO(dt$Bj]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c$Cc#c#o(d#s;'S(d;'S;=`*T<%lO(dt$CjZ!nSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$Db]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$EZ#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$EbZ!YSlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$FY]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#b(d#b#c$GR#c#o(d#s;'S(d;'S;=`*T<%lO(dt$GW]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#g(d#g#h$HP#h#o(d#s;'S(d;'S;=`*T<%lO(dt$HU_lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$IT#Y#d(d#d#e$J{#e#o(d#s;'S(d;'S;=`*T<%lO(dt$IY]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#h(d#h#i$JR#i#o(d#s;'S(d;'S;=`*T<%lO(dt$JYZ!_SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(dt$KQ]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y$Ky#Y#o(d#s;'S(d;'S;=`*T<%lO(dt$LO]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#V(d#V#W$Lw#W#o(d#s;'S(d;'S;=`*T<%lO(dt$L|]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^$Mu#^#o(d#s;'S(d;'S;=`*T<%lO(dt$Mz]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#Y(d#Y#Z$Ns#Z#o(d#s;'S(d;'S;=`*T<%lO(dt$Nx]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#](d#]#^% q#^#o(d#s;'S(d;'S;=`*T<%lO(dt% v]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#X(d#X#Y%!o#Y#o(d#s;'S(d;'S;=`*T<%lO(dt%!t]lpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#W(d#W#X%#m#X#o(d#s;'S(d;'S;=`*T<%lO(dt%#tZ!`SlpOp(drs)[sv(dwx(dz|(d}!^(d!a#Q(d#R#o(d#s;'S(d;'S;=`*T<%lO(d~%$lO!U~~%$qPZ~#p#q%$t~%$yOY~~%%OO!V~!t%%VO!T!db`",tokenizers:[1,2,3,4,5,6,new Gt.RA("j~RQYZXz{^~^O!P~~aP!P!Qd~iO!Q~~",25,46)],topRules:{TraceQL:[0,3]},tokenPrec:1001}),Ys=1,Gs=2,Lr=3,Ge=4,Kt=5,Zs=6,Ks=7,qs=8,Hs=9,qt=10,Ht=11,Js=12,en=13,zr=14,tn=15,Ze=16,ne=17,vt=18,St=19,Ar=20,an=21,rn=22,sn=23,nn=24,Tt=25,ln=26,ze=27,on=28,dn=29,cn=30,Jt=31,_r=32,un=33,Ke=34,pn=35,ea=36,Wr=37,mn=38,Vr=39,gn=40;function ta(e,t){const a=e.cursorAt(t);do if(a.from===t||a.to===t){const{node:r}=a;if(r.type.isError)return r}while(a.next());return null}function Ur(e,t){return e[t]}function me(e,t){let a=e;for(const[r,n]of t)if(a=Ur(a,r),a===null||n.find(l=>l===a?.type.id)===void 0)return null;return a}function qe(e,t){return t.slice(e.from===e.to?e.from-1:e.from,e.to)}function jr(e,t){return e.every((a,r)=>a===t[r])}function Fr(e,t){if(e==="")return{query:e,type:"EMPTY"};const a=Zt.parse(e);let r=t;for(;r-1>=0&&e[r-1]===" ";)r-=1;let n=ta(a,r);n||(n=ta(a,r-1));const l=n!=null?n.cursor():a.cursorAt(r),i=l.node,d=[l.type.id];for(;l.parent();)d.push(l.type.id);let c;for(let u of Br)jr(u.path,d)&&(c=u.fun(i,e,r,t));return{query:e,...c??{type:"UNKNOWN"}}}const Ee=0,Br=[{path:[Ee,ze],fun:Xr},{path:[Ee,ne],fun:ra},{path:[Ee,Ze],fun:Gr},{path:[Ee,Ke],fun:na},{path:[Ee,Tt],fun:na},{path:[Ee,Ge],fun:Yr},{path:[Ee,Jt,zr],fun:kr},{path:[ne],fun:aa},{path:[Ze],fun:aa},{path:[Ge],fun:sa},{path:[Lr],fun:sa},{path:[Ar,St],fun:ra}],yt=(e,t,a)=>{const r=i=>{const d=me(i,[["firstChild",[ze]]]),c=d?qe(d,t):"",u=c.indexOf(".");return c.slice(0,u)};if(t[a-1]===" ")return;const n=me(e,[["firstChild",[ne]]]);if(n)return{type:"SPANSET_IN_NAME_SCOPE",scope:r(n)};const l=me(e,[["parent",[Ze]],["firstChild",[ne]]]);if(l&&t[a]!==" ")return{type:"SPANSET_IN_NAME_SCOPE",scope:r(l)}};function aa(e,t,a,r){const n=yt(e,t,r);if(n)return n;let l=me(e,[["firstChild",[ne]],["firstChild",[ze]]]);return l?{type:"SPANSET_EXPRESSION_OPERATORS"}:(l=me(e,[["lastChild",[ne]],["lastChild",[ne]],["lastChild",[St]]]),l?{type:"SPANFIELD_COMBINING_OPERATORS"}:(l=me(e,[["lastChild",[ne]]]),l?{type:"SPANSET_EXPRESSION_OPERATORS"}:{type:"SPANSET_EMPTY"}))}function Xr(e,t){const a=me(e,[["parent",[ze]]]),r=a?qe(a,t):"";if(r===".")return{type:"SPANSET_ONLY_DOT"};const n=r.indexOf("."),l=r.slice(0,n);return["span","resource","parent"].find(i=>i===l)?{type:"SPANSET_IN_NAME_SCOPE",scope:l}:{type:"SPANSET_IN_NAME"}}function ra(e,t,a,r){const n=yt(e,t,r);if(n)return n;if(me(e,[["parent",[St]],["parent",[ne]],["prevSibling",[vt]]])){let l=e.parent?.parent?.prevSibling?.prevSibling;if(l)return{type:"SPANSET_IN_VALUE",tagName:qe(l,t),betweenQuotes:!0}}if(e.prevSibling?.type.id===vt){let l=e.prevSibling?.prevSibling;if(l)return{type:"SPANSET_IN_VALUE",tagName:qe(l,t),betweenQuotes:!1}}return e.prevSibling?.type.name==="And"||e.prevSibling?.type.name==="Or"?{type:"SPANSET_EMPTY"}:{type:"SPANSET_IN_THE_MIDDLE"}}function kr(e,t,a){if(e.prevSibling?.type.id!==ea)return{type:"SPANSET_COMPARISON_OPERATORS"}}function sa(e,t,a){let r=e.firstChild;try{for(r=e.firstChild;r.to<a;)r=r.nextSibling}catch(n){console.error("Unexpected error while searching for previous node",n)}return r?.type.id===Kt||r?.type.id===qt?{type:"NEW_SPANSET"}:{type:"SPANSET_COMBINING_OPERATORS"}}function na(e,t,a){const r=e?.parent;if(r&&[Tt,Ke,Wr,Vr].includes(r.type.id))return{type:"ATTRIBUTE_FOR_FUNCTION"}}function Yr(e,t,a){return e.prevSibling?.type.id===Ht?{type:"SPANSET_PIPELINE_AFTER_OPERATOR"}:{type:"NEW_SPANSET"}}function Gr(e,t,a){const r=yt(e,t,a);return r||{type:"SPANSET_EXPRESSION_OPERATORS_WITH_MISSING_CLOSED_BRACE"}}const B=class{constructor(e){this.triggerCharacters=["{",".","[","(","=","~"," ",'"'],this.cachedValues={},this.languageProvider=e.languageProvider,this.registerInteractionCommandId=null}provideCompletionItems(e,t){if(!(this.monaco&&this.editor))throw new Error("provideCompletionItems called before CompletionProvider was initialized");if(this.editor.getModel()?.id!==e.id)return{suggestions:[]};const{range:a,offset:r}=Kr(this.monaco,e,t),n=Fr(e.getValue(),r);return(n!=null?this.getCompletions(n):Promise.resolve([])).then(i=>{const d=i.length.toString().length;return{suggestions:i.map((u,m)=>{const p={kind:Zr(u.type,this.monaco),label:u.label,insertText:u.insertText,insertTextRules:u.insertTextRules,detail:u.detail,documentation:u.documentation,sortText:m.toString().padStart(d,"0"),range:a,command:{id:this.registerInteractionCommandId||"noOp",title:"Report Interaction",arguments:[u.label,u.type]}};return qr(p,u.type,e,r),p})}})}setRegisterInteractionCommandId(e){this.registerInteractionCommandId=e}async getTagValues(e,t){let a;const r=`${e}:${t}`;return this.cachedValues.hasOwnProperty(r)?a=this.cachedValues[r]:(a=await this.languageProvider.getOptionsV2(e,t),this.cachedValues[r]=a),a}async getCompletions(e){switch(e.type){case"UNKNOWN":return[];case"EMPTY":return this.getScopesCompletions("{ ").concat(this.getIntrinsicsCompletions("{ ")).concat(this.getTagsCompletions("{ ."));case"SPANSET_EMPTY":return this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions("."));case"SPANSET_ONLY_DOT":return this.getTagsCompletions();case"SPANSET_IN_THE_MIDDLE":return[...B.comparisonOps,...B.logicalOps].map(i=>({...i,type:"OPERATOR"}));case"SPANSET_EXPRESSION_OPERATORS_WITH_MISSING_CLOSED_BRACE":return[...B.comparisonOps,...B.logicalOps].map(i=>({...i,type:"OPERATOR"}));case"SPANSET_IN_NAME":return this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions());case"SPANSET_IN_NAME_SCOPE":return this.getTagsCompletions(void 0,e.scope);case"SPANSET_EXPRESSION_OPERATORS":return[...B.comparisonOps,...B.logicalOps,...B.arithmeticOps].map(i=>({...i,type:"OPERATOR"}));case"SPANFIELD_COMBINING_OPERATORS":return[...B.logicalOps,...B.arithmeticOps,...B.comparisonOps].map(i=>({...i,type:"OPERATOR"}));case"SPANSET_COMBINING_OPERATORS":return B.spansetOps.map(i=>({...i,type:"OPERATOR"}));case"SPANSET_PIPELINE_AFTER_OPERATOR":const t=B.functions.map(i=>({...i,insertTextRules:this.monaco?.languages.CompletionItemInsertTextRule?.InsertAsSnippet,type:"FUNCTION"})),a=this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions("."));return[...t,...a];case"SPANSET_COMPARISON_OPERATORS":return B.comparisonOps.map(i=>({...i,type:"OPERATOR"}));case"SPANSET_IN_VALUE":let r;try{r=await this.getTagValues(e.tagName,e.query)}catch(i){(0,Qe.kW)(i)?(0,pe.WI)((0,De.$l)((0,ue.t_)(i.data.error,new Error(i.data.message)))):i instanceof Error&&(0,pe.WI)((0,De.$l)((0,ue.t_)("Error",i)))}const n=[],l=i=>e.betweenQuotes?i.label:i.type==="string"?`"${i.label}"`:i.label;return r?.forEach(i=>{i?.label&&n.push({label:i.label,insertText:l(i),type:"TAG_VALUE"})}),n;case"SPANSET_AFTER_VALUE":return B.logicalOps.map(i=>({label:i.label,insertText:i.insertText+"}",type:"OPERATOR"}));case"NEW_SPANSET":return this.getScopesCompletions("{ ","$0 }").concat(this.getIntrinsicsCompletions("{ ","$0 }")).concat(this.getTagsCompletions("."));case"ATTRIBUTE_FOR_FUNCTION":return this.getScopesCompletions().concat(this.getIntrinsicsCompletions()).concat(this.getTagsCompletions("."));default:throw new Error(`Unexpected situation ${e}`)}}getTagsCompletions(e,t){return this.languageProvider.getTraceqlAutocompleteTags(t).sort((r,n)=>r.localeCompare(n,void 0,{sensitivity:"accent"})).map(r=>({label:r,insertText:(e||"")+r,type:"TAG_NAME"}))}getIntrinsicsCompletions(e,t){return je.map(a=>({label:a,insertText:(e||"")+a+(t||""),type:"KEYWORD",insertTextRules:this.monaco?.languages.CompletionItemInsertTextRule?.InsertAsSnippet}))}getScopesCompletions(e,t){return Mt.map(a=>({label:a,insertText:(e||"")+a+(t||""),type:"SCOPE",insertTextRules:this.monaco?.languages.CompletionItemInsertTextRule?.InsertAsSnippet}))}};let ge=B;ge.arithmeticOps=[{label:"+",insertText:"+",detail:"Plus"},{label:"-",insertText:"-",detail:"Minus"},{label:"*",insertText:"*",detail:"Times"},{label:"/",insertText:"/",detail:"Over"}],ge.logicalOps=[{label:"&&",insertText:"&&",detail:"And",documentation:"And (intersection) operator. Checks that both conditions found matches."},{label:"||",insertText:"||",detail:"Or",documentation:"Or (union) operator. Checks that either condition found matches."}],ge.comparisonOps=[{label:"=",insertText:"=",detail:"Equality"},{label:"!=",insertText:"!=",detail:"Inequality"},{label:">",insertText:">",detail:"Greater than"},{label:">=",insertText:">=",detail:"Greater than or equal to"},{label:"<",insertText:"<",detail:"Less than"},{label:"<=",insertText:"<=",detail:"Less than or equal to"},{label:"=~",insertText:"=~",detail:"Regular expression"},{label:"!~",insertText:"!~",detail:"Negated regular expression"}],ge.structuralOps=[{label:">>",insertText:">>",detail:"Descendant",documentation:"Descendant operator. Looks for spans matching {condB} that are descendants of a span matching {condA}"},{label:">",insertText:">",detail:"Child",documentation:"Child operator. Looks for spans matching {condB} that are direct child spans of a parent matching {condA}"},{label:"<<",insertText:"<<",detail:"Ancestor",documentation:"Ancestor operator. Looks for spans matching {condB} that are ancestors of a span matching {condA}"},{label:"<",insertText:"<",detail:"Parent",documentation:"Parent operator. Looks for spans matching {condB} that are direct parent spans of a child matching {condA}"},{label:"~",insertText:"~",detail:"Sibling",documentation:"Sibling operator. Checks that spans matching {condA} and {condB} are siblings of the same parent span."}],ge.spansetOps=[{label:"|",insertText:"|",detail:"Pipe"},...B.logicalOps,...B.structuralOps],ge.spansetAggregatorOps=[{label:"count",insertText:"count()$0",detail:"Number of spans",documentation:"Counts the number of spans in a spanset"},{label:"avg",insertText:"avg($0)",detail:"Average of attribute",documentation:"Computes the average of a given numeric attribute or intrinsic for a spanset."},{label:"max",insertText:"max($0)",detail:"Max value of attribute",documentation:"Computes the maximum value of a given numeric attribute or intrinsic for a spanset."},{label:"min",insertText:"min($0)",detail:"Min value of attribute",documentation:"Computes the minimum value of a given numeric attribute or intrinsic for a spanset."},{label:"sum",insertText:"sum($0)",detail:"Sum value of attribute",documentation:"Computes the sum value of a given numeric attribute or intrinsic for a spanset."}],ge.functions=[...B.spansetAggregatorOps,{label:"by",insertText:"by($0)",detail:"Grouping of attributes",documentation:"Groups by arbitrary attributes."},{label:"select",insertText:"select($0)",detail:"Selection of fields",documentation:"Selects arbitrary fields from spans."}];function Zr(e,t){switch(e){case"TAG_NAME":return t.languages.CompletionItemKind.Enum;case"KEYWORD":return t.languages.CompletionItemKind.Keyword;case"OPERATOR":return t.languages.CompletionItemKind.Operator;case"TAG_VALUE":return t.languages.CompletionItemKind.EnumMember;case"SCOPE":return t.languages.CompletionItemKind.Class;case"FUNCTION":return t.languages.CompletionItemKind.Function;default:throw new Error(`Unexpected CompletionType: ${e}`)}}function Kr(e,t,a){const r=t.getWordAtPosition(a),n=r!=null?e.Range.lift({startLineNumber:a.lineNumber,endLineNumber:a.lineNumber,startColumn:r.startColumn,endColumn:r.endColumn}):e.Range.fromPositions(a),l={column:a.column,lineNumber:a.lineNumber};return{offset:t.getOffsetAt(l),range:n}}function qr(e,t,a,r){if(t==="TAG_NAME"){const n=a.getValue().substring(0,r).match(/(span\.|resource\.|\.)?([\w./-]*)$/);if(n){const l=n[1],i=n[2];i&&(!l&&e.insertText[0]!=="."&&(e.insertText="."+e.insertText),e.range={...e.range,startColumn:r-i.length+1})}}}const Hr=e=>{switch(e.parent?.type.id){case ne:switch(e.prevSibling?.type.id){case Kt:case qt:return"Invalid value after logical operator.";case vt:return"Invalid value after comparison or arithmetic operator.";default:return"Invalid operator after field expression."}case Ze:return e.prevSibling?.type.id===ne?"Invalid comparison operator after field expression.":"Invalid expression for spanset.";case Ge:switch(e.prevSibling?.type.id){case Ge:return"Invalid spanset combining operator after spanset expression.";case Ht:return"Invalid aggregation operator after pipepile operator.";default:return"Invalid spanset expression after spanset combining operator."}case Tt:case Ke:return"Invalid expression for aggregator operator.";case ze:return"Invalid expression for spanset.";case Jt:switch(e.prevSibling?.type.id){case ea:return"Invalid value after comparison operator.";case _r:if(e.prevSibling?.firstChild?.type.id===Ke)return"Invalid comparison operator after aggregator operator.";default:return"Invalid value after comparison operator."}default:return"Invalid query."}},ia=e=>{if(e.trim()==="")return[];const t=/^[0-9A-Fa-f]*$/;if(e.trim().match(t))return[];const a=Zt.parse(e),r=[];return a.iterate({enter:n=>{n.type.id===0&&r.push(n.node)}}),r},Et=(e,t,a)=>{e.editor.setModelMarkers(t,"owner",a.map(r=>{let n=0,l=0,i=r.from,d=r.to;for(;i>0;)n++,i-=t.getLineLength(n)+1;for(;d>0;)l++,d-=t.getLineLength(l)+1;return{message:Hr(r),severity:e.MarkerSeverity.Error,startLineNumber:n,endLineNumber:l,startColumn:i+t.getLineLength(n)+2,endColumn:d+t.getLineLength(l)+2}}))};function Jr(e){const{onChange:t,onRunQuery:a,placeholder:r}=e,n=ss(e.datasource),l=(0,b.l4)(),i=is(l,r),d=(0,s.useRef)(a);d.current=a;const c=(0,s.useRef)();return s.createElement(jt.p,{value:e.value,language:Ae,onBlur:t,onChange:t,containerStyles:i.queryField,readOnly:e.readOnly,monacoOptions:{folding:!1,fontSize:14,lineNumbers:"off",overviewRulerLanes:0,renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,wordWrap:"on"},onBeforeEditorMount:ns,onEditorDidMount:(u,m)=>{e.readOnly||(n(u,m,as(u)),ts(u,m,()=>d.current()),es(u,m,i)),rs(u);const p=u.getModel();if(p){const h=ia(p.getValue());Et(m,p,h)}u.onDidChangeModelContent(h=>{const f=u.getModel();if(!f)return;window.clearTimeout(c.current);const w=ia(f.getValue()),U=h.changes[0].rangeOffset;Et(m,f,w.filter(q=>!(q.from<=U&&U<=q.to))),c.current=window.setTimeout(()=>{Et(m,f,w)},500)})}})}function es(e,t,a){const r=[{range:new t.Range(1,1,1,1),options:{className:a.placeholder,isWholeLine:!0}}];let n=[];const l=()=>{const i=e.getModel();if(!i)return;const d=i.getValueLength()===0?r:[];n=i.deltaDecorations(n,d)};l(),e.onDidChangeModelContent(l)}function ts(e,t,a){e.addAction({id:"run-query",label:"Run Query",keybindings:[t.KeyMod.Shift|t.KeyCode.Enter],contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(){a()}})}function as(e){return e.addCommand(0,function(t,a,r){const n={datasourceType:"tempo",type:r};r!=="TAG_VALUE"&&(n.label=a),(0,I.ff)("grafana_traces_traceql_completion",n)})}function rs(e){const t=e.getDomNode(),a=()=>{if(t){const r=Math.min(1e3,e.getContentHeight()),n=parseInt(t.style.width,10);t.style.width=`${n}px`,t.style.height=`${r}px`,e.layout({width:n,height:r})}};e.onDidContentSizeChange(a),a()}function ss(e){const t=(0,s.useRef)(new ge({languageProvider:e.languageProvider}));(0,s.useEffect)(()=>{(async()=>{try{await e.languageProvider.start()}catch(n){n instanceof Error&&(0,pe.WI)((0,De.$l)((0,ue.t_)("Error",n)))}})()},[e]);const a=(0,s.useRef)(null);return(0,s.useEffect)(()=>()=>{a.current?.()},[]),(r,n,l)=>{t.current.editor=r,t.current.monaco=n,t.current.setRegisterInteractionCommandId(l);const{dispose:i}=n.languages.registerCompletionItemProvider(Ae,t.current);a.current=i}}let la=!1;const Ae="traceql";function ns(e){if(!la){la=!0;const{aliases:t,extensions:a,mimetypes:r,def:n}=Qa;e.languages.register({id:Ae,aliases:t,extensions:a,mimetypes:r}),e.languages.setMonarchTokensProvider(Ae,n.language),e.languages.setLanguageConfiguration(Ae,n.languageConfiguration)}}const is=(e,t)=>({queryField:(0,x.css)`
      border-radius: ${e.shape.radius.default};
      border: 1px solid ${e.components.input.borderColor};
      flex: 1;
    `,placeholder:(0,x.css)`
      ::after {
        content: '${t}';
        font-family: ${e.typography.fontFamilyMonospace};
        opacity: 0.3;
      }
    `});function ls(e){const t=(0,b.wW)(os),a=(0,te.defaults)(e.query,Mr),[r,n]=(0,s.useState)(()=>{const i=Re(a.filters||[]);return i===a.query||i==="{}"}),l=i=>{e.onChange({...a,query:i})};return s.createElement(s.Fragment,null,s.createElement(N.W,null,"Build complex queries using TraceQL to select a list of traces."," ",s.createElement("a",{rel:"noreferrer",target:"_blank",href:"https://grafana.com/docs/tempo/latest/traceql/"},"Documentation")),!r&&s.createElement(N.W,null,s.createElement("div",null,"Continue editing the query from the Search tab?",s.createElement(_.zx,{variant:"secondary",size:"sm",onClick:()=>{(0,I.ff)("grafana_traces_copy_to_traceql_clicked",{app:e.app??"",grafana_version:Q.config.buildInfo.version,location:"traceql_tab"}),e.onClearResults(),e.onChange({...a,query:Re(a.filters||[])}),n(!0)},style:{marginLeft:"10px"}},"Copy query from Search"))),s.createElement(Jr,{placeholder:"Enter a TraceQL query or trace ID (run with Shift+Enter)",value:a.query||"",onChange:l,datasource:e.datasource,onRunQuery:e.onRunQuery}),s.createElement("div",{className:t.optionsContainer},s.createElement(gt,{query:a,onChange:e.onChange})))}const os=()=>({optionsContainer:(0,x.css)`
    margin-top: 10px;
  `}),ds="traceql";class cs extends s.PureComponent{constructor(t){super(t),this.onChangeLinkedQuery=a=>{const{query:r,onChange:n}=this.props;n({...r,linkedQuery:{...a,refId:"linked"}})},this.onRunLinkedQuery=()=>{this.props.onRunQuery()},this.onClearResults=()=>{const{onChange:a,query:r,onRunQuery:n}=this.props;a({...r,queryType:"clear"}),n()},this.state={uploadModalOpen:!1}}async componentDidMount(){(!this.props.query.queryType||this.props.query.queryType==="clear")&&this.props.onChange({...this.props.query,queryType:ds})}render(){const{query:t,onChange:a,datasource:r,app:n}=this.props,l=r.getLokiSearchDS(),i=r.serviceMap?.datasourceUid;let d=[{value:"traceqlSearch",label:"Search"},{value:"traceql",label:"TraceQL"},{value:"serviceMap",label:"Service Graph"}];return l&&(r?.search?.hide?d.unshift({value:"search",label:"Search"}):d.push({value:"search",label:"Loki Search"})),(t.spanName||t.serviceName||t.search||t.maxDuration||t.minDuration||t.queryType==="nativeSearch")&&d.unshift({value:"nativeSearch",label:"[Deprecated] Search"}),s.createElement(s.Fragment,null,s.createElement(A.u,{title:"Upload trace",isOpen:this.state.uploadModalOpen,onDismiss:()=>this.setState({uploadModalOpen:!1})},s.createElement("div",{className:(0,x.css)({padding:this.props.theme.spacing(2)})},s.createElement(j.Yo,{options:{multiple:!1},onLoad:c=>{this.props.datasource.uploadedJson=c,a({...t,queryType:"upload"}),this.setState({uploadModalOpen:!1}),this.props.onRunQuery()}}))),s.createElement(R.Z,null,s.createElement(T._,{label:"Query type",grow:!0},s.createElement(v.Lh,{spacing:"sm",align:"center",justify:"space-between"},s.createElement(E.S,{options:d,value:t.queryType,onChange:c=>{(0,I.ff)("grafana_traces_query_type_changed",{datasourceType:"tempo",app:n??"",grafana_version:Q.config.buildInfo.version,newQueryType:c,previousQueryType:t.queryType??""}),this.onClearResults(),a({...t,queryType:c})},size:"md"}),s.createElement(_.zx,{variant:"secondary",size:"sm",onClick:()=>{this.setState({uploadModalOpen:!0})}},"Import trace")))),t.queryType==="search"&&s.createElement(be,{logsDatasourceUid:l,query:t,onRunQuery:this.onRunLinkedQuery,onChange:this.onChangeLinkedQuery}),t.queryType==="nativeSearch"&&s.createElement(fr,{datasource:this.props.datasource,query:t,onChange:a,onBlur:this.props.onBlur,onRunQuery:this.props.onRunQuery}),t.queryType==="traceqlSearch"&&s.createElement(Rr,{datasource:this.props.datasource,query:t,onChange:a,onBlur:this.props.onBlur,app:n,onClearResults:this.onClearResults}),t.queryType==="serviceMap"&&s.createElement(Cr,{graphDatasourceUid:i,query:t,onChange:a}),t.queryType==="traceql"&&s.createElement(ls,{datasource:this.props.datasource,query:t,onRunQuery:this.props.onRunQuery,onChange:a,app:n,onClearResults:this.onClearResults}))}}const us=(0,b.HE)(cs);var ps=o(85510),ms=o(60466),gs=o(49875),fs=o(31388),oa=o(83717),hs=o(39592),He=o(98463),Os=o(41854),_e=o(5936),J=o(84655),vs=o(36662),bt=o(42302),Ss=o(46898),Ts=o(59326),X=o(44992),Qt=o(76772),xt=o(79228),ys=o(90540),Es=o(87580),bs=o(69256);function Qs({options:e,onOptionsChange:t}){const a=(0,s.useMemo)(()=>["grafana-pyroscope-datasource"],[]),[r,n]=(0,s.useState)([]),l=(0,s.useMemo)(()=>{let d=r.length===0?"No profile types found":"Select profile type";return e.jsonData.tracesToProfiles?.datasourceUid||(d="Please select profiling data source"),d},[e.jsonData.tracesToProfiles?.datasourceUid,r]),{value:i}=(0,Ts.Z)(async()=>await(0,z.F)().get(e.jsonData.tracesToProfiles?.datasourceUid),[e.jsonData.tracesToProfiles?.datasourceUid]);return(0,s.useEffect)(()=>{i&&i instanceof Es.tF&&a.includes(i.type)&&i.uid===e.jsonData.tracesToProfiles?.datasourceUid?i.getAllProfileTypes().then(d=>{n(d)}):n([])},[i,t,e,a]),s.createElement("div",{className:(0,x.css)({width:"100%"})},s.createElement(R.Z,null,s.createElement(T._,{tooltip:"The profiles data source the trace is going to navigate to",label:"Data source",labelWidth:26},s.createElement(xt.q,{inputId:"trace-to-profiles-data-source-picker",filter:d=>a.includes(d.type),current:e.jsonData.tracesToProfiles?.datasourceUid,noDefault:!0,width:40,onChange:d=>{(0,X.tp)({onOptionsChange:t,options:e},"tracesToProfiles",{...e.jsonData.tracesToProfiles,datasourceUid:d.uid})}}))),s.createElement(R.Z,null,s.createElement(T._,{tooltip:"Tags that will be used in the query. Default tags: 'service.name', 'service.namespace'",label:"Tags",labelWidth:26},s.createElement(bs.a,{values:e.jsonData.tracesToProfiles?.tags??[],onChange:d=>{(0,X.tp)({onOptionsChange:t,options:e},"tracesToProfiles",{...e.jsonData.tracesToProfiles,tags:d})}}))),s.createElement(R.Z,null,s.createElement(T._,{tooltip:"Profile type that will be used in the query",label:"Profile type",labelWidth:26},s.createElement(ys.o,{profileTypes:r,placeholder:l,initialProfileTypeId:e.jsonData.tracesToProfiles?.profileTypeId,onChange:d=>{(0,X.tp)({onOptionsChange:t,options:e},"tracesToProfiles",{...e.jsonData.tracesToProfiles,profileTypeId:d})},width:40}))),s.createElement(R.Z,null,s.createElement(T._,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26},s.createElement(Qt.x,{id:"profilesCustomQuerySwitch",value:e.jsonData.tracesToProfiles?.customQuery,onChange:d=>(0,X.tp)({onOptionsChange:t,options:e},"tracesToProfiles",{...e.jsonData.tracesToProfiles,customQuery:d.currentTarget.checked})}))),e.jsonData.tracesToProfiles?.customQuery&&s.createElement(T._,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to profiles data source. Interpolate tags using the `$__tags` keyword",grow:!0},s.createElement(Ce.I,{label:"Query",type:"text",allowFullScreen:!0,value:e.jsonData.tracesToProfiles?.query||"",onChange:d=>(0,X.tp)({onOptionsChange:t,options:e},"tracesToProfiles",{...e.jsonData.tracesToProfiles,query:d.currentTarget.value})})))}const xs=({options:e,onOptionsChange:t})=>s.createElement(oa.K,{title:"Trace to profiles",description:s.createElement(_e.W,{description:"Navigate from a trace span to the selected data source's profiles.",suffix:`${e.type}/#trace-to-profiles`,feature:"trace to profiles"}),isCollapsible:!0,isInitiallyOpen:!0},s.createElement(Qs,{options:e,onOptionsChange:t}));var Ps=o(18180),da=o(4200);function Rs({options:e,onOptionsChange:t}){const a=(0,b.wW)(Je),r=l=>`Time shift for ${l} of search`,n=l=>`Shifts the ${l} of the time range when searching by TraceID. Searching can return traces that do not fully fall into the search time range, so we recommend using higher time shifts for longer traces. Default: 30m (Time units can be used here, for example: 5s, 1m, 3h`;return s.createElement("div",{className:a.container},s.createElement(T._,{label:"Use time range in query",tooltip:"The time range can be used when there are performance issues or timeouts since it will narrow down the search to the defined range. Default: disabled",labelWidth:26},s.createElement(Qt.x,{id:"enable-time-shift",value:e.jsonData.traceQuery?.timeShiftEnabled||!1,onChange:l=>{(0,X.tp)({onOptionsChange:t,options:e},"traceQuery",{...e.jsonData.traceQuery,timeShiftEnabled:l.currentTarget.checked})}})),s.createElement(da.w,{label:r("start"),tooltip:n("start"),value:e.jsonData.traceQuery?.spanStartTimeShift||"",disabled:!e.jsonData.traceQuery?.timeShiftEnabled,onChange:l=>{(0,X.tp)({onOptionsChange:t,options:e},"traceQuery",{...e.jsonData.traceQuery,spanStartTimeShift:l})},isInvalidError:bt.Ny}),s.createElement(da.w,{label:r("end"),tooltip:n("end"),value:e.jsonData.traceQuery?.spanEndTimeShift||"",disabled:!e.jsonData.traceQuery?.timeShiftEnabled,onChange:l=>{(0,X.tp)({onOptionsChange:t,options:e},"traceQuery",{...e.jsonData.traceQuery,spanEndTimeShift:l})},isInvalidError:bt.Ny}))}const Je=e=>({infoText:(0,x.css)`
    padding-bottom: ${e.spacing(2)};
    color: ${e.colors.text.secondary};
  `,container:(0,x.css)`
    width: 100%;
  `,row:(0,x.css)`
    align-items: baseline;
  `});function ws({options:e,onOptionsChange:t}){const a=(0,b.wW)(Je),r=e.jsonData.tracesToLogs?.lokiSearch!==!1?e.jsonData.tracesToLogs?.datasourceUid:void 0;return r&&e.jsonData.lokiSearch===void 0&&(0,X.tp)({onOptionsChange:t,options:e},"lokiSearch",{datasourceUid:r}),s.createElement("div",{className:a.container},s.createElement(R.Z,{className:a.row},s.createElement(T._,{tooltip:"The Loki data source with the service graph data",label:"Data source",labelWidth:26},s.createElement(xt.q,{inputId:"loki-search-data-source-picker",pluginId:"loki",current:e.jsonData.lokiSearch?.datasourceUid,noDefault:!0,width:40,onChange:n=>(0,X.tp)({onOptionsChange:t,options:e},"lokiSearch",{datasourceUid:n.uid})})),e.jsonData.lokiSearch?.datasourceUid?s.createElement(_.zx,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,X.tp)({onOptionsChange:t,options:e},"lokiSearch",{datasourceUid:void 0})}},"Clear"):null))}function Ds({options:e,onOptionsChange:t}){const a=(0,b.wW)(Je);return s.createElement("div",{className:a.container},s.createElement(R.Z,{className:a.row},s.createElement(T._,{tooltip:"The Prometheus data source with the service graph data",label:"Data source",labelWidth:26},s.createElement(xt.q,{inputId:"service-graph-data-source-picker",pluginId:"prometheus",current:e.jsonData.serviceMap?.datasourceUid,noDefault:!0,width:40,onChange:r=>(0,X.tp)({onOptionsChange:t,options:e},"serviceMap",{datasourceUid:r.uid})})),e.jsonData.serviceMap?.datasourceUid?s.createElement(_.zx,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,X.tp)({onOptionsChange:t,options:e},"serviceMap",{datasourceUid:void 0})}},"Clear"):null))}function Cs({options:e,onOptionsChange:t,datasource:a}){const r=async()=>{if(!a)throw new Error("Unable to retrieve datasource");try{await a.languageProvider.start()}catch(m){throw new Error(V(m.data.message,"Unable to query Tempo"))}},{error:n,loading:l}=(0,g.Z)(r,[a,e]),i=(0,s.useCallback)(m=>{let p=e.jsonData.search?.filters;p||=[];const h=p.findIndex(f=>f.id===m.id);h>=0?p=it(p,h,m):p.push(m),(0,X.tp)({onOptionsChange:t,options:e},"search",{...e.jsonData.search,filters:p})},[t,e]),d=m=>{(0,X.tp)({onOptionsChange:t,options:e},"search",{...e.jsonData.search,filters:e.jsonData.search?.filters?.filter(p=>p.id!==m.id)})};(0,s.useEffect)(()=>{e.jsonData.search?.filters||(0,X.tp)({onOptionsChange:t,options:e},"search",{...e.jsonData.search,filters:[{id:"service-name",tag:"service.name",operator:"=",scope:M.NM.Resource},{id:"span-name",tag:"name",operator:"=",scope:M.NM.Span}]})},[t,e]);const c=["duration"],u=e.jsonData.search?.filters?.find(m=>!m.tag);return s.createElement(s.Fragment,null,a?s.createElement(Yt,{updateFilter:i,deleteFilter:d,filters:e.jsonData.search?.filters||[],datasource:a,setError:()=>{},staticTags:c,isTagsLoading:l,hideValues:!0,query:"{}"}):s.createElement("div",null,"Invalid data source, please create a valid data source and try again"),n&&s.createElement(xe.b,{title:"Unable to fetch TraceQL tags",severity:"error",topSpacing:1},n.message),u&&s.createElement(xe.b,{title:"Please ensure each filter has a selected tag",severity:"warning",topSpacing:1}))}function Is({options:e,onOptionsChange:t}){const a=(0,b.wW)(Je),r=(0,z.F)(),n=async()=>await r.get({type:e.type,uid:e.uid}),{value:l}=(0,g.Z)(n,[r,e]);return s.createElement("div",{className:a.container},s.createElement(R.Z,{className:a.row},s.createElement(T._,{tooltip:"Removes the search tab from the query editor",label:"Hide search",labelWidth:26},s.createElement(Qt.x,{id:"hideSearch",value:e.jsonData.search?.hide,onChange:i=>(0,X.tp)({onOptionsChange:t,options:e},"search",{...e.jsonData.search,hide:i.currentTarget.checked})}))),s.createElement(R.Z,{className:a.row},s.createElement(T._,{tooltip:"Configures which fields are available in the UI",label:"Static filters",labelWidth:26},s.createElement(Cs,{datasource:l,options:e,onOptionsChange:t}))))}const Ns=({options:e,onOptionsChange:t})=>{const a=(0,b.wW)(Ms);return s.createElement("div",{className:a.container},s.createElement(ps.j,{dataSourceName:"Tempo",docsLink:"https://grafana.com/docs/grafana/latest/datasources/tempo",hasRequiredFields:!1}),s.createElement(J.i,null),s.createElement(ms.f,{config:e,onChange:t,urlPlaceholder:"http://localhost:3200"}),s.createElement(J.i,null),s.createElement(gs.g,{...(0,fs.T2)({config:e,onChange:t})}),s.createElement(J.i,null),s.createElement(bt.dw,{options:e,onOptionsChange:t}),s.createElement(J.i,null),Q.config.featureToggles.traceToMetrics?s.createElement(s.Fragment,null,s.createElement(Ss.Y,{options:e,onOptionsChange:t}),s.createElement(J.i,null)):null,Q.config.featureToggles.traceToProfiles&&s.createElement(s.Fragment,null,s.createElement(xs,{options:e,onOptionsChange:t}),s.createElement(J.i,null)),s.createElement(oa.K,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!1},s.createElement(hs.a,{config:e,onChange:t}),Q.config.secureSocksDSProxyEnabled&&s.createElement(s.Fragment,null,s.createElement(J.i,{hideLine:!0}),s.createElement(Os.i,{options:e,onOptionsChange:t})),s.createElement(J.i,{hideLine:!0}),s.createElement(He._,{title:"Service graph",description:s.createElement(_e.W,{description:"Select a Prometheus data source that contains the service graph data.",suffix:"tempo/configure-tempo-data-source/#service-graph",feature:"the service graph"})},s.createElement(Ds,{options:e,onOptionsChange:t})),s.createElement(J.i,{hideLine:!0}),s.createElement(vs.I,{options:e,onOptionsChange:t}),s.createElement(J.i,{hideLine:!0}),s.createElement(He._,{title:"Tempo search",description:s.createElement(_e.W,{description:"Modify how traces are searched.",suffix:"tempo/configure-tempo-data-source/#tempo-search",feature:"Tempo search"})},s.createElement(Is,{options:e,onOptionsChange:t})),s.createElement(J.i,{hideLine:!0}),s.createElement(He._,{title:"Loki search",description:s.createElement(_e.W,{description:"Select a Loki data source to search for traces. Derived fields must be configured in the Loki data source.",suffix:"tempo/configure-tempo-data-source/#loki-search",feature:"Loki search"})},s.createElement(ws,{options:e,onOptionsChange:t})),s.createElement(J.i,{hideLine:!0}),s.createElement(He._,{title:"TraceID query",description:s.createElement(_e.W,{description:"Modify how TraceID queries are run.",suffix:"tempo/configure-tempo-data-source/#traceid-query",feature:"the TraceID query"})},s.createElement(Rs,{options:e,onOptionsChange:t})),s.createElement(J.i,{hideLine:!0}),s.createElement(Ps.vc,{options:e,onOptionsChange:t})))},Ms=e=>({container:(0,x.css)`
    label: container;
    margin-bottom: ${e.spacing(2)};
    max-width: 900px;
  `});var $s=o(35630);const Ls=({payload:{dashboardId:e,orgId:t,grafanaVersion:a,queries:r}})=>{try{const n=r[$s.id];if(!n?.length)return;let l={grafana_version:a,dashboard_id:e,org_id:t,native_search_query_count:0,search_query_count:0,service_map_query_count:0,traceql_query_count:0,upload_query_count:0,native_search_queries_with_template_variables_count:0,search_queries_with_template_variables_count:0,service_map_queries_with_template_variables_count:0,traceql_queries_with_template_variables_count:0};for(const i of n)i.hide||(i.queryType==="nativeSearch"?(l.native_search_query_count++,(i.serviceName&&fe(i.serviceName)||i.spanName&&fe(i.spanName)||i.search&&fe(i.search)||i.minDuration&&fe(i.minDuration)||i.maxDuration&&fe(i.maxDuration))&&l.native_search_queries_with_template_variables_count++):i.queryType==="search"?(l.search_query_count++,i.linkedQuery&&i.linkedQuery.expr&&fe(i.linkedQuery.expr)&&l.search_queries_with_template_variables_count++):i.queryType==="serviceMap"?(l.service_map_query_count++,i.serviceMapQuery&&fe(i.serviceMapQuery)&&l.service_map_queries_with_template_variables_count++):i.queryType==="traceql"?(l.traceql_query_count++,fe(i.query)&&l.traceql_queries_with_template_variables_count++):i.queryType==="upload"&&l.upload_query_count++);(0,I.ff)("grafana_tempo_dashboard_loaded",l)}catch(n){console.error("error in tempo tracking handler",n)}},fe=e=>(0,Oe.J)().containsTemplate(e),zs=new y.hf(Ja).setQueryEditor(us).setConfigEditor(Ns).setQueryEditorHelp(S);(0,L.N$)().subscribe(O.Pl,Ls)}}]);

//# sourceMappingURL=8631.c3db84ef0c5badf8452a.js.map